function u(o,s){const i=new Date(o),r=new Date(s).getTime()-i.getTime(),t=Math.ceil(r/(1e3*60*60*24));return Math.max(1,t+1)}function p(o,s){const e=new Date(o).getTime()-s.getTime();return Math.floor(e/(1e3*60*60*24))}function S(o,s){const i=[];for(const e of o.phases??[]){i.push({id:`phase-${e.id}`,type:"phase",entityId:e.id,name:e.name,startDate:new Date(e.start_date),endDate:new Date(e.end_date),duration:u(e.start_date,e.end_date),dependencies:e.dependencies??[],earlyStart:p(e.start_date,s),earlyFinish:0,lateStart:0,lateFinish:0,totalFloat:0});const r=t=>{for(const n of t)i.push({id:`subphase-${n.id}`,type:"subphase",entityId:n.id,name:n.name,startDate:new Date(n.start_date),endDate:new Date(n.end_date),duration:u(n.start_date,n.end_date),dependencies:n.dependencies??[],earlyStart:p(n.start_date,s),earlyFinish:0,lateStart:0,lateFinish:0,totalFloat:0}),n.children?.length&&r(n.children)};e.children?.length&&r(e.children)}return i}function F(o,s){const i=[...o].sort((e,r)=>e.earlyStart-r.earlyStart);for(const e of i){e.earlyFinish=e.earlyStart+e.duration-1;for(const r of e.dependencies){const t=`phase-${r.id}`,n=`subphase-${r.id}`,d=s.get(t)||s.get(n);if(d){let c;const a=r.lag??0;switch(r.type){case"FS":c=d.earlyFinish+1+a;break;case"SS":c=d.earlyStart+a;break;case"FF":c=d.earlyFinish-e.duration+1+a;break;case"SF":c=d.earlyStart-e.duration+1+a;break;default:c=d.earlyFinish+1+a}c>e.earlyStart&&(e.earlyStart=c,e.earlyFinish=e.earlyStart+e.duration-1)}}}}function y(o,s,i){for(const t of o)t.lateFinish=i,t.lateStart=t.lateFinish-t.duration+1;const e=[...o].sort((t,n)=>n.earlyFinish-t.earlyFinish),r=new Map;for(const t of o)for(const n of t.dependencies){const d=`phase-${n.id}`,c=`subphase-${n.id}`,a=s.get(d)||s.get(c);a&&(r.has(a.id)||r.set(a.id,[]),r.get(a.id).push({node:t,dep:n}))}for(const t of e){const n=r.get(t.id)||[];for(const{node:d,dep:c}of n){let a;const l=c.lag??0;switch(c.type){case"FS":a=d.lateStart-1-l;break;case"SS":a=d.lateStart+t.duration-1-l;break;case"FF":a=d.lateFinish-l;break;case"SF":a=d.lateFinish+t.duration-1-l;break;default:a=d.lateStart-1-l}a<t.lateFinish&&(t.lateFinish=a,t.lateStart=t.lateFinish-t.duration+1)}}}function g(o){for(const s of o)s.totalFloat=s.lateStart-s.earlyStart}function b(o){const s=new Set;for(const i of o)i.totalFloat<=0&&s.add(i.id);return s}function D(o){const s=o.phases??[];if(s.length===0)return{criticalItems:new Set,hasDependencies:!1};let i=!1;for(const a of s){if(a.dependencies?.length>0){i=!0;break}const l=f=>{for(const h of f)if(h.dependencies?.length>0||h.children?.length&&l(h.children))return!0;return!1};if(a.children?.length&&l(a.children)){i=!0;break}}let e=null,r=null;for(const a of s){const l=new Date(a.start_date),f=new Date(a.end_date);(!e||l<e)&&(e=l),(!r||f>r)&&(r=f)}if(!e||!r)return{criticalItems:new Set,hasDependencies:i};const t=S(o,e);if(t.length===0)return{criticalItems:new Set,hasDependencies:i};const n=new Map;for(const a of t)n.set(a.id,a);const d=Math.ceil((r.getTime()-e.getTime())/(1e3*60*60*24));return F(t,n),y(t,n,d),g(t),{criticalItems:b(t),hasDependencies:i}}export{D as calculateCriticalPath};
//# sourceMappingURL=criticalPath-CabRwJM7.js.map
