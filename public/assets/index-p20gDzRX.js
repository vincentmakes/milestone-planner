(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const u of d.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function r(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function i(l){if(l.ep)return;l.ep=!0;const d=r(l);fetch(l.href,d)}})();function n1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ed={exports:{}},Xr={},td={exports:{}},Xe={};var Af;function s1(){if(Af)return Xe;Af=1;var n=Symbol.for("react.element"),s=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),u=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),y=Symbol.iterator;function b(N){return N===null||typeof N!="object"?null:(N=y&&N[y]||N["@@iterator"],typeof N=="function"?N:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,_={};function S(N,W,K){this.props=N,this.context=W,this.refs=_,this.updater=K||w}S.prototype.isReactComponent={},S.prototype.setState=function(N,W){if(typeof N!="object"&&typeof N!="function"&&N!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,N,W,"setState")},S.prototype.forceUpdate=function(N){this.updater.enqueueForceUpdate(this,N,"forceUpdate")};function C(){}C.prototype=S.prototype;function B(N,W,K){this.props=N,this.context=W,this.refs=_,this.updater=K||w}var D=B.prototype=new C;D.constructor=B,x(D,S.prototype),D.isPureReactComponent=!0;var O=Array.isArray,z=Object.prototype.hasOwnProperty,R={current:null},Q={key:!0,ref:!0,__self:!0,__source:!0};function H(N,W,K){var te,Y={},me=null,ge=null;if(W!=null)for(te in W.ref!==void 0&&(ge=W.ref),W.key!==void 0&&(me=""+W.key),W)z.call(W,te)&&!Q.hasOwnProperty(te)&&(Y[te]=W[te]);var pe=arguments.length-2;if(pe===1)Y.children=K;else if(1<pe){for(var oe=Array(pe),le=0;le<pe;le++)oe[le]=arguments[le+2];Y.children=oe}if(N&&N.defaultProps)for(te in pe=N.defaultProps,pe)Y[te]===void 0&&(Y[te]=pe[te]);return{$$typeof:n,type:N,key:me,ref:ge,props:Y,_owner:R.current}}function J(N,W){return{$$typeof:n,type:N.type,key:W,ref:N.ref,props:N.props,_owner:N._owner}}function q(N){return typeof N=="object"&&N!==null&&N.$$typeof===n}function E(N){var W={"=":"=0",":":"=2"};return"$"+N.replace(/[=:]/g,function(K){return W[K]})}var L=/\/+/g;function $(N,W){return typeof N=="object"&&N!==null&&N.key!=null?E(""+N.key):W.toString(36)}function M(N,W,K,te,Y){var me=typeof N;(me==="undefined"||me==="boolean")&&(N=null);var ge=!1;if(N===null)ge=!0;else switch(me){case"string":case"number":ge=!0;break;case"object":switch(N.$$typeof){case n:case s:ge=!0}}if(ge)return ge=N,Y=Y(ge),N=te===""?"."+$(ge,0):te,O(Y)?(K="",N!=null&&(K=N.replace(L,"$&/")+"/"),M(Y,W,K,"",function(le){return le})):Y!=null&&(q(Y)&&(Y=J(Y,K+(!Y.key||ge&&ge.key===Y.key?"":(""+Y.key).replace(L,"$&/")+"/")+N)),W.push(Y)),1;if(ge=0,te=te===""?".":te+":",O(N))for(var pe=0;pe<N.length;pe++){me=N[pe];var oe=te+$(me,pe);ge+=M(me,W,K,oe,Y)}else if(oe=b(N),typeof oe=="function")for(N=oe.call(N),pe=0;!(me=N.next()).done;)me=me.value,oe=te+$(me,pe++),ge+=M(me,W,K,oe,Y);else if(me==="object")throw W=String(N),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(N).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.");return ge}function k(N,W,K){if(N==null)return N;var te=[],Y=0;return M(N,te,"","",function(me){return W.call(K,me,Y++)}),te}function P(N){if(N._status===-1){var W=N._result;W=W(),W.then(function(K){(N._status===0||N._status===-1)&&(N._status=1,N._result=K)},function(K){(N._status===0||N._status===-1)&&(N._status=2,N._result=K)}),N._status===-1&&(N._status=0,N._result=W)}if(N._status===1)return N._result.default;throw N._result}var F={current:null},A={transition:null},I={ReactCurrentDispatcher:F,ReactCurrentBatchConfig:A,ReactCurrentOwner:R};function U(){throw Error("act(...) is not supported in production builds of React.")}return Xe.Children={map:k,forEach:function(N,W,K){k(N,function(){W.apply(this,arguments)},K)},count:function(N){var W=0;return k(N,function(){W++}),W},toArray:function(N){return k(N,function(W){return W})||[]},only:function(N){if(!q(N))throw Error("React.Children.only expected to receive a single React element child.");return N}},Xe.Component=S,Xe.Fragment=r,Xe.Profiler=l,Xe.PureComponent=B,Xe.StrictMode=i,Xe.Suspense=p,Xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I,Xe.act=U,Xe.cloneElement=function(N,W,K){if(N==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+N+".");var te=x({},N.props),Y=N.key,me=N.ref,ge=N._owner;if(W!=null){if(W.ref!==void 0&&(me=W.ref,ge=R.current),W.key!==void 0&&(Y=""+W.key),N.type&&N.type.defaultProps)var pe=N.type.defaultProps;for(oe in W)z.call(W,oe)&&!Q.hasOwnProperty(oe)&&(te[oe]=W[oe]===void 0&&pe!==void 0?pe[oe]:W[oe])}var oe=arguments.length-2;if(oe===1)te.children=K;else if(1<oe){pe=Array(oe);for(var le=0;le<oe;le++)pe[le]=arguments[le+2];te.children=pe}return{$$typeof:n,type:N.type,key:Y,ref:me,props:te,_owner:ge}},Xe.createContext=function(N){return N={$$typeof:u,_currentValue:N,_currentValue2:N,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},N.Provider={$$typeof:d,_context:N},N.Consumer=N},Xe.createElement=H,Xe.createFactory=function(N){var W=H.bind(null,N);return W.type=N,W},Xe.createRef=function(){return{current:null}},Xe.forwardRef=function(N){return{$$typeof:h,render:N}},Xe.isValidElement=q,Xe.lazy=function(N){return{$$typeof:v,_payload:{_status:-1,_result:N},_init:P}},Xe.memo=function(N,W){return{$$typeof:m,type:N,compare:W===void 0?null:W}},Xe.startTransition=function(N){var W=A.transition;A.transition={};try{N()}finally{A.transition=W}},Xe.unstable_act=U,Xe.useCallback=function(N,W){return F.current.useCallback(N,W)},Xe.useContext=function(N){return F.current.useContext(N)},Xe.useDebugValue=function(){},Xe.useDeferredValue=function(N){return F.current.useDeferredValue(N)},Xe.useEffect=function(N,W){return F.current.useEffect(N,W)},Xe.useId=function(){return F.current.useId()},Xe.useImperativeHandle=function(N,W,K){return F.current.useImperativeHandle(N,W,K)},Xe.useInsertionEffect=function(N,W){return F.current.useInsertionEffect(N,W)},Xe.useLayoutEffect=function(N,W){return F.current.useLayoutEffect(N,W)},Xe.useMemo=function(N,W){return F.current.useMemo(N,W)},Xe.useReducer=function(N,W,K){return F.current.useReducer(N,W,K)},Xe.useRef=function(N){return F.current.useRef(N)},Xe.useState=function(N){return F.current.useState(N)},Xe.useSyncExternalStore=function(N,W,K){return F.current.useSyncExternalStore(N,W,K)},Xe.useTransition=function(){return F.current.useTransition()},Xe.version="18.3.1",Xe}var Rf;function Fd(){return Rf||(Rf=1,td.exports=s1()),td.exports}var Bf;function a1(){if(Bf)return Xr;Bf=1;var n=Fd(),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function u(h,p,m){var v,y={},b=null,w=null;m!==void 0&&(b=""+m),p.key!==void 0&&(b=""+p.key),p.ref!==void 0&&(w=p.ref);for(v in p)i.call(p,v)&&!d.hasOwnProperty(v)&&(y[v]=p[v]);if(h&&h.defaultProps)for(v in p=h.defaultProps,p)y[v]===void 0&&(y[v]=p[v]);return{$$typeof:s,type:h,key:b,ref:w,props:y,_owner:l.current}}return Xr.Fragment=r,Xr.jsx=u,Xr.jsxs=u,Xr}var Of;function r1(){return Of||(Of=1,ed.exports=a1()),ed.exports}var e=r1(),f=Fd();const Eo=n1(f);var $o={},nd={exports:{}},kn={},sd={exports:{}},ad={};var Ff;function i1(){return Ff||(Ff=1,(function(n){function s(A,I){var U=A.length;A.push(I);e:for(;0<U;){var N=U-1>>>1,W=A[N];if(0<l(W,I))A[N]=I,A[U]=W,U=N;else break e}}function r(A){return A.length===0?null:A[0]}function i(A){if(A.length===0)return null;var I=A[0],U=A.pop();if(U!==I){A[0]=U;e:for(var N=0,W=A.length,K=W>>>1;N<K;){var te=2*(N+1)-1,Y=A[te],me=te+1,ge=A[me];if(0>l(Y,U))me<W&&0>l(ge,Y)?(A[N]=ge,A[me]=U,N=me):(A[N]=Y,A[te]=U,N=te);else if(me<W&&0>l(ge,U))A[N]=ge,A[me]=U,N=me;else break e}}return I}function l(A,I){var U=A.sortIndex-I.sortIndex;return U!==0?U:A.id-I.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var u=Date,h=u.now();n.unstable_now=function(){return u.now()-h}}var p=[],m=[],v=1,y=null,b=3,w=!1,x=!1,_=!1,S=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function D(A){for(var I=r(m);I!==null;){if(I.callback===null)i(m);else if(I.startTime<=A)i(m),I.sortIndex=I.expirationTime,s(p,I);else break;I=r(m)}}function O(A){if(_=!1,D(A),!x)if(r(p)!==null)x=!0,P(z);else{var I=r(m);I!==null&&F(O,I.startTime-A)}}function z(A,I){x=!1,_&&(_=!1,C(H),H=-1),w=!0;var U=b;try{for(D(I),y=r(p);y!==null&&(!(y.expirationTime>I)||A&&!E());){var N=y.callback;if(typeof N=="function"){y.callback=null,b=y.priorityLevel;var W=N(y.expirationTime<=I);I=n.unstable_now(),typeof W=="function"?y.callback=W:y===r(p)&&i(p),D(I)}else i(p);y=r(p)}if(y!==null)var K=!0;else{var te=r(m);te!==null&&F(O,te.startTime-I),K=!1}return K}finally{y=null,b=U,w=!1}}var R=!1,Q=null,H=-1,J=5,q=-1;function E(){return!(n.unstable_now()-q<J)}function L(){if(Q!==null){var A=n.unstable_now();q=A;var I=!0;try{I=Q(!0,A)}finally{I?$():(R=!1,Q=null)}}else R=!1}var $;if(typeof B=="function")$=function(){B(L)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,k=M.port2;M.port1.onmessage=L,$=function(){k.postMessage(null)}}else $=function(){S(L,0)};function P(A){Q=A,R||(R=!0,$())}function F(A,I){H=S(function(){A(n.unstable_now())},I)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(A){A.callback=null},n.unstable_continueExecution=function(){x||w||(x=!0,P(z))},n.unstable_forceFrameRate=function(A){0>A||125<A?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<A?Math.floor(1e3/A):5},n.unstable_getCurrentPriorityLevel=function(){return b},n.unstable_getFirstCallbackNode=function(){return r(p)},n.unstable_next=function(A){switch(b){case 1:case 2:case 3:var I=3;break;default:I=b}var U=b;b=I;try{return A()}finally{b=U}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(A,I){switch(A){case 1:case 2:case 3:case 4:case 5:break;default:A=3}var U=b;b=A;try{return I()}finally{b=U}},n.unstable_scheduleCallback=function(A,I,U){var N=n.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?N+U:N):U=N,A){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=U+W,A={id:v++,callback:I,priorityLevel:A,startTime:U,expirationTime:W,sortIndex:-1},U>N?(A.sortIndex=U,s(m,A),r(p)===null&&A===r(m)&&(_?(C(H),H=-1):_=!0,F(O,U-N))):(A.sortIndex=W,s(p,A),x||w||(x=!0,P(z))),A},n.unstable_shouldYield=E,n.unstable_wrapCallback=function(A){var I=b;return function(){var U=b;b=I;try{return A.apply(this,arguments)}finally{b=U}}}})(ad)),ad}var zf;function o1(){return zf||(zf=1,sd.exports=i1()),sd.exports}var Hf;function l1(){if(Hf)return kn;Hf=1;var n=Fd(),s=o1();function r(t){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+t,o=1;o<arguments.length;o++)a+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+t+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,l={};function d(t,a){u(t,a),u(t+"Capture",a)}function u(t,a){for(l[t]=a,t=0;t<a.length;t++)i.add(a[t])}var h=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),p=Object.prototype.hasOwnProperty,m=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,v={},y={};function b(t){return p.call(y,t)?!0:p.call(v,t)?!1:m.test(t)?y[t]=!0:(v[t]=!0,!1)}function w(t,a,o,c){if(o!==null&&o.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return c?!1:o!==null?!o.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function x(t,a,o,c){if(a===null||typeof a>"u"||w(t,a,o,c))return!0;if(c)return!1;if(o!==null)switch(o.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function _(t,a,o,c,g,j,T){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=c,this.attributeNamespace=g,this.mustUseProperty=o,this.propertyName=t,this.type=a,this.sanitizeURL=j,this.removeEmptyString=T}var S={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){S[t]=new _(t,0,!1,t,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var a=t[0];S[a]=new _(a,1,!1,t[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(t){S[t]=new _(t,2,!1,t.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){S[t]=new _(t,2,!1,t,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){S[t]=new _(t,3,!1,t.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(t){S[t]=new _(t,3,!0,t,null,!1,!1)}),["capture","download"].forEach(function(t){S[t]=new _(t,4,!1,t,null,!1,!1)}),["cols","rows","size","span"].forEach(function(t){S[t]=new _(t,6,!1,t,null,!1,!1)}),["rowSpan","start"].forEach(function(t){S[t]=new _(t,5,!1,t.toLowerCase(),null,!1,!1)});var C=/[\-:]([a-z])/g;function B(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var a=t.replace(C,B);S[a]=new _(a,1,!1,t,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var a=t.replace(C,B);S[a]=new _(a,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(t){var a=t.replace(C,B);S[a]=new _(a,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(t){S[t]=new _(t,1,!1,t.toLowerCase(),null,!1,!1)}),S.xlinkHref=new _("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(t){S[t]=new _(t,1,!1,t.toLowerCase(),null,!0,!0)});function D(t,a,o,c){var g=S.hasOwnProperty(a)?S[a]:null;(g!==null?g.type!==0:c||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(x(a,o,g,c)&&(o=null),c||g===null?b(a)&&(o===null?t.removeAttribute(a):t.setAttribute(a,""+o)):g.mustUseProperty?t[g.propertyName]=o===null?g.type===3?!1:"":o:(a=g.attributeName,c=g.attributeNamespace,o===null?t.removeAttribute(a):(g=g.type,o=g===3||g===4&&o===!0?"":""+o,c?t.setAttributeNS(c,a,o):t.setAttribute(a,o))))}var O=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,z=Symbol.for("react.element"),R=Symbol.for("react.portal"),Q=Symbol.for("react.fragment"),H=Symbol.for("react.strict_mode"),J=Symbol.for("react.profiler"),q=Symbol.for("react.provider"),E=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),$=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),F=Symbol.for("react.offscreen"),A=Symbol.iterator;function I(t){return t===null||typeof t!="object"?null:(t=A&&t[A]||t["@@iterator"],typeof t=="function"?t:null)}var U=Object.assign,N;function W(t){if(N===void 0)try{throw Error()}catch(o){var a=o.stack.trim().match(/\n( *(at )?)/);N=a&&a[1]||""}return`
`+N+t}var K=!1;function te(t,a){if(!t||K)return"";K=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(he){var c=he}Reflect.construct(t,[],a)}else{try{a.call()}catch(he){c=he}t.call(a.prototype)}else{try{throw Error()}catch(he){c=he}t()}}catch(he){if(he&&c&&typeof he.stack=="string"){for(var g=he.stack.split(`
`),j=c.stack.split(`
`),T=g.length-1,X=j.length-1;1<=T&&0<=X&&g[T]!==j[X];)X--;for(;1<=T&&0<=X;T--,X--)if(g[T]!==j[X]){if(T!==1||X!==1)do if(T--,X--,0>X||g[T]!==j[X]){var Z=`
`+g[T].replace(" at new "," at ");return t.displayName&&Z.includes("<anonymous>")&&(Z=Z.replace("<anonymous>",t.displayName)),Z}while(1<=T&&0<=X);break}}}finally{K=!1,Error.prepareStackTrace=o}return(t=t?t.displayName||t.name:"")?W(t):""}function Y(t){switch(t.tag){case 5:return W(t.type);case 16:return W("Lazy");case 13:return W("Suspense");case 19:return W("SuspenseList");case 0:case 2:case 15:return t=te(t.type,!1),t;case 11:return t=te(t.type.render,!1),t;case 1:return t=te(t.type,!0),t;default:return""}}function me(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Q:return"Fragment";case R:return"Portal";case J:return"Profiler";case H:return"StrictMode";case $:return"Suspense";case M:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case E:return(t.displayName||"Context")+".Consumer";case q:return(t._context.displayName||"Context")+".Provider";case L:var a=t.render;return t=t.displayName,t||(t=a.displayName||a.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case k:return a=t.displayName||null,a!==null?a:me(t.type)||"Memo";case P:a=t._payload,t=t._init;try{return me(t(a))}catch{}}return null}function ge(t){var a=t.type;switch(t.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=a.render,t=t.displayName||t.name||"",a.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return me(a);case 8:return a===H?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function pe(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function oe(t){var a=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function le(t){var a=oe(t)?"checked":"value",o=Object.getOwnPropertyDescriptor(t.constructor.prototype,a),c=""+t[a];if(!t.hasOwnProperty(a)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var g=o.get,j=o.set;return Object.defineProperty(t,a,{configurable:!0,get:function(){return g.call(this)},set:function(T){c=""+T,j.call(this,T)}}),Object.defineProperty(t,a,{enumerable:o.enumerable}),{getValue:function(){return c},setValue:function(T){c=""+T},stopTracking:function(){t._valueTracker=null,delete t[a]}}}}function se(t){t._valueTracker||(t._valueTracker=le(t))}function De(t){if(!t)return!1;var a=t._valueTracker;if(!a)return!0;var o=a.getValue(),c="";return t&&(c=oe(t)?t.checked?"true":"false":t.value),t=c,t!==o?(a.setValue(t),!0):!1}function We(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function ot(t,a){var o=a.checked;return U({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??t._wrapperState.initialChecked})}function ce(t,a){var o=a.defaultValue==null?"":a.defaultValue,c=a.checked!=null?a.checked:a.defaultChecked;o=pe(a.value!=null?a.value:o),t._wrapperState={initialChecked:c,initialValue:o,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function ae(t,a){a=a.checked,a!=null&&D(t,"checked",a,!1)}function ue(t,a){ae(t,a);var o=pe(a.value),c=a.type;if(o!=null)c==="number"?(o===0&&t.value===""||t.value!=o)&&(t.value=""+o):t.value!==""+o&&(t.value=""+o);else if(c==="submit"||c==="reset"){t.removeAttribute("value");return}a.hasOwnProperty("value")?ie(t,a.type,o):a.hasOwnProperty("defaultValue")&&ie(t,a.type,pe(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(t.defaultChecked=!!a.defaultChecked)}function we(t,a,o){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var c=a.type;if(!(c!=="submit"&&c!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+t._wrapperState.initialValue,o||a===t.value||(t.value=a),t.defaultValue=a}o=t.name,o!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,o!==""&&(t.name=o)}function ie(t,a,o){(a!=="number"||We(t.ownerDocument)!==t)&&(o==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+o&&(t.defaultValue=""+o))}var Ae=Array.isArray;function Bt(t,a,o,c){if(t=t.options,a){a={};for(var g=0;g<o.length;g++)a["$"+o[g]]=!0;for(o=0;o<t.length;o++)g=a.hasOwnProperty("$"+t[o].value),t[o].selected!==g&&(t[o].selected=g),g&&c&&(t[o].defaultSelected=!0)}else{for(o=""+pe(o),a=null,g=0;g<t.length;g++){if(t[g].value===o){t[g].selected=!0,c&&(t[g].defaultSelected=!0);return}a!==null||t[g].disabled||(a=t[g])}a!==null&&(a.selected=!0)}}function Es(t,a){if(a.dangerouslySetInnerHTML!=null)throw Error(r(91));return U({},a,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function $s(t,a){var o=a.value;if(o==null){if(o=a.children,a=a.defaultValue,o!=null){if(a!=null)throw Error(r(92));if(Ae(o)){if(1<o.length)throw Error(r(93));o=o[0]}a=o}a==null&&(a=""),o=a}t._wrapperState={initialValue:pe(o)}}function Xn(t,a){var o=pe(a.value),c=pe(a.defaultValue);o!=null&&(o=""+o,o!==t.value&&(t.value=o),a.defaultValue==null&&t.defaultValue!==o&&(t.defaultValue=o)),c!=null&&(t.defaultValue=""+c)}function Ts(t){var a=t.textContent;a===t._wrapperState.initialValue&&a!==""&&a!==null&&(t.value=a)}function dr(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Da(t,a){return t==null||t==="http://www.w3.org/1999/xhtml"?dr(a):t==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ea,ur=(function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,o,c,g){MSApp.execUnsafeLocalFunction(function(){return t(a,o,c,g)})}:t})(function(t,a){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=a;else{for(Ea=Ea||document.createElement("div"),Ea.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=Ea.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;a.firstChild;)t.appendChild(a.firstChild)}});function oa(t,a){if(a){var o=t.firstChild;if(o&&o===t.lastChild&&o.nodeType===3){o.nodeValue=a;return}}t.textContent=a}var la={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_l=["Webkit","ms","Moz","O"];Object.keys(la).forEach(function(t){_l.forEach(function(a){a=a+t.charAt(0).toUpperCase()+t.substring(1),la[a]=la[t]})});function Ms(t,a,o){return a==null||typeof a=="boolean"||a===""?"":o||typeof a!="number"||a===0||la.hasOwnProperty(t)&&la[t]?(""+a).trim():a+"px"}function hr(t,a){t=t.style;for(var o in a)if(a.hasOwnProperty(o)){var c=o.indexOf("--")===0,g=Ms(o,a[o],c);o==="float"&&(o="cssFloat"),c?t.setProperty(o,g):t[o]=g}}var yl=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fr(t,a){if(a){if(yl[t]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(r(137,t));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(r(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(r(61))}if(a.style!=null&&typeof a.style!="object")throw Error(r(62))}}function $a(t,a){if(t.indexOf("-")===-1)return typeof a.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mr=null;function pr(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var gr=null,Ps=null,de=null;function $e(t){if(t=Lr(t)){if(typeof gr!="function")throw Error(r(280));var a=t.stateNode;a&&(a=Wi(a),gr(t.stateNode,t.type,a))}}function Le(t){Ps?de?de.push(t):de=[t]:Ps=t}function Ge(){if(Ps){var t=Ps,a=de;if(de=Ps=null,$e(t),a)for(t=0;t<a.length;t++)$e(a[t])}}function Ue(t,a){return t(a)}function lt(){}var gt=!1;function ut(t,a,o){if(gt)return t(a,o);gt=!0;try{return Ue(t,a,o)}finally{gt=!1,(Ps!==null||de!==null)&&(lt(),Ge())}}function ln(t,a){var o=t.stateNode;if(o===null)return null;var c=Wi(o);if(c===null)return null;o=c[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(t=t.type,c=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!c;break e;default:t=!1}if(t)return null;if(o&&typeof o!="function")throw Error(r(231,a,typeof o));return o}var Et=!1;if(h)try{var Nn={};Object.defineProperty(Nn,"passive",{get:function(){Et=!0}}),window.addEventListener("test",Nn,Nn),window.removeEventListener("test",Nn,Nn)}catch{Et=!1}function xi(t,a,o,c,g,j,T,X,Z){var he=Array.prototype.slice.call(arguments,3);try{a.apply(o,he)}catch(ye){this.onError(ye)}}var ca=!1,ji=null,wi=!1,vl=null,cg={onError:function(t){ca=!0,ji=t}};function dg(t,a,o,c,g,j,T,X,Z){ca=!1,ji=null,xi.apply(cg,arguments)}function ug(t,a,o,c,g,j,T,X,Z){if(dg.apply(this,arguments),ca){if(ca){var he=ji;ca=!1,ji=null}else throw Error(r(198));wi||(wi=!0,vl=he)}}function da(t){var a=t,o=t;if(t.alternate)for(;a.return;)a=a.return;else{t=a;do a=t,(a.flags&4098)!==0&&(o=a.return),t=a.return;while(t)}return a.tag===3?o:null}function au(t){if(t.tag===13){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function ru(t){if(da(t)!==t)throw Error(r(188))}function hg(t){var a=t.alternate;if(!a){if(a=da(t),a===null)throw Error(r(188));return a!==t?null:t}for(var o=t,c=a;;){var g=o.return;if(g===null)break;var j=g.alternate;if(j===null){if(c=g.return,c!==null){o=c;continue}break}if(g.child===j.child){for(j=g.child;j;){if(j===o)return ru(g),t;if(j===c)return ru(g),a;j=j.sibling}throw Error(r(188))}if(o.return!==c.return)o=g,c=j;else{for(var T=!1,X=g.child;X;){if(X===o){T=!0,o=g,c=j;break}if(X===c){T=!0,c=g,o=j;break}X=X.sibling}if(!T){for(X=j.child;X;){if(X===o){T=!0,o=j,c=g;break}if(X===c){T=!0,c=j,o=g;break}X=X.sibling}if(!T)throw Error(r(189))}}if(o.alternate!==c)throw Error(r(190))}if(o.tag!==3)throw Error(r(188));return o.stateNode.current===o?t:a}function iu(t){return t=hg(t),t!==null?ou(t):null}function ou(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var a=ou(t);if(a!==null)return a;t=t.sibling}return null}var lu=s.unstable_scheduleCallback,cu=s.unstable_cancelCallback,fg=s.unstable_shouldYield,mg=s.unstable_requestPaint,Ot=s.unstable_now,pg=s.unstable_getCurrentPriorityLevel,xl=s.unstable_ImmediatePriority,du=s.unstable_UserBlockingPriority,Si=s.unstable_NormalPriority,gg=s.unstable_LowPriority,uu=s.unstable_IdlePriority,Ci=null,ls=null;function _g(t){if(ls&&typeof ls.onCommitFiberRoot=="function")try{ls.onCommitFiberRoot(Ci,t,void 0,(t.current.flags&128)===128)}catch{}}var Kn=Math.clz32?Math.clz32:xg,yg=Math.log,vg=Math.LN2;function xg(t){return t>>>=0,t===0?32:31-(yg(t)/vg|0)|0}var bi=64,ki=4194304;function _r(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ni(t,a){var o=t.pendingLanes;if(o===0)return 0;var c=0,g=t.suspendedLanes,j=t.pingedLanes,T=o&268435455;if(T!==0){var X=T&~g;X!==0?c=_r(X):(j&=T,j!==0&&(c=_r(j)))}else T=o&~g,T!==0?c=_r(T):j!==0&&(c=_r(j));if(c===0)return 0;if(a!==0&&a!==c&&(a&g)===0&&(g=c&-c,j=a&-a,g>=j||g===16&&(j&4194240)!==0))return a;if((c&4)!==0&&(c|=o&16),a=t.entangledLanes,a!==0)for(t=t.entanglements,a&=c;0<a;)o=31-Kn(a),g=1<<o,c|=t[o],a&=~g;return c}function jg(t,a){switch(t){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wg(t,a){for(var o=t.suspendedLanes,c=t.pingedLanes,g=t.expirationTimes,j=t.pendingLanes;0<j;){var T=31-Kn(j),X=1<<T,Z=g[T];Z===-1?((X&o)===0||(X&c)!==0)&&(g[T]=jg(X,a)):Z<=a&&(t.expiredLanes|=X),j&=~X}}function jl(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function hu(){var t=bi;return bi<<=1,(bi&4194240)===0&&(bi=64),t}function wl(t){for(var a=[],o=0;31>o;o++)a.push(t);return a}function yr(t,a,o){t.pendingLanes|=a,a!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,a=31-Kn(a),t[a]=o}function Sg(t,a){var o=t.pendingLanes&~a;t.pendingLanes=a,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=a,t.mutableReadLanes&=a,t.entangledLanes&=a,a=t.entanglements;var c=t.eventTimes;for(t=t.expirationTimes;0<o;){var g=31-Kn(o),j=1<<g;a[g]=0,c[g]=-1,t[g]=-1,o&=~j}}function Sl(t,a){var o=t.entangledLanes|=a;for(t=t.entanglements;o;){var c=31-Kn(o),g=1<<c;g&a|t[c]&a&&(t[c]|=a),o&=~g}}var ct=0;function fu(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var mu,Cl,pu,gu,_u,bl=!1,Di=[],Is=null,Ls=null,As=null,vr=new Map,xr=new Map,Rs=[],Cg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function yu(t,a){switch(t){case"focusin":case"focusout":Is=null;break;case"dragenter":case"dragleave":Ls=null;break;case"mouseover":case"mouseout":As=null;break;case"pointerover":case"pointerout":vr.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":xr.delete(a.pointerId)}}function jr(t,a,o,c,g,j){return t===null||t.nativeEvent!==j?(t={blockedOn:a,domEventName:o,eventSystemFlags:c,nativeEvent:j,targetContainers:[g]},a!==null&&(a=Lr(a),a!==null&&Cl(a)),t):(t.eventSystemFlags|=c,a=t.targetContainers,g!==null&&a.indexOf(g)===-1&&a.push(g),t)}function bg(t,a,o,c,g){switch(a){case"focusin":return Is=jr(Is,t,a,o,c,g),!0;case"dragenter":return Ls=jr(Ls,t,a,o,c,g),!0;case"mouseover":return As=jr(As,t,a,o,c,g),!0;case"pointerover":var j=g.pointerId;return vr.set(j,jr(vr.get(j)||null,t,a,o,c,g)),!0;case"gotpointercapture":return j=g.pointerId,xr.set(j,jr(xr.get(j)||null,t,a,o,c,g)),!0}return!1}function vu(t){var a=ua(t.target);if(a!==null){var o=da(a);if(o!==null){if(a=o.tag,a===13){if(a=au(o),a!==null){t.blockedOn=a,_u(t.priority,function(){pu(o)});return}}else if(a===3&&o.stateNode.current.memoizedState.isDehydrated){t.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ei(t){if(t.blockedOn!==null)return!1;for(var a=t.targetContainers;0<a.length;){var o=Nl(t.domEventName,t.eventSystemFlags,a[0],t.nativeEvent);if(o===null){o=t.nativeEvent;var c=new o.constructor(o.type,o);mr=c,o.target.dispatchEvent(c),mr=null}else return a=Lr(o),a!==null&&Cl(a),t.blockedOn=o,!1;a.shift()}return!0}function xu(t,a,o){Ei(t)&&o.delete(a)}function kg(){bl=!1,Is!==null&&Ei(Is)&&(Is=null),Ls!==null&&Ei(Ls)&&(Ls=null),As!==null&&Ei(As)&&(As=null),vr.forEach(xu),xr.forEach(xu)}function wr(t,a){t.blockedOn===a&&(t.blockedOn=null,bl||(bl=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,kg)))}function Sr(t){function a(g){return wr(g,t)}if(0<Di.length){wr(Di[0],t);for(var o=1;o<Di.length;o++){var c=Di[o];c.blockedOn===t&&(c.blockedOn=null)}}for(Is!==null&&wr(Is,t),Ls!==null&&wr(Ls,t),As!==null&&wr(As,t),vr.forEach(a),xr.forEach(a),o=0;o<Rs.length;o++)c=Rs[o],c.blockedOn===t&&(c.blockedOn=null);for(;0<Rs.length&&(o=Rs[0],o.blockedOn===null);)vu(o),o.blockedOn===null&&Rs.shift()}var Ta=O.ReactCurrentBatchConfig,$i=!0;function Ng(t,a,o,c){var g=ct,j=Ta.transition;Ta.transition=null;try{ct=1,kl(t,a,o,c)}finally{ct=g,Ta.transition=j}}function Dg(t,a,o,c){var g=ct,j=Ta.transition;Ta.transition=null;try{ct=4,kl(t,a,o,c)}finally{ct=g,Ta.transition=j}}function kl(t,a,o,c){if($i){var g=Nl(t,a,o,c);if(g===null)ql(t,a,c,Ti,o),yu(t,c);else if(bg(g,t,a,o,c))c.stopPropagation();else if(yu(t,c),a&4&&-1<Cg.indexOf(t)){for(;g!==null;){var j=Lr(g);if(j!==null&&mu(j),j=Nl(t,a,o,c),j===null&&ql(t,a,c,Ti,o),j===g)break;g=j}g!==null&&c.stopPropagation()}else ql(t,a,c,null,o)}}var Ti=null;function Nl(t,a,o,c){if(Ti=null,t=pr(c),t=ua(t),t!==null)if(a=da(t),a===null)t=null;else if(o=a.tag,o===13){if(t=au(a),t!==null)return t;t=null}else if(o===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;t=null}else a!==t&&(t=null);return Ti=t,null}function ju(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(pg()){case xl:return 1;case du:return 4;case Si:case gg:return 16;case uu:return 536870912;default:return 16}default:return 16}}var Bs=null,Dl=null,Mi=null;function wu(){if(Mi)return Mi;var t,a=Dl,o=a.length,c,g="value"in Bs?Bs.value:Bs.textContent,j=g.length;for(t=0;t<o&&a[t]===g[t];t++);var T=o-t;for(c=1;c<=T&&a[o-c]===g[j-c];c++);return Mi=g.slice(t,1<c?1-c:void 0)}function Pi(t){var a=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&a===13&&(t=13)):t=a,t===10&&(t=13),32<=t||t===13?t:0}function Ii(){return!0}function Su(){return!1}function Dn(t){function a(o,c,g,j,T){this._reactName=o,this._targetInst=g,this.type=c,this.nativeEvent=j,this.target=T,this.currentTarget=null;for(var X in t)t.hasOwnProperty(X)&&(o=t[X],this[X]=o?o(j):j[X]);return this.isDefaultPrevented=(j.defaultPrevented!=null?j.defaultPrevented:j.returnValue===!1)?Ii:Su,this.isPropagationStopped=Su,this}return U(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Ii)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Ii)},persist:function(){},isPersistent:Ii}),a}var Ma={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},El=Dn(Ma),Cr=U({},Ma,{view:0,detail:0}),Eg=Dn(Cr),$l,Tl,br,Li=U({},Cr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pl,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==br&&(br&&t.type==="mousemove"?($l=t.screenX-br.screenX,Tl=t.screenY-br.screenY):Tl=$l=0,br=t),$l)},movementY:function(t){return"movementY"in t?t.movementY:Tl}}),Cu=Dn(Li),$g=U({},Li,{dataTransfer:0}),Tg=Dn($g),Mg=U({},Cr,{relatedTarget:0}),Ml=Dn(Mg),Pg=U({},Ma,{animationName:0,elapsedTime:0,pseudoElement:0}),Ig=Dn(Pg),Lg=U({},Ma,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Ag=Dn(Lg),Rg=U({},Ma,{data:0}),bu=Dn(Rg),Bg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Og={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Fg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zg(t){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(t):(t=Fg[t])?!!a[t]:!1}function Pl(){return zg}var Hg=U({},Cr,{key:function(t){if(t.key){var a=Bg[t.key]||t.key;if(a!=="Unidentified")return a}return t.type==="keypress"?(t=Pi(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Og[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pl,charCode:function(t){return t.type==="keypress"?Pi(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Pi(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Wg=Dn(Hg),qg=U({},Li,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ku=Dn(qg),Ug=U({},Cr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pl}),Vg=Dn(Ug),Gg=U({},Ma,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yg=Dn(Gg),Qg=U({},Li,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Xg=Dn(Qg),Kg=[9,13,27,32],Il=h&&"CompositionEvent"in window,kr=null;h&&"documentMode"in document&&(kr=document.documentMode);var Zg=h&&"TextEvent"in window&&!kr,Nu=h&&(!Il||kr&&8<kr&&11>=kr),Du=" ",Eu=!1;function $u(t,a){switch(t){case"keyup":return Kg.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Tu(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Pa=!1;function Jg(t,a){switch(t){case"compositionend":return Tu(a);case"keypress":return a.which!==32?null:(Eu=!0,Du);case"textInput":return t=a.data,t===Du&&Eu?null:t;default:return null}}function e_(t,a){if(Pa)return t==="compositionend"||!Il&&$u(t,a)?(t=wu(),Mi=Dl=Bs=null,Pa=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Nu&&a.locale!=="ko"?null:a.data;default:return null}}var t_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mu(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a==="input"?!!t_[t.type]:a==="textarea"}function Pu(t,a,o,c){Le(c),a=Fi(a,"onChange"),0<a.length&&(o=new El("onChange","change",null,o,c),t.push({event:o,listeners:a}))}var Nr=null,Dr=null;function n_(t){Ku(t,0)}function Ai(t){var a=Ba(t);if(De(a))return t}function s_(t,a){if(t==="change")return a}var Iu=!1;if(h){var Ll;if(h){var Al="oninput"in document;if(!Al){var Lu=document.createElement("div");Lu.setAttribute("oninput","return;"),Al=typeof Lu.oninput=="function"}Ll=Al}else Ll=!1;Iu=Ll&&(!document.documentMode||9<document.documentMode)}function Au(){Nr&&(Nr.detachEvent("onpropertychange",Ru),Dr=Nr=null)}function Ru(t){if(t.propertyName==="value"&&Ai(Dr)){var a=[];Pu(a,Dr,t,pr(t)),ut(n_,a)}}function a_(t,a,o){t==="focusin"?(Au(),Nr=a,Dr=o,Nr.attachEvent("onpropertychange",Ru)):t==="focusout"&&Au()}function r_(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ai(Dr)}function i_(t,a){if(t==="click")return Ai(a)}function o_(t,a){if(t==="input"||t==="change")return Ai(a)}function l_(t,a){return t===a&&(t!==0||1/t===1/a)||t!==t&&a!==a}var Zn=typeof Object.is=="function"?Object.is:l_;function Er(t,a){if(Zn(t,a))return!0;if(typeof t!="object"||t===null||typeof a!="object"||a===null)return!1;var o=Object.keys(t),c=Object.keys(a);if(o.length!==c.length)return!1;for(c=0;c<o.length;c++){var g=o[c];if(!p.call(a,g)||!Zn(t[g],a[g]))return!1}return!0}function Bu(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Ou(t,a){var o=Bu(t);t=0;for(var c;o;){if(o.nodeType===3){if(c=t+o.textContent.length,t<=a&&c>=a)return{node:o,offset:a-t};t=c}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Bu(o)}}function Fu(t,a){return t&&a?t===a?!0:t&&t.nodeType===3?!1:a&&a.nodeType===3?Fu(t,a.parentNode):"contains"in t?t.contains(a):t.compareDocumentPosition?!!(t.compareDocumentPosition(a)&16):!1:!1}function zu(){for(var t=window,a=We();a instanceof t.HTMLIFrameElement;){try{var o=typeof a.contentWindow.location.href=="string"}catch{o=!1}if(o)t=a.contentWindow;else break;a=We(t.document)}return a}function Rl(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a&&(a==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||a==="textarea"||t.contentEditable==="true")}function c_(t){var a=zu(),o=t.focusedElem,c=t.selectionRange;if(a!==o&&o&&o.ownerDocument&&Fu(o.ownerDocument.documentElement,o)){if(c!==null&&Rl(o)){if(a=c.start,t=c.end,t===void 0&&(t=a),"selectionStart"in o)o.selectionStart=a,o.selectionEnd=Math.min(t,o.value.length);else if(t=(a=o.ownerDocument||document)&&a.defaultView||window,t.getSelection){t=t.getSelection();var g=o.textContent.length,j=Math.min(c.start,g);c=c.end===void 0?j:Math.min(c.end,g),!t.extend&&j>c&&(g=c,c=j,j=g),g=Ou(o,j);var T=Ou(o,c);g&&T&&(t.rangeCount!==1||t.anchorNode!==g.node||t.anchorOffset!==g.offset||t.focusNode!==T.node||t.focusOffset!==T.offset)&&(a=a.createRange(),a.setStart(g.node,g.offset),t.removeAllRanges(),j>c?(t.addRange(a),t.extend(T.node,T.offset)):(a.setEnd(T.node,T.offset),t.addRange(a)))}}for(a=[],t=o;t=t.parentNode;)t.nodeType===1&&a.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<a.length;o++)t=a[o],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var d_=h&&"documentMode"in document&&11>=document.documentMode,Ia=null,Bl=null,$r=null,Ol=!1;function Hu(t,a,o){var c=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Ol||Ia==null||Ia!==We(c)||(c=Ia,"selectionStart"in c&&Rl(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),$r&&Er($r,c)||($r=c,c=Fi(Bl,"onSelect"),0<c.length&&(a=new El("onSelect","select",null,a,o),t.push({event:a,listeners:c}),a.target=Ia)))}function Ri(t,a){var o={};return o[t.toLowerCase()]=a.toLowerCase(),o["Webkit"+t]="webkit"+a,o["Moz"+t]="moz"+a,o}var La={animationend:Ri("Animation","AnimationEnd"),animationiteration:Ri("Animation","AnimationIteration"),animationstart:Ri("Animation","AnimationStart"),transitionend:Ri("Transition","TransitionEnd")},Fl={},Wu={};h&&(Wu=document.createElement("div").style,"AnimationEvent"in window||(delete La.animationend.animation,delete La.animationiteration.animation,delete La.animationstart.animation),"TransitionEvent"in window||delete La.transitionend.transition);function Bi(t){if(Fl[t])return Fl[t];if(!La[t])return t;var a=La[t],o;for(o in a)if(a.hasOwnProperty(o)&&o in Wu)return Fl[t]=a[o];return t}var qu=Bi("animationend"),Uu=Bi("animationiteration"),Vu=Bi("animationstart"),Gu=Bi("transitionend"),Yu=new Map,Qu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Os(t,a){Yu.set(t,a),d(a,[t])}for(var zl=0;zl<Qu.length;zl++){var Hl=Qu[zl],u_=Hl.toLowerCase(),h_=Hl[0].toUpperCase()+Hl.slice(1);Os(u_,"on"+h_)}Os(qu,"onAnimationEnd"),Os(Uu,"onAnimationIteration"),Os(Vu,"onAnimationStart"),Os("dblclick","onDoubleClick"),Os("focusin","onFocus"),Os("focusout","onBlur"),Os(Gu,"onTransitionEnd"),u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Tr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),f_=new Set("cancel close invalid load scroll toggle".split(" ").concat(Tr));function Xu(t,a,o){var c=t.type||"unknown-event";t.currentTarget=o,ug(c,a,void 0,t),t.currentTarget=null}function Ku(t,a){a=(a&4)!==0;for(var o=0;o<t.length;o++){var c=t[o],g=c.event;c=c.listeners;e:{var j=void 0;if(a)for(var T=c.length-1;0<=T;T--){var X=c[T],Z=X.instance,he=X.currentTarget;if(X=X.listener,Z!==j&&g.isPropagationStopped())break e;Xu(g,X,he),j=Z}else for(T=0;T<c.length;T++){if(X=c[T],Z=X.instance,he=X.currentTarget,X=X.listener,Z!==j&&g.isPropagationStopped())break e;Xu(g,X,he),j=Z}}}if(wi)throw t=vl,wi=!1,vl=null,t}function St(t,a){var o=a[Xl];o===void 0&&(o=a[Xl]=new Set);var c=t+"__bubble";o.has(c)||(Zu(a,t,2,!1),o.add(c))}function Wl(t,a,o){var c=0;a&&(c|=4),Zu(o,t,c,a)}var Oi="_reactListening"+Math.random().toString(36).slice(2);function Mr(t){if(!t[Oi]){t[Oi]=!0,i.forEach(function(o){o!=="selectionchange"&&(f_.has(o)||Wl(o,!1,t),Wl(o,!0,t))});var a=t.nodeType===9?t:t.ownerDocument;a===null||a[Oi]||(a[Oi]=!0,Wl("selectionchange",!1,a))}}function Zu(t,a,o,c){switch(ju(a)){case 1:var g=Ng;break;case 4:g=Dg;break;default:g=kl}o=g.bind(null,a,o,t),g=void 0,!Et||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(g=!0),c?g!==void 0?t.addEventListener(a,o,{capture:!0,passive:g}):t.addEventListener(a,o,!0):g!==void 0?t.addEventListener(a,o,{passive:g}):t.addEventListener(a,o,!1)}function ql(t,a,o,c,g){var j=c;if((a&1)===0&&(a&2)===0&&c!==null)e:for(;;){if(c===null)return;var T=c.tag;if(T===3||T===4){var X=c.stateNode.containerInfo;if(X===g||X.nodeType===8&&X.parentNode===g)break;if(T===4)for(T=c.return;T!==null;){var Z=T.tag;if((Z===3||Z===4)&&(Z=T.stateNode.containerInfo,Z===g||Z.nodeType===8&&Z.parentNode===g))return;T=T.return}for(;X!==null;){if(T=ua(X),T===null)return;if(Z=T.tag,Z===5||Z===6){c=j=T;continue e}X=X.parentNode}}c=c.return}ut(function(){var he=j,ye=pr(o),ve=[];e:{var _e=Yu.get(t);if(_e!==void 0){var be=El,Te=t;switch(t){case"keypress":if(Pi(o)===0)break e;case"keydown":case"keyup":be=Wg;break;case"focusin":Te="focus",be=Ml;break;case"focusout":Te="blur",be=Ml;break;case"beforeblur":case"afterblur":be=Ml;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":be=Cu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":be=Tg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":be=Vg;break;case qu:case Uu:case Vu:be=Ig;break;case Gu:be=Yg;break;case"scroll":be=Eg;break;case"wheel":be=Xg;break;case"copy":case"cut":case"paste":be=Ag;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":be=ku}var Pe=(a&4)!==0,Ft=!Pe&&t==="scroll",ne=Pe?_e!==null?_e+"Capture":null:_e;Pe=[];for(var ee=he,re;ee!==null;){re=ee;var Se=re.stateNode;if(re.tag===5&&Se!==null&&(re=Se,ne!==null&&(Se=ln(ee,ne),Se!=null&&Pe.push(Pr(ee,Se,re)))),Ft)break;ee=ee.return}0<Pe.length&&(_e=new be(_e,Te,null,o,ye),ve.push({event:_e,listeners:Pe}))}}if((a&7)===0){e:{if(_e=t==="mouseover"||t==="pointerover",be=t==="mouseout"||t==="pointerout",_e&&o!==mr&&(Te=o.relatedTarget||o.fromElement)&&(ua(Te)||Te[ys]))break e;if((be||_e)&&(_e=ye.window===ye?ye:(_e=ye.ownerDocument)?_e.defaultView||_e.parentWindow:window,be?(Te=o.relatedTarget||o.toElement,be=he,Te=Te?ua(Te):null,Te!==null&&(Ft=da(Te),Te!==Ft||Te.tag!==5&&Te.tag!==6)&&(Te=null)):(be=null,Te=he),be!==Te)){if(Pe=Cu,Se="onMouseLeave",ne="onMouseEnter",ee="mouse",(t==="pointerout"||t==="pointerover")&&(Pe=ku,Se="onPointerLeave",ne="onPointerEnter",ee="pointer"),Ft=be==null?_e:Ba(be),re=Te==null?_e:Ba(Te),_e=new Pe(Se,ee+"leave",be,o,ye),_e.target=Ft,_e.relatedTarget=re,Se=null,ua(ye)===he&&(Pe=new Pe(ne,ee+"enter",Te,o,ye),Pe.target=re,Pe.relatedTarget=Ft,Se=Pe),Ft=Se,be&&Te)t:{for(Pe=be,ne=Te,ee=0,re=Pe;re;re=Aa(re))ee++;for(re=0,Se=ne;Se;Se=Aa(Se))re++;for(;0<ee-re;)Pe=Aa(Pe),ee--;for(;0<re-ee;)ne=Aa(ne),re--;for(;ee--;){if(Pe===ne||ne!==null&&Pe===ne.alternate)break t;Pe=Aa(Pe),ne=Aa(ne)}Pe=null}else Pe=null;be!==null&&Ju(ve,_e,be,Pe,!1),Te!==null&&Ft!==null&&Ju(ve,Ft,Te,Pe,!0)}}e:{if(_e=he?Ba(he):window,be=_e.nodeName&&_e.nodeName.toLowerCase(),be==="select"||be==="input"&&_e.type==="file")var Ie=s_;else if(Mu(_e))if(Iu)Ie=o_;else{Ie=r_;var Re=a_}else(be=_e.nodeName)&&be.toLowerCase()==="input"&&(_e.type==="checkbox"||_e.type==="radio")&&(Ie=i_);if(Ie&&(Ie=Ie(t,he))){Pu(ve,Ie,o,ye);break e}Re&&Re(t,_e,he),t==="focusout"&&(Re=_e._wrapperState)&&Re.controlled&&_e.type==="number"&&ie(_e,"number",_e.value)}switch(Re=he?Ba(he):window,t){case"focusin":(Mu(Re)||Re.contentEditable==="true")&&(Ia=Re,Bl=he,$r=null);break;case"focusout":$r=Bl=Ia=null;break;case"mousedown":Ol=!0;break;case"contextmenu":case"mouseup":case"dragend":Ol=!1,Hu(ve,o,ye);break;case"selectionchange":if(d_)break;case"keydown":case"keyup":Hu(ve,o,ye)}var Be;if(Il)e:{switch(t){case"compositionstart":var Fe="onCompositionStart";break e;case"compositionend":Fe="onCompositionEnd";break e;case"compositionupdate":Fe="onCompositionUpdate";break e}Fe=void 0}else Pa?$u(t,o)&&(Fe="onCompositionEnd"):t==="keydown"&&o.keyCode===229&&(Fe="onCompositionStart");Fe&&(Nu&&o.locale!=="ko"&&(Pa||Fe!=="onCompositionStart"?Fe==="onCompositionEnd"&&Pa&&(Be=wu()):(Bs=ye,Dl="value"in Bs?Bs.value:Bs.textContent,Pa=!0)),Re=Fi(he,Fe),0<Re.length&&(Fe=new bu(Fe,t,null,o,ye),ve.push({event:Fe,listeners:Re}),Be?Fe.data=Be:(Be=Tu(o),Be!==null&&(Fe.data=Be)))),(Be=Zg?Jg(t,o):e_(t,o))&&(he=Fi(he,"onBeforeInput"),0<he.length&&(ye=new bu("onBeforeInput","beforeinput",null,o,ye),ve.push({event:ye,listeners:he}),ye.data=Be))}Ku(ve,a)})}function Pr(t,a,o){return{instance:t,listener:a,currentTarget:o}}function Fi(t,a){for(var o=a+"Capture",c=[];t!==null;){var g=t,j=g.stateNode;g.tag===5&&j!==null&&(g=j,j=ln(t,o),j!=null&&c.unshift(Pr(t,j,g)),j=ln(t,a),j!=null&&c.push(Pr(t,j,g))),t=t.return}return c}function Aa(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ju(t,a,o,c,g){for(var j=a._reactName,T=[];o!==null&&o!==c;){var X=o,Z=X.alternate,he=X.stateNode;if(Z!==null&&Z===c)break;X.tag===5&&he!==null&&(X=he,g?(Z=ln(o,j),Z!=null&&T.unshift(Pr(o,Z,X))):g||(Z=ln(o,j),Z!=null&&T.push(Pr(o,Z,X)))),o=o.return}T.length!==0&&t.push({event:a,listeners:T})}var m_=/\r\n?/g,p_=/\u0000|\uFFFD/g;function eh(t){return(typeof t=="string"?t:""+t).replace(m_,`
`).replace(p_,"")}function zi(t,a,o){if(a=eh(a),eh(t)!==a&&o)throw Error(r(425))}function Hi(){}var Ul=null,Vl=null;function Gl(t,a){return t==="textarea"||t==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Yl=typeof setTimeout=="function"?setTimeout:void 0,g_=typeof clearTimeout=="function"?clearTimeout:void 0,th=typeof Promise=="function"?Promise:void 0,__=typeof queueMicrotask=="function"?queueMicrotask:typeof th<"u"?function(t){return th.resolve(null).then(t).catch(y_)}:Yl;function y_(t){setTimeout(function(){throw t})}function Ql(t,a){var o=a,c=0;do{var g=o.nextSibling;if(t.removeChild(o),g&&g.nodeType===8)if(o=g.data,o==="/$"){if(c===0){t.removeChild(g),Sr(a);return}c--}else o!=="$"&&o!=="$?"&&o!=="$!"||c++;o=g}while(o);Sr(a)}function Fs(t){for(;t!=null;t=t.nextSibling){var a=t.nodeType;if(a===1||a===3)break;if(a===8){if(a=t.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return t}function nh(t){t=t.previousSibling;for(var a=0;t;){if(t.nodeType===8){var o=t.data;if(o==="$"||o==="$!"||o==="$?"){if(a===0)return t;a--}else o==="/$"&&a++}t=t.previousSibling}return null}var Ra=Math.random().toString(36).slice(2),cs="__reactFiber$"+Ra,Ir="__reactProps$"+Ra,ys="__reactContainer$"+Ra,Xl="__reactEvents$"+Ra,v_="__reactListeners$"+Ra,x_="__reactHandles$"+Ra;function ua(t){var a=t[cs];if(a)return a;for(var o=t.parentNode;o;){if(a=o[ys]||o[cs]){if(o=a.alternate,a.child!==null||o!==null&&o.child!==null)for(t=nh(t);t!==null;){if(o=t[cs])return o;t=nh(t)}return a}t=o,o=t.parentNode}return null}function Lr(t){return t=t[cs]||t[ys],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ba(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(r(33))}function Wi(t){return t[Ir]||null}var Kl=[],Oa=-1;function zs(t){return{current:t}}function Ct(t){0>Oa||(t.current=Kl[Oa],Kl[Oa]=null,Oa--)}function _t(t,a){Oa++,Kl[Oa]=t.current,t.current=a}var Hs={},cn=zs(Hs),jn=zs(!1),ha=Hs;function Fa(t,a){var o=t.type.contextTypes;if(!o)return Hs;var c=t.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===a)return c.__reactInternalMemoizedMaskedChildContext;var g={},j;for(j in o)g[j]=a[j];return c&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=a,t.__reactInternalMemoizedMaskedChildContext=g),g}function wn(t){return t=t.childContextTypes,t!=null}function qi(){Ct(jn),Ct(cn)}function sh(t,a,o){if(cn.current!==Hs)throw Error(r(168));_t(cn,a),_t(jn,o)}function ah(t,a,o){var c=t.stateNode;if(a=a.childContextTypes,typeof c.getChildContext!="function")return o;c=c.getChildContext();for(var g in c)if(!(g in a))throw Error(r(108,ge(t)||"Unknown",g));return U({},o,c)}function Ui(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Hs,ha=cn.current,_t(cn,t),_t(jn,jn.current),!0}function rh(t,a,o){var c=t.stateNode;if(!c)throw Error(r(169));o?(t=ah(t,a,ha),c.__reactInternalMemoizedMergedChildContext=t,Ct(jn),Ct(cn),_t(cn,t)):Ct(jn),_t(jn,o)}var vs=null,Vi=!1,Zl=!1;function ih(t){vs===null?vs=[t]:vs.push(t)}function j_(t){Vi=!0,ih(t)}function Ws(){if(!Zl&&vs!==null){Zl=!0;var t=0,a=ct;try{var o=vs;for(ct=1;t<o.length;t++){var c=o[t];do c=c(!0);while(c!==null)}vs=null,Vi=!1}catch(g){throw vs!==null&&(vs=vs.slice(t+1)),lu(xl,Ws),g}finally{ct=a,Zl=!1}}return null}var za=[],Ha=0,Gi=null,Yi=0,In=[],Ln=0,fa=null,xs=1,js="";function ma(t,a){za[Ha++]=Yi,za[Ha++]=Gi,Gi=t,Yi=a}function oh(t,a,o){In[Ln++]=xs,In[Ln++]=js,In[Ln++]=fa,fa=t;var c=xs;t=js;var g=32-Kn(c)-1;c&=~(1<<g),o+=1;var j=32-Kn(a)+g;if(30<j){var T=g-g%5;j=(c&(1<<T)-1).toString(32),c>>=T,g-=T,xs=1<<32-Kn(a)+g|o<<g|c,js=j+t}else xs=1<<j|o<<g|c,js=t}function Jl(t){t.return!==null&&(ma(t,1),oh(t,1,0))}function ec(t){for(;t===Gi;)Gi=za[--Ha],za[Ha]=null,Yi=za[--Ha],za[Ha]=null;for(;t===fa;)fa=In[--Ln],In[Ln]=null,js=In[--Ln],In[Ln]=null,xs=In[--Ln],In[Ln]=null}var En=null,$n=null,Nt=!1,Jn=null;function lh(t,a){var o=On(5,null,null,0);o.elementType="DELETED",o.stateNode=a,o.return=t,a=t.deletions,a===null?(t.deletions=[o],t.flags|=16):a.push(o)}function ch(t,a){switch(t.tag){case 5:var o=t.type;return a=a.nodeType!==1||o.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(t.stateNode=a,En=t,$n=Fs(a.firstChild),!0):!1;case 6:return a=t.pendingProps===""||a.nodeType!==3?null:a,a!==null?(t.stateNode=a,En=t,$n=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(o=fa!==null?{id:xs,overflow:js}:null,t.memoizedState={dehydrated:a,treeContext:o,retryLane:1073741824},o=On(18,null,null,0),o.stateNode=a,o.return=t,t.child=o,En=t,$n=null,!0):!1;default:return!1}}function tc(t){return(t.mode&1)!==0&&(t.flags&128)===0}function nc(t){if(Nt){var a=$n;if(a){var o=a;if(!ch(t,a)){if(tc(t))throw Error(r(418));a=Fs(o.nextSibling);var c=En;a&&ch(t,a)?lh(c,o):(t.flags=t.flags&-4097|2,Nt=!1,En=t)}}else{if(tc(t))throw Error(r(418));t.flags=t.flags&-4097|2,Nt=!1,En=t}}}function dh(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;En=t}function Qi(t){if(t!==En)return!1;if(!Nt)return dh(t),Nt=!0,!1;var a;if((a=t.tag!==3)&&!(a=t.tag!==5)&&(a=t.type,a=a!=="head"&&a!=="body"&&!Gl(t.type,t.memoizedProps)),a&&(a=$n)){if(tc(t))throw uh(),Error(r(418));for(;a;)lh(t,a),a=Fs(a.nextSibling)}if(dh(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(r(317));e:{for(t=t.nextSibling,a=0;t;){if(t.nodeType===8){var o=t.data;if(o==="/$"){if(a===0){$n=Fs(t.nextSibling);break e}a--}else o!=="$"&&o!=="$!"&&o!=="$?"||a++}t=t.nextSibling}$n=null}}else $n=En?Fs(t.stateNode.nextSibling):null;return!0}function uh(){for(var t=$n;t;)t=Fs(t.nextSibling)}function Wa(){$n=En=null,Nt=!1}function sc(t){Jn===null?Jn=[t]:Jn.push(t)}var w_=O.ReactCurrentBatchConfig;function Ar(t,a,o){if(t=o.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(r(309));var c=o.stateNode}if(!c)throw Error(r(147,t));var g=c,j=""+t;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===j?a.ref:(a=function(T){var X=g.refs;T===null?delete X[j]:X[j]=T},a._stringRef=j,a)}if(typeof t!="string")throw Error(r(284));if(!o._owner)throw Error(r(290,t))}return t}function Xi(t,a){throw t=Object.prototype.toString.call(a),Error(r(31,t==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":t))}function hh(t){var a=t._init;return a(t._payload)}function fh(t){function a(ne,ee){if(t){var re=ne.deletions;re===null?(ne.deletions=[ee],ne.flags|=16):re.push(ee)}}function o(ne,ee){if(!t)return null;for(;ee!==null;)a(ne,ee),ee=ee.sibling;return null}function c(ne,ee){for(ne=new Map;ee!==null;)ee.key!==null?ne.set(ee.key,ee):ne.set(ee.index,ee),ee=ee.sibling;return ne}function g(ne,ee){return ne=Ks(ne,ee),ne.index=0,ne.sibling=null,ne}function j(ne,ee,re){return ne.index=re,t?(re=ne.alternate,re!==null?(re=re.index,re<ee?(ne.flags|=2,ee):re):(ne.flags|=2,ee)):(ne.flags|=1048576,ee)}function T(ne){return t&&ne.alternate===null&&(ne.flags|=2),ne}function X(ne,ee,re,Se){return ee===null||ee.tag!==6?(ee=Yc(re,ne.mode,Se),ee.return=ne,ee):(ee=g(ee,re),ee.return=ne,ee)}function Z(ne,ee,re,Se){var Ie=re.type;return Ie===Q?ye(ne,ee,re.props.children,Se,re.key):ee!==null&&(ee.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===P&&hh(Ie)===ee.type)?(Se=g(ee,re.props),Se.ref=Ar(ne,ee,re),Se.return=ne,Se):(Se=jo(re.type,re.key,re.props,null,ne.mode,Se),Se.ref=Ar(ne,ee,re),Se.return=ne,Se)}function he(ne,ee,re,Se){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==re.containerInfo||ee.stateNode.implementation!==re.implementation?(ee=Qc(re,ne.mode,Se),ee.return=ne,ee):(ee=g(ee,re.children||[]),ee.return=ne,ee)}function ye(ne,ee,re,Se,Ie){return ee===null||ee.tag!==7?(ee=wa(re,ne.mode,Se,Ie),ee.return=ne,ee):(ee=g(ee,re),ee.return=ne,ee)}function ve(ne,ee,re){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return ee=Yc(""+ee,ne.mode,re),ee.return=ne,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case z:return re=jo(ee.type,ee.key,ee.props,null,ne.mode,re),re.ref=Ar(ne,null,ee),re.return=ne,re;case R:return ee=Qc(ee,ne.mode,re),ee.return=ne,ee;case P:var Se=ee._init;return ve(ne,Se(ee._payload),re)}if(Ae(ee)||I(ee))return ee=wa(ee,ne.mode,re,null),ee.return=ne,ee;Xi(ne,ee)}return null}function _e(ne,ee,re,Se){var Ie=ee!==null?ee.key:null;if(typeof re=="string"&&re!==""||typeof re=="number")return Ie!==null?null:X(ne,ee,""+re,Se);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case z:return re.key===Ie?Z(ne,ee,re,Se):null;case R:return re.key===Ie?he(ne,ee,re,Se):null;case P:return Ie=re._init,_e(ne,ee,Ie(re._payload),Se)}if(Ae(re)||I(re))return Ie!==null?null:ye(ne,ee,re,Se,null);Xi(ne,re)}return null}function be(ne,ee,re,Se,Ie){if(typeof Se=="string"&&Se!==""||typeof Se=="number")return ne=ne.get(re)||null,X(ee,ne,""+Se,Ie);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case z:return ne=ne.get(Se.key===null?re:Se.key)||null,Z(ee,ne,Se,Ie);case R:return ne=ne.get(Se.key===null?re:Se.key)||null,he(ee,ne,Se,Ie);case P:var Re=Se._init;return be(ne,ee,re,Re(Se._payload),Ie)}if(Ae(Se)||I(Se))return ne=ne.get(re)||null,ye(ee,ne,Se,Ie,null);Xi(ee,Se)}return null}function Te(ne,ee,re,Se){for(var Ie=null,Re=null,Be=ee,Fe=ee=0,nn=null;Be!==null&&Fe<re.length;Fe++){Be.index>Fe?(nn=Be,Be=null):nn=Be.sibling;var st=_e(ne,Be,re[Fe],Se);if(st===null){Be===null&&(Be=nn);break}t&&Be&&st.alternate===null&&a(ne,Be),ee=j(st,ee,Fe),Re===null?Ie=st:Re.sibling=st,Re=st,Be=nn}if(Fe===re.length)return o(ne,Be),Nt&&ma(ne,Fe),Ie;if(Be===null){for(;Fe<re.length;Fe++)Be=ve(ne,re[Fe],Se),Be!==null&&(ee=j(Be,ee,Fe),Re===null?Ie=Be:Re.sibling=Be,Re=Be);return Nt&&ma(ne,Fe),Ie}for(Be=c(ne,Be);Fe<re.length;Fe++)nn=be(Be,ne,Fe,re[Fe],Se),nn!==null&&(t&&nn.alternate!==null&&Be.delete(nn.key===null?Fe:nn.key),ee=j(nn,ee,Fe),Re===null?Ie=nn:Re.sibling=nn,Re=nn);return t&&Be.forEach(function(Zs){return a(ne,Zs)}),Nt&&ma(ne,Fe),Ie}function Pe(ne,ee,re,Se){var Ie=I(re);if(typeof Ie!="function")throw Error(r(150));if(re=Ie.call(re),re==null)throw Error(r(151));for(var Re=Ie=null,Be=ee,Fe=ee=0,nn=null,st=re.next();Be!==null&&!st.done;Fe++,st=re.next()){Be.index>Fe?(nn=Be,Be=null):nn=Be.sibling;var Zs=_e(ne,Be,st.value,Se);if(Zs===null){Be===null&&(Be=nn);break}t&&Be&&Zs.alternate===null&&a(ne,Be),ee=j(Zs,ee,Fe),Re===null?Ie=Zs:Re.sibling=Zs,Re=Zs,Be=nn}if(st.done)return o(ne,Be),Nt&&ma(ne,Fe),Ie;if(Be===null){for(;!st.done;Fe++,st=re.next())st=ve(ne,st.value,Se),st!==null&&(ee=j(st,ee,Fe),Re===null?Ie=st:Re.sibling=st,Re=st);return Nt&&ma(ne,Fe),Ie}for(Be=c(ne,Be);!st.done;Fe++,st=re.next())st=be(Be,ne,Fe,st.value,Se),st!==null&&(t&&st.alternate!==null&&Be.delete(st.key===null?Fe:st.key),ee=j(st,ee,Fe),Re===null?Ie=st:Re.sibling=st,Re=st);return t&&Be.forEach(function(t1){return a(ne,t1)}),Nt&&ma(ne,Fe),Ie}function Ft(ne,ee,re,Se){if(typeof re=="object"&&re!==null&&re.type===Q&&re.key===null&&(re=re.props.children),typeof re=="object"&&re!==null){switch(re.$$typeof){case z:e:{for(var Ie=re.key,Re=ee;Re!==null;){if(Re.key===Ie){if(Ie=re.type,Ie===Q){if(Re.tag===7){o(ne,Re.sibling),ee=g(Re,re.props.children),ee.return=ne,ne=ee;break e}}else if(Re.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===P&&hh(Ie)===Re.type){o(ne,Re.sibling),ee=g(Re,re.props),ee.ref=Ar(ne,Re,re),ee.return=ne,ne=ee;break e}o(ne,Re);break}else a(ne,Re);Re=Re.sibling}re.type===Q?(ee=wa(re.props.children,ne.mode,Se,re.key),ee.return=ne,ne=ee):(Se=jo(re.type,re.key,re.props,null,ne.mode,Se),Se.ref=Ar(ne,ee,re),Se.return=ne,ne=Se)}return T(ne);case R:e:{for(Re=re.key;ee!==null;){if(ee.key===Re)if(ee.tag===4&&ee.stateNode.containerInfo===re.containerInfo&&ee.stateNode.implementation===re.implementation){o(ne,ee.sibling),ee=g(ee,re.children||[]),ee.return=ne,ne=ee;break e}else{o(ne,ee);break}else a(ne,ee);ee=ee.sibling}ee=Qc(re,ne.mode,Se),ee.return=ne,ne=ee}return T(ne);case P:return Re=re._init,Ft(ne,ee,Re(re._payload),Se)}if(Ae(re))return Te(ne,ee,re,Se);if(I(re))return Pe(ne,ee,re,Se);Xi(ne,re)}return typeof re=="string"&&re!==""||typeof re=="number"?(re=""+re,ee!==null&&ee.tag===6?(o(ne,ee.sibling),ee=g(ee,re),ee.return=ne,ne=ee):(o(ne,ee),ee=Yc(re,ne.mode,Se),ee.return=ne,ne=ee),T(ne)):o(ne,ee)}return Ft}var qa=fh(!0),mh=fh(!1),Ki=zs(null),Zi=null,Ua=null,ac=null;function rc(){ac=Ua=Zi=null}function ic(t){var a=Ki.current;Ct(Ki),t._currentValue=a}function oc(t,a,o){for(;t!==null;){var c=t.alternate;if((t.childLanes&a)!==a?(t.childLanes|=a,c!==null&&(c.childLanes|=a)):c!==null&&(c.childLanes&a)!==a&&(c.childLanes|=a),t===o)break;t=t.return}}function Va(t,a){Zi=t,ac=Ua=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&a)!==0&&(Sn=!0),t.firstContext=null)}function An(t){var a=t._currentValue;if(ac!==t)if(t={context:t,memoizedValue:a,next:null},Ua===null){if(Zi===null)throw Error(r(308));Ua=t,Zi.dependencies={lanes:0,firstContext:t}}else Ua=Ua.next=t;return a}var pa=null;function lc(t){pa===null?pa=[t]:pa.push(t)}function ph(t,a,o,c){var g=a.interleaved;return g===null?(o.next=o,lc(a)):(o.next=g.next,g.next=o),a.interleaved=o,ws(t,c)}function ws(t,a){t.lanes|=a;var o=t.alternate;for(o!==null&&(o.lanes|=a),o=t,t=t.return;t!==null;)t.childLanes|=a,o=t.alternate,o!==null&&(o.childLanes|=a),o=t,t=t.return;return o.tag===3?o.stateNode:null}var qs=!1;function cc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function gh(t,a){t=t.updateQueue,a.updateQueue===t&&(a.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ss(t,a){return{eventTime:t,lane:a,tag:0,payload:null,callback:null,next:null}}function Us(t,a,o){var c=t.updateQueue;if(c===null)return null;if(c=c.shared,(et&2)!==0){var g=c.pending;return g===null?a.next=a:(a.next=g.next,g.next=a),c.pending=a,ws(t,o)}return g=c.interleaved,g===null?(a.next=a,lc(c)):(a.next=g.next,g.next=a),c.interleaved=a,ws(t,o)}function Ji(t,a,o){if(a=a.updateQueue,a!==null&&(a=a.shared,(o&4194240)!==0)){var c=a.lanes;c&=t.pendingLanes,o|=c,a.lanes=o,Sl(t,o)}}function _h(t,a){var o=t.updateQueue,c=t.alternate;if(c!==null&&(c=c.updateQueue,o===c)){var g=null,j=null;if(o=o.firstBaseUpdate,o!==null){do{var T={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};j===null?g=j=T:j=j.next=T,o=o.next}while(o!==null);j===null?g=j=a:j=j.next=a}else g=j=a;o={baseState:c.baseState,firstBaseUpdate:g,lastBaseUpdate:j,shared:c.shared,effects:c.effects},t.updateQueue=o;return}t=o.lastBaseUpdate,t===null?o.firstBaseUpdate=a:t.next=a,o.lastBaseUpdate=a}function eo(t,a,o,c){var g=t.updateQueue;qs=!1;var j=g.firstBaseUpdate,T=g.lastBaseUpdate,X=g.shared.pending;if(X!==null){g.shared.pending=null;var Z=X,he=Z.next;Z.next=null,T===null?j=he:T.next=he,T=Z;var ye=t.alternate;ye!==null&&(ye=ye.updateQueue,X=ye.lastBaseUpdate,X!==T&&(X===null?ye.firstBaseUpdate=he:X.next=he,ye.lastBaseUpdate=Z))}if(j!==null){var ve=g.baseState;T=0,ye=he=Z=null,X=j;do{var _e=X.lane,be=X.eventTime;if((c&_e)===_e){ye!==null&&(ye=ye.next={eventTime:be,lane:0,tag:X.tag,payload:X.payload,callback:X.callback,next:null});e:{var Te=t,Pe=X;switch(_e=a,be=o,Pe.tag){case 1:if(Te=Pe.payload,typeof Te=="function"){ve=Te.call(be,ve,_e);break e}ve=Te;break e;case 3:Te.flags=Te.flags&-65537|128;case 0:if(Te=Pe.payload,_e=typeof Te=="function"?Te.call(be,ve,_e):Te,_e==null)break e;ve=U({},ve,_e);break e;case 2:qs=!0}}X.callback!==null&&X.lane!==0&&(t.flags|=64,_e=g.effects,_e===null?g.effects=[X]:_e.push(X))}else be={eventTime:be,lane:_e,tag:X.tag,payload:X.payload,callback:X.callback,next:null},ye===null?(he=ye=be,Z=ve):ye=ye.next=be,T|=_e;if(X=X.next,X===null){if(X=g.shared.pending,X===null)break;_e=X,X=_e.next,_e.next=null,g.lastBaseUpdate=_e,g.shared.pending=null}}while(!0);if(ye===null&&(Z=ve),g.baseState=Z,g.firstBaseUpdate=he,g.lastBaseUpdate=ye,a=g.shared.interleaved,a!==null){g=a;do T|=g.lane,g=g.next;while(g!==a)}else j===null&&(g.shared.lanes=0);ya|=T,t.lanes=T,t.memoizedState=ve}}function yh(t,a,o){if(t=a.effects,a.effects=null,t!==null)for(a=0;a<t.length;a++){var c=t[a],g=c.callback;if(g!==null){if(c.callback=null,c=o,typeof g!="function")throw Error(r(191,g));g.call(c)}}}var Rr={},ds=zs(Rr),Br=zs(Rr),Or=zs(Rr);function ga(t){if(t===Rr)throw Error(r(174));return t}function dc(t,a){switch(_t(Or,a),_t(Br,t),_t(ds,Rr),t=a.nodeType,t){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:Da(null,"");break;default:t=t===8?a.parentNode:a,a=t.namespaceURI||null,t=t.tagName,a=Da(a,t)}Ct(ds),_t(ds,a)}function Ga(){Ct(ds),Ct(Br),Ct(Or)}function vh(t){ga(Or.current);var a=ga(ds.current),o=Da(a,t.type);a!==o&&(_t(Br,t),_t(ds,o))}function uc(t){Br.current===t&&(Ct(ds),Ct(Br))}var $t=zs(0);function to(t){for(var a=t;a!==null;){if(a.tag===13){var o=a.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var hc=[];function fc(){for(var t=0;t<hc.length;t++)hc[t]._workInProgressVersionPrimary=null;hc.length=0}var no=O.ReactCurrentDispatcher,mc=O.ReactCurrentBatchConfig,_a=0,Tt=null,Yt=null,en=null,so=!1,Fr=!1,zr=0,S_=0;function dn(){throw Error(r(321))}function pc(t,a){if(a===null)return!1;for(var o=0;o<a.length&&o<t.length;o++)if(!Zn(t[o],a[o]))return!1;return!0}function gc(t,a,o,c,g,j){if(_a=j,Tt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,no.current=t===null||t.memoizedState===null?N_:D_,t=o(c,g),Fr){j=0;do{if(Fr=!1,zr=0,25<=j)throw Error(r(301));j+=1,en=Yt=null,a.updateQueue=null,no.current=E_,t=o(c,g)}while(Fr)}if(no.current=io,a=Yt!==null&&Yt.next!==null,_a=0,en=Yt=Tt=null,so=!1,a)throw Error(r(300));return t}function _c(){var t=zr!==0;return zr=0,t}function us(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return en===null?Tt.memoizedState=en=t:en=en.next=t,en}function Rn(){if(Yt===null){var t=Tt.alternate;t=t!==null?t.memoizedState:null}else t=Yt.next;var a=en===null?Tt.memoizedState:en.next;if(a!==null)en=a,Yt=t;else{if(t===null)throw Error(r(310));Yt=t,t={memoizedState:Yt.memoizedState,baseState:Yt.baseState,baseQueue:Yt.baseQueue,queue:Yt.queue,next:null},en===null?Tt.memoizedState=en=t:en=en.next=t}return en}function Hr(t,a){return typeof a=="function"?a(t):a}function yc(t){var a=Rn(),o=a.queue;if(o===null)throw Error(r(311));o.lastRenderedReducer=t;var c=Yt,g=c.baseQueue,j=o.pending;if(j!==null){if(g!==null){var T=g.next;g.next=j.next,j.next=T}c.baseQueue=g=j,o.pending=null}if(g!==null){j=g.next,c=c.baseState;var X=T=null,Z=null,he=j;do{var ye=he.lane;if((_a&ye)===ye)Z!==null&&(Z=Z.next={lane:0,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null}),c=he.hasEagerState?he.eagerState:t(c,he.action);else{var ve={lane:ye,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null};Z===null?(X=Z=ve,T=c):Z=Z.next=ve,Tt.lanes|=ye,ya|=ye}he=he.next}while(he!==null&&he!==j);Z===null?T=c:Z.next=X,Zn(c,a.memoizedState)||(Sn=!0),a.memoizedState=c,a.baseState=T,a.baseQueue=Z,o.lastRenderedState=c}if(t=o.interleaved,t!==null){g=t;do j=g.lane,Tt.lanes|=j,ya|=j,g=g.next;while(g!==t)}else g===null&&(o.lanes=0);return[a.memoizedState,o.dispatch]}function vc(t){var a=Rn(),o=a.queue;if(o===null)throw Error(r(311));o.lastRenderedReducer=t;var c=o.dispatch,g=o.pending,j=a.memoizedState;if(g!==null){o.pending=null;var T=g=g.next;do j=t(j,T.action),T=T.next;while(T!==g);Zn(j,a.memoizedState)||(Sn=!0),a.memoizedState=j,a.baseQueue===null&&(a.baseState=j),o.lastRenderedState=j}return[j,c]}function xh(){}function jh(t,a){var o=Tt,c=Rn(),g=a(),j=!Zn(c.memoizedState,g);if(j&&(c.memoizedState=g,Sn=!0),c=c.queue,xc(Ch.bind(null,o,c,t),[t]),c.getSnapshot!==a||j||en!==null&&en.memoizedState.tag&1){if(o.flags|=2048,Wr(9,Sh.bind(null,o,c,g,a),void 0,null),tn===null)throw Error(r(349));(_a&30)!==0||wh(o,a,g)}return g}function wh(t,a,o){t.flags|=16384,t={getSnapshot:a,value:o},a=Tt.updateQueue,a===null?(a={lastEffect:null,stores:null},Tt.updateQueue=a,a.stores=[t]):(o=a.stores,o===null?a.stores=[t]:o.push(t))}function Sh(t,a,o,c){a.value=o,a.getSnapshot=c,bh(a)&&kh(t)}function Ch(t,a,o){return o(function(){bh(a)&&kh(t)})}function bh(t){var a=t.getSnapshot;t=t.value;try{var o=a();return!Zn(t,o)}catch{return!0}}function kh(t){var a=ws(t,1);a!==null&&ss(a,t,1,-1)}function Nh(t){var a=us();return typeof t=="function"&&(t=t()),a.memoizedState=a.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hr,lastRenderedState:t},a.queue=t,t=t.dispatch=k_.bind(null,Tt,t),[a.memoizedState,t]}function Wr(t,a,o,c){return t={tag:t,create:a,destroy:o,deps:c,next:null},a=Tt.updateQueue,a===null?(a={lastEffect:null,stores:null},Tt.updateQueue=a,a.lastEffect=t.next=t):(o=a.lastEffect,o===null?a.lastEffect=t.next=t:(c=o.next,o.next=t,t.next=c,a.lastEffect=t)),t}function Dh(){return Rn().memoizedState}function ao(t,a,o,c){var g=us();Tt.flags|=t,g.memoizedState=Wr(1|a,o,void 0,c===void 0?null:c)}function ro(t,a,o,c){var g=Rn();c=c===void 0?null:c;var j=void 0;if(Yt!==null){var T=Yt.memoizedState;if(j=T.destroy,c!==null&&pc(c,T.deps)){g.memoizedState=Wr(a,o,j,c);return}}Tt.flags|=t,g.memoizedState=Wr(1|a,o,j,c)}function Eh(t,a){return ao(8390656,8,t,a)}function xc(t,a){return ro(2048,8,t,a)}function $h(t,a){return ro(4,2,t,a)}function Th(t,a){return ro(4,4,t,a)}function Mh(t,a){if(typeof a=="function")return t=t(),a(t),function(){a(null)};if(a!=null)return t=t(),a.current=t,function(){a.current=null}}function Ph(t,a,o){return o=o!=null?o.concat([t]):null,ro(4,4,Mh.bind(null,a,t),o)}function jc(){}function Ih(t,a){var o=Rn();a=a===void 0?null:a;var c=o.memoizedState;return c!==null&&a!==null&&pc(a,c[1])?c[0]:(o.memoizedState=[t,a],t)}function Lh(t,a){var o=Rn();a=a===void 0?null:a;var c=o.memoizedState;return c!==null&&a!==null&&pc(a,c[1])?c[0]:(t=t(),o.memoizedState=[t,a],t)}function Ah(t,a,o){return(_a&21)===0?(t.baseState&&(t.baseState=!1,Sn=!0),t.memoizedState=o):(Zn(o,a)||(o=hu(),Tt.lanes|=o,ya|=o,t.baseState=!0),a)}function C_(t,a){var o=ct;ct=o!==0&&4>o?o:4,t(!0);var c=mc.transition;mc.transition={};try{t(!1),a()}finally{ct=o,mc.transition=c}}function Rh(){return Rn().memoizedState}function b_(t,a,o){var c=Qs(t);if(o={lane:c,action:o,hasEagerState:!1,eagerState:null,next:null},Bh(t))Oh(a,o);else if(o=ph(t,a,o,c),o!==null){var g=yn();ss(o,t,c,g),Fh(o,a,c)}}function k_(t,a,o){var c=Qs(t),g={lane:c,action:o,hasEagerState:!1,eagerState:null,next:null};if(Bh(t))Oh(a,g);else{var j=t.alternate;if(t.lanes===0&&(j===null||j.lanes===0)&&(j=a.lastRenderedReducer,j!==null))try{var T=a.lastRenderedState,X=j(T,o);if(g.hasEagerState=!0,g.eagerState=X,Zn(X,T)){var Z=a.interleaved;Z===null?(g.next=g,lc(a)):(g.next=Z.next,Z.next=g),a.interleaved=g;return}}catch{}o=ph(t,a,g,c),o!==null&&(g=yn(),ss(o,t,c,g),Fh(o,a,c))}}function Bh(t){var a=t.alternate;return t===Tt||a!==null&&a===Tt}function Oh(t,a){Fr=so=!0;var o=t.pending;o===null?a.next=a:(a.next=o.next,o.next=a),t.pending=a}function Fh(t,a,o){if((o&4194240)!==0){var c=a.lanes;c&=t.pendingLanes,o|=c,a.lanes=o,Sl(t,o)}}var io={readContext:An,useCallback:dn,useContext:dn,useEffect:dn,useImperativeHandle:dn,useInsertionEffect:dn,useLayoutEffect:dn,useMemo:dn,useReducer:dn,useRef:dn,useState:dn,useDebugValue:dn,useDeferredValue:dn,useTransition:dn,useMutableSource:dn,useSyncExternalStore:dn,useId:dn,unstable_isNewReconciler:!1},N_={readContext:An,useCallback:function(t,a){return us().memoizedState=[t,a===void 0?null:a],t},useContext:An,useEffect:Eh,useImperativeHandle:function(t,a,o){return o=o!=null?o.concat([t]):null,ao(4194308,4,Mh.bind(null,a,t),o)},useLayoutEffect:function(t,a){return ao(4194308,4,t,a)},useInsertionEffect:function(t,a){return ao(4,2,t,a)},useMemo:function(t,a){var o=us();return a=a===void 0?null:a,t=t(),o.memoizedState=[t,a],t},useReducer:function(t,a,o){var c=us();return a=o!==void 0?o(a):a,c.memoizedState=c.baseState=a,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:a},c.queue=t,t=t.dispatch=b_.bind(null,Tt,t),[c.memoizedState,t]},useRef:function(t){var a=us();return t={current:t},a.memoizedState=t},useState:Nh,useDebugValue:jc,useDeferredValue:function(t){return us().memoizedState=t},useTransition:function(){var t=Nh(!1),a=t[0];return t=C_.bind(null,t[1]),us().memoizedState=t,[a,t]},useMutableSource:function(){},useSyncExternalStore:function(t,a,o){var c=Tt,g=us();if(Nt){if(o===void 0)throw Error(r(407));o=o()}else{if(o=a(),tn===null)throw Error(r(349));(_a&30)!==0||wh(c,a,o)}g.memoizedState=o;var j={value:o,getSnapshot:a};return g.queue=j,Eh(Ch.bind(null,c,j,t),[t]),c.flags|=2048,Wr(9,Sh.bind(null,c,j,o,a),void 0,null),o},useId:function(){var t=us(),a=tn.identifierPrefix;if(Nt){var o=js,c=xs;o=(c&~(1<<32-Kn(c)-1)).toString(32)+o,a=":"+a+"R"+o,o=zr++,0<o&&(a+="H"+o.toString(32)),a+=":"}else o=S_++,a=":"+a+"r"+o.toString(32)+":";return t.memoizedState=a},unstable_isNewReconciler:!1},D_={readContext:An,useCallback:Ih,useContext:An,useEffect:xc,useImperativeHandle:Ph,useInsertionEffect:$h,useLayoutEffect:Th,useMemo:Lh,useReducer:yc,useRef:Dh,useState:function(){return yc(Hr)},useDebugValue:jc,useDeferredValue:function(t){var a=Rn();return Ah(a,Yt.memoizedState,t)},useTransition:function(){var t=yc(Hr)[0],a=Rn().memoizedState;return[t,a]},useMutableSource:xh,useSyncExternalStore:jh,useId:Rh,unstable_isNewReconciler:!1},E_={readContext:An,useCallback:Ih,useContext:An,useEffect:xc,useImperativeHandle:Ph,useInsertionEffect:$h,useLayoutEffect:Th,useMemo:Lh,useReducer:vc,useRef:Dh,useState:function(){return vc(Hr)},useDebugValue:jc,useDeferredValue:function(t){var a=Rn();return Yt===null?a.memoizedState=t:Ah(a,Yt.memoizedState,t)},useTransition:function(){var t=vc(Hr)[0],a=Rn().memoizedState;return[t,a]},useMutableSource:xh,useSyncExternalStore:jh,useId:Rh,unstable_isNewReconciler:!1};function es(t,a){if(t&&t.defaultProps){a=U({},a),t=t.defaultProps;for(var o in t)a[o]===void 0&&(a[o]=t[o]);return a}return a}function wc(t,a,o,c){a=t.memoizedState,o=o(c,a),o=o==null?a:U({},a,o),t.memoizedState=o,t.lanes===0&&(t.updateQueue.baseState=o)}var oo={isMounted:function(t){return(t=t._reactInternals)?da(t)===t:!1},enqueueSetState:function(t,a,o){t=t._reactInternals;var c=yn(),g=Qs(t),j=Ss(c,g);j.payload=a,o!=null&&(j.callback=o),a=Us(t,j,g),a!==null&&(ss(a,t,g,c),Ji(a,t,g))},enqueueReplaceState:function(t,a,o){t=t._reactInternals;var c=yn(),g=Qs(t),j=Ss(c,g);j.tag=1,j.payload=a,o!=null&&(j.callback=o),a=Us(t,j,g),a!==null&&(ss(a,t,g,c),Ji(a,t,g))},enqueueForceUpdate:function(t,a){t=t._reactInternals;var o=yn(),c=Qs(t),g=Ss(o,c);g.tag=2,a!=null&&(g.callback=a),a=Us(t,g,c),a!==null&&(ss(a,t,c,o),Ji(a,t,c))}};function zh(t,a,o,c,g,j,T){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(c,j,T):a.prototype&&a.prototype.isPureReactComponent?!Er(o,c)||!Er(g,j):!0}function Hh(t,a,o){var c=!1,g=Hs,j=a.contextType;return typeof j=="object"&&j!==null?j=An(j):(g=wn(a)?ha:cn.current,c=a.contextTypes,j=(c=c!=null)?Fa(t,g):Hs),a=new a(o,j),t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=oo,t.stateNode=a,a._reactInternals=t,c&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=g,t.__reactInternalMemoizedMaskedChildContext=j),a}function Wh(t,a,o,c){t=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(o,c),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(o,c),a.state!==t&&oo.enqueueReplaceState(a,a.state,null)}function Sc(t,a,o,c){var g=t.stateNode;g.props=o,g.state=t.memoizedState,g.refs={},cc(t);var j=a.contextType;typeof j=="object"&&j!==null?g.context=An(j):(j=wn(a)?ha:cn.current,g.context=Fa(t,j)),g.state=t.memoizedState,j=a.getDerivedStateFromProps,typeof j=="function"&&(wc(t,a,j,o),g.state=t.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(a=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),a!==g.state&&oo.enqueueReplaceState(g,g.state,null),eo(t,o,g,c),g.state=t.memoizedState),typeof g.componentDidMount=="function"&&(t.flags|=4194308)}function Ya(t,a){try{var o="",c=a;do o+=Y(c),c=c.return;while(c);var g=o}catch(j){g=`
Error generating stack: `+j.message+`
`+j.stack}return{value:t,source:a,stack:g,digest:null}}function Cc(t,a,o){return{value:t,source:null,stack:o??null,digest:a??null}}function bc(t,a){try{console.error(a.value)}catch(o){setTimeout(function(){throw o})}}var $_=typeof WeakMap=="function"?WeakMap:Map;function qh(t,a,o){o=Ss(-1,o),o.tag=3,o.payload={element:null};var c=a.value;return o.callback=function(){po||(po=!0,Fc=c),bc(t,a)},o}function Uh(t,a,o){o=Ss(-1,o),o.tag=3;var c=t.type.getDerivedStateFromError;if(typeof c=="function"){var g=a.value;o.payload=function(){return c(g)},o.callback=function(){bc(t,a)}}var j=t.stateNode;return j!==null&&typeof j.componentDidCatch=="function"&&(o.callback=function(){bc(t,a),typeof c!="function"&&(Gs===null?Gs=new Set([this]):Gs.add(this));var T=a.stack;this.componentDidCatch(a.value,{componentStack:T!==null?T:""})}),o}function Vh(t,a,o){var c=t.pingCache;if(c===null){c=t.pingCache=new $_;var g=new Set;c.set(a,g)}else g=c.get(a),g===void 0&&(g=new Set,c.set(a,g));g.has(o)||(g.add(o),t=q_.bind(null,t,a,o),a.then(t,t))}function Gh(t){do{var a;if((a=t.tag===13)&&(a=t.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return t;t=t.return}while(t!==null);return null}function Yh(t,a,o,c,g){return(t.mode&1)===0?(t===a?t.flags|=65536:(t.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(a=Ss(-1,1),a.tag=2,Us(o,a,1))),o.lanes|=1),t):(t.flags|=65536,t.lanes=g,t)}var T_=O.ReactCurrentOwner,Sn=!1;function _n(t,a,o,c){a.child=t===null?mh(a,null,o,c):qa(a,t.child,o,c)}function Qh(t,a,o,c,g){o=o.render;var j=a.ref;return Va(a,g),c=gc(t,a,o,c,j,g),o=_c(),t!==null&&!Sn?(a.updateQueue=t.updateQueue,a.flags&=-2053,t.lanes&=~g,Cs(t,a,g)):(Nt&&o&&Jl(a),a.flags|=1,_n(t,a,c,g),a.child)}function Xh(t,a,o,c,g){if(t===null){var j=o.type;return typeof j=="function"&&!Gc(j)&&j.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(a.tag=15,a.type=j,Kh(t,a,j,c,g)):(t=jo(o.type,null,c,a,a.mode,g),t.ref=a.ref,t.return=a,a.child=t)}if(j=t.child,(t.lanes&g)===0){var T=j.memoizedProps;if(o=o.compare,o=o!==null?o:Er,o(T,c)&&t.ref===a.ref)return Cs(t,a,g)}return a.flags|=1,t=Ks(j,c),t.ref=a.ref,t.return=a,a.child=t}function Kh(t,a,o,c,g){if(t!==null){var j=t.memoizedProps;if(Er(j,c)&&t.ref===a.ref)if(Sn=!1,a.pendingProps=c=j,(t.lanes&g)!==0)(t.flags&131072)!==0&&(Sn=!0);else return a.lanes=t.lanes,Cs(t,a,g)}return kc(t,a,o,c,g)}function Zh(t,a,o){var c=a.pendingProps,g=c.children,j=t!==null?t.memoizedState:null;if(c.mode==="hidden")if((a.mode&1)===0)a.memoizedState={baseLanes:0,cachePool:null,transitions:null},_t(Xa,Tn),Tn|=o;else{if((o&1073741824)===0)return t=j!==null?j.baseLanes|o:o,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:t,cachePool:null,transitions:null},a.updateQueue=null,_t(Xa,Tn),Tn|=t,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=j!==null?j.baseLanes:o,_t(Xa,Tn),Tn|=c}else j!==null?(c=j.baseLanes|o,a.memoizedState=null):c=o,_t(Xa,Tn),Tn|=c;return _n(t,a,g,o),a.child}function Jh(t,a){var o=a.ref;(t===null&&o!==null||t!==null&&t.ref!==o)&&(a.flags|=512,a.flags|=2097152)}function kc(t,a,o,c,g){var j=wn(o)?ha:cn.current;return j=Fa(a,j),Va(a,g),o=gc(t,a,o,c,j,g),c=_c(),t!==null&&!Sn?(a.updateQueue=t.updateQueue,a.flags&=-2053,t.lanes&=~g,Cs(t,a,g)):(Nt&&c&&Jl(a),a.flags|=1,_n(t,a,o,g),a.child)}function ef(t,a,o,c,g){if(wn(o)){var j=!0;Ui(a)}else j=!1;if(Va(a,g),a.stateNode===null)co(t,a),Hh(a,o,c),Sc(a,o,c,g),c=!0;else if(t===null){var T=a.stateNode,X=a.memoizedProps;T.props=X;var Z=T.context,he=o.contextType;typeof he=="object"&&he!==null?he=An(he):(he=wn(o)?ha:cn.current,he=Fa(a,he));var ye=o.getDerivedStateFromProps,ve=typeof ye=="function"||typeof T.getSnapshotBeforeUpdate=="function";ve||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(X!==c||Z!==he)&&Wh(a,T,c,he),qs=!1;var _e=a.memoizedState;T.state=_e,eo(a,c,T,g),Z=a.memoizedState,X!==c||_e!==Z||jn.current||qs?(typeof ye=="function"&&(wc(a,o,ye,c),Z=a.memoizedState),(X=qs||zh(a,o,X,c,_e,Z,he))?(ve||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(a.flags|=4194308)):(typeof T.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=c,a.memoizedState=Z),T.props=c,T.state=Z,T.context=he,c=X):(typeof T.componentDidMount=="function"&&(a.flags|=4194308),c=!1)}else{T=a.stateNode,gh(t,a),X=a.memoizedProps,he=a.type===a.elementType?X:es(a.type,X),T.props=he,ve=a.pendingProps,_e=T.context,Z=o.contextType,typeof Z=="object"&&Z!==null?Z=An(Z):(Z=wn(o)?ha:cn.current,Z=Fa(a,Z));var be=o.getDerivedStateFromProps;(ye=typeof be=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(X!==ve||_e!==Z)&&Wh(a,T,c,Z),qs=!1,_e=a.memoizedState,T.state=_e,eo(a,c,T,g);var Te=a.memoizedState;X!==ve||_e!==Te||jn.current||qs?(typeof be=="function"&&(wc(a,o,be,c),Te=a.memoizedState),(he=qs||zh(a,o,he,c,_e,Te,Z)||!1)?(ye||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(c,Te,Z),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(c,Te,Z)),typeof T.componentDidUpdate=="function"&&(a.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof T.componentDidUpdate!="function"||X===t.memoizedProps&&_e===t.memoizedState||(a.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||X===t.memoizedProps&&_e===t.memoizedState||(a.flags|=1024),a.memoizedProps=c,a.memoizedState=Te),T.props=c,T.state=Te,T.context=Z,c=he):(typeof T.componentDidUpdate!="function"||X===t.memoizedProps&&_e===t.memoizedState||(a.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||X===t.memoizedProps&&_e===t.memoizedState||(a.flags|=1024),c=!1)}return Nc(t,a,o,c,j,g)}function Nc(t,a,o,c,g,j){Jh(t,a);var T=(a.flags&128)!==0;if(!c&&!T)return g&&rh(a,o,!1),Cs(t,a,j);c=a.stateNode,T_.current=a;var X=T&&typeof o.getDerivedStateFromError!="function"?null:c.render();return a.flags|=1,t!==null&&T?(a.child=qa(a,t.child,null,j),a.child=qa(a,null,X,j)):_n(t,a,X,j),a.memoizedState=c.state,g&&rh(a,o,!0),a.child}function tf(t){var a=t.stateNode;a.pendingContext?sh(t,a.pendingContext,a.pendingContext!==a.context):a.context&&sh(t,a.context,!1),dc(t,a.containerInfo)}function nf(t,a,o,c,g){return Wa(),sc(g),a.flags|=256,_n(t,a,o,c),a.child}var Dc={dehydrated:null,treeContext:null,retryLane:0};function Ec(t){return{baseLanes:t,cachePool:null,transitions:null}}function sf(t,a,o){var c=a.pendingProps,g=$t.current,j=!1,T=(a.flags&128)!==0,X;if((X=T)||(X=t!==null&&t.memoizedState===null?!1:(g&2)!==0),X?(j=!0,a.flags&=-129):(t===null||t.memoizedState!==null)&&(g|=1),_t($t,g&1),t===null)return nc(a),t=a.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((a.mode&1)===0?a.lanes=1:t.data==="$!"?a.lanes=8:a.lanes=1073741824,null):(T=c.children,t=c.fallback,j?(c=a.mode,j=a.child,T={mode:"hidden",children:T},(c&1)===0&&j!==null?(j.childLanes=0,j.pendingProps=T):j=wo(T,c,0,null),t=wa(t,c,o,null),j.return=a,t.return=a,j.sibling=t,a.child=j,a.child.memoizedState=Ec(o),a.memoizedState=Dc,t):$c(a,T));if(g=t.memoizedState,g!==null&&(X=g.dehydrated,X!==null))return M_(t,a,T,c,X,g,o);if(j){j=c.fallback,T=a.mode,g=t.child,X=g.sibling;var Z={mode:"hidden",children:c.children};return(T&1)===0&&a.child!==g?(c=a.child,c.childLanes=0,c.pendingProps=Z,a.deletions=null):(c=Ks(g,Z),c.subtreeFlags=g.subtreeFlags&14680064),X!==null?j=Ks(X,j):(j=wa(j,T,o,null),j.flags|=2),j.return=a,c.return=a,c.sibling=j,a.child=c,c=j,j=a.child,T=t.child.memoizedState,T=T===null?Ec(o):{baseLanes:T.baseLanes|o,cachePool:null,transitions:T.transitions},j.memoizedState=T,j.childLanes=t.childLanes&~o,a.memoizedState=Dc,c}return j=t.child,t=j.sibling,c=Ks(j,{mode:"visible",children:c.children}),(a.mode&1)===0&&(c.lanes=o),c.return=a,c.sibling=null,t!==null&&(o=a.deletions,o===null?(a.deletions=[t],a.flags|=16):o.push(t)),a.child=c,a.memoizedState=null,c}function $c(t,a){return a=wo({mode:"visible",children:a},t.mode,0,null),a.return=t,t.child=a}function lo(t,a,o,c){return c!==null&&sc(c),qa(a,t.child,null,o),t=$c(a,a.pendingProps.children),t.flags|=2,a.memoizedState=null,t}function M_(t,a,o,c,g,j,T){if(o)return a.flags&256?(a.flags&=-257,c=Cc(Error(r(422))),lo(t,a,T,c)):a.memoizedState!==null?(a.child=t.child,a.flags|=128,null):(j=c.fallback,g=a.mode,c=wo({mode:"visible",children:c.children},g,0,null),j=wa(j,g,T,null),j.flags|=2,c.return=a,j.return=a,c.sibling=j,a.child=c,(a.mode&1)!==0&&qa(a,t.child,null,T),a.child.memoizedState=Ec(T),a.memoizedState=Dc,j);if((a.mode&1)===0)return lo(t,a,T,null);if(g.data==="$!"){if(c=g.nextSibling&&g.nextSibling.dataset,c)var X=c.dgst;return c=X,j=Error(r(419)),c=Cc(j,c,void 0),lo(t,a,T,c)}if(X=(T&t.childLanes)!==0,Sn||X){if(c=tn,c!==null){switch(T&-T){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=(g&(c.suspendedLanes|T))!==0?0:g,g!==0&&g!==j.retryLane&&(j.retryLane=g,ws(t,g),ss(c,t,g,-1))}return Vc(),c=Cc(Error(r(421))),lo(t,a,T,c)}return g.data==="$?"?(a.flags|=128,a.child=t.child,a=U_.bind(null,t),g._reactRetry=a,null):(t=j.treeContext,$n=Fs(g.nextSibling),En=a,Nt=!0,Jn=null,t!==null&&(In[Ln++]=xs,In[Ln++]=js,In[Ln++]=fa,xs=t.id,js=t.overflow,fa=a),a=$c(a,c.children),a.flags|=4096,a)}function af(t,a,o){t.lanes|=a;var c=t.alternate;c!==null&&(c.lanes|=a),oc(t.return,a,o)}function Tc(t,a,o,c,g){var j=t.memoizedState;j===null?t.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:c,tail:o,tailMode:g}:(j.isBackwards=a,j.rendering=null,j.renderingStartTime=0,j.last=c,j.tail=o,j.tailMode=g)}function rf(t,a,o){var c=a.pendingProps,g=c.revealOrder,j=c.tail;if(_n(t,a,c.children,o),c=$t.current,(c&2)!==0)c=c&1|2,a.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=a.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&af(t,o,a);else if(t.tag===19)af(t,o,a);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===a)break e;for(;t.sibling===null;){if(t.return===null||t.return===a)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}c&=1}if(_t($t,c),(a.mode&1)===0)a.memoizedState=null;else switch(g){case"forwards":for(o=a.child,g=null;o!==null;)t=o.alternate,t!==null&&to(t)===null&&(g=o),o=o.sibling;o=g,o===null?(g=a.child,a.child=null):(g=o.sibling,o.sibling=null),Tc(a,!1,g,o,j);break;case"backwards":for(o=null,g=a.child,a.child=null;g!==null;){if(t=g.alternate,t!==null&&to(t)===null){a.child=g;break}t=g.sibling,g.sibling=o,o=g,g=t}Tc(a,!0,o,null,j);break;case"together":Tc(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function co(t,a){(a.mode&1)===0&&t!==null&&(t.alternate=null,a.alternate=null,a.flags|=2)}function Cs(t,a,o){if(t!==null&&(a.dependencies=t.dependencies),ya|=a.lanes,(o&a.childLanes)===0)return null;if(t!==null&&a.child!==t.child)throw Error(r(153));if(a.child!==null){for(t=a.child,o=Ks(t,t.pendingProps),a.child=o,o.return=a;t.sibling!==null;)t=t.sibling,o=o.sibling=Ks(t,t.pendingProps),o.return=a;o.sibling=null}return a.child}function P_(t,a,o){switch(a.tag){case 3:tf(a),Wa();break;case 5:vh(a);break;case 1:wn(a.type)&&Ui(a);break;case 4:dc(a,a.stateNode.containerInfo);break;case 10:var c=a.type._context,g=a.memoizedProps.value;_t(Ki,c._currentValue),c._currentValue=g;break;case 13:if(c=a.memoizedState,c!==null)return c.dehydrated!==null?(_t($t,$t.current&1),a.flags|=128,null):(o&a.child.childLanes)!==0?sf(t,a,o):(_t($t,$t.current&1),t=Cs(t,a,o),t!==null?t.sibling:null);_t($t,$t.current&1);break;case 19:if(c=(o&a.childLanes)!==0,(t.flags&128)!==0){if(c)return rf(t,a,o);a.flags|=128}if(g=a.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),_t($t,$t.current),c)break;return null;case 22:case 23:return a.lanes=0,Zh(t,a,o)}return Cs(t,a,o)}var of,Mc,lf,cf;of=function(t,a){for(var o=a.child;o!==null;){if(o.tag===5||o.tag===6)t.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return;o=o.return}o.sibling.return=o.return,o=o.sibling}},Mc=function(){},lf=function(t,a,o,c){var g=t.memoizedProps;if(g!==c){t=a.stateNode,ga(ds.current);var j=null;switch(o){case"input":g=ot(t,g),c=ot(t,c),j=[];break;case"select":g=U({},g,{value:void 0}),c=U({},c,{value:void 0}),j=[];break;case"textarea":g=Es(t,g),c=Es(t,c),j=[];break;default:typeof g.onClick!="function"&&typeof c.onClick=="function"&&(t.onclick=Hi)}fr(o,c);var T;o=null;for(he in g)if(!c.hasOwnProperty(he)&&g.hasOwnProperty(he)&&g[he]!=null)if(he==="style"){var X=g[he];for(T in X)X.hasOwnProperty(T)&&(o||(o={}),o[T]="")}else he!=="dangerouslySetInnerHTML"&&he!=="children"&&he!=="suppressContentEditableWarning"&&he!=="suppressHydrationWarning"&&he!=="autoFocus"&&(l.hasOwnProperty(he)?j||(j=[]):(j=j||[]).push(he,null));for(he in c){var Z=c[he];if(X=g?.[he],c.hasOwnProperty(he)&&Z!==X&&(Z!=null||X!=null))if(he==="style")if(X){for(T in X)!X.hasOwnProperty(T)||Z&&Z.hasOwnProperty(T)||(o||(o={}),o[T]="");for(T in Z)Z.hasOwnProperty(T)&&X[T]!==Z[T]&&(o||(o={}),o[T]=Z[T])}else o||(j||(j=[]),j.push(he,o)),o=Z;else he==="dangerouslySetInnerHTML"?(Z=Z?Z.__html:void 0,X=X?X.__html:void 0,Z!=null&&X!==Z&&(j=j||[]).push(he,Z)):he==="children"?typeof Z!="string"&&typeof Z!="number"||(j=j||[]).push(he,""+Z):he!=="suppressContentEditableWarning"&&he!=="suppressHydrationWarning"&&(l.hasOwnProperty(he)?(Z!=null&&he==="onScroll"&&St("scroll",t),j||X===Z||(j=[])):(j=j||[]).push(he,Z))}o&&(j=j||[]).push("style",o);var he=j;(a.updateQueue=he)&&(a.flags|=4)}},cf=function(t,a,o,c){o!==c&&(a.flags|=4)};function qr(t,a){if(!Nt)switch(t.tailMode){case"hidden":a=t.tail;for(var o=null;a!==null;)a.alternate!==null&&(o=a),a=a.sibling;o===null?t.tail=null:o.sibling=null;break;case"collapsed":o=t.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?a||t.tail===null?t.tail=null:t.tail.sibling=null:c.sibling=null}}function un(t){var a=t.alternate!==null&&t.alternate.child===t.child,o=0,c=0;if(a)for(var g=t.child;g!==null;)o|=g.lanes|g.childLanes,c|=g.subtreeFlags&14680064,c|=g.flags&14680064,g.return=t,g=g.sibling;else for(g=t.child;g!==null;)o|=g.lanes|g.childLanes,c|=g.subtreeFlags,c|=g.flags,g.return=t,g=g.sibling;return t.subtreeFlags|=c,t.childLanes=o,a}function I_(t,a,o){var c=a.pendingProps;switch(ec(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return un(a),null;case 1:return wn(a.type)&&qi(),un(a),null;case 3:return c=a.stateNode,Ga(),Ct(jn),Ct(cn),fc(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(t===null||t.child===null)&&(Qi(a)?a.flags|=4:t===null||t.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Jn!==null&&(Wc(Jn),Jn=null))),Mc(t,a),un(a),null;case 5:uc(a);var g=ga(Or.current);if(o=a.type,t!==null&&a.stateNode!=null)lf(t,a,o,c,g),t.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!c){if(a.stateNode===null)throw Error(r(166));return un(a),null}if(t=ga(ds.current),Qi(a)){c=a.stateNode,o=a.type;var j=a.memoizedProps;switch(c[cs]=a,c[Ir]=j,t=(a.mode&1)!==0,o){case"dialog":St("cancel",c),St("close",c);break;case"iframe":case"object":case"embed":St("load",c);break;case"video":case"audio":for(g=0;g<Tr.length;g++)St(Tr[g],c);break;case"source":St("error",c);break;case"img":case"image":case"link":St("error",c),St("load",c);break;case"details":St("toggle",c);break;case"input":ce(c,j),St("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!j.multiple},St("invalid",c);break;case"textarea":$s(c,j),St("invalid",c)}fr(o,j),g=null;for(var T in j)if(j.hasOwnProperty(T)){var X=j[T];T==="children"?typeof X=="string"?c.textContent!==X&&(j.suppressHydrationWarning!==!0&&zi(c.textContent,X,t),g=["children",X]):typeof X=="number"&&c.textContent!==""+X&&(j.suppressHydrationWarning!==!0&&zi(c.textContent,X,t),g=["children",""+X]):l.hasOwnProperty(T)&&X!=null&&T==="onScroll"&&St("scroll",c)}switch(o){case"input":se(c),we(c,j,!0);break;case"textarea":se(c),Ts(c);break;case"select":case"option":break;default:typeof j.onClick=="function"&&(c.onclick=Hi)}c=g,a.updateQueue=c,c!==null&&(a.flags|=4)}else{T=g.nodeType===9?g:g.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=dr(o)),t==="http://www.w3.org/1999/xhtml"?o==="script"?(t=T.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof c.is=="string"?t=T.createElement(o,{is:c.is}):(t=T.createElement(o),o==="select"&&(T=t,c.multiple?T.multiple=!0:c.size&&(T.size=c.size))):t=T.createElementNS(t,o),t[cs]=a,t[Ir]=c,of(t,a,!1,!1),a.stateNode=t;e:{switch(T=$a(o,c),o){case"dialog":St("cancel",t),St("close",t),g=c;break;case"iframe":case"object":case"embed":St("load",t),g=c;break;case"video":case"audio":for(g=0;g<Tr.length;g++)St(Tr[g],t);g=c;break;case"source":St("error",t),g=c;break;case"img":case"image":case"link":St("error",t),St("load",t),g=c;break;case"details":St("toggle",t),g=c;break;case"input":ce(t,c),g=ot(t,c),St("invalid",t);break;case"option":g=c;break;case"select":t._wrapperState={wasMultiple:!!c.multiple},g=U({},c,{value:void 0}),St("invalid",t);break;case"textarea":$s(t,c),g=Es(t,c),St("invalid",t);break;default:g=c}fr(o,g),X=g;for(j in X)if(X.hasOwnProperty(j)){var Z=X[j];j==="style"?hr(t,Z):j==="dangerouslySetInnerHTML"?(Z=Z?Z.__html:void 0,Z!=null&&ur(t,Z)):j==="children"?typeof Z=="string"?(o!=="textarea"||Z!=="")&&oa(t,Z):typeof Z=="number"&&oa(t,""+Z):j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&j!=="autoFocus"&&(l.hasOwnProperty(j)?Z!=null&&j==="onScroll"&&St("scroll",t):Z!=null&&D(t,j,Z,T))}switch(o){case"input":se(t),we(t,c,!1);break;case"textarea":se(t),Ts(t);break;case"option":c.value!=null&&t.setAttribute("value",""+pe(c.value));break;case"select":t.multiple=!!c.multiple,j=c.value,j!=null?Bt(t,!!c.multiple,j,!1):c.defaultValue!=null&&Bt(t,!!c.multiple,c.defaultValue,!0);break;default:typeof g.onClick=="function"&&(t.onclick=Hi)}switch(o){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return un(a),null;case 6:if(t&&a.stateNode!=null)cf(t,a,t.memoizedProps,c);else{if(typeof c!="string"&&a.stateNode===null)throw Error(r(166));if(o=ga(Or.current),ga(ds.current),Qi(a)){if(c=a.stateNode,o=a.memoizedProps,c[cs]=a,(j=c.nodeValue!==o)&&(t=En,t!==null))switch(t.tag){case 3:zi(c.nodeValue,o,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&zi(c.nodeValue,o,(t.mode&1)!==0)}j&&(a.flags|=4)}else c=(o.nodeType===9?o:o.ownerDocument).createTextNode(c),c[cs]=a,a.stateNode=c}return un(a),null;case 13:if(Ct($t),c=a.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Nt&&$n!==null&&(a.mode&1)!==0&&(a.flags&128)===0)uh(),Wa(),a.flags|=98560,j=!1;else if(j=Qi(a),c!==null&&c.dehydrated!==null){if(t===null){if(!j)throw Error(r(318));if(j=a.memoizedState,j=j!==null?j.dehydrated:null,!j)throw Error(r(317));j[cs]=a}else Wa(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;un(a),j=!1}else Jn!==null&&(Wc(Jn),Jn=null),j=!0;if(!j)return a.flags&65536?a:null}return(a.flags&128)!==0?(a.lanes=o,a):(c=c!==null,c!==(t!==null&&t.memoizedState!==null)&&c&&(a.child.flags|=8192,(a.mode&1)!==0&&(t===null||($t.current&1)!==0?Qt===0&&(Qt=3):Vc())),a.updateQueue!==null&&(a.flags|=4),un(a),null);case 4:return Ga(),Mc(t,a),t===null&&Mr(a.stateNode.containerInfo),un(a),null;case 10:return ic(a.type._context),un(a),null;case 17:return wn(a.type)&&qi(),un(a),null;case 19:if(Ct($t),j=a.memoizedState,j===null)return un(a),null;if(c=(a.flags&128)!==0,T=j.rendering,T===null)if(c)qr(j,!1);else{if(Qt!==0||t!==null&&(t.flags&128)!==0)for(t=a.child;t!==null;){if(T=to(t),T!==null){for(a.flags|=128,qr(j,!1),c=T.updateQueue,c!==null&&(a.updateQueue=c,a.flags|=4),a.subtreeFlags=0,c=o,o=a.child;o!==null;)j=o,t=c,j.flags&=14680066,T=j.alternate,T===null?(j.childLanes=0,j.lanes=t,j.child=null,j.subtreeFlags=0,j.memoizedProps=null,j.memoizedState=null,j.updateQueue=null,j.dependencies=null,j.stateNode=null):(j.childLanes=T.childLanes,j.lanes=T.lanes,j.child=T.child,j.subtreeFlags=0,j.deletions=null,j.memoizedProps=T.memoizedProps,j.memoizedState=T.memoizedState,j.updateQueue=T.updateQueue,j.type=T.type,t=T.dependencies,j.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),o=o.sibling;return _t($t,$t.current&1|2),a.child}t=t.sibling}j.tail!==null&&Ot()>Ka&&(a.flags|=128,c=!0,qr(j,!1),a.lanes=4194304)}else{if(!c)if(t=to(T),t!==null){if(a.flags|=128,c=!0,o=t.updateQueue,o!==null&&(a.updateQueue=o,a.flags|=4),qr(j,!0),j.tail===null&&j.tailMode==="hidden"&&!T.alternate&&!Nt)return un(a),null}else 2*Ot()-j.renderingStartTime>Ka&&o!==1073741824&&(a.flags|=128,c=!0,qr(j,!1),a.lanes=4194304);j.isBackwards?(T.sibling=a.child,a.child=T):(o=j.last,o!==null?o.sibling=T:a.child=T,j.last=T)}return j.tail!==null?(a=j.tail,j.rendering=a,j.tail=a.sibling,j.renderingStartTime=Ot(),a.sibling=null,o=$t.current,_t($t,c?o&1|2:o&1),a):(un(a),null);case 22:case 23:return Uc(),c=a.memoizedState!==null,t!==null&&t.memoizedState!==null!==c&&(a.flags|=8192),c&&(a.mode&1)!==0?(Tn&1073741824)!==0&&(un(a),a.subtreeFlags&6&&(a.flags|=8192)):un(a),null;case 24:return null;case 25:return null}throw Error(r(156,a.tag))}function L_(t,a){switch(ec(a),a.tag){case 1:return wn(a.type)&&qi(),t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 3:return Ga(),Ct(jn),Ct(cn),fc(),t=a.flags,(t&65536)!==0&&(t&128)===0?(a.flags=t&-65537|128,a):null;case 5:return uc(a),null;case 13:if(Ct($t),t=a.memoizedState,t!==null&&t.dehydrated!==null){if(a.alternate===null)throw Error(r(340));Wa()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 19:return Ct($t),null;case 4:return Ga(),null;case 10:return ic(a.type._context),null;case 22:case 23:return Uc(),null;case 24:return null;default:return null}}var uo=!1,hn=!1,A_=typeof WeakSet=="function"?WeakSet:Set,Ne=null;function Qa(t,a){var o=t.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(c){It(t,a,c)}else o.current=null}function Pc(t,a,o){try{o()}catch(c){It(t,a,c)}}var df=!1;function R_(t,a){if(Ul=$i,t=zu(),Rl(t)){if("selectionStart"in t)var o={start:t.selectionStart,end:t.selectionEnd};else e:{o=(o=t.ownerDocument)&&o.defaultView||window;var c=o.getSelection&&o.getSelection();if(c&&c.rangeCount!==0){o=c.anchorNode;var g=c.anchorOffset,j=c.focusNode;c=c.focusOffset;try{o.nodeType,j.nodeType}catch{o=null;break e}var T=0,X=-1,Z=-1,he=0,ye=0,ve=t,_e=null;t:for(;;){for(var be;ve!==o||g!==0&&ve.nodeType!==3||(X=T+g),ve!==j||c!==0&&ve.nodeType!==3||(Z=T+c),ve.nodeType===3&&(T+=ve.nodeValue.length),(be=ve.firstChild)!==null;)_e=ve,ve=be;for(;;){if(ve===t)break t;if(_e===o&&++he===g&&(X=T),_e===j&&++ye===c&&(Z=T),(be=ve.nextSibling)!==null)break;ve=_e,_e=ve.parentNode}ve=be}o=X===-1||Z===-1?null:{start:X,end:Z}}else o=null}o=o||{start:0,end:0}}else o=null;for(Vl={focusedElem:t,selectionRange:o},$i=!1,Ne=a;Ne!==null;)if(a=Ne,t=a.child,(a.subtreeFlags&1028)!==0&&t!==null)t.return=a,Ne=t;else for(;Ne!==null;){a=Ne;try{var Te=a.alternate;if((a.flags&1024)!==0)switch(a.tag){case 0:case 11:case 15:break;case 1:if(Te!==null){var Pe=Te.memoizedProps,Ft=Te.memoizedState,ne=a.stateNode,ee=ne.getSnapshotBeforeUpdate(a.elementType===a.type?Pe:es(a.type,Pe),Ft);ne.__reactInternalSnapshotBeforeUpdate=ee}break;case 3:var re=a.stateNode.containerInfo;re.nodeType===1?re.textContent="":re.nodeType===9&&re.documentElement&&re.removeChild(re.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(Se){It(a,a.return,Se)}if(t=a.sibling,t!==null){t.return=a.return,Ne=t;break}Ne=a.return}return Te=df,df=!1,Te}function Ur(t,a,o){var c=a.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var g=c=c.next;do{if((g.tag&t)===t){var j=g.destroy;g.destroy=void 0,j!==void 0&&Pc(a,o,j)}g=g.next}while(g!==c)}}function ho(t,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var o=a=a.next;do{if((o.tag&t)===t){var c=o.create;o.destroy=c()}o=o.next}while(o!==a)}}function Ic(t){var a=t.ref;if(a!==null){var o=t.stateNode;t.tag,t=o,typeof a=="function"?a(t):a.current=t}}function uf(t){var a=t.alternate;a!==null&&(t.alternate=null,uf(a)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(a=t.stateNode,a!==null&&(delete a[cs],delete a[Ir],delete a[Xl],delete a[v_],delete a[x_])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function hf(t){return t.tag===5||t.tag===3||t.tag===4}function ff(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||hf(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Lc(t,a,o){var c=t.tag;if(c===5||c===6)t=t.stateNode,a?o.nodeType===8?o.parentNode.insertBefore(t,a):o.insertBefore(t,a):(o.nodeType===8?(a=o.parentNode,a.insertBefore(t,o)):(a=o,a.appendChild(t)),o=o._reactRootContainer,o!=null||a.onclick!==null||(a.onclick=Hi));else if(c!==4&&(t=t.child,t!==null))for(Lc(t,a,o),t=t.sibling;t!==null;)Lc(t,a,o),t=t.sibling}function Ac(t,a,o){var c=t.tag;if(c===5||c===6)t=t.stateNode,a?o.insertBefore(t,a):o.appendChild(t);else if(c!==4&&(t=t.child,t!==null))for(Ac(t,a,o),t=t.sibling;t!==null;)Ac(t,a,o),t=t.sibling}var an=null,ts=!1;function Vs(t,a,o){for(o=o.child;o!==null;)mf(t,a,o),o=o.sibling}function mf(t,a,o){if(ls&&typeof ls.onCommitFiberUnmount=="function")try{ls.onCommitFiberUnmount(Ci,o)}catch{}switch(o.tag){case 5:hn||Qa(o,a);case 6:var c=an,g=ts;an=null,Vs(t,a,o),an=c,ts=g,an!==null&&(ts?(t=an,o=o.stateNode,t.nodeType===8?t.parentNode.removeChild(o):t.removeChild(o)):an.removeChild(o.stateNode));break;case 18:an!==null&&(ts?(t=an,o=o.stateNode,t.nodeType===8?Ql(t.parentNode,o):t.nodeType===1&&Ql(t,o),Sr(t)):Ql(an,o.stateNode));break;case 4:c=an,g=ts,an=o.stateNode.containerInfo,ts=!0,Vs(t,a,o),an=c,ts=g;break;case 0:case 11:case 14:case 15:if(!hn&&(c=o.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){g=c=c.next;do{var j=g,T=j.destroy;j=j.tag,T!==void 0&&((j&2)!==0||(j&4)!==0)&&Pc(o,a,T),g=g.next}while(g!==c)}Vs(t,a,o);break;case 1:if(!hn&&(Qa(o,a),c=o.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=o.memoizedProps,c.state=o.memoizedState,c.componentWillUnmount()}catch(X){It(o,a,X)}Vs(t,a,o);break;case 21:Vs(t,a,o);break;case 22:o.mode&1?(hn=(c=hn)||o.memoizedState!==null,Vs(t,a,o),hn=c):Vs(t,a,o);break;default:Vs(t,a,o)}}function pf(t){var a=t.updateQueue;if(a!==null){t.updateQueue=null;var o=t.stateNode;o===null&&(o=t.stateNode=new A_),a.forEach(function(c){var g=V_.bind(null,t,c);o.has(c)||(o.add(c),c.then(g,g))})}}function ns(t,a){var o=a.deletions;if(o!==null)for(var c=0;c<o.length;c++){var g=o[c];try{var j=t,T=a,X=T;e:for(;X!==null;){switch(X.tag){case 5:an=X.stateNode,ts=!1;break e;case 3:an=X.stateNode.containerInfo,ts=!0;break e;case 4:an=X.stateNode.containerInfo,ts=!0;break e}X=X.return}if(an===null)throw Error(r(160));mf(j,T,g),an=null,ts=!1;var Z=g.alternate;Z!==null&&(Z.return=null),g.return=null}catch(he){It(g,a,he)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)gf(a,t),a=a.sibling}function gf(t,a){var o=t.alternate,c=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ns(a,t),hs(t),c&4){try{Ur(3,t,t.return),ho(3,t)}catch(Pe){It(t,t.return,Pe)}try{Ur(5,t,t.return)}catch(Pe){It(t,t.return,Pe)}}break;case 1:ns(a,t),hs(t),c&512&&o!==null&&Qa(o,o.return);break;case 5:if(ns(a,t),hs(t),c&512&&o!==null&&Qa(o,o.return),t.flags&32){var g=t.stateNode;try{oa(g,"")}catch(Pe){It(t,t.return,Pe)}}if(c&4&&(g=t.stateNode,g!=null)){var j=t.memoizedProps,T=o!==null?o.memoizedProps:j,X=t.type,Z=t.updateQueue;if(t.updateQueue=null,Z!==null)try{X==="input"&&j.type==="radio"&&j.name!=null&&ae(g,j),$a(X,T);var he=$a(X,j);for(T=0;T<Z.length;T+=2){var ye=Z[T],ve=Z[T+1];ye==="style"?hr(g,ve):ye==="dangerouslySetInnerHTML"?ur(g,ve):ye==="children"?oa(g,ve):D(g,ye,ve,he)}switch(X){case"input":ue(g,j);break;case"textarea":Xn(g,j);break;case"select":var _e=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!j.multiple;var be=j.value;be!=null?Bt(g,!!j.multiple,be,!1):_e!==!!j.multiple&&(j.defaultValue!=null?Bt(g,!!j.multiple,j.defaultValue,!0):Bt(g,!!j.multiple,j.multiple?[]:"",!1))}g[Ir]=j}catch(Pe){It(t,t.return,Pe)}}break;case 6:if(ns(a,t),hs(t),c&4){if(t.stateNode===null)throw Error(r(162));g=t.stateNode,j=t.memoizedProps;try{g.nodeValue=j}catch(Pe){It(t,t.return,Pe)}}break;case 3:if(ns(a,t),hs(t),c&4&&o!==null&&o.memoizedState.isDehydrated)try{Sr(a.containerInfo)}catch(Pe){It(t,t.return,Pe)}break;case 4:ns(a,t),hs(t);break;case 13:ns(a,t),hs(t),g=t.child,g.flags&8192&&(j=g.memoizedState!==null,g.stateNode.isHidden=j,!j||g.alternate!==null&&g.alternate.memoizedState!==null||(Oc=Ot())),c&4&&pf(t);break;case 22:if(ye=o!==null&&o.memoizedState!==null,t.mode&1?(hn=(he=hn)||ye,ns(a,t),hn=he):ns(a,t),hs(t),c&8192){if(he=t.memoizedState!==null,(t.stateNode.isHidden=he)&&!ye&&(t.mode&1)!==0)for(Ne=t,ye=t.child;ye!==null;){for(ve=Ne=ye;Ne!==null;){switch(_e=Ne,be=_e.child,_e.tag){case 0:case 11:case 14:case 15:Ur(4,_e,_e.return);break;case 1:Qa(_e,_e.return);var Te=_e.stateNode;if(typeof Te.componentWillUnmount=="function"){c=_e,o=_e.return;try{a=c,Te.props=a.memoizedProps,Te.state=a.memoizedState,Te.componentWillUnmount()}catch(Pe){It(c,o,Pe)}}break;case 5:Qa(_e,_e.return);break;case 22:if(_e.memoizedState!==null){vf(ve);continue}}be!==null?(be.return=_e,Ne=be):vf(ve)}ye=ye.sibling}e:for(ye=null,ve=t;;){if(ve.tag===5){if(ye===null){ye=ve;try{g=ve.stateNode,he?(j=g.style,typeof j.setProperty=="function"?j.setProperty("display","none","important"):j.display="none"):(X=ve.stateNode,Z=ve.memoizedProps.style,T=Z!=null&&Z.hasOwnProperty("display")?Z.display:null,X.style.display=Ms("display",T))}catch(Pe){It(t,t.return,Pe)}}}else if(ve.tag===6){if(ye===null)try{ve.stateNode.nodeValue=he?"":ve.memoizedProps}catch(Pe){It(t,t.return,Pe)}}else if((ve.tag!==22&&ve.tag!==23||ve.memoizedState===null||ve===t)&&ve.child!==null){ve.child.return=ve,ve=ve.child;continue}if(ve===t)break e;for(;ve.sibling===null;){if(ve.return===null||ve.return===t)break e;ye===ve&&(ye=null),ve=ve.return}ye===ve&&(ye=null),ve.sibling.return=ve.return,ve=ve.sibling}}break;case 19:ns(a,t),hs(t),c&4&&pf(t);break;case 21:break;default:ns(a,t),hs(t)}}function hs(t){var a=t.flags;if(a&2){try{e:{for(var o=t.return;o!==null;){if(hf(o)){var c=o;break e}o=o.return}throw Error(r(160))}switch(c.tag){case 5:var g=c.stateNode;c.flags&32&&(oa(g,""),c.flags&=-33);var j=ff(t);Ac(t,j,g);break;case 3:case 4:var T=c.stateNode.containerInfo,X=ff(t);Lc(t,X,T);break;default:throw Error(r(161))}}catch(Z){It(t,t.return,Z)}t.flags&=-3}a&4096&&(t.flags&=-4097)}function B_(t,a,o){Ne=t,_f(t)}function _f(t,a,o){for(var c=(t.mode&1)!==0;Ne!==null;){var g=Ne,j=g.child;if(g.tag===22&&c){var T=g.memoizedState!==null||uo;if(!T){var X=g.alternate,Z=X!==null&&X.memoizedState!==null||hn;X=uo;var he=hn;if(uo=T,(hn=Z)&&!he)for(Ne=g;Ne!==null;)T=Ne,Z=T.child,T.tag===22&&T.memoizedState!==null?xf(g):Z!==null?(Z.return=T,Ne=Z):xf(g);for(;j!==null;)Ne=j,_f(j),j=j.sibling;Ne=g,uo=X,hn=he}yf(t)}else(g.subtreeFlags&8772)!==0&&j!==null?(j.return=g,Ne=j):yf(t)}}function yf(t){for(;Ne!==null;){var a=Ne;if((a.flags&8772)!==0){var o=a.alternate;try{if((a.flags&8772)!==0)switch(a.tag){case 0:case 11:case 15:hn||ho(5,a);break;case 1:var c=a.stateNode;if(a.flags&4&&!hn)if(o===null)c.componentDidMount();else{var g=a.elementType===a.type?o.memoizedProps:es(a.type,o.memoizedProps);c.componentDidUpdate(g,o.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var j=a.updateQueue;j!==null&&yh(a,j,c);break;case 3:var T=a.updateQueue;if(T!==null){if(o=null,a.child!==null)switch(a.child.tag){case 5:o=a.child.stateNode;break;case 1:o=a.child.stateNode}yh(a,T,o)}break;case 5:var X=a.stateNode;if(o===null&&a.flags&4){o=X;var Z=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":Z.autoFocus&&o.focus();break;case"img":Z.src&&(o.src=Z.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var he=a.alternate;if(he!==null){var ye=he.memoizedState;if(ye!==null){var ve=ye.dehydrated;ve!==null&&Sr(ve)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}hn||a.flags&512&&Ic(a)}catch(_e){It(a,a.return,_e)}}if(a===t){Ne=null;break}if(o=a.sibling,o!==null){o.return=a.return,Ne=o;break}Ne=a.return}}function vf(t){for(;Ne!==null;){var a=Ne;if(a===t){Ne=null;break}var o=a.sibling;if(o!==null){o.return=a.return,Ne=o;break}Ne=a.return}}function xf(t){for(;Ne!==null;){var a=Ne;try{switch(a.tag){case 0:case 11:case 15:var o=a.return;try{ho(4,a)}catch(Z){It(a,o,Z)}break;case 1:var c=a.stateNode;if(typeof c.componentDidMount=="function"){var g=a.return;try{c.componentDidMount()}catch(Z){It(a,g,Z)}}var j=a.return;try{Ic(a)}catch(Z){It(a,j,Z)}break;case 5:var T=a.return;try{Ic(a)}catch(Z){It(a,T,Z)}}}catch(Z){It(a,a.return,Z)}if(a===t){Ne=null;break}var X=a.sibling;if(X!==null){X.return=a.return,Ne=X;break}Ne=a.return}}var O_=Math.ceil,fo=O.ReactCurrentDispatcher,Rc=O.ReactCurrentOwner,Bn=O.ReactCurrentBatchConfig,et=0,tn=null,Ut=null,rn=0,Tn=0,Xa=zs(0),Qt=0,Vr=null,ya=0,mo=0,Bc=0,Gr=null,Cn=null,Oc=0,Ka=1/0,bs=null,po=!1,Fc=null,Gs=null,go=!1,Ys=null,_o=0,Yr=0,zc=null,yo=-1,vo=0;function yn(){return(et&6)!==0?Ot():yo!==-1?yo:yo=Ot()}function Qs(t){return(t.mode&1)===0?1:(et&2)!==0&&rn!==0?rn&-rn:w_.transition!==null?(vo===0&&(vo=hu()),vo):(t=ct,t!==0||(t=window.event,t=t===void 0?16:ju(t.type)),t)}function ss(t,a,o,c){if(50<Yr)throw Yr=0,zc=null,Error(r(185));yr(t,o,c),((et&2)===0||t!==tn)&&(t===tn&&((et&2)===0&&(mo|=o),Qt===4&&Xs(t,rn)),bn(t,c),o===1&&et===0&&(a.mode&1)===0&&(Ka=Ot()+500,Vi&&Ws()))}function bn(t,a){var o=t.callbackNode;wg(t,a);var c=Ni(t,t===tn?rn:0);if(c===0)o!==null&&cu(o),t.callbackNode=null,t.callbackPriority=0;else if(a=c&-c,t.callbackPriority!==a){if(o!=null&&cu(o),a===1)t.tag===0?j_(wf.bind(null,t)):ih(wf.bind(null,t)),__(function(){(et&6)===0&&Ws()}),o=null;else{switch(fu(c)){case 1:o=xl;break;case 4:o=du;break;case 16:o=Si;break;case 536870912:o=uu;break;default:o=Si}o=$f(o,jf.bind(null,t))}t.callbackPriority=a,t.callbackNode=o}}function jf(t,a){if(yo=-1,vo=0,(et&6)!==0)throw Error(r(327));var o=t.callbackNode;if(Za()&&t.callbackNode!==o)return null;var c=Ni(t,t===tn?rn:0);if(c===0)return null;if((c&30)!==0||(c&t.expiredLanes)!==0||a)a=xo(t,c);else{a=c;var g=et;et|=2;var j=Cf();(tn!==t||rn!==a)&&(bs=null,Ka=Ot()+500,xa(t,a));do try{H_();break}catch(X){Sf(t,X)}while(!0);rc(),fo.current=j,et=g,Ut!==null?a=0:(tn=null,rn=0,a=Qt)}if(a!==0){if(a===2&&(g=jl(t),g!==0&&(c=g,a=Hc(t,g))),a===1)throw o=Vr,xa(t,0),Xs(t,c),bn(t,Ot()),o;if(a===6)Xs(t,c);else{if(g=t.current.alternate,(c&30)===0&&!F_(g)&&(a=xo(t,c),a===2&&(j=jl(t),j!==0&&(c=j,a=Hc(t,j))),a===1))throw o=Vr,xa(t,0),Xs(t,c),bn(t,Ot()),o;switch(t.finishedWork=g,t.finishedLanes=c,a){case 0:case 1:throw Error(r(345));case 2:ja(t,Cn,bs);break;case 3:if(Xs(t,c),(c&130023424)===c&&(a=Oc+500-Ot(),10<a)){if(Ni(t,0)!==0)break;if(g=t.suspendedLanes,(g&c)!==c){yn(),t.pingedLanes|=t.suspendedLanes&g;break}t.timeoutHandle=Yl(ja.bind(null,t,Cn,bs),a);break}ja(t,Cn,bs);break;case 4:if(Xs(t,c),(c&4194240)===c)break;for(a=t.eventTimes,g=-1;0<c;){var T=31-Kn(c);j=1<<T,T=a[T],T>g&&(g=T),c&=~j}if(c=g,c=Ot()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*O_(c/1960))-c,10<c){t.timeoutHandle=Yl(ja.bind(null,t,Cn,bs),c);break}ja(t,Cn,bs);break;case 5:ja(t,Cn,bs);break;default:throw Error(r(329))}}}return bn(t,Ot()),t.callbackNode===o?jf.bind(null,t):null}function Hc(t,a){var o=Gr;return t.current.memoizedState.isDehydrated&&(xa(t,a).flags|=256),t=xo(t,a),t!==2&&(a=Cn,Cn=o,a!==null&&Wc(a)),t}function Wc(t){Cn===null?Cn=t:Cn.push.apply(Cn,t)}function F_(t){for(var a=t;;){if(a.flags&16384){var o=a.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var c=0;c<o.length;c++){var g=o[c],j=g.getSnapshot;g=g.value;try{if(!Zn(j(),g))return!1}catch{return!1}}}if(o=a.child,a.subtreeFlags&16384&&o!==null)o.return=a,a=o;else{if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Xs(t,a){for(a&=~Bc,a&=~mo,t.suspendedLanes|=a,t.pingedLanes&=~a,t=t.expirationTimes;0<a;){var o=31-Kn(a),c=1<<o;t[o]=-1,a&=~c}}function wf(t){if((et&6)!==0)throw Error(r(327));Za();var a=Ni(t,0);if((a&1)===0)return bn(t,Ot()),null;var o=xo(t,a);if(t.tag!==0&&o===2){var c=jl(t);c!==0&&(a=c,o=Hc(t,c))}if(o===1)throw o=Vr,xa(t,0),Xs(t,a),bn(t,Ot()),o;if(o===6)throw Error(r(345));return t.finishedWork=t.current.alternate,t.finishedLanes=a,ja(t,Cn,bs),bn(t,Ot()),null}function qc(t,a){var o=et;et|=1;try{return t(a)}finally{et=o,et===0&&(Ka=Ot()+500,Vi&&Ws())}}function va(t){Ys!==null&&Ys.tag===0&&(et&6)===0&&Za();var a=et;et|=1;var o=Bn.transition,c=ct;try{if(Bn.transition=null,ct=1,t)return t()}finally{ct=c,Bn.transition=o,et=a,(et&6)===0&&Ws()}}function Uc(){Tn=Xa.current,Ct(Xa)}function xa(t,a){t.finishedWork=null,t.finishedLanes=0;var o=t.timeoutHandle;if(o!==-1&&(t.timeoutHandle=-1,g_(o)),Ut!==null)for(o=Ut.return;o!==null;){var c=o;switch(ec(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&qi();break;case 3:Ga(),Ct(jn),Ct(cn),fc();break;case 5:uc(c);break;case 4:Ga();break;case 13:Ct($t);break;case 19:Ct($t);break;case 10:ic(c.type._context);break;case 22:case 23:Uc()}o=o.return}if(tn=t,Ut=t=Ks(t.current,null),rn=Tn=a,Qt=0,Vr=null,Bc=mo=ya=0,Cn=Gr=null,pa!==null){for(a=0;a<pa.length;a++)if(o=pa[a],c=o.interleaved,c!==null){o.interleaved=null;var g=c.next,j=o.pending;if(j!==null){var T=j.next;j.next=g,c.next=T}o.pending=c}pa=null}return t}function Sf(t,a){do{var o=Ut;try{if(rc(),no.current=io,so){for(var c=Tt.memoizedState;c!==null;){var g=c.queue;g!==null&&(g.pending=null),c=c.next}so=!1}if(_a=0,en=Yt=Tt=null,Fr=!1,zr=0,Rc.current=null,o===null||o.return===null){Qt=1,Vr=a,Ut=null;break}e:{var j=t,T=o.return,X=o,Z=a;if(a=rn,X.flags|=32768,Z!==null&&typeof Z=="object"&&typeof Z.then=="function"){var he=Z,ye=X,ve=ye.tag;if((ye.mode&1)===0&&(ve===0||ve===11||ve===15)){var _e=ye.alternate;_e?(ye.updateQueue=_e.updateQueue,ye.memoizedState=_e.memoizedState,ye.lanes=_e.lanes):(ye.updateQueue=null,ye.memoizedState=null)}var be=Gh(T);if(be!==null){be.flags&=-257,Yh(be,T,X,j,a),be.mode&1&&Vh(j,he,a),a=be,Z=he;var Te=a.updateQueue;if(Te===null){var Pe=new Set;Pe.add(Z),a.updateQueue=Pe}else Te.add(Z);break e}else{if((a&1)===0){Vh(j,he,a),Vc();break e}Z=Error(r(426))}}else if(Nt&&X.mode&1){var Ft=Gh(T);if(Ft!==null){(Ft.flags&65536)===0&&(Ft.flags|=256),Yh(Ft,T,X,j,a),sc(Ya(Z,X));break e}}j=Z=Ya(Z,X),Qt!==4&&(Qt=2),Gr===null?Gr=[j]:Gr.push(j),j=T;do{switch(j.tag){case 3:j.flags|=65536,a&=-a,j.lanes|=a;var ne=qh(j,Z,a);_h(j,ne);break e;case 1:X=Z;var ee=j.type,re=j.stateNode;if((j.flags&128)===0&&(typeof ee.getDerivedStateFromError=="function"||re!==null&&typeof re.componentDidCatch=="function"&&(Gs===null||!Gs.has(re)))){j.flags|=65536,a&=-a,j.lanes|=a;var Se=Uh(j,X,a);_h(j,Se);break e}}j=j.return}while(j!==null)}kf(o)}catch(Ie){a=Ie,Ut===o&&o!==null&&(Ut=o=o.return);continue}break}while(!0)}function Cf(){var t=fo.current;return fo.current=io,t===null?io:t}function Vc(){(Qt===0||Qt===3||Qt===2)&&(Qt=4),tn===null||(ya&268435455)===0&&(mo&268435455)===0||Xs(tn,rn)}function xo(t,a){var o=et;et|=2;var c=Cf();(tn!==t||rn!==a)&&(bs=null,xa(t,a));do try{z_();break}catch(g){Sf(t,g)}while(!0);if(rc(),et=o,fo.current=c,Ut!==null)throw Error(r(261));return tn=null,rn=0,Qt}function z_(){for(;Ut!==null;)bf(Ut)}function H_(){for(;Ut!==null&&!fg();)bf(Ut)}function bf(t){var a=Ef(t.alternate,t,Tn);t.memoizedProps=t.pendingProps,a===null?kf(t):Ut=a,Rc.current=null}function kf(t){var a=t;do{var o=a.alternate;if(t=a.return,(a.flags&32768)===0){if(o=I_(o,a,Tn),o!==null){Ut=o;return}}else{if(o=L_(o,a),o!==null){o.flags&=32767,Ut=o;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Qt=6,Ut=null;return}}if(a=a.sibling,a!==null){Ut=a;return}Ut=a=t}while(a!==null);Qt===0&&(Qt=5)}function ja(t,a,o){var c=ct,g=Bn.transition;try{Bn.transition=null,ct=1,W_(t,a,o,c)}finally{Bn.transition=g,ct=c}return null}function W_(t,a,o,c){do Za();while(Ys!==null);if((et&6)!==0)throw Error(r(327));o=t.finishedWork;var g=t.finishedLanes;if(o===null)return null;if(t.finishedWork=null,t.finishedLanes=0,o===t.current)throw Error(r(177));t.callbackNode=null,t.callbackPriority=0;var j=o.lanes|o.childLanes;if(Sg(t,j),t===tn&&(Ut=tn=null,rn=0),(o.subtreeFlags&2064)===0&&(o.flags&2064)===0||go||(go=!0,$f(Si,function(){return Za(),null})),j=(o.flags&15990)!==0,(o.subtreeFlags&15990)!==0||j){j=Bn.transition,Bn.transition=null;var T=ct;ct=1;var X=et;et|=4,Rc.current=null,R_(t,o),gf(o,t),c_(Vl),$i=!!Ul,Vl=Ul=null,t.current=o,B_(o),mg(),et=X,ct=T,Bn.transition=j}else t.current=o;if(go&&(go=!1,Ys=t,_o=g),j=t.pendingLanes,j===0&&(Gs=null),_g(o.stateNode),bn(t,Ot()),a!==null)for(c=t.onRecoverableError,o=0;o<a.length;o++)g=a[o],c(g.value,{componentStack:g.stack,digest:g.digest});if(po)throw po=!1,t=Fc,Fc=null,t;return(_o&1)!==0&&t.tag!==0&&Za(),j=t.pendingLanes,(j&1)!==0?t===zc?Yr++:(Yr=0,zc=t):Yr=0,Ws(),null}function Za(){if(Ys!==null){var t=fu(_o),a=Bn.transition,o=ct;try{if(Bn.transition=null,ct=16>t?16:t,Ys===null)var c=!1;else{if(t=Ys,Ys=null,_o=0,(et&6)!==0)throw Error(r(331));var g=et;for(et|=4,Ne=t.current;Ne!==null;){var j=Ne,T=j.child;if((Ne.flags&16)!==0){var X=j.deletions;if(X!==null){for(var Z=0;Z<X.length;Z++){var he=X[Z];for(Ne=he;Ne!==null;){var ye=Ne;switch(ye.tag){case 0:case 11:case 15:Ur(8,ye,j)}var ve=ye.child;if(ve!==null)ve.return=ye,Ne=ve;else for(;Ne!==null;){ye=Ne;var _e=ye.sibling,be=ye.return;if(uf(ye),ye===he){Ne=null;break}if(_e!==null){_e.return=be,Ne=_e;break}Ne=be}}}var Te=j.alternate;if(Te!==null){var Pe=Te.child;if(Pe!==null){Te.child=null;do{var Ft=Pe.sibling;Pe.sibling=null,Pe=Ft}while(Pe!==null)}}Ne=j}}if((j.subtreeFlags&2064)!==0&&T!==null)T.return=j,Ne=T;else e:for(;Ne!==null;){if(j=Ne,(j.flags&2048)!==0)switch(j.tag){case 0:case 11:case 15:Ur(9,j,j.return)}var ne=j.sibling;if(ne!==null){ne.return=j.return,Ne=ne;break e}Ne=j.return}}var ee=t.current;for(Ne=ee;Ne!==null;){T=Ne;var re=T.child;if((T.subtreeFlags&2064)!==0&&re!==null)re.return=T,Ne=re;else e:for(T=ee;Ne!==null;){if(X=Ne,(X.flags&2048)!==0)try{switch(X.tag){case 0:case 11:case 15:ho(9,X)}}catch(Ie){It(X,X.return,Ie)}if(X===T){Ne=null;break e}var Se=X.sibling;if(Se!==null){Se.return=X.return,Ne=Se;break e}Ne=X.return}}if(et=g,Ws(),ls&&typeof ls.onPostCommitFiberRoot=="function")try{ls.onPostCommitFiberRoot(Ci,t)}catch{}c=!0}return c}finally{ct=o,Bn.transition=a}}return!1}function Nf(t,a,o){a=Ya(o,a),a=qh(t,a,1),t=Us(t,a,1),a=yn(),t!==null&&(yr(t,1,a),bn(t,a))}function It(t,a,o){if(t.tag===3)Nf(t,t,o);else for(;a!==null;){if(a.tag===3){Nf(a,t,o);break}else if(a.tag===1){var c=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Gs===null||!Gs.has(c))){t=Ya(o,t),t=Uh(a,t,1),a=Us(a,t,1),t=yn(),a!==null&&(yr(a,1,t),bn(a,t));break}}a=a.return}}function q_(t,a,o){var c=t.pingCache;c!==null&&c.delete(a),a=yn(),t.pingedLanes|=t.suspendedLanes&o,tn===t&&(rn&o)===o&&(Qt===4||Qt===3&&(rn&130023424)===rn&&500>Ot()-Oc?xa(t,0):Bc|=o),bn(t,a)}function Df(t,a){a===0&&((t.mode&1)===0?a=1:(a=ki,ki<<=1,(ki&130023424)===0&&(ki=4194304)));var o=yn();t=ws(t,a),t!==null&&(yr(t,a,o),bn(t,o))}function U_(t){var a=t.memoizedState,o=0;a!==null&&(o=a.retryLane),Df(t,o)}function V_(t,a){var o=0;switch(t.tag){case 13:var c=t.stateNode,g=t.memoizedState;g!==null&&(o=g.retryLane);break;case 19:c=t.stateNode;break;default:throw Error(r(314))}c!==null&&c.delete(a),Df(t,o)}var Ef;Ef=function(t,a,o){if(t!==null)if(t.memoizedProps!==a.pendingProps||jn.current)Sn=!0;else{if((t.lanes&o)===0&&(a.flags&128)===0)return Sn=!1,P_(t,a,o);Sn=(t.flags&131072)!==0}else Sn=!1,Nt&&(a.flags&1048576)!==0&&oh(a,Yi,a.index);switch(a.lanes=0,a.tag){case 2:var c=a.type;co(t,a),t=a.pendingProps;var g=Fa(a,cn.current);Va(a,o),g=gc(null,a,c,t,g,o);var j=_c();return a.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,wn(c)?(j=!0,Ui(a)):j=!1,a.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,cc(a),g.updater=oo,a.stateNode=g,g._reactInternals=a,Sc(a,c,t,o),a=Nc(null,a,c,!0,j,o)):(a.tag=0,Nt&&j&&Jl(a),_n(null,a,g,o),a=a.child),a;case 16:c=a.elementType;e:{switch(co(t,a),t=a.pendingProps,g=c._init,c=g(c._payload),a.type=c,g=a.tag=Y_(c),t=es(c,t),g){case 0:a=kc(null,a,c,t,o);break e;case 1:a=ef(null,a,c,t,o);break e;case 11:a=Qh(null,a,c,t,o);break e;case 14:a=Xh(null,a,c,es(c.type,t),o);break e}throw Error(r(306,c,""))}return a;case 0:return c=a.type,g=a.pendingProps,g=a.elementType===c?g:es(c,g),kc(t,a,c,g,o);case 1:return c=a.type,g=a.pendingProps,g=a.elementType===c?g:es(c,g),ef(t,a,c,g,o);case 3:e:{if(tf(a),t===null)throw Error(r(387));c=a.pendingProps,j=a.memoizedState,g=j.element,gh(t,a),eo(a,c,null,o);var T=a.memoizedState;if(c=T.element,j.isDehydrated)if(j={element:c,isDehydrated:!1,cache:T.cache,pendingSuspenseBoundaries:T.pendingSuspenseBoundaries,transitions:T.transitions},a.updateQueue.baseState=j,a.memoizedState=j,a.flags&256){g=Ya(Error(r(423)),a),a=nf(t,a,c,o,g);break e}else if(c!==g){g=Ya(Error(r(424)),a),a=nf(t,a,c,o,g);break e}else for($n=Fs(a.stateNode.containerInfo.firstChild),En=a,Nt=!0,Jn=null,o=mh(a,null,c,o),a.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Wa(),c===g){a=Cs(t,a,o);break e}_n(t,a,c,o)}a=a.child}return a;case 5:return vh(a),t===null&&nc(a),c=a.type,g=a.pendingProps,j=t!==null?t.memoizedProps:null,T=g.children,Gl(c,g)?T=null:j!==null&&Gl(c,j)&&(a.flags|=32),Jh(t,a),_n(t,a,T,o),a.child;case 6:return t===null&&nc(a),null;case 13:return sf(t,a,o);case 4:return dc(a,a.stateNode.containerInfo),c=a.pendingProps,t===null?a.child=qa(a,null,c,o):_n(t,a,c,o),a.child;case 11:return c=a.type,g=a.pendingProps,g=a.elementType===c?g:es(c,g),Qh(t,a,c,g,o);case 7:return _n(t,a,a.pendingProps,o),a.child;case 8:return _n(t,a,a.pendingProps.children,o),a.child;case 12:return _n(t,a,a.pendingProps.children,o),a.child;case 10:e:{if(c=a.type._context,g=a.pendingProps,j=a.memoizedProps,T=g.value,_t(Ki,c._currentValue),c._currentValue=T,j!==null)if(Zn(j.value,T)){if(j.children===g.children&&!jn.current){a=Cs(t,a,o);break e}}else for(j=a.child,j!==null&&(j.return=a);j!==null;){var X=j.dependencies;if(X!==null){T=j.child;for(var Z=X.firstContext;Z!==null;){if(Z.context===c){if(j.tag===1){Z=Ss(-1,o&-o),Z.tag=2;var he=j.updateQueue;if(he!==null){he=he.shared;var ye=he.pending;ye===null?Z.next=Z:(Z.next=ye.next,ye.next=Z),he.pending=Z}}j.lanes|=o,Z=j.alternate,Z!==null&&(Z.lanes|=o),oc(j.return,o,a),X.lanes|=o;break}Z=Z.next}}else if(j.tag===10)T=j.type===a.type?null:j.child;else if(j.tag===18){if(T=j.return,T===null)throw Error(r(341));T.lanes|=o,X=T.alternate,X!==null&&(X.lanes|=o),oc(T,o,a),T=j.sibling}else T=j.child;if(T!==null)T.return=j;else for(T=j;T!==null;){if(T===a){T=null;break}if(j=T.sibling,j!==null){j.return=T.return,T=j;break}T=T.return}j=T}_n(t,a,g.children,o),a=a.child}return a;case 9:return g=a.type,c=a.pendingProps.children,Va(a,o),g=An(g),c=c(g),a.flags|=1,_n(t,a,c,o),a.child;case 14:return c=a.type,g=es(c,a.pendingProps),g=es(c.type,g),Xh(t,a,c,g,o);case 15:return Kh(t,a,a.type,a.pendingProps,o);case 17:return c=a.type,g=a.pendingProps,g=a.elementType===c?g:es(c,g),co(t,a),a.tag=1,wn(c)?(t=!0,Ui(a)):t=!1,Va(a,o),Hh(a,c,g),Sc(a,c,g,o),Nc(null,a,c,!0,t,o);case 19:return rf(t,a,o);case 22:return Zh(t,a,o)}throw Error(r(156,a.tag))};function $f(t,a){return lu(t,a)}function G_(t,a,o,c){this.tag=t,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function On(t,a,o,c){return new G_(t,a,o,c)}function Gc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Y_(t){if(typeof t=="function")return Gc(t)?1:0;if(t!=null){if(t=t.$$typeof,t===L)return 11;if(t===k)return 14}return 2}function Ks(t,a){var o=t.alternate;return o===null?(o=On(t.tag,a,t.key,t.mode),o.elementType=t.elementType,o.type=t.type,o.stateNode=t.stateNode,o.alternate=t,t.alternate=o):(o.pendingProps=a,o.type=t.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=t.flags&14680064,o.childLanes=t.childLanes,o.lanes=t.lanes,o.child=t.child,o.memoizedProps=t.memoizedProps,o.memoizedState=t.memoizedState,o.updateQueue=t.updateQueue,a=t.dependencies,o.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},o.sibling=t.sibling,o.index=t.index,o.ref=t.ref,o}function jo(t,a,o,c,g,j){var T=2;if(c=t,typeof t=="function")Gc(t)&&(T=1);else if(typeof t=="string")T=5;else e:switch(t){case Q:return wa(o.children,g,j,a);case H:T=8,g|=8;break;case J:return t=On(12,o,a,g|2),t.elementType=J,t.lanes=j,t;case $:return t=On(13,o,a,g),t.elementType=$,t.lanes=j,t;case M:return t=On(19,o,a,g),t.elementType=M,t.lanes=j,t;case F:return wo(o,g,j,a);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case q:T=10;break e;case E:T=9;break e;case L:T=11;break e;case k:T=14;break e;case P:T=16,c=null;break e}throw Error(r(130,t==null?t:typeof t,""))}return a=On(T,o,a,g),a.elementType=t,a.type=c,a.lanes=j,a}function wa(t,a,o,c){return t=On(7,t,c,a),t.lanes=o,t}function wo(t,a,o,c){return t=On(22,t,c,a),t.elementType=F,t.lanes=o,t.stateNode={isHidden:!1},t}function Yc(t,a,o){return t=On(6,t,null,a),t.lanes=o,t}function Qc(t,a,o){return a=On(4,t.children!==null?t.children:[],t.key,a),a.lanes=o,a.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},a}function Q_(t,a,o,c,g){this.tag=a,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wl(0),this.expirationTimes=wl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wl(0),this.identifierPrefix=c,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function Xc(t,a,o,c,g,j,T,X,Z){return t=new Q_(t,a,o,X,Z),a===1?(a=1,j===!0&&(a|=8)):a=0,j=On(3,null,null,a),t.current=j,j.stateNode=t,j.memoizedState={element:c,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},cc(j),t}function X_(t,a,o){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:R,key:c==null?null:""+c,children:t,containerInfo:a,implementation:o}}function Tf(t){if(!t)return Hs;t=t._reactInternals;e:{if(da(t)!==t||t.tag!==1)throw Error(r(170));var a=t;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(wn(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(r(171))}if(t.tag===1){var o=t.type;if(wn(o))return ah(t,o,a)}return a}function Mf(t,a,o,c,g,j,T,X,Z){return t=Xc(o,c,!0,t,g,j,T,X,Z),t.context=Tf(null),o=t.current,c=yn(),g=Qs(o),j=Ss(c,g),j.callback=a??null,Us(o,j,g),t.current.lanes=g,yr(t,g,c),bn(t,c),t}function So(t,a,o,c){var g=a.current,j=yn(),T=Qs(g);return o=Tf(o),a.context===null?a.context=o:a.pendingContext=o,a=Ss(j,T),a.payload={element:t},c=c===void 0?null:c,c!==null&&(a.callback=c),t=Us(g,a,T),t!==null&&(ss(t,g,T,j),Ji(t,g,T)),T}function Co(t){return t=t.current,t.child?(t.child.tag===5,t.child.stateNode):null}function Pf(t,a){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var o=t.retryLane;t.retryLane=o!==0&&o<a?o:a}}function Kc(t,a){Pf(t,a),(t=t.alternate)&&Pf(t,a)}function K_(){return null}var If=typeof reportError=="function"?reportError:function(t){console.error(t)};function Zc(t){this._internalRoot=t}bo.prototype.render=Zc.prototype.render=function(t){var a=this._internalRoot;if(a===null)throw Error(r(409));So(t,a,null,null)},bo.prototype.unmount=Zc.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var a=t.containerInfo;va(function(){So(null,t,null,null)}),a[ys]=null}};function bo(t){this._internalRoot=t}bo.prototype.unstable_scheduleHydration=function(t){if(t){var a=gu();t={blockedOn:null,target:t,priority:a};for(var o=0;o<Rs.length&&a!==0&&a<Rs[o].priority;o++);Rs.splice(o,0,t),o===0&&vu(t)}};function Jc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function ko(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Lf(){}function Z_(t,a,o,c,g){if(g){if(typeof c=="function"){var j=c;c=function(){var he=Co(T);j.call(he)}}var T=Mf(a,c,t,0,null,!1,!1,"",Lf);return t._reactRootContainer=T,t[ys]=T.current,Mr(t.nodeType===8?t.parentNode:t),va(),T}for(;g=t.lastChild;)t.removeChild(g);if(typeof c=="function"){var X=c;c=function(){var he=Co(Z);X.call(he)}}var Z=Xc(t,0,!1,null,null,!1,!1,"",Lf);return t._reactRootContainer=Z,t[ys]=Z.current,Mr(t.nodeType===8?t.parentNode:t),va(function(){So(a,Z,o,c)}),Z}function No(t,a,o,c,g){var j=o._reactRootContainer;if(j){var T=j;if(typeof g=="function"){var X=g;g=function(){var Z=Co(T);X.call(Z)}}So(a,T,t,g)}else T=Z_(o,a,t,g,c);return Co(T)}mu=function(t){switch(t.tag){case 3:var a=t.stateNode;if(a.current.memoizedState.isDehydrated){var o=_r(a.pendingLanes);o!==0&&(Sl(a,o|1),bn(a,Ot()),(et&6)===0&&(Ka=Ot()+500,Ws()))}break;case 13:va(function(){var c=ws(t,1);if(c!==null){var g=yn();ss(c,t,1,g)}}),Kc(t,1)}},Cl=function(t){if(t.tag===13){var a=ws(t,134217728);if(a!==null){var o=yn();ss(a,t,134217728,o)}Kc(t,134217728)}},pu=function(t){if(t.tag===13){var a=Qs(t),o=ws(t,a);if(o!==null){var c=yn();ss(o,t,a,c)}Kc(t,a)}},gu=function(){return ct},_u=function(t,a){var o=ct;try{return ct=t,a()}finally{ct=o}},gr=function(t,a,o){switch(a){case"input":if(ue(t,o),a=o.name,o.type==="radio"&&a!=null){for(o=t;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<o.length;a++){var c=o[a];if(c!==t&&c.form===t.form){var g=Wi(c);if(!g)throw Error(r(90));De(c),ue(c,g)}}}break;case"textarea":Xn(t,o);break;case"select":a=o.value,a!=null&&Bt(t,!!o.multiple,a,!1)}},Ue=qc,lt=va;var J_={usingClientEntryPoint:!1,Events:[Lr,Ba,Wi,Le,Ge,qc]},Qr={findFiberByHostInstance:ua,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},e1={bundleType:Qr.bundleType,version:Qr.version,rendererPackageName:Qr.rendererPackageName,rendererConfig:Qr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:O.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=iu(t),t===null?null:t.stateNode},findFiberByHostInstance:Qr.findFiberByHostInstance||K_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Do=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Do.isDisabled&&Do.supportsFiber)try{Ci=Do.inject(e1),ls=Do}catch{}}return kn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=J_,kn.createPortal=function(t,a){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Jc(a))throw Error(r(200));return X_(t,a,null,o)},kn.createRoot=function(t,a){if(!Jc(t))throw Error(r(299));var o=!1,c="",g=If;return a!=null&&(a.unstable_strictMode===!0&&(o=!0),a.identifierPrefix!==void 0&&(c=a.identifierPrefix),a.onRecoverableError!==void 0&&(g=a.onRecoverableError)),a=Xc(t,1,!1,null,null,o,!1,c,g),t[ys]=a.current,Mr(t.nodeType===8?t.parentNode:t),new Zc(a)},kn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var a=t._reactInternals;if(a===void 0)throw typeof t.render=="function"?Error(r(188)):(t=Object.keys(t).join(","),Error(r(268,t)));return t=iu(a),t=t===null?null:t.stateNode,t},kn.flushSync=function(t){return va(t)},kn.hydrate=function(t,a,o){if(!ko(a))throw Error(r(200));return No(null,t,a,!0,o)},kn.hydrateRoot=function(t,a,o){if(!Jc(t))throw Error(r(405));var c=o!=null&&o.hydratedSources||null,g=!1,j="",T=If;if(o!=null&&(o.unstable_strictMode===!0&&(g=!0),o.identifierPrefix!==void 0&&(j=o.identifierPrefix),o.onRecoverableError!==void 0&&(T=o.onRecoverableError)),a=Mf(a,null,t,1,o??null,g,!1,j,T),t[ys]=a.current,Mr(t),c)for(t=0;t<c.length;t++)o=c[t],g=o._getVersion,g=g(o._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[o,g]:a.mutableSourceEagerHydrationData.push(o,g);return new bo(a)},kn.render=function(t,a,o){if(!ko(a))throw Error(r(200));return No(null,t,a,!1,o)},kn.unmountComponentAtNode=function(t){if(!ko(t))throw Error(r(40));return t._reactRootContainer?(va(function(){No(null,null,t,!1,function(){t._reactRootContainer=null,t[ys]=null})}),!0):!1},kn.unstable_batchedUpdates=qc,kn.unstable_renderSubtreeIntoContainer=function(t,a,o,c){if(!ko(o))throw Error(r(200));if(t==null||t._reactInternals===void 0)throw Error(r(38));return No(t,a,o,!1,c)},kn.version="18.3.1-next-f1338f8080-20240426",kn}var Wf;function Gm(){if(Wf)return nd.exports;Wf=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(s){console.error(s)}}return n(),nd.exports=l1(),nd.exports}var qf;function c1(){if(qf)return $o;qf=1;var n=Gm();return $o.createRoot=n.createRoot,$o.hydrateRoot=n.hydrateRoot,$o}var d1=c1(),nl=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},u1={setTimeout:(n,s)=>setTimeout(n,s),clearTimeout:n=>clearTimeout(n),setInterval:(n,s)=>setInterval(n,s),clearInterval:n=>clearInterval(n)},h1=class{#e=u1;#t=!1;setTimeoutProvider(n){this.#e=n}setTimeout(n,s){return this.#e.setTimeout(n,s)}clearTimeout(n){this.#e.clearTimeout(n)}setInterval(n,s){return this.#e.setInterval(n,s)}clearInterval(n){this.#e.clearInterval(n)}},xd=new h1;function f1(n){setTimeout(n,0)}var sl=typeof window>"u"||"Deno"in globalThis;function is(){}function m1(n,s){return typeof n=="function"?n(s):n}function p1(n){return typeof n=="number"&&n>=0&&n!==1/0}function g1(n,s){return Math.max(n+(s||0)-Date.now(),0)}function jd(n,s){return typeof n=="function"?n(s):n}function _1(n,s){return typeof n=="function"?n(s):n}function Uf(n,s){const{type:r="all",exact:i,fetchStatus:l,predicate:d,queryKey:u,stale:h}=n;if(u){if(i){if(s.queryHash!==zd(u,s.options))return!1}else if(!li(s.queryKey,u))return!1}if(r!=="all"){const p=s.isActive();if(r==="active"&&!p||r==="inactive"&&p)return!1}return!(typeof h=="boolean"&&s.isStale()!==h||l&&l!==s.state.fetchStatus||d&&!d(s))}function Vf(n,s){const{exact:r,status:i,predicate:l,mutationKey:d}=n;if(d){if(!s.options.mutationKey)return!1;if(r){if(oi(s.options.mutationKey)!==oi(d))return!1}else if(!li(s.options.mutationKey,d))return!1}return!(i&&s.state.status!==i||l&&!l(s))}function zd(n,s){return(s?.queryKeyHashFn||oi)(n)}function oi(n){return JSON.stringify(n,(s,r)=>wd(r)?Object.keys(r).sort().reduce((i,l)=>(i[l]=r[l],i),{}):r)}function li(n,s){return n===s?!0:typeof n!=typeof s?!1:n&&s&&typeof n=="object"&&typeof s=="object"?Object.keys(s).every(r=>li(n[r],s[r])):!1}var y1=Object.prototype.hasOwnProperty;function Ym(n,s){if(n===s)return n;const r=Gf(n)&&Gf(s);if(!r&&!(wd(n)&&wd(s)))return s;const l=(r?n:Object.keys(n)).length,d=r?s:Object.keys(s),u=d.length,h=r?new Array(u):{};let p=0;for(let m=0;m<u;m++){const v=r?m:d[m],y=n[v],b=s[v];if(y===b){h[v]=y,(r?m<l:y1.call(n,v))&&p++;continue}if(y===null||b===null||typeof y!="object"||typeof b!="object"){h[v]=b;continue}const w=Ym(y,b);h[v]=w,w===y&&p++}return l===u&&p===l?n:h}function Gf(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function wd(n){if(!Yf(n))return!1;const s=n.constructor;if(s===void 0)return!0;const r=s.prototype;return!(!Yf(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function Yf(n){return Object.prototype.toString.call(n)==="[object Object]"}function v1(n){return new Promise(s=>{xd.setTimeout(s,n)})}function x1(n,s,r){return typeof r.structuralSharing=="function"?r.structuralSharing(n,s):r.structuralSharing!==!1?Ym(n,s):s}function j1(n,s,r=0){const i=[...n,s];return r&&i.length>r?i.slice(1):i}function w1(n,s,r=0){const i=[s,...n];return r&&i.length>r?i.slice(0,-1):i}var Hd=Symbol();function Qm(n,s){return!n.queryFn&&s?.initialPromise?()=>s.initialPromise:!n.queryFn||n.queryFn===Hd?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}var S1=class extends nl{#e;#t;#n;constructor(){super(),this.#n=n=>{if(!sl&&window.addEventListener){const s=()=>n();return window.addEventListener("visibilitychange",s,!1),()=>{window.removeEventListener("visibilitychange",s)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(n){this.#n=n,this.#t?.(),this.#t=n(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus()})}setFocused(n){this.#e!==n&&(this.#e=n,this.onFocus())}onFocus(){const n=this.isFocused();this.listeners.forEach(s=>{s(n)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Xm=new S1;function C1(){let n,s;const r=new Promise((l,d)=>{n=l,s=d});r.status="pending",r.catch(()=>{});function i(l){Object.assign(r,l),delete r.resolve,delete r.reject}return r.resolve=l=>{i({status:"fulfilled",value:l}),n(l)},r.reject=l=>{i({status:"rejected",reason:l}),s(l)},r}var b1=f1;function k1(){let n=[],s=0,r=h=>{h()},i=h=>{h()},l=b1;const d=h=>{s?n.push(h):l(()=>{r(h)})},u=()=>{const h=n;n=[],h.length&&l(()=>{i(()=>{h.forEach(p=>{r(p)})})})};return{batch:h=>{let p;s++;try{p=h()}finally{s--,s||u()}return p},batchCalls:h=>(...p)=>{d(()=>{h(...p)})},schedule:d,setNotifyFunction:h=>{r=h},setBatchNotifyFunction:h=>{i=h},setScheduler:h=>{l=h}}}var vn=k1(),N1=class extends nl{#e=!0;#t;#n;constructor(){super(),this.#n=n=>{if(!sl&&window.addEventListener){const s=()=>n(!0),r=()=>n(!1);return window.addEventListener("online",s,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",r)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(n){this.#n=n,this.#t?.(),this.#t=n(this.setOnline.bind(this))}setOnline(n){this.#e!==n&&(this.#e=n,this.listeners.forEach(r=>{r(n)}))}isOnline(){return this.#e}},Ho=new N1;function D1(n){return Math.min(1e3*2**n,3e4)}function Km(n){return(n??"online")==="online"?Ho.isOnline():!0}var Sd=class extends Error{constructor(n){super("CancelledError"),this.revert=n?.revert,this.silent=n?.silent}};function Zm(n){let s=!1,r=0,i;const l=C1(),d=()=>l.status!=="pending",u=_=>{if(!d()){const S=new Sd(_);b(S),n.onCancel?.(S)}},h=()=>{s=!0},p=()=>{s=!1},m=()=>Xm.isFocused()&&(n.networkMode==="always"||Ho.isOnline())&&n.canRun(),v=()=>Km(n.networkMode)&&n.canRun(),y=_=>{d()||(i?.(),l.resolve(_))},b=_=>{d()||(i?.(),l.reject(_))},w=()=>new Promise(_=>{i=S=>{(d()||m())&&_(S)},n.onPause?.()}).then(()=>{i=void 0,d()||n.onContinue?.()}),x=()=>{if(d())return;let _;const S=r===0?n.initialPromise:void 0;try{_=S??n.fn()}catch(C){_=Promise.reject(C)}Promise.resolve(_).then(y).catch(C=>{if(d())return;const B=n.retry??(sl?0:3),D=n.retryDelay??D1,O=typeof D=="function"?D(r,C):D,z=B===!0||typeof B=="number"&&r<B||typeof B=="function"&&B(r,C);if(s||!z){b(C);return}r++,n.onFail?.(r,C),v1(O).then(()=>m()?void 0:w()).then(()=>{s?b(C):x()})})};return{promise:l,status:()=>l.status,cancel:u,continue:()=>(i?.(),l),cancelRetry:h,continueRetry:p,canStart:v,start:()=>(v()?x():w().then(x),l)}}var Jm=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),p1(this.gcTime)&&(this.#e=xd.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(sl?1/0:300*1e3))}clearGcTimeout(){this.#e&&(xd.clearTimeout(this.#e),this.#e=void 0)}},E1=class extends Jm{#e;#t;#n;#a;#s;#i;#o;constructor(n){super(),this.#o=!1,this.#i=n.defaultOptions,this.setOptions(n.options),this.observers=[],this.#a=n.client,this.#n=this.#a.getQueryCache(),this.queryKey=n.queryKey,this.queryHash=n.queryHash,this.#e=Xf(this.options),this.state=n.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#s?.promise}setOptions(n){if(this.options={...this.#i,...n},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const s=Xf(this.options);s.data!==void 0&&(this.setState(Qf(s.data,s.dataUpdatedAt)),this.#e=s)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(n,s){const r=x1(this.state.data,n,this.options);return this.#r({data:r,type:"success",dataUpdatedAt:s?.updatedAt,manual:s?.manual}),r}setState(n,s){this.#r({type:"setState",state:n,setStateOptions:s})}cancel(n){const s=this.#s?.promise;return this.#s?.cancel(n),s?s.then(is).catch(is):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(n=>_1(n.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Hd||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(n=>jd(n.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(n=>n.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(n=0){return this.state.data===void 0?!0:n==="static"?!1:this.state.isInvalidated?!0:!g1(this.state.dataUpdatedAt,n)}onFocus(){this.observers.find(s=>s.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#s?.continue()}onOnline(){this.observers.find(s=>s.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#s?.continue()}addObserver(n){this.observers.includes(n)||(this.observers.push(n),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:n}))}removeObserver(n){this.observers.includes(n)&&(this.observers=this.observers.filter(s=>s!==n),this.observers.length||(this.#s&&(this.#o?this.#s.cancel({revert:!0}):this.#s.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:n}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#r({type:"invalidate"})}async fetch(n,s){if(this.state.fetchStatus!=="idle"&&this.#s?.status()!=="rejected"){if(this.state.data!==void 0&&s?.cancelRefetch)this.cancel({silent:!0});else if(this.#s)return this.#s.continueRetry(),this.#s.promise}if(n&&this.setOptions(n),!this.options.queryFn){const h=this.observers.find(p=>p.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,i=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,r.signal)})},l=()=>{const h=Qm(this.options,s),m=(()=>{const v={client:this.#a,queryKey:this.queryKey,meta:this.meta};return i(v),v})();return this.#o=!1,this.options.persister?this.options.persister(h,m,this):h(m)},u=(()=>{const h={fetchOptions:s,options:this.options,queryKey:this.queryKey,client:this.#a,state:this.state,fetchFn:l};return i(h),h})();this.options.behavior?.onFetch(u,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==u.fetchOptions?.meta)&&this.#r({type:"fetch",meta:u.fetchOptions?.meta}),this.#s=Zm({initialPromise:s?.initialPromise,fn:u.fetchFn,onCancel:h=>{h instanceof Sd&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(h,p)=>{this.#r({type:"failed",failureCount:h,error:p})},onPause:()=>{this.#r({type:"pause"})},onContinue:()=>{this.#r({type:"continue"})},retry:u.options.retry,retryDelay:u.options.retryDelay,networkMode:u.options.networkMode,canRun:()=>!0});try{const h=await this.#s.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof Sd){if(h.silent)return this.#s.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#r({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#r(n){const s=r=>{switch(n.type){case"failed":return{...r,fetchFailureCount:n.failureCount,fetchFailureReason:n.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...$1(r.data,this.options),fetchMeta:n.meta??null};case"success":const i={...r,...Qf(n.data,n.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!n.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=n.manual?i:void 0,i;case"error":const l=n.error;return{...r,error:l,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:l,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...n.state}}};this.state=s(this.state),vn.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:n})})}};function $1(n,s){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Km(s.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function Qf(n,s){return{data:n,dataUpdatedAt:s??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Xf(n){const s=typeof n.initialData=="function"?n.initialData():n.initialData,r=s!==void 0,i=r?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:s,dataUpdateCount:0,dataUpdatedAt:r?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}function Kf(n){return{onFetch:(s,r)=>{const i=s.options,l=s.fetchOptions?.meta?.fetchMore?.direction,d=s.state.data?.pages||[],u=s.state.data?.pageParams||[];let h={pages:[],pageParams:[]},p=0;const m=async()=>{let v=!1;const y=x=>{Object.defineProperty(x,"signal",{enumerable:!0,get:()=>(s.signal.aborted?v=!0:s.signal.addEventListener("abort",()=>{v=!0}),s.signal)})},b=Qm(s.options,s.fetchOptions),w=async(x,_,S)=>{if(v)return Promise.reject();if(_==null&&x.pages.length)return Promise.resolve(x);const B=(()=>{const R={client:s.client,queryKey:s.queryKey,pageParam:_,direction:S?"backward":"forward",meta:s.options.meta};return y(R),R})(),D=await b(B),{maxPages:O}=s.options,z=S?w1:j1;return{pages:z(x.pages,D,O),pageParams:z(x.pageParams,_,O)}};if(l&&d.length){const x=l==="backward",_=x?T1:Zf,S={pages:d,pageParams:u},C=_(i,S);h=await w(S,C,x)}else{const x=n??d.length;do{const _=p===0?u[0]??i.initialPageParam:Zf(i,h);if(p>0&&_==null)break;h=await w(h,_),p++}while(p<x)}return h};s.options.persister?s.fetchFn=()=>s.options.persister?.(m,{client:s.client,queryKey:s.queryKey,meta:s.options.meta,signal:s.signal},r):s.fetchFn=m}}}function Zf(n,{pages:s,pageParams:r}){const i=s.length-1;return s.length>0?n.getNextPageParam(s[i],s,r[i],r):void 0}function T1(n,{pages:s,pageParams:r}){return s.length>0?n.getPreviousPageParam?.(s[0],s,r[0],r):void 0}var M1=class extends Jm{#e;#t;#n;#a;constructor(n){super(),this.#e=n.client,this.mutationId=n.mutationId,this.#n=n.mutationCache,this.#t=[],this.state=n.state||P1(),this.setOptions(n.options),this.scheduleGc()}setOptions(n){this.options=n,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(n){this.#t.includes(n)||(this.#t.push(n),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:n}))}removeObserver(n){this.#t=this.#t.filter(s=>s!==n),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:n})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#a?.continue()??this.execute(this.state.variables)}async execute(n){const s=()=>{this.#s({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#a=Zm({fn:()=>this.options.mutationFn?this.options.mutationFn(n,r):Promise.reject(new Error("No mutationFn found")),onFail:(d,u)=>{this.#s({type:"failed",failureCount:d,error:u})},onPause:()=>{this.#s({type:"pause"})},onContinue:s,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const i=this.state.status==="pending",l=!this.#a.canStart();try{if(i)s();else{this.#s({type:"pending",variables:n,isPaused:l}),await this.#n.config.onMutate?.(n,this,r);const u=await this.options.onMutate?.(n,r);u!==this.state.context&&this.#s({type:"pending",context:u,variables:n,isPaused:l})}const d=await this.#a.start();return await this.#n.config.onSuccess?.(d,n,this.state.context,this,r),await this.options.onSuccess?.(d,n,this.state.context,r),await this.#n.config.onSettled?.(d,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(d,null,n,this.state.context,r),this.#s({type:"success",data:d}),d}catch(d){try{throw await this.#n.config.onError?.(d,n,this.state.context,this,r),await this.options.onError?.(d,n,this.state.context,r),await this.#n.config.onSettled?.(void 0,d,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(void 0,d,n,this.state.context,r),d}finally{this.#s({type:"error",error:d})}}finally{this.#n.runNext(this)}}#s(n){const s=r=>{switch(n.type){case"failed":return{...r,failureCount:n.failureCount,failureReason:n.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:n.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:n.isPaused,status:"pending",variables:n.variables,submittedAt:Date.now()};case"success":return{...r,data:n.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:n.error,failureCount:r.failureCount+1,failureReason:n.error,isPaused:!1,status:"error"}}};this.state=s(this.state),vn.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(n)}),this.#n.notify({mutation:this,type:"updated",action:n})})}};function P1(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var I1=class extends nl{constructor(n={}){super(),this.config=n,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(n,s,r){const i=new M1({client:n,mutationCache:this,mutationId:++this.#n,options:n.defaultMutationOptions(s),state:r});return this.add(i),i}add(n){this.#e.add(n);const s=To(n);if(typeof s=="string"){const r=this.#t.get(s);r?r.push(n):this.#t.set(s,[n])}this.notify({type:"added",mutation:n})}remove(n){if(this.#e.delete(n)){const s=To(n);if(typeof s=="string"){const r=this.#t.get(s);if(r)if(r.length>1){const i=r.indexOf(n);i!==-1&&r.splice(i,1)}else r[0]===n&&this.#t.delete(s)}}this.notify({type:"removed",mutation:n})}canRun(n){const s=To(n);if(typeof s=="string"){const i=this.#t.get(s)?.find(l=>l.state.status==="pending");return!i||i===n}else return!0}runNext(n){const s=To(n);return typeof s=="string"?this.#t.get(s)?.find(i=>i!==n&&i.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){vn.batch(()=>{this.#e.forEach(n=>{this.notify({type:"removed",mutation:n})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(n){const s={exact:!0,...n};return this.getAll().find(r=>Vf(s,r))}findAll(n={}){return this.getAll().filter(s=>Vf(n,s))}notify(n){vn.batch(()=>{this.listeners.forEach(s=>{s(n)})})}resumePausedMutations(){const n=this.getAll().filter(s=>s.state.isPaused);return vn.batch(()=>Promise.all(n.map(s=>s.continue().catch(is))))}};function To(n){return n.options.scope?.id}var L1=class extends nl{constructor(n={}){super(),this.config=n,this.#e=new Map}#e;build(n,s,r){const i=s.queryKey,l=s.queryHash??zd(i,s);let d=this.get(l);return d||(d=new E1({client:n,queryKey:i,queryHash:l,options:n.defaultQueryOptions(s),state:r,defaultOptions:n.getQueryDefaults(i)}),this.add(d)),d}add(n){this.#e.has(n.queryHash)||(this.#e.set(n.queryHash,n),this.notify({type:"added",query:n}))}remove(n){const s=this.#e.get(n.queryHash);s&&(n.destroy(),s===n&&this.#e.delete(n.queryHash),this.notify({type:"removed",query:n}))}clear(){vn.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}get(n){return this.#e.get(n)}getAll(){return[...this.#e.values()]}find(n){const s={exact:!0,...n};return this.getAll().find(r=>Uf(s,r))}findAll(n={}){const s=this.getAll();return Object.keys(n).length>0?s.filter(r=>Uf(n,r)):s}notify(n){vn.batch(()=>{this.listeners.forEach(s=>{s(n)})})}onFocus(){vn.batch(()=>{this.getAll().forEach(n=>{n.onFocus()})})}onOnline(){vn.batch(()=>{this.getAll().forEach(n=>{n.onOnline()})})}},A1=class{#e;#t;#n;#a;#s;#i;#o;#r;constructor(n={}){this.#e=n.queryCache||new L1,this.#t=n.mutationCache||new I1,this.#n=n.defaultOptions||{},this.#a=new Map,this.#s=new Map,this.#i=0}mount(){this.#i++,this.#i===1&&(this.#o=Xm.subscribe(async n=>{n&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#r=Ho.subscribe(async n=>{n&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#i--,this.#i===0&&(this.#o?.(),this.#o=void 0,this.#r?.(),this.#r=void 0)}isFetching(n){return this.#e.findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return this.#t.findAll({...n,status:"pending"}).length}getQueryData(n){const s=this.defaultQueryOptions({queryKey:n});return this.#e.get(s.queryHash)?.state.data}ensureQueryData(n){const s=this.defaultQueryOptions(n),r=this.#e.build(this,s),i=r.state.data;return i===void 0?this.fetchQuery(n):(n.revalidateIfStale&&r.isStaleByTime(jd(s.staleTime,r))&&this.prefetchQuery(s),Promise.resolve(i))}getQueriesData(n){return this.#e.findAll(n).map(({queryKey:s,state:r})=>{const i=r.data;return[s,i]})}setQueryData(n,s,r){const i=this.defaultQueryOptions({queryKey:n}),d=this.#e.get(i.queryHash)?.state.data,u=m1(s,d);if(u!==void 0)return this.#e.build(this,i).setData(u,{...r,manual:!0})}setQueriesData(n,s,r){return vn.batch(()=>this.#e.findAll(n).map(({queryKey:i})=>[i,this.setQueryData(i,s,r)]))}getQueryState(n){const s=this.defaultQueryOptions({queryKey:n});return this.#e.get(s.queryHash)?.state}removeQueries(n){const s=this.#e;vn.batch(()=>{s.findAll(n).forEach(r=>{s.remove(r)})})}resetQueries(n,s){const r=this.#e;return vn.batch(()=>(r.findAll(n).forEach(i=>{i.reset()}),this.refetchQueries({type:"active",...n},s)))}cancelQueries(n,s={}){const r={revert:!0,...s},i=vn.batch(()=>this.#e.findAll(n).map(l=>l.cancel(r)));return Promise.all(i).then(is).catch(is)}invalidateQueries(n,s={}){return vn.batch(()=>(this.#e.findAll(n).forEach(r=>{r.invalidate()}),n?.refetchType==="none"?Promise.resolve():this.refetchQueries({...n,type:n?.refetchType??n?.type??"active"},s)))}refetchQueries(n,s={}){const r={...s,cancelRefetch:s.cancelRefetch??!0},i=vn.batch(()=>this.#e.findAll(n).filter(l=>!l.isDisabled()&&!l.isStatic()).map(l=>{let d=l.fetch(void 0,r);return r.throwOnError||(d=d.catch(is)),l.state.fetchStatus==="paused"?Promise.resolve():d}));return Promise.all(i).then(is)}fetchQuery(n){const s=this.defaultQueryOptions(n);s.retry===void 0&&(s.retry=!1);const r=this.#e.build(this,s);return r.isStaleByTime(jd(s.staleTime,r))?r.fetch(s):Promise.resolve(r.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(is).catch(is)}fetchInfiniteQuery(n){return n.behavior=Kf(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(is).catch(is)}ensureInfiniteQueryData(n){return n.behavior=Kf(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return Ho.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(n){this.#n=n}setQueryDefaults(n,s){this.#a.set(oi(n),{queryKey:n,defaultOptions:s})}getQueryDefaults(n){const s=[...this.#a.values()],r={};return s.forEach(i=>{li(n,i.queryKey)&&Object.assign(r,i.defaultOptions)}),r}setMutationDefaults(n,s){this.#s.set(oi(n),{mutationKey:n,defaultOptions:s})}getMutationDefaults(n){const s=[...this.#s.values()],r={};return s.forEach(i=>{li(n,i.mutationKey)&&Object.assign(r,i.defaultOptions)}),r}defaultQueryOptions(n){if(n._defaulted)return n;const s={...this.#n.queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return s.queryHash||(s.queryHash=zd(s.queryKey,s)),s.refetchOnReconnect===void 0&&(s.refetchOnReconnect=s.networkMode!=="always"),s.throwOnError===void 0&&(s.throwOnError=!!s.suspense),!s.networkMode&&s.persister&&(s.networkMode="offlineFirst"),s.queryFn===Hd&&(s.enabled=!1),s}defaultMutationOptions(n){return n?._defaulted?n:{...this.#n.mutations,...n?.mutationKey&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},R1=f.createContext(void 0),B1=({client:n,children:s})=>(f.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),e.jsx(R1.Provider,{value:n,children:s}));const O1="modulepreload",F1=function(n){return"/"+n},Jf={},zo=function(s,r,i){let l=Promise.resolve();if(r&&r.length>0){let m=function(v){return Promise.all(v.map(y=>Promise.resolve(y).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};var u=m;document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),p=h?.nonce||h?.getAttribute("nonce");l=m(r.map(v=>{if(v=F1(v),v in Jf)return;Jf[v]=!0;const y=v.endsWith(".css"),b=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${b}`))return;const w=document.createElement("link");if(w.rel=y?"stylesheet":O1,y||(w.as="script"),w.crossOrigin="",w.href=v,p&&w.setAttribute("nonce",p),document.head.appendChild(w),y)return new Promise((x,_)=>{w.addEventListener("load",x),w.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${v}`)))})}))}function d(h){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=h,window.dispatchEvent(p),!p.defaultPrevented)throw h}return l.then(h=>{for(const p of h||[])p.status==="rejected"&&d(p.reason);return s().catch(d)})},em=n=>{let s;const r=new Set,i=(m,v)=>{const y=typeof m=="function"?m(s):m;if(!Object.is(y,s)){const b=s;s=v??(typeof y!="object"||y===null)?y:Object.assign({},s,y),r.forEach(w=>w(s,b))}},l=()=>s,h={setState:i,getState:l,getInitialState:()=>p,subscribe:m=>(r.add(m),()=>r.delete(m))},p=s=n(i,l,h);return h},z1=(n=>n?em(n):em),H1=n=>n;function W1(n,s=H1){const r=Eo.useSyncExternalStore(n.subscribe,Eo.useCallback(()=>s(n.getState()),[n,s]),Eo.useCallback(()=>s(n.getInitialState()),[n,s]));return Eo.useDebugValue(r),r}const tm=n=>{const s=z1(n),r=i=>W1(s,i);return Object.assign(r,s),r},al=(n=>n?tm(n):tm);function ep(n,s){let r;try{r=n()}catch{return}return{getItem:l=>{var d;const u=p=>p===null?null:JSON.parse(p,void 0),h=(d=r.getItem(l))!=null?d:null;return h instanceof Promise?h.then(u):u(h)},setItem:(l,d)=>r.setItem(l,JSON.stringify(d,void 0)),removeItem:l=>r.removeItem(l)}}const Cd=n=>s=>{try{const r=n(s);return r instanceof Promise?r:{then(i){return Cd(i)(r)},catch(i){return this}}}catch(r){return{then(i){return this},catch(i){return Cd(i)(r)}}}},q1=(n,s)=>(r,i,l)=>{let d={storage:ep(()=>localStorage),partialize:_=>_,version:0,merge:(_,S)=>({...S,..._}),...s},u=!1;const h=new Set,p=new Set;let m=d.storage;if(!m)return n((..._)=>{console.warn(`[zustand persist middleware] Unable to update item '${d.name}', the given storage is currently unavailable.`),r(..._)},i,l);const v=()=>{const _=d.partialize({...i()});return m.setItem(d.name,{state:_,version:d.version})},y=l.setState;l.setState=(_,S)=>(y(_,S),v());const b=n((..._)=>(r(..._),v()),i,l);l.getInitialState=()=>b;let w;const x=()=>{var _,S;if(!m)return;u=!1,h.forEach(B=>{var D;return B((D=i())!=null?D:b)});const C=((S=d.onRehydrateStorage)==null?void 0:S.call(d,(_=i())!=null?_:b))||void 0;return Cd(m.getItem.bind(m))(d.name).then(B=>{if(B)if(typeof B.version=="number"&&B.version!==d.version){if(d.migrate){const D=d.migrate(B.state,B.version);return D instanceof Promise?D.then(O=>[!0,O]):[!0,D]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,B.state];return[!1,void 0]}).then(B=>{var D;const[O,z]=B;if(w=d.merge(z,(D=i())!=null?D:b),r(w,!0),O)return v()}).then(()=>{C?.(w,void 0),w=i(),u=!0,p.forEach(B=>B(w))}).catch(B=>{C?.(void 0,B)})};return l.persist={setOptions:_=>{d={...d,..._},_.storage&&(m=_.storage)},clearStorage:()=>{m?.removeItem(d.name)},getOptions:()=>d,rehydrate:()=>x(),hasHydrated:()=>u,onHydrate:_=>(h.add(_),()=>{h.delete(_)}),onFinishHydration:_=>(p.add(_),()=>{p.delete(_)})},d.skipHydration||x(),w||b},U1=q1,V1={week:100,month:36,quarter:50,year:80};function bd(n){const s={1:[]};for(const i of n.phases||[])if(!i.is_milestone){const l=i.children||[],d=l.length>0;s[1].push({type:"phase",id:i.id,hasChildren:d}),d&&tp(l,2,s)}let r=0;for(const i in s)s[i]&&s[i].length>0&&(r=Math.max(r,parseInt(i)));return r=Math.max(r,1),{levels:s,maxLevel:r}}function tp(n,s,r){if(!(!n||n.length===0)){r[s]||(r[s]=[]);for(const i of n){const l=i.children||[],d=l.length>0;r[s].push({type:"subphase",id:i.id,hasChildren:d}),d&&tp(l,s+1,r)}}}function nm(n,s,r,i){if(!s.has(n.id))return 0;const{levels:l,maxLevel:d}=bd(n);if(!l[1]||l[1].length===0||!l[1].some(h=>r.has(h.id)))return 1;for(let h=2;h<=d;h++){if(!l[h]||l[h].length===0)continue;if(!l[h].some(m=>i.has(m.id)))return h}return d}function sm(n,s,r,i,l,d,u){const h=new Set(l),p=new Set(d),m=new Set(u);if(s===0){h.delete(n.id);for(const v of r[1]||[])p.delete(v.id);for(let v=2;v<=i;v++)for(const y of r[v]||[])m.delete(y.id)}else if(h.add(n.id),s===1){for(const v of r[1]||[])p.delete(v.id);for(let v=2;v<=i;v++)for(const y of r[v]||[])m.delete(y.id)}else{for(const v of r[1]||[])p.add(v.id);for(let v=2;v<=i;v++)for(const y of r[v]||[])v<s?m.add(y.id):m.delete(y.id)}return{expandedProjects:h,expandedPhases:p,expandedSubphases:m}}const am={isAuthChecking:!0,isAuthenticated:!1,sites:[],projects:[],staff:[],equipment:[],vacations:[],bankHolidays:[],bankHolidayDates:new Set,companyEvents:[],companyEventDates:new Set,users:[],instanceSettings:null,customColumns:[],customColumnValues:{},customColumnFilters:{},showAllCustomColumns:!0,hiddenCustomColumns:new Set,skills:[],currentSite:null,currentUser:null,_persistedSiteId:null,viewMode:"month",currentView:"gantt",currentDate:new Date,cellWidth:36,currentResourceTab:"staff",timelineScrollLeft:0,showAssignments:!0,showStaffOverview:!1,showEquipmentOverview:!1,expandedProjects:new Set,expandedPhases:new Set,expandedSubphases:new Set,expandedStaff:new Set,expandedEquipment:new Set,expandedBankHolidays:!1,criticalPathEnabled:new Set,criticalPathItems:new Map,whatIfMode:!1,whatIfSnapshot:null,whatIfPendingOperations:[],sidebarCollapsed:!1,resourcePanelCollapsed:!1},G=al()(U1((n,s)=>({...am,setSites:r=>n({sites:r}),setProjects:r=>n({projects:r}),setStaff:r=>n({staff:r}),setEquipment:r=>n({equipment:r}),setVacations:r=>n({vacations:r}),setBankHolidays:(r,i)=>n({bankHolidays:r,bankHolidayDates:i}),setCompanyEvents:(r,i)=>n({companyEvents:r,companyEventDates:i}),setUsers:r=>n({users:r}),setInstanceSettings:r=>n({instanceSettings:r}),setCustomColumns:r=>n({customColumns:r}),setCustomColumnValues:r=>n({customColumnValues:r}),setSkills:r=>n({skills:r}),setCustomColumnValue:(r,i,l,d)=>n(u=>({customColumnValues:{...u.customColumnValues,[`${r}-${i}-${l}`]:d}})),setCustomColumnFilter:(r,i)=>n(l=>({customColumnFilters:{...l.customColumnFilters,[r]:i}})),clearCustomColumnFilter:r=>n(i=>{const l={...i.customColumnFilters};return delete l[r],{customColumnFilters:l}}),clearAllCustomColumnFilters:()=>n({customColumnFilters:{}}),entityPassesFilters:(r,i)=>{const l=s(),{customColumnFilters:d,customColumnValues:u}=l,h=Object.keys(d).filter(p=>d[Number(p)]?.length>0);if(h.length===0)return!0;for(const p of h){const m=Number(p),v=d[m],y=`${m}-${r}-${i}`,b=u[y]??null;if(b===null){if(!v.includes("__empty__"))return!1}else if(!v.includes(b))return!1}return!0},setShowAllCustomColumns:r=>n({showAllCustomColumns:r}),toggleCustomColumnVisibility:r=>n(i=>{const l=new Set(i.hiddenCustomColumns);return l.has(r)?l.delete(r):l.add(r),{hiddenCustomColumns:l}}),setCurrentSite:r=>n({currentSite:r,_persistedSiteId:r?.id??null}),setCurrentUser:r=>n({currentUser:r}),setAuthChecking:r=>n({isAuthChecking:r}),setAuthenticated:r=>n({isAuthenticated:r}),setViewMode:r=>n({viewMode:r,cellWidth:V1[r]}),setCurrentView:r=>n({currentView:r}),setCurrentDate:r=>n({currentDate:r}),setCellWidth:r=>n({cellWidth:r}),setCurrentResourceTab:r=>n({currentResourceTab:r}),setTimelineScrollLeft:r=>n({timelineScrollLeft:r}),setShowAssignments:r=>n({showAssignments:r}),toggleShowAssignments:()=>n(r=>({showAssignments:!r.showAssignments})),setShowStaffOverview:r=>n({showStaffOverview:r,showEquipmentOverview:r?!1:s().showEquipmentOverview}),toggleShowStaffOverview:()=>n(r=>({showStaffOverview:!r.showStaffOverview,showEquipmentOverview:r.showStaffOverview?r.showEquipmentOverview:!1})),setShowEquipmentOverview:r=>n({showEquipmentOverview:r,showStaffOverview:r?!1:s().showStaffOverview}),toggleShowEquipmentOverview:()=>n(r=>({showEquipmentOverview:!r.showEquipmentOverview,showStaffOverview:r.showEquipmentOverview?r.showStaffOverview:!1})),navigatePeriod:r=>{const{viewMode:i,currentDate:l}=s(),d=new Date(l);switch(i){case"week":d.setDate(d.getDate()+r*7);break;case"month":d.setMonth(d.getMonth()+r);break;case"quarter":d.setMonth(d.getMonth()+r*3);break;case"year":d.setFullYear(d.getFullYear()+r);break}n({currentDate:d})},goToToday:()=>n({currentDate:new Date}),toggleProjectExpanded:r=>n(i=>{const l=new Set(i.expandedProjects);return l.has(r)?l.delete(r):l.add(r),{expandedProjects:l}}),togglePhaseExpanded:r=>n(i=>{const l=new Set(i.expandedPhases);return l.has(r)?l.delete(r):l.add(r),{expandedPhases:l}}),toggleSubphaseExpanded:r=>n(i=>{const l=new Set(i.expandedSubphases);return l.has(r)?l.delete(r):l.add(r),{expandedSubphases:l}}),toggleStaffExpanded:r=>n(i=>{const l=new Set(i.expandedStaff);return l.has(r)?l.delete(r):l.add(r),{expandedStaff:l}}),toggleEquipmentExpanded:r=>n(i=>{const l=new Set(i.expandedEquipment);return l.has(r)?l.delete(r):l.add(r),{expandedEquipment:l}}),toggleBankHolidaysExpanded:()=>n(r=>({expandedBankHolidays:!r.expandedBankHolidays})),ensureProjectExpanded:r=>n(i=>{if(i.expandedProjects.has(r))return i;const l=new Set(i.expandedProjects);return l.add(r),{expandedProjects:l}}),ensurePhaseExpanded:r=>n(i=>{if(i.expandedPhases.has(r))return i;const l=new Set(i.expandedPhases);return l.add(r),{expandedPhases:l}}),ensureSubphaseExpanded:r=>n(i=>{if(i.expandedSubphases.has(r))return i;const l=new Set(i.expandedSubphases);return l.add(r),{expandedSubphases:l}}),setExpandedProjects:r=>n({expandedProjects:r}),setExpandedPhases:r=>n({expandedPhases:r}),collapseAll:()=>n({expandedProjects:new Set,expandedPhases:new Set,expandedSubphases:new Set,expandedStaff:new Set,expandedEquipment:new Set}),expandAll:()=>{const{projects:r}=s(),i=new Set(r.map(u=>u.id)),l=new Set,d=new Set;r.forEach(u=>{u.phases?.forEach(h=>{l.add(h.id);const p=m=>{m?.forEach(v=>{d.add(v.id),p(v.children)})};p(h.children)})}),n({expandedProjects:i,expandedPhases:l,expandedSubphases:d})},expandProjectLevel:r=>{const{projects:i,expandedProjects:l,expandedPhases:d,expandedSubphases:u}=s(),h=i.find(w=>w.id===r);if(!h)return;const{levels:p,maxLevel:m}=bd(h),v=nm(h,l,d,u),y=Math.min(v+1,m),b=sm(h,y,p,m,l,d,u);n(b)},collapseProjectLevel:r=>{const{projects:i,expandedProjects:l,expandedPhases:d,expandedSubphases:u}=s(),h=i.find(w=>w.id===r);if(!h)return;const{levels:p,maxLevel:m}=bd(h),v=nm(h,l,d,u),y=Math.max(v-1,0),b=sm(h,y,p,m,l,d,u);n(b)},toggleCriticalPath:r=>{const{criticalPathEnabled:i,criticalPathItems:l,projects:d}=s(),u=new Set(i),h=new Map(l);if(u.has(r))u.delete(r),h.delete(r);else{u.add(r);const p=d.find(m=>m.id===r);p&&zo(async()=>{const{calculateCriticalPath:m}=await import("./criticalPath-CabRwJM7.js");return{calculateCriticalPath:m}},[]).then(({calculateCriticalPath:m})=>{const v=m(p),y=new Map(s().criticalPathItems);y.set(r,v.criticalItems),n({criticalPathItems:y})})}n({criticalPathEnabled:u,criticalPathItems:h})},recalculateCriticalPath:r=>{const{criticalPathEnabled:i,projects:l}=s();if(!i.has(r))return;const d=l.find(u=>u.id===r);d&&zo(async()=>{const{calculateCriticalPath:u}=await import("./criticalPath-CabRwJM7.js");return{calculateCriticalPath:u}},[]).then(({calculateCriticalPath:u})=>{const h=u(d),p=new Map(s().criticalPathItems);p.set(r,h.criticalItems),n({criticalPathItems:p})})},isCriticalPathEnabled:r=>s().criticalPathEnabled.has(r),getCriticalPathItems:r=>s().criticalPathItems.get(r)||new Set,enterWhatIfMode:()=>{const{projects:r}=s();n({whatIfMode:!0,whatIfSnapshot:{projects:structuredClone(r)},whatIfPendingOperations:[]})},exitWhatIfMode:async r=>{const{whatIfSnapshot:i,whatIfPendingOperations:l}=s();if(!r&&i)n({projects:i.projects,whatIfMode:!1,whatIfSnapshot:null,whatIfPendingOperations:[]});else if(r&&l.length>0){console.log(`[What If] Applying ${l.length} pending operations...`);const{apiRequest:d,clientConfig:u}=await zo(async()=>{const{apiRequest:p,clientConfig:m}=await Promise.resolve().then(()=>Q1);return{apiRequest:p,clientConfig:m}},void 0),h=u.isWhatIfMode;u.isWhatIfMode=()=>!1;try{for(const p of l)console.log(`[What If] Executing: ${p.method} ${p.url}`),await d(p.url,{method:p.method,body:p.body});console.log("[What If] All operations applied successfully")}catch(p){console.error("[What If] Failed to apply operations:",p)}finally{u.isWhatIfMode=h}n({whatIfMode:!1,whatIfSnapshot:null,whatIfPendingOperations:[]})}else n({whatIfMode:!1,whatIfSnapshot:null,whatIfPendingOperations:[]})},queueWhatIfOperation:r=>{n(i=>({whatIfPendingOperations:[...i.whatIfPendingOperations,{...r,id:`op_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now()}]}))},toggleSidebar:()=>n(r=>({sidebarCollapsed:!r.sidebarCollapsed})),toggleResourcePanel:()=>n(r=>({resourcePanelCollapsed:!r.resourcePanelCollapsed})),setSidebarCollapsed:r=>n({sidebarCollapsed:r}),setResourcePanelCollapsed:r=>n({resourcePanelCollapsed:r}),reset:()=>n(am)}),{name:"milestone-app-storage-v3",storage:ep(()=>localStorage),partialize:n=>({viewMode:n.viewMode,currentView:n.currentView,cellWidth:n.cellWidth,currentResourceTab:n.currentResourceTab,sidebarCollapsed:n.sidebarCollapsed,resourcePanelCollapsed:n.resourcePanelCollapsed,timelineScrollLeft:n.timelineScrollLeft,showStaffOverview:n.showStaffOverview,showEquipmentOverview:n.showEquipmentOverview,showAllCustomColumns:n.showAllCustomColumns,hiddenCustomColumns:Array.from(n.hiddenCustomColumns),expandedProjects:Array.from(n.expandedProjects),expandedPhases:Array.from(n.expandedPhases),expandedSubphases:Array.from(n.expandedSubphases),currentSiteId:n._persistedSiteId,currentDateISO:n.currentDate.toISOString()}),onRehydrateStorage:()=>(console.log("[AppStore] Starting hydration from localStorage..."),(n,s)=>{s?console.error("[AppStore] Hydration error:",s):n&&console.log("[AppStore] Hydration complete:",{viewMode:n.viewMode,currentDate:n.currentDate?.toISOString?.(),cellWidth:n.cellWidth})}),merge:(n,s)=>{const r=n?.state??n;return console.log("[AppStore] Merging persisted state:",{raw:n,unwrapped:r,currentSiteId:r?.currentSiteId}),{...s,_persistedSiteId:r?.currentSiteId??s._persistedSiteId,viewMode:r?.viewMode??s.viewMode,currentView:r?.currentView??s.currentView,cellWidth:r?.cellWidth??s.cellWidth,currentResourceTab:r?.currentResourceTab??s.currentResourceTab,sidebarCollapsed:r?.sidebarCollapsed??s.sidebarCollapsed,resourcePanelCollapsed:r?.resourcePanelCollapsed??s.resourcePanelCollapsed,timelineScrollLeft:r?.timelineScrollLeft??s.timelineScrollLeft,showStaffOverview:r?.showStaffOverview??s.showStaffOverview,showEquipmentOverview:r?.showEquipmentOverview??s.showEquipmentOverview,showAllCustomColumns:r?.showAllCustomColumns??s.showAllCustomColumns,hiddenCustomColumns:Array.isArray(r?.hiddenCustomColumns)?new Set(r.hiddenCustomColumns):s.hiddenCustomColumns,expandedProjects:Array.isArray(r?.expandedProjects)?new Set(r.expandedProjects):s.expandedProjects,expandedPhases:Array.isArray(r?.expandedPhases)?new Set(r.expandedPhases):s.expandedPhases,expandedSubphases:Array.isArray(r?.expandedSubphases)?new Set(r.expandedSubphases):s.expandedSubphases,currentDate:r?.currentDateISO?new Date(r.currentDateISO):s.currentDate}}})),G1=n=>n.currentUser?.role==="admin"||n.currentUser?.role==="superuser";function Y1(){return window.location.port==="3333"?`${window.location.protocol}//${window.location.hostname}:8485`:""}function np(){const n=window.location.pathname.match(/^(\/t\/[a-z0-9][a-z0-9-]*)/);return n?n[1]:""}let ir={isWhatIfMode:()=>!1,queueWhatIfOperation:void 0};function sp(n){ir={...ir,...n}}async function Na(n,s={}){const r=Y1(),i=np();let l=n.startsWith("/")?n:`/${n}`;l.startsWith("/api/")&&i&&(l=i+l),l=r+l;const d=s.method||"GET";if(ir.isWhatIfMode?.()&&["PUT","POST","DELETE"].includes(d)&&!["/api/auth/","/api/settings/"].some(b=>l.includes(b))){if(console.log(`[What If Mode] Queued ${d} request to ${l}`),ir.queueWhatIfOperation){const b=l.replace(r,"");ir.queueWhatIfOperation({method:d,url:b,body:s.body})}return{success:!0,whatIfMode:!0,id:Date.now()}}const{body:u,headers:h,...p}=s,m={method:d,headers:{"Content-Type":"application/json",...h},credentials:"include",...p};u!==void 0&&(m.body=JSON.stringify(u));try{const v=await fetch(l,m);if(v.status===204)return{};const y=await v.text();if(!y||y.trim()===""){if(v.ok)return{};throw new Error(`HTTP ${v.status}: Empty response`)}let b;try{b=JSON.parse(y)}catch{throw console.error(`[API Error] Non-JSON response from ${n}:`,y.substring(0,200)),new Error(`HTTP ${v.status}: Invalid response`)}if(!v.ok){const w=b;if(Array.isArray(w.detail)){const _=w.detail.map(S=>`${S.loc?.slice(-1)[0]||"field"}: ${S.msg||"invalid"}`);throw new Error(_.join(", "))}const x=w.error||w.detail||`HTTP ${v.status}`;throw new Error(x)}return b}catch(v){throw v instanceof Error?(console.error(`[API Error] ${d} ${n}:`,v.message),v):new Error("An unexpected error occurred")}}function Je(n){return Na(n,{method:"GET"})}function rt(n,s){return Na(n,{method:"POST",body:s})}function wt(n,s){return Na(n,{method:"PUT",body:s})}function Zt(n){return Na(n,{method:"DELETE"})}function ap(n,s){return Na(n,{method:"PATCH",body:s})}const Q1=Object.freeze(Object.defineProperty({__proto__:null,apiDelete:Zt,apiGet:Je,apiPatch:ap,apiPost:rt,apiPut:wt,apiRequest:Na,get clientConfig(){return ir},configureApiClient:sp,getTenantPrefix:np},Symbol.toStringTag,{value:"Module"}));function rp(n){return{id:n.id,email:n.email,first_name:n.firstName,last_name:n.lastName,name:n.name,job_title:n.jobTitle,role:n.role,max_capacity:n.maxCapacity??n.max_capacity??100,active:!0,site_ids:n.siteIds||[],skills:n.skills||[]}}async function X1(){try{const n=await Je("/api/auth/me");return n.user?{user:rp(n.user)}:{user:null}}catch{return{user:null}}}async function K1(n,s){const r=await rt("/api/auth/login",{email:n,password:s});return{user:rp(r.user)}}async function ip(){await rt("/api/auth/logout")}async function Z1(){try{return await Je("/api/auth/sso/status")}catch{return{enabled:!1}}}async function J1(){return Je("/api/auth/sso/login")}const kd={0:"#FF50A8",1:"#05B6D4",2:"#8B5CF6",3:"#3B82F6",4:"#FA7315",5:"#11B981",6:"#EC4899",7:"#EAB30A",8:"#14B8A6",9:"#A755F7",10:"#F43F5E"};function op(n){return typeof window>"u"?null:getComputedStyle(document.documentElement).getPropertyValue(n).trim()||null}function rl(){return op("--level-phase")||kd[0]}function Wo(n){const s=Math.max(1,Math.min(10,n));return op(`--level-${s}`)||kd[s]||kd[1]}async function ey(n="false"){return Je(`/api/projects?archived=${n}`)}async function ty(n){return Je(`/api/projects/${n}`)}async function ny(n){return rt("/api/projects",n)}async function fi(n,s){return wt(`/api/projects/${n}`,s)}async function sy(n){await Zt(`/api/projects/${n}`)}async function ay(n,s){const r={type:s.name,start_date:s.start_date,end_date:s.end_date,is_milestone:s.is_milestone??!1};return s.order_index!==void 0&&(r.order_index=s.order_index),s.dependencies!==void 0&&(r.dependencies=s.dependencies),rt(`/api/projects/${n}/phases`,r)}async function ra(n,s){const r={};return s.name!==void 0&&(r.type=s.name),s.start_date!==void 0&&(r.start_date=s.start_date),s.end_date!==void 0&&(r.end_date=s.end_date),s.is_milestone!==void 0&&(r.is_milestone=s.is_milestone),s.dependencies!==void 0&&(r.dependencies=s.dependencies),s.completion!==void 0&&(r.completion=s.completion),wt(`/api/phases/${n}`,r)}async function lp(n){await Zt(`/api/phases/${n}`)}async function ry(n,s,r){const i={name:r.name,start_date:r.start_date,end_date:r.end_date,project_id:s,is_milestone:r.is_milestone??!1};return r.order_index!==void 0&&(i.order_index=r.order_index),r.dependencies!==void 0&&(i.dependencies=r.dependencies),rt(`/api/phases/${n}/subphases`,i)}async function iy(n,s,r){const i={name:r.name,start_date:r.start_date,end_date:r.end_date,project_id:s,is_milestone:r.is_milestone??!1};return r.order_index!==void 0&&(i.order_index=r.order_index),r.dependencies!==void 0&&(i.dependencies=r.dependencies),rt(`/api/subphases/${n}/children`,i)}async function ia(n,s){return wt(`/api/subphases/${n}`,s)}async function cp(n){await Zt(`/api/subphases/${n}`)}async function Wd(n){if(n.subphase_id)return rt(`/api/subphases/${n.subphase_id}/staff`,n);if(n.phase_id)return rt(`/api/phases/${n.phase_id}/staff`,n);if(n.project_id)return rt(`/api/projects/${n.project_id}/staff`,n);throw new Error("Must specify project_id, phase_id, or subphase_id")}async function il(n,s,r="project"){const i=r==="subphase"?`/api/subphase-staff/${n}`:r==="phase"?`/api/phase-staff/${n}`:`/api/assignments/${n}`;return wt(i,s)}async function dp(n,s="project"){const r=s==="subphase"?`/api/subphase-staff/${n}`:s==="phase"?`/api/phase-staff/${n}`:`/api/assignments/${n}`;await Zt(r)}async function qd(n){if(n.subphase_id)return rt(`/api/subphases/${n.subphase_id}/equipment`,n);if(n.phase_id)return rt(`/api/phases/${n.phase_id}/equipment`,n);if(n.project_id)return rt(`/api/projects/${n.project_id}/equipment`,n);throw new Error("Must specify project_id, phase_id, or subphase_id")}async function ol(n,s){return wt(`/api/equipment-assignments/${n}`,s)}async function up(n){await Zt(`/api/equipment-assignments/${n}`)}function oy(n){return{...n,phases:(n.phases??[]).map(uy),staffAssignments:(n.staff_assignments??n.staffAssignments??[]).map(Ud),equipmentAssignments:(n.equipment_assignments??n.equipmentAssignments??[]).map(Vd)}}const ly="#ec4899",rm={1:"#06b6d4",2:"#8b5cf6",3:"#3b82f6",4:"#f97316",5:"#10b981",6:"#ec4899",7:"#eab308",8:"#14b8a6",9:"#a855f7"};function cy(n){try{return Wo(n)}catch{return rm[n]||rm[1]}}function dy(){try{return rl()}catch{return ly}}function uy(n){return{id:n.id,project_id:n.project_id,name:n.type||n.name||"Phase",start_date:n.start_date,end_date:n.end_date,color:dy(),order_index:n.sort_order??0,completion:n.completion??null,is_milestone:!!n.is_milestone,dependencies:n.dependencies??[],children:(n.children??n.subphases??[]).map(s=>hp(s,1)),staffAssignments:(n.staff_assignments??n.staffAssignments??[]).map(Ud),equipmentAssignments:(n.equipment_assignments??n.equipmentAssignments??[]).map(Vd)}}function hp(n,s=1){const r=n.depth??s;return{id:n.id,project_id:n.project_id,parent_phase_id:n.parent_type==="phase"?n.parent_id:null,parent_subphase_id:n.parent_type==="subphase"?n.parent_id:null,name:n.name,start_date:n.start_date,end_date:n.end_date,color:cy(r),order_index:n.sort_order??0,completion:n.completion??null,is_milestone:!!n.is_milestone,dependencies:n.dependencies??[],children:(n.children??[]).map(i=>hp(i,r+1)),staffAssignments:(n.staff_assignments??n.staffAssignments??[]).map(Ud),equipmentAssignments:(n.equipment_assignments??n.equipmentAssignments??[]).map(Vd)}}function Ud(n){return{id:n.id,staff_id:n.staff_id,staff_name:n.staff_name,project_id:n.project_id,phase_id:n.phase_id,subphase_id:n.subphase_id,allocation:n.allocation??n.allocation_percent??100,start_date:n.start_date,end_date:n.end_date}}function Vd(n){return{id:n.id,equipment_id:n.equipment_id,equipment_name:n.equipment_name,project_id:n.project_id,phase_id:n.phase_id,subphase_id:n.subphase_id,start_date:n.start_date,end_date:n.end_date}}async function Rt(){const n=await ey("all");return!n||n.length===0?[]:(await Promise.all(n.map(r=>ty(r.id)))).map(oy)}async function hy(){return Je("/api/sites")}async function fy(n){return rt("/api/sites",n)}async function my(n,s){return wt(`/api/sites/${n}`,s)}async function sa(n,s){const r=s?`/api/sites/${n}/holidays?year=${s}`:`/api/sites/${n}/holidays`;return Je(r)}async function fp(n,s){return rt(`/api/sites/${n}/holidays`,s)}const py=fp;async function mp(n,s){await Zt(`/api/sites/${n}/holidays/${s}`)}const gy=mp;async function pp(n){return rt(`/api/sites/${n}/holidays/refresh`)}async function ci(n){return Je(`/api/sites/${n}/events`)}async function _y(n,s){return rt(`/api/sites/${n}/events`,s)}async function yy(n,s){await Zt(`/api/sites/${n}/events/${s}`)}function gs(n){const s=new Set;return n.forEach(r=>{const i=r.date.substring(0,10),l=(r.end_date||r.date).substring(0,10),[d,u,h]=i.split("-").map(Number),[p,m,v]=l.split("-").map(Number),y=new Date(d,u-1,h),b=new Date(p,m-1,v),w=new Date(y);for(;w<=b;){const x=gp(w);s.add(x),w.setDate(w.getDate()+1)}}),s}function di(n){const s=new Set;return n.forEach(r=>{const i=r.date.substring(0,10),l=(r.end_date||r.date).substring(0,10),[d,u,h]=i.split("-").map(Number),[p,m,v]=l.split("-").map(Number),y=new Date(d,u-1,h),b=new Date(p,m-1,v),w=new Date(y);for(;w<=b;){const x=gp(w);s.add(x),w.setDate(w.getDate()+1)}}),s}function gp(n){const s=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0");return`${s}-${r}-${i}`}async function im(n=!1){return Je(n?"/api/staff?includeAllSites=true":"/api/staff")}async function vy(n=!1){return Je(n?"/api/equipment?includeAllSites=true":"/api/equipment")}async function qo(){return Je("/api/vacations")}async function om(n){return rt("/api/vacations",n)}async function xy(n,s){return wt(`/api/vacations/${n}`,s)}async function jy(n){await Zt(`/api/vacations/${n}`)}async function wy(n=!1){return Je(n?"/api/users?includeDisabled=true":"/api/users")}async function Sy(n){return rt("/api/users",n)}async function Cy(n,s){return wt(`/api/users/${n}`,s)}async function by(n){await Zt(`/api/users/${n}`)}async function Nd(n){return Je(`/api/settings/${n}`)}async function ky(n,s){return wt(`/api/settings/${n}`,{value:s})}async function Ny(){const n=await Je("/api/settings");return{instance_title:n.instance_title||void 0,instance_name:n.instance_name||void 0}}async function Dy(){return Je("/api/predefined-phases")}async function Uo(n){return Je(`/api/custom-columns/with-values?site_id=${n}`)}async function Ey(n){return rt("/api/custom-columns",n)}async function Gd(n,s){return Na(`/api/custom-columns/${n}`,{method:"PATCH",body:s})}async function _p(n){return Zt(`/api/custom-columns/${n}`)}async function lm(n){return wt("/api/custom-columns/values",n)}function $y(n,s,r){return`${n}-${s}-${r}`}const or={getAll:()=>Je("/api/skills"),get:n=>Je(`/api/skills/${n}`),create:n=>rt("/api/skills",n),update:(n,s)=>wt(`/api/skills/${n}`,s),delete:n=>Zt(`/api/skills/${n}`),getUserSkills:n=>Je(`/api/skills/user/${n}`),updateUserSkills:(n,s)=>wt(`/api/skills/user/${n}`,{skill_ids:s}),addUserSkill:(n,s)=>rt(`/api/skills/user/${n}/${s}`),removeUserSkill:(n,s)=>Zt(`/api/skills/user/${n}/${s}`)},Ty=Object.freeze(Object.defineProperty({__proto__:null,skillsApi:or},Symbol.toStringTag,{value:"Module"}));async function My(n,s){return rt("/api/admin/auth/login",{email:n,password:s})}async function Py(){await rt("/api/admin/auth/logout",{})}async function Iy(n,s){return rt("/api/admin/auth/change-password",{current_password:n,new_password:s})}async function Ly(){return Je("/api/admin/auth/me")}async function Ay(){return Je("/api/admin/tenants")}async function Ry(n){return Je(`/api/admin/tenants/${n}`)}async function By(n){return rt("/api/admin/tenants",n)}async function Oy(n,s){return wt(`/api/admin/tenants/${n}/status`,{status:s})}async function Fy(n,s=!1){await Zt(`/api/admin/tenants/${n}?delete_database=${s}`)}async function zy(n){return rt(`/api/admin/tenants/${n}/provision`,{})}async function Hy(n){return rt(`/api/admin/tenants/${n}/reset-admin-password`,{})}async function Wy(n,s=50){return Je(`/api/admin/tenants/${n}/audit?limit=${s}`)}async function qy(){return Je("/api/admin/stats")}async function Uy(){return Je("/api/admin/users")}async function Vy(n){return rt("/api/admin/users",n)}async function Gy(n,s){return wt(`/api/admin/users/${n}`,s)}async function Yy(n){await Zt(`/api/admin/users/${n}`)}async function Qy(){return Je("/api/admin/organizations")}async function Xy(n){return Je(`/api/admin/organizations/${n}`)}async function Ky(n){return rt("/api/admin/organizations",n)}async function Zy(n,s){return wt(`/api/admin/organizations/${n}`,s)}async function Jy(n){await Zt(`/api/admin/organizations/${n}`)}async function ev(n,s){return wt(`/api/admin/organizations/${n}/sso`,s)}async function tv(n,s,r){await wt(`/api/admin/organizations/${n}/tenants/${s}`,{})}async function nv(n,s){await Zt(`/api/admin/organizations/${n}/tenants/${s}`)}async function sv(n,s){await ap(`/api/admin/organizations/tenants/${n}/groups`,s)}function yp(){const n=G(m=>m.currentUser),s=G(m=>m.isAuthChecking),r=G(m=>m.isAuthenticated),i=G(m=>m.setCurrentUser),l=G(m=>m.setAuthChecking),d=G(m=>m.setAuthenticated),u=G(m=>m.reset);f.useEffect(()=>{s&&(async()=>{try{const v=await X1();v.user?(i(v.user),d(!0)):d(!1)}catch(v){console.error("Auth check failed:",v),d(!1)}finally{l(!1)}})()},[s,i,d,l]);const h=f.useCallback(async(m,v)=>{try{const y=await K1(m,v);i(y.user),d(!0)}catch(y){const b=y instanceof Error?y.message:"Login failed";throw new Error(b)}},[i,d]),p=f.useCallback(async()=>{try{await ip()}catch(m){console.error("Logout error:",m)}finally{i(null),d(!1),u()}},[i,d,u]);return{isLoading:s,isAuthenticated:r,user:n,login:h,logout:p}}function ll(){const[n,s]=f.useState(!1),[r,i]=f.useState(null),{setSites:l,setProjects:d,setStaff:u,setEquipment:h,setVacations:p,setBankHolidays:m,setCompanyEvents:v,setCurrentSite:y,setInstanceSettings:b,setCustomColumns:w,setCustomColumnValues:x,setSkills:_}=G(),S=G(R=>R._persistedSiteId),C=f.useCallback(async()=>{s(!0),i(null);try{console.log("[DataLoader] Loading all data...");const[R,Q,H,J,q,E]=await Promise.all([hy(),im(!0),vy(!0),qo(),Ny().catch(()=>null),or.getAll().catch(()=>[])]);if(console.log("[DataLoader] Loaded:",{sites:R.length,staff:Q.length,equipment:H.length,vacations:J.length,instanceSettings:q?"yes":"no",skills:E.length}),l(R),u(Q),h(H),p(J),_(E),q&&b(q),R.length>0){const $=[...R].sort((I,U)=>I.id-U.id);let M=$[0];if(console.log("[DataLoader] Default site (first by ID):",M.name,"id:",M.id),console.log("[DataLoader] Persisted site ID from store:",S),S!=null){const I=$.find(U=>U.id===S);I?(M=I,console.log("[DataLoader]  Restored persisted site:",M.name,"id:",M.id)):console.log("[DataLoader]  Site ID",S,"not found in available sites")}else console.log("[DataLoader] No persistedSiteId in store");console.log("[DataLoader] Final selected site:",M.name,"id:",M.id),y(M);const k=await sa(M.id),P=gs(k);m(k,P);const F=await ci(M.id),A=di(F);v(F,A);try{const I=await Uo(M.id);w(I.columns),x(I.values),console.log("[DataLoader] Loaded custom columns:",I.columns.length)}catch(I){console.warn("[DataLoader] Failed to load custom columns:",I)}}const L=await Rt();d(L),console.log("[DataLoader] Loaded projects:",L.length)}catch(R){const Q=R instanceof Error?R.message:"Failed to load data";console.error("[DataLoader] Error:",Q),i(Q)}finally{s(!1)}},[l,d,u,h,p,m,v,y,b,w,x,_]),B=f.useCallback(async()=>{try{const R=await Rt();d(R)}catch(R){console.error("[DataLoader] Failed to refresh projects:",R)}},[d]),D=f.useCallback(async R=>{try{const Q=await sa(R),H=gs(Q);m(Q,H);const J=await ci(R),q=di(J);v(J,q)}catch(Q){console.error("[DataLoader] Failed to refresh site data:",Q)}},[m,v]),O=f.useCallback(async R=>{try{const Q=await Uo(R);w(Q.columns),x(Q.values)}catch(Q){console.error("[DataLoader] Failed to refresh custom columns:",Q)}},[w,x]),z=f.useCallback(async()=>{try{const R=await im(!0);u(R)}catch(R){console.error("[DataLoader] Failed to refresh staff:",R)}},[u]);return{isLoading:n,error:r,loadAllData:C,refreshProjects:B,refreshSiteData:D,refreshCustomColumns:O,refreshStaff:z}}const av="_container_69zuh_1",rv="_content_69zuh_9",iv="_logo_69zuh_16",ov="_spinner_69zuh_21",lv="_message_69zuh_30",Kr={container:av,content:rv,logo:iv,spinner:ov,message:lv};function cm({message:n="Loading..."}){return e.jsx("div",{className:Kr.container,children:e.jsxs("div",{className:Kr.content,children:[e.jsx("img",{src:"/img/milestone_logo_no_text.svg",alt:"Milestone",className:Kr.logo}),e.jsx("div",{className:Kr.spinner}),e.jsx("p",{className:Kr.message,children:n})]})})}function cv(n,s){try{const r=localStorage.getItem(n);return r===null?s:JSON.parse(r)}catch{return console.warn(`Failed to parse localStorage key "${n}"`),s}}function dv(n,s){try{localStorage.setItem(n,JSON.stringify(s))}catch(r){console.warn(`Failed to set localStorage key "${n}"`,r)}}const ms={PREF_SITE_ID:"milestone_pref_site_id",PREF_VIEW:"milestone_pref_view",PREF_VIEW_MODE:"milestone_pref_view_mode",PREF_THEME:"milestone_theme",PROJECT_ORDER_PREFIX:"milestone_project_order_site_",LEGACY_SITE_ID:"rd_pref_site_id",LEGACY_VIEW:"rd_pref_view",LEGACY_VIEW_MODE:"rd_pref_view_mode"};function Dd(n){const s=`${ms.PROJECT_ORDER_PREFIX}${n}`;return cv(s,[])}function uv(n,s){const r=`${ms.PROJECT_ORDER_PREFIX}${n}`;dv(r,s)}function hv(n,s){const r=Dd(s);if(r.length===0)return n;const i=new Map;return r.forEach((l,d)=>i.set(l,d)),[...n].sort((l,d)=>{const u=i.get(l.id),h=i.get(d.id);return u!==void 0&&h!==void 0?u-h:u!==void 0?-1:h!==void 0?1:0})}function fv(){[[ms.LEGACY_SITE_ID,ms.PREF_SITE_ID],[ms.LEGACY_VIEW,ms.PREF_VIEW],[ms.LEGACY_VIEW_MODE,ms.PREF_VIEW_MODE]].forEach(([s,r])=>{const i=localStorage.getItem(s);i!==null&&localStorage.getItem(r)===null&&(localStorage.setItem(r,i),console.log(`Migrated storage: ${s} -> ${r}`))})}const mv=[{id:"default",name:"Default",description:"Original Milestone theme"},{id:"sulzer",name:"S-Theme",description:"Alternative color scheme"}],ui=[{id:"dark",name:"Default Dark",description:"Original Milestone dark theme",family:"default",mode:"dark"},{id:"light",name:"Default Light",description:"Original Milestone light theme",family:"default",mode:"light"},{id:"sulzer-dark",name:"S-Theme Dark",description:"Alternative dark theme",family:"sulzer",mode:"dark"},{id:"sulzer-light",name:"S-Theme Light",description:"Alternative light theme",family:"sulzer",mode:"light"}];function Ds(){const n=localStorage.getItem(ms.PREF_THEME);return n==="light"||n==="dark"||n==="sulzer-dark"||n==="sulzer-light"?n:"dark"}function cl(n){return ui.find(s=>s.id===n)||ui[0]}function mi(n){return cl(n).mode==="dark"}function Vo(n){localStorage.setItem(ms.PREF_THEME,n),document.documentElement.setAttribute("data-theme",n)}function pv(){const n=Ds(),s=cl(n),r=ui.find(l=>l.family===s.family&&l.mode!==s.mode);if(r)return Vo(r.id),r.id;const i=n==="dark"?"light":"dark";return Vo(i),i}function gv(){const n=Ds();return cl(n).family}function _v(n){const s=Ds(),r=cl(s),i=ui.find(d=>d.family===n&&d.mode===r.mode);if(i)return Vo(i.id),i.id;const l=ui.find(d=>d.family===n&&d.mode==="dark");return l?(Vo(l.id),l.id):s}function yv(){const n=Ds();document.documentElement.setAttribute("data-theme",n)}const vv="_container_1pc0d_1",xv="_card_1pc0d_10",jv="_header_1pc0d_19",wv="_logo_1pc0d_24",Sv="_subtitle_1pc0d_30",Cv="_ssoButton_1pc0d_36",bv="_divider_1pc0d_58",kv="_form_1pc0d_78",Nv="_formGroup_1pc0d_84",Dv="_label_1pc0d_90",Ev="_input_1pc0d_96",$v="_error_1pc0d_122",Tv="_submitButton_1pc0d_132",fn={container:vv,card:xv,header:jv,logo:wv,subtitle:Sv,ssoButton:Cv,divider:bv,form:kv,formGroup:Nv,label:Dv,input:Ev,error:$v,submitButton:Tv};function Mv(){const{login:n}=yp(),[s,r]=f.useState(""),[i,l]=f.useState(""),[d,u]=f.useState(!1),[h,p]=f.useState(null),[m,v]=f.useState(!1),[y,b]=f.useState(()=>Ds());f.useEffect(()=>{(async()=>{try{const{enabled:C}=await Z1();v(C)}catch{}})()},[]),f.useEffect(()=>{const S=new MutationObserver(()=>{const C=document.documentElement.dataset.theme;C&&C!==y&&b(C)});return S.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>S.disconnect()},[y]);const w=async S=>{S.preventDefault(),p(null),u(!0);try{await n(s,i)}catch(C){p(C instanceof Error?C.message:"Invalid email or password")}finally{u(!1)}},x=async()=>{try{const S=await J1();console.log("SSO Login response:",S),S.url?window.location.href=S.url:(console.error("No URL in SSO response:",S),p("SSO login URL not received"))}catch(S){console.error("SSO login error:",S),p("Failed to initiate SSO login")}},_=mi(y)?"/img/milestone_logo_dark_theme.svg":"/img/milestone_logo_light_theme.svg";return e.jsx("div",{className:fn.container,children:e.jsxs("div",{className:fn.card,children:[e.jsxs("div",{className:fn.header,children:[e.jsx("img",{src:_,alt:"Milestone",className:fn.logo}),e.jsx("p",{className:fn.subtitle,children:"Sign in to continue"})]}),m&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:fn.ssoButton,onClick:x,children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 23 23",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{fill:"#f35325",d:"M1 1h10v10H1z"}),e.jsx("path",{fill:"#81bc06",d:"M12 1h10v10H12z"}),e.jsx("path",{fill:"#05a6f0",d:"M1 12h10v10H1z"}),e.jsx("path",{fill:"#ffba08",d:"M12 12h10v10H12z"})]}),"Sign in with Microsoft"]}),e.jsx("div",{className:fn.divider,children:e.jsx("span",{children:"or sign in with email"})})]}),e.jsxs("form",{onSubmit:w,className:fn.form,children:[e.jsxs("div",{className:fn.formGroup,children:[e.jsx("label",{htmlFor:"email",className:fn.label,children:"Email"}),e.jsx("input",{type:"email",id:"email",className:fn.input,value:s,onChange:S=>r(S.target.value),placeholder:"your@email.com",required:!0,autoFocus:!0,disabled:d})]}),e.jsxs("div",{className:fn.formGroup,children:[e.jsx("label",{htmlFor:"password",className:fn.label,children:"Password"}),e.jsx("input",{type:"password",id:"password",className:fn.input,value:i,onChange:S=>l(S.target.value),placeholder:"",required:!0,disabled:d})]}),h&&e.jsx("div",{className:fn.error,children:h}),e.jsx("button",{type:"submit",className:fn.submitButton,disabled:d,children:d?"Signing in...":"Sign In"})]})]})})}const Pv={activeModal:null,editingProject:null,editingPhase:null,editingSubphase:null,editingStaffAssignment:null,editingEquipmentAssignment:null,editingVacation:null,editingStaff:null,editingEquipment:null,editingUser:null,editingSite:null,modalContext:{},tooltip:{visible:!1,content:"",x:0,y:0},contextMenu:{visible:!1,x:0,y:0,type:null,targetId:null,projectId:void 0,phaseId:void 0,subphaseId:void 0,assignmentData:void 0},isDragging:!1,dragType:null,dragItemId:null,isResizing:!1,resizeEdge:null,resizeItemId:null,resizeItemType:null,dragIndicator:{visible:!1,left:0,top:0,type:"drag"},isLinkingDependency:!1,linkingFrom:null,phantomSiblingMode:null,isLoading:!1,loadingMessage:"",scrollToTodayTrigger:0,scrollToDateTrigger:null,zoomTrigger:null,resourceDrag:{active:!1,type:null,resourceId:null,resourceName:null,targetProjectId:null,targetPhaseId:null,targetSubphaseId:null,previewStart:null,previewEnd:null}},xe=al()(n=>({...Pv,openModal:(s,r={})=>n({activeModal:s,modalContext:r}),closeModal:()=>n({activeModal:null,editingProject:null,editingPhase:null,editingSubphase:null,editingStaffAssignment:null,editingEquipmentAssignment:null,editingVacation:null,editingStaff:null,editingEquipment:null,editingUser:null,editingSite:null,modalContext:{}}),setEditingProject:s=>n({editingProject:s}),setEditingPhase:s=>n({editingPhase:s}),setEditingSubphase:s=>n({editingSubphase:s}),setEditingStaffAssignment:s=>n({editingStaffAssignment:s}),setEditingEquipmentAssignment:s=>n({editingEquipmentAssignment:s}),setEditingVacation:s=>n({editingVacation:s}),setEditingStaff:s=>n({editingStaff:s}),setEditingEquipment:s=>n({editingEquipment:s}),setEditingUser:s=>n({editingUser:s}),setEditingSite:s=>n({editingSite:s}),openProjectModal:s=>n({activeModal:"project",editingProject:s||null}),openPhaseModal:(s,r)=>n({activeModal:"phase",editingPhase:s||null,modalContext:r?{projectId:r}:{}}),openSubphaseModal:(s,r,i,l)=>n({activeModal:"subphase",editingSubphase:s||null,modalContext:{phaseId:r,projectId:i,subphaseId:l}}),openVacationModal:(s,r)=>n({activeModal:"vacation",editingVacation:s||null,modalContext:r?{staffId:r}:{}}),openBankHolidayModal:()=>n({activeModal:"bankHoliday"}),openSiteModal:()=>n({activeModal:"site"}),setActiveModal:s=>n({activeModal:s}),showTooltip:(s,r,i)=>n({tooltip:{visible:!0,content:s,x:r,y:i}}),hideTooltip:()=>n({tooltip:{visible:!1,content:"",x:0,y:0}}),startDrag:(s,r)=>n({isDragging:!0,dragType:s,dragItemId:r}),endDrag:()=>n({isDragging:!1,dragType:null,dragItemId:null}),startResize:(s,r,i)=>n({isResizing:!0,resizeItemType:s,resizeItemId:r,resizeEdge:i}),endResize:()=>n({isResizing:!1,resizeItemType:null,resizeItemId:null,resizeEdge:null}),showDragIndicator:(s,r,i)=>n({dragIndicator:{visible:!0,left:s,top:r,type:"drag",lagDays:i}}),showResizeIndicator:(s,r,i,l,d)=>n({dragIndicator:{visible:!0,left:s,top:r,type:"resize",date:i,duration:l,edge:d}}),hideIndicator:()=>n({dragIndicator:{visible:!1,left:0,top:0,type:"drag"}}),startLinking:(s,r,i,l)=>n({isLinkingDependency:!0,linkingFrom:{projectId:s,itemId:r,itemType:i,zone:l}}),completeLinking:()=>n({isLinkingDependency:!1,linkingFrom:null}),cancelLinking:()=>n({isLinkingDependency:!1,linkingFrom:null}),startPhantomSibling:s=>n({phantomSiblingMode:s}),updatePhantomPosition:(s,r)=>n(i=>({phantomSiblingMode:i.phantomSiblingMode?{...i.phantomSiblingMode,phantomStart:s,phantomEnd:r}:null})),endPhantomSibling:()=>n({phantomSiblingMode:null}),setLoading:(s,r="")=>n({isLoading:s,loadingMessage:r}),showContextMenu:(s,r,i,l,d,u,h,p)=>n({contextMenu:{visible:!0,x:i,y:l,type:s,targetId:r,projectId:d,phaseId:u,subphaseId:h,assignmentData:p}}),hideContextMenu:()=>n({contextMenu:{visible:!1,x:0,y:0,type:null,targetId:null,projectId:void 0,phaseId:void 0,subphaseId:void 0,assignmentData:void 0}}),triggerScrollToToday:()=>n(s=>({scrollToTodayTrigger:s.scrollToTodayTrigger+1})),triggerScrollToDate:s=>n({scrollToDateTrigger:{date:s,timestamp:Date.now()}}),clearScrollToDateTrigger:()=>n({scrollToDateTrigger:null}),triggerZoom:(s,r)=>n({zoomTrigger:{direction:s,newCellWidth:r,timestamp:Date.now()}}),clearZoomTrigger:()=>n({zoomTrigger:null}),startResourceDrag:(s,r,i)=>n({resourceDrag:{active:!0,type:s,resourceId:r,resourceName:i,targetProjectId:null,targetPhaseId:null,targetSubphaseId:null,previewStart:null,previewEnd:null}}),updateResourceDragTarget:(s,r,i,l,d)=>n(u=>({resourceDrag:{...u.resourceDrag,targetProjectId:s,targetPhaseId:r,targetSubphaseId:i,previewStart:l,previewEnd:d}})),endResourceDrag:()=>n({resourceDrag:{active:!1,type:null,resourceId:null,resourceName:null,targetProjectId:null,targetPhaseId:null,targetSubphaseId:null,previewStart:null,previewEnd:null}})})),vp=al()((n,s)=>({undoStack:[],redoStack:[],canUndo:!1,canRedo:!1,saveState:(r,i)=>{n(l=>{const d={projects:structuredClone(r),description:i,timestamp:Date.now()};return{undoStack:[...l.undoStack,d].slice(-50),redoStack:[],canUndo:!0,canRedo:!1}})},undo:()=>{const{undoStack:r,redoStack:i}=s();if(r.length===0)return null;const l=r[r.length-1],d=r.slice(0,-1);return n({undoStack:d,redoStack:[...i,l],canUndo:d.length>0,canRedo:!0}),d.length>0?d[d.length-1].projects:null},redo:()=>{const{undoStack:r,redoStack:i}=s();if(i.length===0)return null;const l=i[i.length-1],d=i.slice(0,-1);return n({undoStack:[...r,l],redoStack:d,canUndo:!0,canRedo:d.length>0}),l.projects},clear:()=>{n({undoStack:[],redoStack:[],canUndo:!1,canRedo:!1})}})),xp=6048e5,Iv=864e5,jp=6e4,wp=36e5,dm=Symbol.for("constructDateFrom");function Pn(n,s){return typeof n=="function"?n(s):n&&typeof n=="object"&&dm in n?n[dm](s):n instanceof Date?new n.constructor(s):new Date(s)}function Jt(n,s){return Pn(s||n,n)}function Gn(n,s,r){const i=Jt(n,r?.in);return isNaN(s)?Pn(n,NaN):(s&&i.setDate(i.getDate()+s),i)}function _s(n,s,r){const i=Jt(n,r?.in);if(isNaN(s))return Pn(n,NaN);if(!s)return i;const l=i.getDate(),d=Pn(n,i.getTime());d.setMonth(i.getMonth()+s+1,0);const u=d.getDate();return l>=u?d:(i.setFullYear(d.getFullYear(),d.getMonth(),l),i)}function Sp(n,s){const r=Jt(n,s?.in).getDay();return r===0||r===6}let Lv={};function dl(){return Lv}function aa(n,s){const r=dl(),i=s?.weekStartsOn??s?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,l=Jt(n,s?.in),d=l.getDay(),u=(d<i?7:0)+d-i;return l.setDate(l.getDate()-u),l.setHours(0,0,0,0),l}function Go(n,s){return aa(n,{...s,weekStartsOn:1})}function Cp(n,s){const r=Jt(n,s?.in),i=r.getFullYear(),l=Pn(r,0);l.setFullYear(i+1,0,4),l.setHours(0,0,0,0);const d=Go(l),u=Pn(r,0);u.setFullYear(i,0,4),u.setHours(0,0,0,0);const h=Go(u);return r.getTime()>=d.getTime()?i+1:r.getTime()>=h.getTime()?i:i-1}function um(n){const s=Jt(n),r=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return r.setUTCFullYear(s.getFullYear()),+n-+r}function ul(n,...s){const r=Pn.bind(null,s.find(i=>typeof i=="object"));return s.map(r)}function Yo(n,s){const r=Jt(n,s?.in);return r.setHours(0,0,0,0),r}function bp(n,s,r){const[i,l]=ul(r?.in,n,s),d=Yo(i),u=Yo(l),h=+d-um(d),p=+u-um(u);return Math.round((h-p)/Iv)}function Av(n,s){const r=Cp(n,s),i=Pn(n,0);return i.setFullYear(r,0,4),i.setHours(0,0,0,0),Go(i)}function Yd(n,s,r){return Gn(n,s*7,r)}function Rv(n,s,r){const[i,l]=ul(r?.in,n,s);return+Yo(i)==+Yo(l)}function Bv(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function Ov(n){return!(!Bv(n)&&typeof n!="number"||isNaN(+Jt(n)))}function Ns(n,s,r){const[i,l]=ul(r?.in,n,s),d=hm(i,l),u=Math.abs(bp(i,l));i.setDate(i.getDate()-d*u);const h=+(hm(i,l)===-d),p=d*(u-h);return p===0?0:p}function hm(n,s){const r=n.getFullYear()-s.getFullYear()||n.getMonth()-s.getMonth()||n.getDate()-s.getDate()||n.getHours()-s.getHours()||n.getMinutes()-s.getMinutes()||n.getSeconds()-s.getSeconds()||n.getMilliseconds()-s.getMilliseconds();return r<0?-1:r>0?1:r}function Fv(n,s){const r=Jt(n,s?.in),i=r.getMonth();return r.setFullYear(r.getFullYear(),i+1,0),r.setHours(23,59,59,999),r}function zv(n,s){const[r,i]=ul(n,s.start,s.end);return{start:r,end:i}}function Hv(n,s){const{start:r,end:i}=zv(s?.in,n);let l=+r>+i;const d=l?+r:+i,u=l?i:r;u.setHours(0,0,0,0);let h=1;const p=[];for(;+u<=d;)p.push(Pn(r,u)),u.setDate(u.getDate()+h),u.setHours(0,0,0,0);return l?p.reverse():p}function kp(n,s){const r=Jt(n,s?.in),i=r.getMonth(),l=i-i%3;return r.setMonth(l,1),r.setHours(0,0,0,0),r}function Wv(n,s){const r=Jt(n,s?.in);return r.setDate(1),r.setHours(0,0,0,0),r}function qv(n,s){const r=Jt(n,s?.in);return r.setFullYear(r.getFullYear(),0,1),r.setHours(0,0,0,0),r}const Uv={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Vv=(n,s,r)=>{let i;const l=Uv[n];return typeof l=="string"?i=l:s===1?i=l.one:i=l.other.replace("{{count}}",s.toString()),r?.addSuffix?r.comparison&&r.comparison>0?"in "+i:i+" ago":i};function rd(n){return(s={})=>{const r=s.width?String(s.width):n.defaultWidth;return n.formats[r]||n.formats[n.defaultWidth]}}const Gv={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Yv={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Qv={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Xv={date:rd({formats:Gv,defaultWidth:"full"}),time:rd({formats:Yv,defaultWidth:"full"}),dateTime:rd({formats:Qv,defaultWidth:"full"})},Kv={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Zv=(n,s,r,i)=>Kv[n];function Zr(n){return(s,r)=>{const i=r?.context?String(r.context):"standalone";let l;if(i==="formatting"&&n.formattingValues){const u=n.defaultFormattingWidth||n.defaultWidth,h=r?.width?String(r.width):u;l=n.formattingValues[h]||n.formattingValues[u]}else{const u=n.defaultWidth,h=r?.width?String(r.width):n.defaultWidth;l=n.values[h]||n.values[u]}const d=n.argumentCallback?n.argumentCallback(s):s;return l[d]}}const Jv={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},ex={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},tx={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},nx={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},sx={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},ax={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},rx=(n,s)=>{const r=Number(n),i=r%100;if(i>20||i<10)switch(i%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},ix={ordinalNumber:rx,era:Zr({values:Jv,defaultWidth:"wide"}),quarter:Zr({values:ex,defaultWidth:"wide",argumentCallback:n=>n-1}),month:Zr({values:tx,defaultWidth:"wide"}),day:Zr({values:nx,defaultWidth:"wide"}),dayPeriod:Zr({values:sx,defaultWidth:"wide",formattingValues:ax,defaultFormattingWidth:"wide"})};function Jr(n){return(s,r={})=>{const i=r.width,l=i&&n.matchPatterns[i]||n.matchPatterns[n.defaultMatchWidth],d=s.match(l);if(!d)return null;const u=d[0],h=i&&n.parsePatterns[i]||n.parsePatterns[n.defaultParseWidth],p=Array.isArray(h)?lx(h,y=>y.test(u)):ox(h,y=>y.test(u));let m;m=n.valueCallback?n.valueCallback(p):p,m=r.valueCallback?r.valueCallback(m):m;const v=s.slice(u.length);return{value:m,rest:v}}}function ox(n,s){for(const r in n)if(Object.prototype.hasOwnProperty.call(n,r)&&s(n[r]))return r}function lx(n,s){for(let r=0;r<n.length;r++)if(s(n[r]))return r}function cx(n){return(s,r={})=>{const i=s.match(n.matchPattern);if(!i)return null;const l=i[0],d=s.match(n.parsePattern);if(!d)return null;let u=n.valueCallback?n.valueCallback(d[0]):d[0];u=r.valueCallback?r.valueCallback(u):u;const h=s.slice(l.length);return{value:u,rest:h}}}const dx=/^(\d+)(th|st|nd|rd)?/i,ux=/\d+/i,hx={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},fx={any:[/^b/i,/^(a|c)/i]},mx={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},px={any:[/1/i,/2/i,/3/i,/4/i]},gx={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},_x={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},yx={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},vx={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},xx={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},jx={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},wx={ordinalNumber:cx({matchPattern:dx,parsePattern:ux,valueCallback:n=>parseInt(n,10)}),era:Jr({matchPatterns:hx,defaultMatchWidth:"wide",parsePatterns:fx,defaultParseWidth:"any"}),quarter:Jr({matchPatterns:mx,defaultMatchWidth:"wide",parsePatterns:px,defaultParseWidth:"any",valueCallback:n=>n+1}),month:Jr({matchPatterns:gx,defaultMatchWidth:"wide",parsePatterns:_x,defaultParseWidth:"any"}),day:Jr({matchPatterns:yx,defaultMatchWidth:"wide",parsePatterns:vx,defaultParseWidth:"any"}),dayPeriod:Jr({matchPatterns:xx,defaultMatchWidth:"any",parsePatterns:jx,defaultParseWidth:"any"})},Sx={code:"en-US",formatDistance:Vv,formatLong:Xv,formatRelative:Zv,localize:ix,match:wx,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Cx(n,s){const r=Jt(n,s?.in);return bp(r,qv(r))+1}function bx(n,s){const r=Jt(n,s?.in),i=+Go(r)-+Av(r);return Math.round(i/xp)+1}function Np(n,s){const r=Jt(n,s?.in),i=r.getFullYear(),l=dl(),d=s?.firstWeekContainsDate??s?.locale?.options?.firstWeekContainsDate??l.firstWeekContainsDate??l.locale?.options?.firstWeekContainsDate??1,u=Pn(s?.in||n,0);u.setFullYear(i+1,0,d),u.setHours(0,0,0,0);const h=aa(u,s),p=Pn(s?.in||n,0);p.setFullYear(i,0,d),p.setHours(0,0,0,0);const m=aa(p,s);return+r>=+h?i+1:+r>=+m?i:i-1}function kx(n,s){const r=dl(),i=s?.firstWeekContainsDate??s?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,l=Np(n,s),d=Pn(s?.in||n,0);return d.setFullYear(l,0,i),d.setHours(0,0,0,0),aa(d,s)}function Qd(n,s){const r=Jt(n,s?.in),i=+aa(r,s)-+kx(r,s);return Math.round(i/xp)+1}function dt(n,s){const r=n<0?"-":"",i=Math.abs(n).toString().padStart(s,"0");return r+i}const Js={y(n,s){const r=n.getFullYear(),i=r>0?r:1-r;return dt(s==="yy"?i%100:i,s.length)},M(n,s){const r=n.getMonth();return s==="M"?String(r+1):dt(r+1,2)},d(n,s){return dt(n.getDate(),s.length)},a(n,s){const r=n.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];default:return r==="am"?"a.m.":"p.m."}},h(n,s){return dt(n.getHours()%12||12,s.length)},H(n,s){return dt(n.getHours(),s.length)},m(n,s){return dt(n.getMinutes(),s.length)},s(n,s){return dt(n.getSeconds(),s.length)},S(n,s){const r=s.length,i=n.getMilliseconds(),l=Math.trunc(i*Math.pow(10,r-3));return dt(l,s.length)}},Ja={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},fm={G:function(n,s,r){const i=n.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return r.era(i,{width:"abbreviated"});case"GGGGG":return r.era(i,{width:"narrow"});default:return r.era(i,{width:"wide"})}},y:function(n,s,r){if(s==="yo"){const i=n.getFullYear(),l=i>0?i:1-i;return r.ordinalNumber(l,{unit:"year"})}return Js.y(n,s)},Y:function(n,s,r,i){const l=Np(n,i),d=l>0?l:1-l;if(s==="YY"){const u=d%100;return dt(u,2)}return s==="Yo"?r.ordinalNumber(d,{unit:"year"}):dt(d,s.length)},R:function(n,s){const r=Cp(n);return dt(r,s.length)},u:function(n,s){const r=n.getFullYear();return dt(r,s.length)},Q:function(n,s,r){const i=Math.ceil((n.getMonth()+1)/3);switch(s){case"Q":return String(i);case"QQ":return dt(i,2);case"Qo":return r.ordinalNumber(i,{unit:"quarter"});case"QQQ":return r.quarter(i,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(i,{width:"narrow",context:"formatting"});default:return r.quarter(i,{width:"wide",context:"formatting"})}},q:function(n,s,r){const i=Math.ceil((n.getMonth()+1)/3);switch(s){case"q":return String(i);case"qq":return dt(i,2);case"qo":return r.ordinalNumber(i,{unit:"quarter"});case"qqq":return r.quarter(i,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(i,{width:"narrow",context:"standalone"});default:return r.quarter(i,{width:"wide",context:"standalone"})}},M:function(n,s,r){const i=n.getMonth();switch(s){case"M":case"MM":return Js.M(n,s);case"Mo":return r.ordinalNumber(i+1,{unit:"month"});case"MMM":return r.month(i,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(i,{width:"narrow",context:"formatting"});default:return r.month(i,{width:"wide",context:"formatting"})}},L:function(n,s,r){const i=n.getMonth();switch(s){case"L":return String(i+1);case"LL":return dt(i+1,2);case"Lo":return r.ordinalNumber(i+1,{unit:"month"});case"LLL":return r.month(i,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(i,{width:"narrow",context:"standalone"});default:return r.month(i,{width:"wide",context:"standalone"})}},w:function(n,s,r,i){const l=Qd(n,i);return s==="wo"?r.ordinalNumber(l,{unit:"week"}):dt(l,s.length)},I:function(n,s,r){const i=bx(n);return s==="Io"?r.ordinalNumber(i,{unit:"week"}):dt(i,s.length)},d:function(n,s,r){return s==="do"?r.ordinalNumber(n.getDate(),{unit:"date"}):Js.d(n,s)},D:function(n,s,r){const i=Cx(n);return s==="Do"?r.ordinalNumber(i,{unit:"dayOfYear"}):dt(i,s.length)},E:function(n,s,r){const i=n.getDay();switch(s){case"E":case"EE":case"EEE":return r.day(i,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(i,{width:"short",context:"formatting"});default:return r.day(i,{width:"wide",context:"formatting"})}},e:function(n,s,r,i){const l=n.getDay(),d=(l-i.weekStartsOn+8)%7||7;switch(s){case"e":return String(d);case"ee":return dt(d,2);case"eo":return r.ordinalNumber(d,{unit:"day"});case"eee":return r.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(l,{width:"short",context:"formatting"});default:return r.day(l,{width:"wide",context:"formatting"})}},c:function(n,s,r,i){const l=n.getDay(),d=(l-i.weekStartsOn+8)%7||7;switch(s){case"c":return String(d);case"cc":return dt(d,s.length);case"co":return r.ordinalNumber(d,{unit:"day"});case"ccc":return r.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(l,{width:"narrow",context:"standalone"});case"cccccc":return r.day(l,{width:"short",context:"standalone"});default:return r.day(l,{width:"wide",context:"standalone"})}},i:function(n,s,r){const i=n.getDay(),l=i===0?7:i;switch(s){case"i":return String(l);case"ii":return dt(l,s.length);case"io":return r.ordinalNumber(l,{unit:"day"});case"iii":return r.day(i,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(i,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(i,{width:"short",context:"formatting"});default:return r.day(i,{width:"wide",context:"formatting"})}},a:function(n,s,r){const l=n.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(l,{width:"narrow",context:"formatting"});default:return r.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(n,s,r){const i=n.getHours();let l;switch(i===12?l=Ja.noon:i===0?l=Ja.midnight:l=i/12>=1?"pm":"am",s){case"b":case"bb":return r.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(l,{width:"narrow",context:"formatting"});default:return r.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(n,s,r){const i=n.getHours();let l;switch(i>=17?l=Ja.evening:i>=12?l=Ja.afternoon:i>=4?l=Ja.morning:l=Ja.night,s){case"B":case"BB":case"BBB":return r.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(l,{width:"narrow",context:"formatting"});default:return r.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(n,s,r){if(s==="ho"){let i=n.getHours()%12;return i===0&&(i=12),r.ordinalNumber(i,{unit:"hour"})}return Js.h(n,s)},H:function(n,s,r){return s==="Ho"?r.ordinalNumber(n.getHours(),{unit:"hour"}):Js.H(n,s)},K:function(n,s,r){const i=n.getHours()%12;return s==="Ko"?r.ordinalNumber(i,{unit:"hour"}):dt(i,s.length)},k:function(n,s,r){let i=n.getHours();return i===0&&(i=24),s==="ko"?r.ordinalNumber(i,{unit:"hour"}):dt(i,s.length)},m:function(n,s,r){return s==="mo"?r.ordinalNumber(n.getMinutes(),{unit:"minute"}):Js.m(n,s)},s:function(n,s,r){return s==="so"?r.ordinalNumber(n.getSeconds(),{unit:"second"}):Js.s(n,s)},S:function(n,s){return Js.S(n,s)},X:function(n,s,r){const i=n.getTimezoneOffset();if(i===0)return"Z";switch(s){case"X":return pm(i);case"XXXX":case"XX":return ka(i);default:return ka(i,":")}},x:function(n,s,r){const i=n.getTimezoneOffset();switch(s){case"x":return pm(i);case"xxxx":case"xx":return ka(i);default:return ka(i,":")}},O:function(n,s,r){const i=n.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+mm(i,":");default:return"GMT"+ka(i,":")}},z:function(n,s,r){const i=n.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+mm(i,":");default:return"GMT"+ka(i,":")}},t:function(n,s,r){const i=Math.trunc(+n/1e3);return dt(i,s.length)},T:function(n,s,r){return dt(+n,s.length)}};function mm(n,s=""){const r=n>0?"-":"+",i=Math.abs(n),l=Math.trunc(i/60),d=i%60;return d===0?r+String(l):r+String(l)+s+dt(d,2)}function pm(n,s){return n%60===0?(n>0?"-":"+")+dt(Math.abs(n)/60,2):ka(n,s)}function ka(n,s=""){const r=n>0?"-":"+",i=Math.abs(n),l=dt(Math.trunc(i/60),2),d=dt(i%60,2);return r+l+s+d}const gm=(n,s)=>{switch(n){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});default:return s.date({width:"full"})}},Dp=(n,s)=>{switch(n){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});default:return s.time({width:"full"})}},Nx=(n,s)=>{const r=n.match(/(P+)(p+)?/)||[],i=r[1],l=r[2];if(!l)return gm(n,s);let d;switch(i){case"P":d=s.dateTime({width:"short"});break;case"PP":d=s.dateTime({width:"medium"});break;case"PPP":d=s.dateTime({width:"long"});break;default:d=s.dateTime({width:"full"});break}return d.replace("{{date}}",gm(i,s)).replace("{{time}}",Dp(l,s))},Dx={p:Dp,P:Nx},Ex=/^D+$/,$x=/^Y+$/,Tx=["D","DD","YY","YYYY"];function Mx(n){return Ex.test(n)}function Px(n){return $x.test(n)}function Ix(n,s,r){const i=Lx(n,s,r);if(console.warn(i),Tx.includes(n))throw new RangeError(i)}function Lx(n,s,r){const i=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${s}\`) for formatting ${i} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Ax=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Rx=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Bx=/^'([^]*?)'?$/,Ox=/''/g,Fx=/[a-zA-Z]/;function kt(n,s,r){const i=dl(),l=i.locale??Sx,d=i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,u=i.weekStartsOn??i.locale?.options?.weekStartsOn??0,h=Jt(n,r?.in);if(!Ov(h))throw new RangeError("Invalid time value");let p=s.match(Rx).map(v=>{const y=v[0];if(y==="p"||y==="P"){const b=Dx[y];return b(v,l.formatLong)}return v}).join("").match(Ax).map(v=>{if(v==="''")return{isToken:!1,value:"'"};const y=v[0];if(y==="'")return{isToken:!1,value:zx(v)};if(fm[y])return{isToken:!0,value:v};if(y.match(Fx))throw new RangeError("Format string contains an unescaped latin alphabet character `"+y+"`");return{isToken:!1,value:v}});l.localize.preprocessor&&(p=l.localize.preprocessor(h,p));const m={firstWeekContainsDate:d,weekStartsOn:u,locale:l};return p.map(v=>{if(!v.isToken)return v.value;const y=v.value;(Px(y)||Mx(y))&&Ix(y,s,String(n));const b=fm[y[0]];return b(h,y,l.localize,m)}).join("")}function zx(n){const s=n.match(Bx);return s?s[1].replace(Ox,"'"):n}function os(n,s){const r=()=>Pn(s?.in,NaN),l=Ux(n);let d;if(l.date){const m=Vx(l.date,2);d=Gx(m.restDateString,m.year)}if(!d||isNaN(+d))return r();const u=+d;let h=0,p;if(l.time&&(h=Yx(l.time),isNaN(h)))return r();if(l.timezone){if(p=Qx(l.timezone),isNaN(p))return r()}else{const m=new Date(u+h),v=Jt(0,s?.in);return v.setFullYear(m.getUTCFullYear(),m.getUTCMonth(),m.getUTCDate()),v.setHours(m.getUTCHours(),m.getUTCMinutes(),m.getUTCSeconds(),m.getUTCMilliseconds()),v}return Jt(u+h+p,s?.in)}const Mo={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Hx=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Wx=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,qx=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Ux(n){const s={},r=n.split(Mo.dateTimeDelimiter);let i;if(r.length>2)return s;if(/:/.test(r[0])?i=r[0]:(s.date=r[0],i=r[1],Mo.timeZoneDelimiter.test(s.date)&&(s.date=n.split(Mo.timeZoneDelimiter)[0],i=n.substr(s.date.length,n.length))),i){const l=Mo.timezone.exec(i);l?(s.time=i.replace(l[1],""),s.timezone=l[1]):s.time=i}return s}function Vx(n,s){const r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),i=n.match(r);if(!i)return{year:NaN,restDateString:""};const l=i[1]?parseInt(i[1]):null,d=i[2]?parseInt(i[2]):null;return{year:d===null?l:d*100,restDateString:n.slice((i[1]||i[2]).length)}}function Gx(n,s){if(s===null)return new Date(NaN);const r=n.match(Hx);if(!r)return new Date(NaN);const i=!!r[4],l=ei(r[1]),d=ei(r[2])-1,u=ei(r[3]),h=ei(r[4]),p=ei(r[5])-1;if(i)return e0(s,h,p)?Xx(s,h,p):new Date(NaN);{const m=new Date(0);return!Zx(s,d,u)||!Jx(s,l)?new Date(NaN):(m.setUTCFullYear(s,d,Math.max(l,u)),m)}}function ei(n){return n?parseInt(n):1}function Yx(n){const s=n.match(Wx);if(!s)return NaN;const r=id(s[1]),i=id(s[2]),l=id(s[3]);return t0(r,i,l)?r*wp+i*jp+l*1e3:NaN}function id(n){return n&&parseFloat(n.replace(",","."))||0}function Qx(n){if(n==="Z")return 0;const s=n.match(qx);if(!s)return 0;const r=s[1]==="+"?-1:1,i=parseInt(s[2]),l=s[3]&&parseInt(s[3])||0;return n0(i,l)?r*(i*wp+l*jp):NaN}function Xx(n,s,r){const i=new Date(0);i.setUTCFullYear(n,0,4);const l=i.getUTCDay()||7,d=(s-1)*7+r+1-l;return i.setUTCDate(i.getUTCDate()+d),i}const Kx=[31,null,31,30,31,30,31,31,30,31,30,31];function Ep(n){return n%400===0||n%4===0&&n%100!==0}function Zx(n,s,r){return s>=0&&s<=11&&r>=1&&r<=(Kx[s]||(Ep(n)?29:28))}function Jx(n,s){return s>=1&&s<=(Ep(n)?366:365)}function e0(n,s,r){return s>=1&&s<=53&&r>=0&&r<=6}function t0(n,s,r){return n===24?s===0&&r===0:r>=0&&r<60&&s>=0&&s<60&&n>=0&&n<25}function n0(n,s){return s>=0&&s<=59}const hl={week:{before:26,after:52},month:{after:36},quarter:{after:16},year:{before:3,after:7}};function pi(n,s,r,i,l=new Set,d=[]){const u=new Date;u.setHours(0,0,0,0);const h=v=>v.substring(0,10),p=v=>{const y=kt(v,"yyyy-MM-dd"),b=i.find(w=>{const x=h(w.date),_=h(w.end_date||w.date);return y>=x&&y<=_});return{name:b?.name,isCustom:b?.is_custom??!1}},m=v=>{const y=kt(v,"yyyy-MM-dd");return{name:d.find(w=>{const x=h(w.date),_=h(w.end_date||w.date);return y>=x&&y<=_})?.name,isEvent:l.has(y)}};switch(s){case"week":return s0(n,u,r,p,m);case"month":return a0(n,u,r,p,m);case"quarter":return r0(n,u,r,p,m);case"year":return i0(n);default:return[]}}function s0(n,s,r,i,l){const d=[],{before:u,after:h}=hl.week,p=aa(n,{weekStartsOn:1}),m=Yd(p,-u),y=(u+h+1)*7;for(let b=0;b<y;b++){const w=Gn(m,b);d.push(Xd(w,s,r,i,l))}return d}function a0(n,s,r,i,l){const d=[],{after:u}=hl.month,h=Wv(n),p=_s(h,-12),m=Fv(_s(h,u));let v=p;for(;v<=m;)d.push(Xd(v,s,r,i,l)),v=Gn(v,1);return d}function r0(n,s,r,i,l){const d=[],{after:u}=hl.quarter,h=kp(n),p=_s(h,-24),m=_s(h,(u+1)*3);let v=aa(p,{weekStartsOn:1});for(;v<m;){const y=Gn(v,6),b=s>=v&&s<=y,w=Xd(v,s,r,i,l);w.dateEnd=y,w.isToday=b,d.push(w),v=Yd(v,1)}return d}function i0(n,s,r,i,l){const d=[],{before:u,after:h}=hl.year,p=new Date(n.getFullYear(),0,1),m=_s(p,-u*12),v=(u+h+1)*12;for(let y=0;y<v;y++){const b=_s(m,y);d.push(o0(b))}return d}function o0(n){const s=kt(n,"yyyy-MM-dd"),r=n.getDay(),i=new Date;i.setHours(0,0,0,0);const l=n.getFullYear()===i.getFullYear()&&n.getMonth()===i.getMonth();return{date:n,dateStr:s,label:kt(n,"MMM"),isToday:l,isWeekend:!1,isBankHoliday:!1,isCustomHoliday:!1,bankHolidayName:void 0,isCompanyEvent:!1,companyEventName:void 0,dayOfWeek:r,isFirstOfWeek:n.getDate()<=7&&r===1,isFirstOfMonth:!0,weekNumber:Qd(n,{weekStartsOn:1}),monthLabel:kt(n,"MMM"),yearLabel:kt(n,"yyyy")}}function Xd(n,s,r,i,l){const d=kt(n,"yyyy-MM-dd"),u=n.getDay(),h=i(n),p=l(n);return{date:n,dateStr:d,label:kt(n,"d"),isToday:Rv(n,s),isWeekend:Sp(n),isBankHoliday:r.has(d),isCustomHoliday:h.isCustom,bankHolidayName:h.name,isCompanyEvent:p.isEvent,companyEventName:p.name,dayOfWeek:u,isFirstOfWeek:u===1,isFirstOfMonth:n.getDate()===1,weekNumber:Qd(n,{weekStartsOn:1}),monthLabel:kt(n,"MMM"),yearLabel:kt(n,"yyyy")}}function gi(n,s){switch(s){case"week":return{primary:_m(n),secondary:ym(n)};case"month":return{primary:_m(n),secondary:ym(n)};case"quarter":return{primary:l0(n),secondary:c0(n)};case"year":return{primary:d0(n),secondary:u0(n)};default:return{primary:[],secondary:[]}}}function _m(n){const s=[];let r="",i=0;const l=new Date;return n.forEach((d,u)=>{const h=`${d.yearLabel}-${d.monthLabel}`;h!==r?(i>0&&s.push({label:r.split("-")[1]+" "+r.split("-")[0],span:i,isCurrentPeriod:!1}),r=h,i=1):i++,u===n.length-1&&s.push({label:r.split("-")[1]+" "+r.split("-")[0],span:i,isCurrentPeriod:kt(l,"yyyy-MMM")===r})}),s}function ym(n){return n.map(s=>({label:s.label,span:1,isCurrentPeriod:s.isToday}))}function l0(n){const s=[];let r="",i=0;return n.forEach((l,d)=>{const h=`Q${Math.floor(l.date.getMonth()/3)+1} ${l.yearLabel}`;h!==r?(i>0&&s.push({label:r,span:i,isCurrentPeriod:!1}),r=h,i=1):i++,d===n.length-1&&s.push({label:r,span:i,isCurrentPeriod:!1})}),s}function c0(n){return n.map(s=>({label:`W${s.weekNumber}`,span:1,isCurrentPeriod:s.isToday}))}function d0(n){const s=[];let r="",i=0;const l=new Date().getFullYear().toString();return n.forEach((d,u)=>{d.yearLabel!==r?(i>0&&s.push({label:r,span:i,isCurrentPeriod:r===l}),r=d.yearLabel,i=1):i++,u===n.length-1&&s.push({label:r,span:i,isCurrentPeriod:r===l})}),s}function u0(n){const r=kt(new Date,"yyyy-MM");return n.map(i=>({label:i.monthLabel,span:1,isCurrentPeriod:kt(i.date,"yyyy-MM")===r}))}function xn(n,s,r,i,l){if(!r.length||!n||!s)return null;const d=String(n).split("T")[0],u=String(s).split("T")[0],h=new Date(d+"T00:00:00"),p=new Date(u+"T23:59:59.999");if(isNaN(h.getTime())||isNaN(p.getTime()))return null;const m=new Date(r[0].date);m.setHours(0,0,0,0);let v;const y=r[r.length-1];if(l==="quarter"&&y.dateEnd?(v=new Date(y.dateEnd),v.setHours(23,59,59,999)):l==="year"?(v=new Date(y.date),v=new Date(v.getFullYear(),v.getMonth()+1,0,23,59,59,999)):(v=new Date(y.date),v.setHours(23,59,59,999)),p<m||h>v)return null;const b=v.getTime()-m.getTime(),w=r.length*i,_=(Math.max(m.getTime(),h.getTime())-m.getTime())/b*w,C=(Math.min(v.getTime(),p.getTime())-m.getTime())/b*w,B=Math.max(20,C-_);return{left:_,width:B}}function fl(n,s){const r=n.findIndex(i=>i.isToday);return r===-1?null:r*s+s/2}function h0(n){const s=[];return n.forEach(r=>{(r.phases??[]).forEach(i=>{(i.dependencies??[]).forEach(l=>{const{item:d,type:u}=Tp(r,l.id);d&&s.push({id:`dep-${u}-${l.id}-phase-${i.id}`,fromId:l.id,fromType:u,toId:i.id,toType:"phase",type:l.type||"FS",lag:l.lag??0,projectId:r.id})}),$p(r,i.children??[],s)})}),s}function $p(n,s,r){s.forEach(i=>{(i.dependencies??[]).forEach(l=>{const{item:d,type:u}=Tp(n,l.id);d&&r.push({id:`dep-${u}-${l.id}-subphase-${i.id}`,fromId:l.id,fromType:u,toId:i.id,toType:"subphase",type:l.type||"FS",lag:l.lag??0,projectId:n.id})}),i.children?.length&&$p(n,i.children,r)})}function Tp(n,s){const r=(n.phases??[]).find(i=>i.id===s);if(r)return{item:r,type:"phase"};for(const i of n.phases??[]){const l=Mp(i.children??[],s);if(l)return{item:l,type:"subphase"}}return{item:null,type:"subphase"}}function Mp(n,s){for(const r of n){if(r.id===s)return r;if(r.children?.length){const i=Mp(r.children,s);if(i)return i}}return null}const f0={FS:{dashArray:"",description:"Finish-to-Start (solid)"},SS:{dashArray:"6,3",description:"Start-to-Start (long dash)"},FF:{dashArray:"4,2",description:"Finish-to-Finish (short dash)"},SF:{dashArray:"2,2",description:"Start-to-Finish (dotted)"}},Pp=5;function Fn(n,s,r,i,l=Pp){const d=l,u={"right-down":{dx1:-d,dy1:0,dx2:0,dy2:d,sweep:1},"right-up":{dx1:-d,dy1:0,dx2:0,dy2:-d,sweep:0},"left-down":{dx1:d,dy1:0,dx2:0,dy2:d,sweep:0},"left-up":{dx1:d,dy1:0,dx2:0,dy2:-d,sweep:1},"down-right":{dx1:0,dy1:-d,dx2:d,dy2:0,sweep:0},"down-left":{dx1:0,dy1:-d,dx2:-d,dy2:0,sweep:1},"up-right":{dx1:0,dy1:d,dx2:d,dy2:0,sweep:1},"up-left":{dx1:0,dy1:d,dx2:-d,dy2:0,sweep:0}},h=`${r}-${i}`,p=u[h];if(!p)return`L ${n} ${s}`;const m=n+p.dx1,v=s+p.dy1,y=n+p.dx2,b=s+p.dy2;return`L ${m} ${v} A ${d} ${d} 0 0 ${p.sweep} ${y} ${b}`}function m0(n,s,r,i,l){const u=Pp,h=i>s?"down":"up";if(l==="FS")if(r>n+15){const p=n+(r-n)/2;return Math.abs(i-s)<u*2?`M ${n} ${s} H ${p} V ${i} H ${r}`:`M ${n} ${s} H ${p-u} ${Fn(p,s,"right",h,u)} V ${i-(i>s?u:-u)} ${Fn(p,i,h,"right",u)} H ${r}`}else{const p=s+(i>s?20:-20),m=Math.min(n,r)-15,v=n+15;if(Math.abs(p-s)<u*2||Math.abs(i-p)<u*2)return`M ${n} ${s} H ${v} V ${p} H ${m} V ${i} H ${r}`;const y=p>s?"down":"up",b=i>p?"down":"up";return`M ${n} ${s} H ${v-u} ${Fn(v,s,"right",y,u)} V ${p-(p>s?u:-u)} ${Fn(v,p,y,"left",u)} H ${m+u} ${Fn(m,p,"left",b,u)} V ${i-(i>p?u:-u)} ${Fn(m,i,b,"right",u)} H ${r}`}if(l==="SS"){const p=Math.min(n,r)-15;return Math.abs(i-s)<u*2?`M ${n} ${s} H ${p} V ${i} H ${r}`:`M ${n} ${s} H ${p+u} ${Fn(p,s,"left",h,u)} V ${i-(i>s?u:-u)} ${Fn(p,i,h,"right",u)} H ${r}`}if(l==="FF"){const p=Math.max(n,r)+15;return Math.abs(i-s)<u*2?`M ${n} ${s} H ${p} V ${i} H ${r}`:`M ${n} ${s} H ${p-u} ${Fn(p,s,"right",h,u)} V ${i-(i>s?u:-u)} ${Fn(p,i,h,"left",u)} H ${r}`}if(l==="SF")if(r<n-15){const p=n-(n-r)/2;return Math.abs(i-s)<u*2?`M ${n} ${s} H ${p} V ${i} H ${r}`:`M ${n} ${s} H ${p+u} ${Fn(p,s,"left",h,u)} V ${i-(i>s?u:-u)} ${Fn(p,i,h,"left",u)} H ${r}`}else{const p=Math.min(n,r)-15,m=Math.max(n,r)+15,v=s+(i>s?20:-20);return`M ${n} ${s} H ${p} V ${v} H ${m} V ${i} H ${r}`}return`M ${n} ${s} L ${r} ${i}`}function p0(n){switch(n){case"FS":return{sourceEdge:"end",targetEdge:"start"};case"SS":return{sourceEdge:"start",targetEdge:"start"};case"FF":return{sourceEdge:"end",targetEdge:"end"};case"SF":return{sourceEdge:"start",targetEdge:"end"};default:return{sourceEdge:"end",targetEdge:"start"}}}const Qo=32,vm=45,ps=33;function g0(n,s,r,i,l,d=!0,u,h){const p=new Map;let m=0,v;const y=(b,w,x)=>{if(!u)return!0;const _=u(b,w),S=h&&x?.length?h(x):!1;return _||S};return n.forEach(b=>{const w=m;if(p.set(`project-${b.id}`,{top:w,height:vm}),m+=vm,s.has(b.id)&&((b.phases??[]).forEach(x=>{if(!y("phase",x.id,x.children))return;const _=m;if(p.set(`phase-${x.id}`,{top:_,height:Qo}),m+=ps,l?.type==="phase"&&l.projectId===b.id&&l.sourceId===x.id&&(v=m,p.set("phantom",{top:m,height:Qo}),m+=ps),r.has(x.id)){const S=Ip(x.children??[],p,m,i,l,b.id,x.id,void 0,d,u,h);if(m=S.currentTop,S.phantomRowTop!==void 0&&(v=S.phantomRowTop),d){const C=x.staffAssignments?.length??0;m+=C*ps;const B=x.equipmentAssignments?.length??0;m+=B*ps}}}),d)){const x=b.staffAssignments?.length??0;m+=x*ps;const _=b.equipmentAssignments?.length??0;m+=_*ps}}),{positions:p,totalHeight:m,phantomRowTop:v}}function Ip(n,s,r,i,l,d,u,h,p=!0,m,v){let y;const b=(w,x)=>{if(!m)return!0;const _=m("subphase",w),S=v&&x?.length?v(x):!1;return _||S};return n.forEach(w=>{if(b(w.id,w.children)&&(s.set(`subphase-${w.id}`,{top:r,height:Qo}),r+=ps,l?.type==="subphase"&&l.projectId===d&&l.sourceId===w.id&&(y=r,s.set("phantom",{top:r,height:Qo}),r+=ps),i.has(w.id))){if(w.children?.length){const x=Ip(w.children,s,r,i,l,d,u,w.id,p,m,v);r=x.currentTop,x.phantomRowTop!==void 0&&(y=x.phantomRowTop)}if(p){const x=w.staffAssignments?.length??0;r+=x*ps;const _=w.equipmentAssignments?.length??0;r+=_*ps}}}),{currentTop:r,phantomRowTop:y}}function Qn(n){const s=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0");return`${s}-${r}-${i}`}function Ed(n,s,r){for(const i of n){if(!i.start_date||!i.end_date){console.warn(`[autoCalculation] Skipping staff assignment ${i.id} - missing dates`);continue}const l=new Date(i.start_date),d=new Date(i.end_date);if(isNaN(l.getTime())||isNaN(d.getTime())){console.warn(`[autoCalculation] Skipping staff assignment ${i.id} - invalid dates`);continue}const u=new Date(l);u.setDate(u.getDate()+s);const h=new Date(d);h.setDate(h.getDate()+s),i.start_date=Qn(u),i.end_date=Qn(h),r.push({type:"staffAssignment",id:i.id,start_date:i.start_date,end_date:i.end_date,allocation:i.allocation??100})}}function $d(n,s,r){for(const i of n){if(!i.start_date||!i.end_date){console.warn(`[autoCalculation] Skipping equipment assignment ${i.id} - missing dates`);continue}const l=new Date(i.start_date),d=new Date(i.end_date);if(isNaN(l.getTime())||isNaN(d.getTime())){console.warn(`[autoCalculation] Skipping equipment assignment ${i.id} - invalid dates`);continue}const u=new Date(l);u.setDate(u.getDate()+s);const h=new Date(d);h.setDate(h.getDate()+s),i.start_date=Qn(u),i.end_date=Qn(h),r.push({type:"equipmentAssignment",id:i.id,start_date:i.start_date,end_date:i.end_date})}}function Xo(n,s,r){for(const i of n){const l=new Date(i.start_date),d=new Date(i.end_date),u=new Date(l);u.setDate(u.getDate()+s);const h=new Date(d);h.setDate(h.getDate()+s),i.start_date=Qn(u),i.end_date=Qn(h),r.push({type:"subphase",id:i.id,start_date:i.start_date,end_date:i.end_date}),i.staffAssignments?.length&&Ed(i.staffAssignments,s,r),i.equipmentAssignments?.length&&$d(i.equipmentAssignments,s,r),i.children?.length&&Xo(i.children,s,r)}}function _0(n,s,r){for(const i of n.phases??[]){const l=new Date(i.start_date),d=new Date(i.end_date),u=new Date(l);u.setDate(u.getDate()+s);const h=new Date(d);h.setDate(h.getDate()+s),i.start_date=Qn(u),i.end_date=Qn(h),r.push({type:"phase",id:i.id,start_date:i.start_date,end_date:i.end_date}),i.staffAssignments?.length&&Ed(i.staffAssignments,s,r),i.equipmentAssignments?.length&&$d(i.equipmentAssignments,s,r),i.children?.length&&Xo(i.children,s,r)}n.staffAssignments?.length&&Ed(n.staffAssignments,s,r),n.equipmentAssignments?.length&&$d(n.equipmentAssignments,s,r)}function xm(n,s){for(const r of n.phases??[])for(const i of r.children??[]){if(i.id===s)return{parent:r,type:"phase"};const l=Lp(i,s);if(l)return l}return null}function Lp(n,s){for(const r of n.children??[]){if(r.id===s)return{parent:n,type:"subphase"};const i=Lp(r,s);if(i)return i}return null}function Ap(n,s,r){let i=s,l=xm(n,i);for(;l;){const d=l.parent,u=d.children??[];if(u.length===0)break;let h=null,p=null;for(const b of u){const w=new Date(b.start_date),x=new Date(b.end_date);(!h||w<h)&&(h=w),(!p||x>p)&&(p=x)}if(!h||!p)break;const m=new Date(d.start_date),v=new Date(d.end_date);let y=!1;if(h.getTime()!==m.getTime()&&(d.start_date=Qn(h),y=!0),p.getTime()!==v.getTime()&&(d.end_date=Qn(p),y=!0),y&&r.push({type:l.type,id:d.id,start_date:d.start_date,end_date:d.end_date}),l.type==="phase"){Kd(n,r);break}else i=d.id,l=xm(n,i)}}function Kd(n,s){const r=n.phases??[];if(r.length===0)return;let i=null,l=null;for(const h of r){const p=new Date(h.start_date),m=new Date(h.end_date);(!i||p<i)&&(i=p),(!l||m>l)&&(l=m)}if(!i||!l)return;const d=Qn(i),u=Qn(l);if(n.start_date!==d||n.end_date!==u){n.start_date=d,n.end_date=u;const h=s.findIndex(p=>p.type==="project"&&p.id===n.id);h>=0?(s[h].start_date=d,s[h].end_date=u):s.push({type:"project",id:n.id,start_date:d,end_date:u,name:n.name,pm_id:n.pm_id,customer:n.customer,sales_pm:n.sales_pm,volume:n.volume,confirmed:n.confirmed})}}async function Ko(n){const s=n.map(r=>r.type==="phase"?ra(r.id,{start_date:r.start_date,end_date:r.end_date}).catch(i=>console.error(`Failed to save phase ${r.id}:`,i)):r.type==="subphase"?ia(r.id,{start_date:r.start_date,end_date:r.end_date}).catch(i=>console.error(`Failed to save subphase ${r.id}:`,i)):r.type==="project"?fi(r.id,{name:r.name,start_date:r.start_date,end_date:r.end_date,pm_id:r.pm_id,customer:r.customer,sales_pm:r.sales_pm,volume:r.volume,confirmed:r.confirmed}).catch(i=>console.error(`Failed to save project ${r.id}:`,i)):r.type==="staffAssignment"?il(r.id,{start_date:r.start_date,end_date:r.end_date,allocation:r.allocation??100}).catch(i=>console.error(`Failed to save staff assignment ${r.id}:`,i)):r.type==="equipmentAssignment"?ol(r.id,{start_date:r.start_date,end_date:r.end_date}).catch(i=>console.error(`Failed to save equipment assignment ${r.id}:`,i)):Promise.resolve());await Promise.all(s)}function Rp(n,s,r,i){const l=[];return Kd(n,l),l}function Bp(n,s,r,i){const l=[];return Ap(n,s,l),l}function Zd(n){return JSON.parse(JSON.stringify(n))}function y0(){const{isDragging:n,dragType:s,dragItemId:r,startDrag:i,endDrag:l,showDragIndicator:d,hideIndicator:u}=xe(),{projects:h,setProjects:p,cellWidth:m,currentView:v,viewMode:y}=G(),{saveState:b}=vp(),w=f.useRef(null),x=f.useRef(0),_=f.useCallback($=>{const M=$.getFullYear(),k=String($.getMonth()+1).padStart(2,"0"),P=String($.getDate()).padStart(2,"0");return`${M}-${k}-${P}`},[]),S=f.useCallback(()=>{const $=document.querySelectorAll("[data-date]");if($.length===0)return null;const M=[];return $.forEach(k=>{const P=k.getAttribute("data-date"),F=k.getAttribute("data-date-end");P&&M.push({date:P,dateEnd:F||void 0})}),M.length>0?M:null},[]),C=f.useCallback(($,M,k,P)=>{if(M.length===0)return null;if(P==="week"||P==="month"){const te=Math.round($/k),Y=Math.max(0,Math.min(M.length-1,te));return M[Y].date}const F=new Date(M[0].date);F.setHours(0,0,0,0);let A;const I=M[M.length-1];P==="quarter"&&I.dateEnd?(A=new Date(I.dateEnd),A.setHours(23,59,59,999)):P==="year"?(A=new Date(I.date),A=new Date(A.getFullYear(),A.getMonth()+1,0,23,59,59,999)):(A=new Date(I.date),A.setHours(23,59,59,999));const U=A.getTime()-F.getTime(),N=M.length*k,W=$/N*U,K=new Date(F.getTime()+W);return _(K)},[_]),B=f.useCallback(($,M,k)=>{const P=h.find(Y=>Y.id===M);if(!P)return null;const F=(P.phases??[]).find(Y=>Y.id===$);if(!F)return null;const A=F.dependencies??[];if(A.length===0)return null;const I=new Date(F.start_date),N=new Date(F.end_date).getTime()-I.getTime(),W=new Date(k),K=new Date(W.getTime()+N);let te=null;for(const Y of A){const me=(P.phases??[]).find(le=>le.id===Y.id);if(!me)continue;const ge=new Date(me.start_date),pe=new Date(me.end_date);let oe;if(Y.type==="SS")oe=Math.round((W.getTime()-ge.getTime())/864e5);else if(Y.type==="FF")oe=Math.round((K.getTime()-pe.getTime())/864e5);else if(Y.type==="SF")oe=Math.round((K.getTime()-ge.getTime())/864e5);else{const le=new Date(pe);le.setDate(le.getDate()+1),oe=Math.round((W.getTime()-le.getTime())/864e5)}(te===null||oe<te)&&(te=oe)}return te},[h]),D=f.useCallback(($,M)=>{const k=P=>{for(const F of P){if(F.id===M)return F;if(F.children?.length){const A=k(F.children);if(A)return A}}return null};for(const P of $.phases??[])if(P.children?.length){const F=k(P.children);if(F)return F}return null},[]),O=f.useCallback(($,M,k)=>{const P=h.find(Y=>Y.id===M);if(!P)return null;const F=D(P,$);if(!F)return null;const A=F.dependencies??[];if(A.length===0)return null;const I=new Date(F.start_date),N=new Date(F.end_date).getTime()-I.getTime(),W=new Date(k),K=new Date(W.getTime()+N);let te=null;for(const Y of A){const me=D(P,Y.id);if(!me)continue;const ge=new Date(me.start_date),pe=new Date(me.end_date);let oe;if(Y.type==="SS")oe=Math.round((W.getTime()-ge.getTime())/864e5);else if(Y.type==="FF")oe=Math.round((K.getTime()-pe.getTime())/864e5);else if(Y.type==="SF")oe=Math.round((K.getTime()-ge.getTime())/864e5);else{const le=new Date(pe);le.setDate(le.getDate()+1),oe=Math.round((W.getTime()-le.getTime())/864e5)}(te===null||oe<te)&&(te=oe)}return te},[h,D]),z=f.useCallback($=>{if(!w.current)return;x.current=$.clientX;const M=w.current,k=$.clientX-M.startX;let P=M.originalLeft+k;(y==="week"||y==="month")&&(P=Math.round(P/m)*m),M.element&&(M.element.style.left=`${P}px`,M.element.style.opacity="0.8",M.element.style.zIndex="1000");const F=S();if(F&&F.length>0&&M.element){const A=C(P,F,m,y);if(A){const I=M.type==="phase"?B(M.id,M.projectId,A):O(M.id,M.projectId,A);if(I!==null){const U=M.element.closest('[class*="row"]');if(U){const N=U.offsetTop,W=M.element.offsetWidth,K=P+W/2,te=N-22;d(K,te,I)}}else u()}}},[m,y,S,C,B,O,d,u]),R=f.useCallback(async()=>{if(u(),!w.current){l();return}const $=w.current;$.element&&($.element.style.opacity="1",$.element.style.zIndex="",$.element.classList.remove("dragging")),document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",R);const M=$.element?parseFloat($.element.style.left)||0:$.originalLeft,k=M-$.originalLeft;if(Math.abs(k)<2){w.current=null,l();return}const P=S();if(!P||P.length===0){console.warn("Could not get timeline cells for date calculation");const Y=Math.round(k/m),me=(oe,le)=>{const se=new Date(oe);return se.setDate(se.getDate()+le),se.toISOString().split("T")[0]},ge=me($.originalStartDate,Y),pe=$.isMilestone?ge:me($.originalEndDate,Y);await Q($,ge,pe);return}const F=C(M,P,m,y);if(!F){console.warn("Could not calculate date from position"),w.current=null,l();return}const A=new Date($.originalStartDate),I=new Date($.originalEndDate);A.setHours(0,0,0,0),I.setHours(0,0,0,0);const U=Math.round((I.getTime()-A.getTime())/864e5),N=new Date(F);N.setHours(0,0,0,0);const W=new Date(N);W.setDate(W.getDate()+U);const K=_(N),te=$.isMilestone?K:_(W);await Q($,K,te)},[m,y,l,z,b,p,h,u]),Q=f.useCallback(async($,M,k)=>{try{const P=h.findIndex(te=>te.id===$.projectId);if(P===-1){console.error("Project not found:",$.projectId),w.current=null,l();return}const F=new Date($.originalStartDate).getTime(),A=new Date(M).getTime(),I=Math.round((A-F)/864e5);if(I===0){w.current=null,l();return}if($.type==="project"){const Y=h[P].phases?.length??0;if(!window.confirm(`Move project by ${I>0?"+":""}${I} days?

This will move all ${Y} phase(s), their subphases, and all staff/equipment assignments.`)){$.element&&($.element.style.left=`${$.originalLeft}px`,$.element.classList.remove("dragging")),w.current=null,l();return}}b(h,"drag");const U=Zd(h[P]),N=[];if($.type==="project")U.start_date=M,U.end_date=k,I!==0&&_0(U,I,N);else if($.type==="phase"){const te=(U.phases??[]).find(Y=>Y.id===$.id);te&&(te.start_date=M,te.end_date=k,te.children?.length&&I!==0&&Xo(te.children,I,N))}else{const te=Y=>{for(const me of Y){if(me.id===$.id)return me.start_date=M,me.end_date=k,me.children?.length&&I!==0&&Xo(me.children,I,N),!0;if(me.children?.length&&te(me.children))return!0}return!1};for(const Y of U.phases??[])if(Y.children?.length&&te(Y.children))break}let W=[];if($.type==="phase")W=Rp(U,$.id,$.originalEndDate,k);else if($.type==="subphase")W=Bp(U,$.id,$.originalEndDate,k);else if($.type==="staffAssignment"){const te=U.staffAssignments?.find(Y=>Y.id===$.id);te&&(te.start_date=M,te.end_date=k)}else if($.type==="equipmentAssignment"){const te=U.equipmentAssignments?.find(Y=>Y.id===$.id);te&&(te.start_date=M,te.end_date=k)}W.push(...N);const K=h.map((te,Y)=>Y===P?U:te);if(p(K),$.type==="project")await fi($.id,{start_date:M,end_date:k});else if($.type==="phase")await ra($.id,{start_date:M,end_date:k});else if($.type==="subphase")await ia($.id,{start_date:M,end_date:k});else if($.type==="staffAssignment"){const te=U.staffAssignments?.find(Y=>Y.id===$.id);await il($.id,{start_date:M,end_date:k,allocation:te?.allocation??100})}else $.type==="equipmentAssignment"&&await ol($.id,{start_date:M,end_date:k});W.length>0&&(console.log(`Saving ${W.length} cascaded updates`),await Ko(W))}catch(P){console.error("Failed to update item:",P);const F=await Rt();p(F)}w.current=null,l()},[b,p,h,l]),H=f.useCallback(($,M,k,P,F,A=!1,I)=>{if($.target.classList.contains("resize-handle")||v==="equipment"||v==="staff")return;$.preventDefault(),$.stopPropagation();let U=I||$.currentTarget;if((!U||!U.classList?.contains("gantt-bar")&&!U.dataset?.phaseId)&&(U=$.target.closest("[data-phase-id]")),!U){console.warn("Could not find element for drag");return}w.current={id:M,type:"phase",projectId:k,startX:$.clientX,element:U,originalLeft:parseInt(U?.style.left||"0")||0,originalStartDate:P,originalEndDate:F,isMilestone:A},x.current=$.clientX,U&&U.classList.add("dragging"),i("phase",M),document.addEventListener("mousemove",z),document.addEventListener("mouseup",R)},[v,z,R,i]),J=f.useCallback(($,M,k,P,F,A,I=!1,U)=>{if($.target.classList.contains("resize-handle")||v==="equipment"||v==="staff")return;$.preventDefault(),$.stopPropagation();let N=U||$.currentTarget;if((!N||!N.classList?.contains("gantt-bar")&&!N.dataset?.subphaseId)&&(N=$.target.closest("[data-subphase-id]")),!N){console.warn("Could not find element for subphase drag");return}w.current={id:M,type:"subphase",projectId:k,phaseId:P,startX:$.clientX,element:N,originalLeft:parseInt(N?.style.left||"0")||0,originalStartDate:F,originalEndDate:A,isMilestone:I},x.current=$.clientX,N&&N.classList.add("dragging"),i("subphase",M),document.addEventListener("mousemove",z),document.addEventListener("mouseup",R)},[v,z,R,i]),q=f.useCallback(($,M,k,P,F)=>{if($.target.classList.contains("resize-handle")||v==="equipment"||v==="staff")return;$.preventDefault(),$.stopPropagation();let A=F||$.currentTarget;if((!A||!A.classList?.contains("gantt-bar")&&!A.dataset?.projectId)&&(A=$.target.closest("[data-project-id]")),!A){console.warn("Could not find element for project drag");return}w.current={id:M,type:"project",projectId:M,startX:$.clientX,element:A,originalLeft:parseInt(A?.style.left||"0")||0,originalStartDate:k,originalEndDate:P,isMilestone:!1},x.current=$.clientX,A&&A.classList.add("dragging"),i("project",M),document.addEventListener("mousemove",z),document.addEventListener("mouseup",R)},[v,z,R,i]),E=f.useCallback(($,M,k,P,F,A)=>{if($.target.classList.contains("resize-handle")||v==="equipment"||v==="staff")return;$.preventDefault(),$.stopPropagation();let I=A||$.currentTarget;if((!I||!I.dataset?.assignmentId)&&(I=$.target.closest("[data-assignment-id]")),!I){console.warn("Could not find element for staff assignment drag");return}w.current={id:M,type:"staffAssignment",projectId:k,startX:$.clientX,element:I,originalLeft:parseInt(I?.style.left||"0")||0,originalStartDate:P,originalEndDate:F,isMilestone:!1},x.current=$.clientX,I&&I.classList.add("dragging"),i("staffAssignment",M),document.addEventListener("mousemove",z),document.addEventListener("mouseup",R)},[v,z,R,i]),L=f.useCallback(($,M,k,P,F,A)=>{if($.target.classList.contains("resize-handle")||v==="equipment"||v==="staff")return;$.preventDefault(),$.stopPropagation();let I=A||$.currentTarget;if((!I||!I.dataset?.assignmentId)&&(I=$.target.closest("[data-assignment-id]")),!I){console.warn("Could not find element for equipment assignment drag");return}w.current={id:M,type:"equipmentAssignment",projectId:k,startX:$.clientX,element:I,originalLeft:parseInt(I?.style.left||"0")||0,originalStartDate:P,originalEndDate:F,isMilestone:!1},x.current=$.clientX,I&&I.classList.add("dragging"),i("equipmentAssignment",M),document.addEventListener("mousemove",z),document.addEventListener("mouseup",R)},[v,z,R,i]);return f.useEffect(()=>()=>{document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",R)},[z,R]),{isDragging:n,dragType:s,dragItemId:r,startProjectDrag:q,startPhaseDrag:H,startSubphaseDrag:J,startStaffAssignmentDrag:E,startEquipmentAssignmentDrag:L}}function v0(){const{isResizing:n,resizeEdge:s,resizeItemId:r,resizeItemType:i,startResize:l,endResize:d,showResizeIndicator:u,hideIndicator:h}=xe(),{projects:p,setProjects:m,cellWidth:v,currentView:y,viewMode:b}=G(),{saveState:w}=vp(),x=f.useRef(null),_=f.useRef(0),S=f.useRef(v),C=f.useRef(b);f.useEffect(()=>{S.current=v},[v]),f.useEffect(()=>{C.current=b},[b]);const B=f.useCallback(E=>{const L=E.getFullYear(),$=String(E.getMonth()+1).padStart(2,"0"),M=String(E.getDate()).padStart(2,"0");return`${L}-${$}-${M}`},[]),D=f.useCallback(()=>{const E=document.querySelectorAll("[data-date]");if(E.length===0)return null;const L=[];return E.forEach($=>{const M=$.getAttribute("data-date"),k=$.getAttribute("data-date-end");M&&L.push({date:M,dateEnd:k||void 0})}),L.length>0?L:null},[]),O=f.useCallback((E,L,$,M)=>{if(L.length===0)return null;if(M==="week"||M==="month"){const W=Math.round(E/$),K=Math.max(0,Math.min(L.length-1,W));return L[K].date}const k=new Date(L[0].date);k.setHours(0,0,0,0);let P;const F=L[L.length-1];M==="quarter"&&F.dateEnd?(P=new Date(F.dateEnd),P.setHours(23,59,59,999)):M==="year"?(P=new Date(F.date),P=new Date(P.getFullYear(),P.getMonth()+1,0,23,59,59,999)):(P=new Date(F.date),P.setHours(23,59,59,999));const A=P.getTime()-k.getTime(),I=L.length*$,U=E/I*A,N=new Date(k.getTime()+U);return B(N)},[B]),z=f.useCallback(E=>{if(!x.current)return;_.current=E.clientX;const L=x.current,$=S.current,M=C.current;let k=E.clientX-L.startX;(M==="week"||M==="month")&&(k=Math.round(k/$)*$);let P=L.originalLeft,F=L.originalWidth;L.element&&(L.edge==="left"?(P=L.originalLeft+k,F=L.originalWidth-k,F>=$&&(L.element.style.left=`${P}px`,L.element.style.width=`${F}px`)):(F=L.originalWidth+k,F>=$&&(L.element.style.width=`${F}px`)));const A=D();if(A&&A.length>0&&F>=$&&L.element){const I=L.edge==="left"?O(P,A,$,M):O(P+F,A,$,M);if(I){const U=L.edge==="left"?I:O(P,A,$,M)||L.originalStartDate,N=L.edge==="left"?O(P+F,A,$,M)||L.originalEndDate:I,W=new Date(U).getTime(),K=new Date(N).getTime(),te=Math.round((K-W)/864e5)+1,Y=L.element.closest('[class*="row"]');if(Y){const me=Y.offsetTop,ge=L.edge==="left"?P:P+F,pe=me-28;u(ge,pe,I,te,L.edge)}}}},[u,D,O]),R=f.useCallback(async()=>{if(h(),!x.current){d();return}const E=x.current,L=S.current,$=C.current;document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",R),document.body.style.cursor="",E.element&&E.element.classList.remove("resizing");const M=E.element?parseFloat(E.element.style.left)||0:E.originalLeft,k=E.element&&parseFloat(E.element.style.width)||E.originalWidth,P=Math.abs(M-E.originalLeft),F=Math.abs(k-E.originalWidth);if(P<2&&F<2){E.element&&(E.element.style.left=`${E.originalLeft}px`,E.element.style.width=`${E.originalWidth}px`),x.current=null,d();return}const A=D();let I=E.originalStartDate,U=E.originalEndDate;if(A&&A.length>0)if(E.edge==="left"){const N=O(M,A,L,$);if(N&&(I=N,new Date(I)>=new Date(U))){const W=new Date(U);W.setDate(W.getDate()-1),I=B(W)}}else{const N=M+k,W=O(N,A,L,$);if(W&&(U=W,new Date(U)<=new Date(I))){const K=new Date(I);K.setDate(K.getDate()+1),U=B(K)}}else{const N=_.current-E.startX;let W;switch($){case"week":case"month":W=1;break;case"quarter":W=7;break;case"year":W=30;break;default:W=1}const K=Math.round(N/L*W),te=(Y,me)=>{const ge=new Date(Y);return ge.setDate(ge.getDate()+me),ge.toISOString().split("T")[0]};E.edge==="left"?(I=te(E.originalStartDate,K),new Date(I)>=new Date(U)&&(I=te(U,-1))):(U=te(E.originalEndDate,K),new Date(U)<=new Date(I)&&(U=te(I,1)))}try{w(p,"resize");const N=p.findIndex(Y=>Y.id===E.projectId);if(N===-1){console.error("Project not found:",E.projectId),x.current=null,d();return}const W=Zd(p[N]);if(E.type==="phase"){const Y=(W.phases??[]).find(me=>me.id===E.id);Y&&(Y.start_date=I,Y.end_date=U)}else if(E.type==="subphase"){const Y=me=>{for(const ge of me){if(ge.id===E.id)return ge.start_date=I,ge.end_date=U,!0;if(ge.children?.length&&Y(ge.children))return!0}return!1};for(const me of W.phases??[])if(me.children?.length&&Y(me.children))break}else if(E.type==="staffAssignment"){const Y=W.staffAssignments?.find(me=>me.id===E.id);Y&&(Y.start_date=I,Y.end_date=U)}else if(E.type==="equipmentAssignment"){const Y=W.equipmentAssignments?.find(me=>me.id===E.id);Y&&(Y.start_date=I,Y.end_date=U)}let K=[];E.type==="phase"?K=Rp(W,E.id,E.originalEndDate,U):E.type==="subphase"&&(K=Bp(W,E.id,E.originalEndDate,U));const te=p.map((Y,me)=>me===N?W:Y);if(m(te),E.type==="phase")await ra(E.id,{start_date:I,end_date:U});else if(E.type==="subphase")await ia(E.id,{start_date:I,end_date:U});else if(E.type==="staffAssignment"){const Y=W.staffAssignments?.find(me=>me.id===E.id);await il(E.id,{start_date:I,end_date:U,allocation:Y?.allocation??100})}else E.type==="equipmentAssignment"&&await ol(E.id,{start_date:I,end_date:U});K.length>0&&(console.log(`Cascading ${K.length} updates:`,K),await Ko(K))}catch(N){console.error("Failed to resize item:",N);const W=await Rt();m(W)}x.current=null,d()},[d,z,w,m,p,h,D,O,B]),Q=f.useCallback((E,L,$,M,k,P,F)=>{if(y==="equipment"||y==="staff")return;E.preventDefault(),E.stopPropagation();const A=F.getBoundingClientRect(),I=window.getComputedStyle(F);x.current={id:L,type:"phase",projectId:$,edge:M,startX:E.clientX,element:F,originalLeft:parseFloat(I.left)||0,originalWidth:A.width,originalStartDate:k,originalEndDate:P},_.current=E.clientX,F.classList.add("resizing"),document.body.style.cursor="ew-resize",l("phase",L,M),document.addEventListener("mousemove",z),document.addEventListener("mouseup",R)},[y,z,R,l]),H=f.useCallback((E,L,$,M,k,P,F)=>{if(y==="equipment"||y==="staff")return;E.preventDefault(),E.stopPropagation();const A=F.getBoundingClientRect(),I=window.getComputedStyle(F);x.current={id:L,type:"subphase",projectId:$,edge:M,startX:E.clientX,element:F,originalLeft:parseFloat(I.left)||0,originalWidth:A.width,originalStartDate:k,originalEndDate:P},_.current=E.clientX,F.classList.add("resizing"),document.body.style.cursor="ew-resize",l("subphase",L,M),document.addEventListener("mousemove",z),document.addEventListener("mouseup",R)},[y,z,R,l]),J=f.useCallback((E,L,$,M,k,P,F)=>{if(y==="equipment"||y==="staff")return;E.preventDefault(),E.stopPropagation();const A=F||E.currentTarget.closest("[data-assignment-id]");A&&(x.current={id:L,type:"staffAssignment",projectId:$,edge:M,startX:E.clientX,element:A,originalLeft:parseInt(A.style.left||"0")||0,originalWidth:parseInt(A.style.width||"0")||A.offsetWidth,originalStartDate:k,originalEndDate:P},_.current=E.clientX,A.classList.add("resizing"),document.body.style.cursor="ew-resize",l("staffAssignment",L,M),document.addEventListener("mousemove",z),document.addEventListener("mouseup",R))},[y,z,R,l]),q=f.useCallback((E,L,$,M,k,P,F)=>{if(y==="equipment"||y==="staff")return;E.preventDefault(),E.stopPropagation();const A=F||E.currentTarget.closest("[data-assignment-id]");A&&(x.current={id:L,type:"equipmentAssignment",projectId:$,edge:M,startX:E.clientX,element:A,originalLeft:parseInt(A.style.left||"0")||0,originalWidth:parseInt(A.style.width||"0")||A.offsetWidth,originalStartDate:k,originalEndDate:P},_.current=E.clientX,A.classList.add("resizing"),document.body.style.cursor="ew-resize",l("equipmentAssignment",L,M),document.addEventListener("mousemove",z),document.addEventListener("mouseup",R))},[y,z,R,l]);return f.useEffect(()=>()=>{document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",R),document.body.style.cursor=""},[z,R]),{isResizing:n,resizeEdge:s,resizeItemId:r,resizeItemType:i,startPhaseResize:Q,startSubphaseResize:H,startStaffAssignmentResize:J,startEquipmentAssignmentResize:q}}function ml(n,s){f.useEffect(()=>{const r=n.current,i=s.current;if(!r||!i)return;let l=!1;const d=()=>{l||(l=!0,i.scrollTop=r.scrollTop,requestAnimationFrame(()=>{l=!1}))},u=()=>{l||(l=!0,r.scrollTop=i.scrollTop,requestAnimationFrame(()=>{l=!1}))};return r.addEventListener("scroll",d,{passive:!0}),i.addEventListener("scroll",u,{passive:!0}),()=>{r.removeEventListener("scroll",d),i.removeEventListener("scroll",u)}},[n,s])}const jm=/^\[R:([0-6](?:,[0-6])*)\]\s*/,Op=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],od=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function _i(n){if(!n)return null;const s=n.match(jm);if(!s)return null;const i=s[1].split(",").map(Number).sort((d,u)=>d-u),l=n.replace(jm,"").trim()||"Recurring absence";return{daysOfWeek:i,cleanDescription:l}}function x0(n,s){return n.length===0?s:`[R:${[...n].sort((i,l)=>i-l).join(",")}] ${s}`.trim()}function Td(n){return n.length===0?"":n.length===1?`Every ${od[n[0]]}`:n.length===2?`Every ${od[n[0]]} & ${od[n[1]]}`:`Every ${n.map(s=>Op[s]).join(", ")}`}function j0(n,s,r){const l=new Date(n).getDay(),d=s.start_date.split("T")[0],u=s.end_date.split("T")[0],h=n.split("T")[0];return h<d||h>u?!1:r.daysOfWeek.includes(l)}function w0(n,s,r,i=100){return f.useMemo(()=>r.map(l=>{const d=l.dateStr;let u,h=!1;for(const w of s){const x=w.start_date.split("T")[0],_=w.end_date.split("T")[0];if(d>=x&&d<=_){const S=_i(w.description);if(S){if(j0(d,w,S)){u={...w,description:S.cleanDescription},h=!0;break}}else{u=w,h=!1;break}}}const p=!!u,m=n.filter(w=>{const x=w.start_date.split("T")[0],_=w.end_date.split("T")[0];return d>=x&&d<=_}),v=m.reduce((w,x)=>w+(x.allocation||0),0);let y,b;return p?(y=0,v>0?b="conflict":b="vacation"):v===0?(y=100,b="empty"):v>i?(y=100-v,b="overloaded"):v===i?(y=0,b="full"):(y=100-v,b="partial"),{total:v,assignments:m,isOnVacation:p,vacationDescription:u?.description,isRecurringVacation:h,available:y,state:b}}),[n,s,r,i])}function S0(n){if(n.isOnVacation){const r=n.vacationDescription||"Vacation",i=n.isRecurringVacation?" (recurring)":"";return n.total>0?`${r}${i}
 Conflict: ${n.total}% assigned during vacation`:`${r}${i}`}if(n.total===0)return"Available";let s=`${n.total}% allocated`;return n.assignments.length>1&&(s+=` (${n.assignments.length} assignments)`),n.total>100&&(s+=`
 Overloaded by ${n.total-100}%`),s}function C0(n){switch(n.state){case"vacation":return{background:"rgba(139, 92, 246, 0.25)"};case"conflict":return{background:"linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(239, 68, 68, 0.3))"};case"overloaded":return{background:`linear-gradient(to top, rgba(239, 68, 68, ${.3+Math.min(100,n.total-100)/200}) ${Math.min(100,n.total)}%, transparent ${Math.min(100,n.total)}%)`};case"full":return{background:"rgba(59, 130, 246, 0.25)"};case"partial":return{background:`linear-gradient(to top, rgba(59, 130, 246, 0.2) ${n.total}%, transparent ${n.total}%)`};default:return{}}}function b0(n,s){return n==="end"&&s==="start"?"FS":n==="start"&&s==="start"?"SS":n==="end"&&s==="end"?"FF":n==="start"&&s==="end"?"SF":"FS"}function er(n){const s=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0");return`${s}-${r}-${i}`}function k0(){const{isLinkingDependency:n,linkingFrom:s,startLinking:r,completeLinking:i,cancelLinking:l}=xe(),{projects:d,setProjects:u}=G(),h=f.useCallback(w=>{for(const x of d){const _=(x.phases??[]).find(S=>S.id===w);if(_)return{project:x,phase:_}}return null},[d]),p=f.useCallback(w=>{const x=_=>{for(const S of _){if(S.id===w)return S;if(S.children?.length){const C=x(S.children);if(C)return C}}return null};for(const _ of d)for(const S of _.phases??[]){const C=x(S.children??[]);if(C)return{project:_,subphase:C}}return null},[d]),m=f.useCallback((w,x,_,S)=>{const C=new Set,B=[x],D=d.find(O=>O.id===w);if(!D)return!1;for(;B.length>0;){const O=B.pop();if(O===_)return!0;if(C.has(O))continue;C.add(O);let z=[];if(S==="phase"){const R=(D.phases??[]).find(Q=>Q.id===O);R?.dependencies&&(z=R.dependencies)}else{const R=Q=>{for(const H of Q){if(H.id===O&&H.dependencies)return H.dependencies;if(H.children?.length){const J=R(H.children);if(J.length)return J}}return[]};for(const Q of D.phases??[])if(z=R(Q.children??[]),z.length)break}z.forEach(R=>B.push(R.id))}return!1},[d]),v=f.useCallback((w,x,_,S,C)=>{if(w.stopPropagation(),w.preventDefault(),n&&s){if(s.projectId!==x){alert("Dependencies can only be created between items in the same project"),l();return}if(s.itemId===_&&s.itemType===S){l();return}if(m(x,_,s.itemId,S)){alert("Cannot create circular dependency"),l();return}const B=b0(s.zone,C);y(x,s.itemId,s.itemType,_,S,B),i();return}r(x,_,S,C)},[n,s,r,i,l,m]),y=f.useCallback(async(w,x,_,S,C,B)=>{try{let D=null,O=null;if(_==="phase"){const F=h(x);F&&(D=F.phase)}else{const F=p(x);F&&(D=F.subphase)}if(C==="phase"){const F=h(S);F&&(O=F.phase)}else{const F=p(S);F&&(O=F.subphase)}if(!D||!O){console.error("Could not find source or target item");return}const z=O.dependencies??[];if(z.some(F=>F.id===x&&F.type===B)){console.log("Dependency already exists");return}const R=[...z,{id:x,type:B}],Q=new Date(O.start_date),H=new Date(O.end_date);Q.setHours(0,0,0,0),H.setHours(0,0,0,0);const J=Math.round((H.getTime()-Q.getTime())/864e5);let q=O.start_date,E=O.end_date,L=0;if(B==="FS"){const F=new Date(D.end_date);F.setHours(0,0,0,0);const A=new Date(F);A.setDate(A.getDate()+1);const I=new Date(A);I.setDate(I.getDate()+J),q=er(A),E=er(I),L=Math.round((A.getTime()-Q.getTime())/864e5)}else if(B==="SS"){const F=new Date(D.start_date);F.setHours(0,0,0,0);const A=new Date(F),I=new Date(A);I.setDate(I.getDate()+J),q=er(A),E=er(I),L=Math.round((A.getTime()-Q.getTime())/864e5)}const $=[],M=(F,A)=>{for(const I of F){const U=new Date(I.start_date),N=new Date(I.end_date);U.setDate(U.getDate()+A),N.setDate(N.getDate()+A);const W=er(U),K=er(N);I.start_date=W,I.end_date=K,$.push({type:"subphase",id:I.id,start_date:W,end_date:K}),I.children?.length&&M(I.children,A)}},k=[],P=d.map(F=>{if(F.id!==w)return F;const A=Zd(F);if(C==="phase"){const I=(A.phases??[]).find(U=>U.id===S);I&&(I.dependencies=R,I.start_date=q,I.end_date=E,L!==0&&I.children?.length&&M(I.children,L)),Kd(A,k)}else{const I=U=>{for(const N of U){if(N.id===S)return N.dependencies=R,N.start_date=q,N.end_date=E,L!==0&&N.children?.length&&M(N.children,L),!0;if(N.children?.length&&I(N.children))return!0}return!1};for(const U of A.phases??[])if(U.children?.length&&I(U.children))break;L!==0&&Ap(A,S,k)}return A});u(P),C==="phase"?await ra(S,{start_date:q,end_date:E,dependencies:R}):await ia(S,{start_date:q,end_date:E,dependencies:R}),$.length>0&&(console.log(`Saving ${$.length} child updates from dependency creation`),await Ko($)),k.length>0&&(console.log(`Saving ${k.length} parent updates from dependency creation`),await Ko(k))}catch(D){console.error("Failed to create dependency:",D);const O=await Rt();u(O)}},[d,u,h,p]),b=f.useCallback(()=>{n&&l()},[n,l]);return{isLinkingDependency:n,linkingFrom:s,handleLinkZoneClick:v,handleCancelLinking:b}}function N0(n,s){for(const r of n.phases||[]){const i=Fp(r.children||[],s,1);if(i!==null)return i}return 1}function Fp(n,s,r){for(const i of n){if(i.id===s)return r;if(i.children&&i.children.length>0){const l=Fp(i.children,s,r+1);if(l!==null)return l}}return null}function Zo(n,s){for(const r of n){const i=Jd(r.children||[],s);if(i)return i}return null}function Jd(n,s){for(const r of n){if(r.id===s)return r;if(r.children&&r.children.length>0){const i=Jd(r.children,s);if(i)return i}}return null}function D0(n,s){const r=Zo(n.phases||[],s);if(!r)return 0;const i=!!r.parent_subphase_id,l=i?r.parent_subphase_id:r.parent_phase_id;let d=[];return i?d=Zo(n.phases||[],l)?.children||[]:d=(n.phases||[]).find(h=>h.id===l)?.children||[],d.findIndex(u=>u.id===s)}function Po(n){return kt(n,"yyyy-MM-dd")}function ti(n){const s=n.split("T")[0];return new Date(s+"T12:00:00")}function yi(){const n=G(y=>y.projects),s=xe(y=>y.phantomSiblingMode),r=xe(y=>y.startPhantomSibling),i=xe(y=>y.updatePhantomPosition),l=xe(y=>y.endPhantomSibling),d=f.useRef(!1);d.current=!!s;const u=f.useCallback(y=>{const{projectId:b,sourceId:w,type:x,zone:_}=y,S=n.find($=>$.id===b);if(!S)return;let C,B,D,O=null,z;const R=_==="start"?"SS":"FS";if(x==="phase"){if(C=(S.phases||[]).find(M=>M.id===w),!C)return;D=(S.phases||[]).findIndex(M=>M.id===w),B=rl();const{expandedPhases:$}=G.getState();$.has(w)&&G.getState().togglePhaseExpanded(w)}else{if(C=Zo(S.phases||[],w)||void 0,!C)return;const $=C;D=D0(S,w),B=$.color||Wo(N0(S,w)),$.parent_subphase_id?(O=$.parent_subphase_id,z="subphase"):(O=$.parent_phase_id,z="phase");const{expandedSubphases:M}=G.getState();M.has(w)&&G.getState().toggleSubphaseExpanded(w)}const Q=ti(C.start_date),H=ti(C.end_date);let J=Ns(H,Q)+1;("is_milestone"in C&&C.is_milestone||J<2)&&(J=5);let E;R==="FS"?E=Gn(H,1):E=new Date(Q);const L=Gn(E,J-1);r({projectId:b,sourceId:w,type:x,dependencyType:R,phantomStart:Po(E),phantomEnd:Po(L),phantomColor:B,siblingDurationDays:J,sourceIndex:D,parentId:O,parentType:z}),document.body.classList.add("phantom-sibling-mode")},[n,r]),h=f.useCallback((y,b,w,x,_)=>{if(!s)return;const{siblingDurationDays:S}=s,C=y-b.left+w;if(x.length===0)return;const B=new Date(x[0].date);B.setHours(0,0,0,0);const D=x[x.length-1],O=new Date(D.date);O.setHours(23,59,59,999);const z=x.length*_,Q=(O.getTime()-B.getTime())/z,H=(S-1)*24*60*60*1e3,J=H/Q/2,q=C-J,E=Math.max(0,Math.min(q,z-H/Q)),L=B.getTime()+E*Q,$=new Date(L);$.setHours(0,0,0,0);const M=Gn($,S-1);i(Po($),Po(M))},[s,i]),p=f.useCallback(()=>{document.body.classList.remove("phantom-sibling-mode"),l()},[l]),m=f.useCallback(()=>{if(!s)return;const{projectId:y,sourceId:b,type:w,phantomStart:x,phantomEnd:_,dependencyType:S,parentId:C,parentType:B}=s,D={startDate:x,endDate:_,predecessorId:b,dependencyType:S,parentId:C,parentType:B};p(),setTimeout(()=>{if(w==="phase")xe.setState({activeModal:"phase",editingPhase:null,modalContext:{projectId:y,phantomPreset:D}});else{const O=n.find(Q=>Q.id===y);let z,R;if(B==="phase")z=C??void 0,R=void 0;else if(B==="subphase"&&C&&O){R=C;for(const Q of O.phases||[])if(Jd(Q.children||[],C)){z=Q.id;break}}xe.setState({activeModal:"subphase",editingSubphase:null,modalContext:{phaseId:z,projectId:y,subphaseId:R,phantomPreset:D}})}},50)},[s,p,n]);f.useEffect(()=>{const y=b=>{b.key==="Escape"&&d.current&&p()};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[p]);const v=f.useCallback(()=>{if(!s)return{lagDays:0,dependencyType:"FS"};const{phantomStart:y,dependencyType:b,sourceId:w,type:x}=s,_=n.find(z=>z.id===s.projectId);if(!_)return{lagDays:0,dependencyType:b};let S;if(x==="phase"?S=(_.phases||[]).find(z=>z.id===w):S=Zo(_.phases||[],w)||void 0,!S)return{lagDays:0,dependencyType:b};const C=ti(y),B=ti(S.start_date),D=ti(S.end_date);let O;if(b==="SS")O=Ns(C,B);else{const z=Gn(D,1);O=Ns(C,z)}return{lagDays:O,dependencyType:b}},[s,n]);return{phantomSiblingMode:s,isPhantomMode:!!s,startPhantom:u,updatePhantom:h,completePhantom:m,cancelPhantom:p,calculateLag:v}}const wm=12,Sm=120,ld=4;function pl({containerRef:n,cellWidth:s,enabled:r=!0}){const i=G(u=>u.setCellWidth),l=f.useRef(!1),d=f.useCallback(u=>{if(!u.ctrlKey||!r)return;u.preventDefault();const h=n.current;if(!h||l.current)return;l.current=!0;const m=u.deltaY<0?Math.min(s+ld,Sm):Math.max(s-ld,wm);if(m===s){l.current=!1;return}const v=h.getBoundingClientRect(),b=(u.clientX-v.left+h.scrollLeft)/s;i(m),requestAnimationFrame(()=>{const w=b*m-(u.clientX-v.left);h.scrollLeft=Math.max(0,w),l.current=!1})},[s,n,i,r]);return f.useEffect(()=>{const u=n.current;if(!(!u||!r))return u.addEventListener("wheel",d,{passive:!1}),()=>{u.removeEventListener("wheel",d)}},[d,n,r]),{minCellWidth:wm,maxCellWidth:Sm,zoomStep:ld}}const E0=12,$0=120,Cm=4;function T0(){const n=xe(y=>y.triggerScrollToToday),s=xe(y=>y.triggerZoom),r=xe(y=>y.endPhantomSibling),i=xe(y=>y.phantomSiblingMode),l=xe(y=>y.cancelLinking),d=xe(y=>y.isLinkingDependency),u=xe(y=>y.closeModal),h=xe(y=>y.activeModal),p=G(y=>y.cellWidth),m=G(y=>y.setCellWidth),v=f.useCallback(y=>{const b=y.target;if(!(b.tagName==="INPUT"||b.tagName==="TEXTAREA"||b.isContentEditable)){if(y.key==="Escape"){if(h){u(),y.preventDefault();return}if(d){l(),y.preventDefault();return}if(i){document.body.classList.remove("phantom-sibling-mode"),r(),y.preventDefault();return}}if(y.key==="Home"&&!y.ctrlKey&&!y.shiftKey&&!y.altKey){n(),y.preventDefault();return}if((y.key==="+"||y.key==="=")&&!y.ctrlKey){const w=Math.min(p+Cm,$0);w!==p&&(s(1,w),m(w)),y.preventDefault();return}if(y.key==="-"&&!y.ctrlKey){const w=Math.max(p-Cm,E0);w!==p&&(s(-1,w),m(w)),y.preventDefault();return}}},[h,u,d,l,i,r,n,s,p,m]);f.useEffect(()=>(document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)),[v])}const bm=5;function zp(){const n=xe(x=>x.resourceDrag),s=xe(x=>x.startResourceDrag),r=xe(x=>x.updateResourceDragTarget),i=xe(x=>x.endResourceDrag),l=G(x=>x.setProjects),d=G(x=>x.currentUser),u=G(x=>x.staff),h=f.useCallback(x=>u.find(S=>S.id===x)?.max_capacity??100,[u]),p=f.useCallback((x,_,S,C)=>{if(!d||d.role!=="superuser"&&d.role!=="admin"){x.preventDefault();return}x.dataTransfer.setData("application/json",JSON.stringify({type:_,resourceId:S,resourceName:C})),x.dataTransfer.effectAllowed="copy",s(_,S,C),document.body.classList.add("resource-dragging")},[d,s]),m=f.useCallback((x,_,S,C,B)=>{if(!n.active)return;x.preventDefault(),x.dataTransfer.dropEffect="copy";let D=B||kt(new Date,"yyyy-MM-dd"),O=kt(Gn(new Date(D),bm-1),"yyyy-MM-dd");r(_,S,C,D,O)},[n.active,r]),v=f.useCallback(x=>{const _=x.relatedTarget;_&&x.currentTarget.contains(_)||r(null,null,null,null,null)},[r]),y=f.useCallback(async(x,_,S,C,B,D)=>{if(x.preventDefault(),!n.active||!n.resourceId){i();return}const{type:O,resourceId:z}=n;try{if(O==="staff"){const Q=h(z);await Wd({staff_id:z,allocation:Q,start_date:B,end_date:D,project_id:C||S?void 0:_,phase_id:C?void 0:S||void 0,subphase_id:C||void 0})}else O==="equipment"&&await qd({equipment_id:z,start_date:B,end_date:D,project_id:C||S?void 0:_,phase_id:C?void 0:S||void 0,subphase_id:C||void 0});const R=await Rt();l(R)}catch(R){console.error("Failed to create assignment:",R)}finally{i(),document.body.classList.remove("resource-dragging")}},[n,i,l,h]),b=f.useCallback(()=>{i(),document.body.classList.remove("resource-dragging")},[i]),w=f.useCallback((x,_,S,C,B)=>{if(B.length===0)return null;const D=x-_.left+S,O=Math.floor(D/C),z=Math.max(0,Math.min(O,B.length-1));return B[z]?.dateStr||null},[]);return{resourceDrag:n,isActive:n.active,handleDragStart:p,handleDragOver:m,handleDragLeave:v,handleDrop:y,handleDragEnd:b,calculateDateFromPosition:w,getStaffDefaultAllocation:h,DEFAULT_DURATION_DAYS:bm}}const M0="_container_ft4rj_1",P0="_wrapper_ft4rj_7",I0="_icon_ft4rj_13",L0="_select_ft4rj_20",A0="_chevron_ft4rj_48",R0="_singleSite_ft4rj_55",Sa={container:M0,wrapper:P0,icon:I0,select:L0,chevron:A0,singleSite:R0};function B0(){const n=G(y=>y.sites),s=G(y=>y.currentSite),r=G(y=>y.setCurrentSite),i=G(y=>y.setBankHolidays),l=G(y=>y.setCompanyEvents),d=G(y=>y.setCustomColumns),u=G(y=>y.setCustomColumnValues),h=G(y=>y.clearAllCustomColumnFilters),p=G(y=>y.currentUser),m=p?.role==="admin"?n:n.filter(y=>p?.site_ids?.includes(y.id)),v=async y=>{const b=parseInt(y.target.value,10),w=n.find(x=>x.id===b);if(w){r(w),h();try{const x=await sa(w.id),_=gs(x);i(x,_)}catch(x){console.error("[SiteSelector] Failed to load bank holidays:",x)}try{const x=await ci(w.id),_=di(x);l(x,_)}catch(x){console.error("[SiteSelector] Failed to load company events:",x)}try{const x=await Uo(w.id);d(x.columns),u(x.values),console.log("[SiteSelector] Loaded custom columns for site:",w.name,x.columns.length)}catch(x){console.error("[SiteSelector] Failed to load custom columns:",x)}}};return m.length<=1?s?e.jsx("div",{className:Sa.container,children:e.jsxs("div",{className:Sa.singleSite,children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsx("span",{children:s.name})]})}):null:e.jsx("div",{className:Sa.container,children:e.jsxs("div",{className:Sa.wrapper,children:[e.jsxs("svg",{className:Sa.icon,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsx("select",{className:Sa.select,value:s?.id||"",onChange:v,children:m.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))}),e.jsx("svg",{className:Sa.chevron,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"6 9 12 15 18 9"})})]})})}const O0="_wrapper_8vp7s_1",F0="_navigation_8vp7s_7",z0="_navButton_8vp7s_17",H0="_periodLabel_8vp7s_40",W0="_todayButton_8vp7s_48",tr={wrapper:O0,navigation:F0,navButton:z0,periodLabel:H0,todayButton:W0};function q0(){const n=G(h=>h.viewMode),s=G(h=>h.currentDate),r=G(h=>h.setCurrentDate),i=xe(h=>h.triggerScrollToToday),l=h=>{let p;switch(n){case"week":p=Yd(s,h);break;case"month":p=_s(s,h);break;case"quarter":p=_s(s,h*3);break;case"year":p=_s(s,h*12);break;default:p=_s(s,h)}r(p)},d=()=>{r(new Date),i()},u=()=>{const h=new Intl.DateTimeFormat(void 0,{month:"long",year:"numeric"}),p=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric"}),m=new Intl.DateTimeFormat(void 0,{year:"numeric"});switch(n){case"week":{const v=aa(s,{weekStartsOn:1});return p.format(v)}case"month":return h.format(s);case"quarter":{const v=kp(s);return`Q${Math.floor(v.getMonth()/3)+1} ${m.format(v)}`}case"year":return m.format(s);default:return h.format(s)}};return e.jsxs("div",{className:tr.wrapper,children:[e.jsxs("div",{className:tr.navigation,children:[e.jsx("button",{className:tr.navButton,onClick:()=>l(-1),title:"Previous period",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})})}),e.jsx("span",{className:tr.periodLabel,children:u()}),e.jsx("button",{className:tr.navButton,onClick:()=>l(1),title:"Next period",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})})]}),e.jsx("button",{className:tr.todayButton,onClick:d,title:"Go to today",children:"Today"})]})}const U0="_wrapper_vcvut_1",V0="_trigger_vcvut_5",G0="_avatar_vcvut_26",Y0="_chevron_vcvut_39",Q0="_open_vcvut_44",X0="_menu_vcvut_48",K0="_userInfo_vcvut_61",Z0="_name_vcvut_68",J0="_email_vcvut_74",ej="_role_vcvut_79",tj="_divider_vcvut_85",nj="_menuItem_vcvut_90",zn={wrapper:U0,trigger:V0,avatar:G0,chevron:Y0,open:Q0,menu:X0,userInfo:K0,name:Z0,email:J0,role:ej,divider:tj,menuItem:nj};function sj(){const[n,s]=f.useState(!1),r=f.useRef(null),i=G(h=>h.currentUser),l=G(h=>h.setCurrentUser);f.useEffect(()=>{const h=p=>{r.current&&!r.current.contains(p.target)&&s(!1)};return n&&document.addEventListener("mousedown",h),()=>{document.removeEventListener("mousedown",h)}},[n]);const d=async()=>{try{await ip(),l(null),window.location.reload()}catch(h){console.error("Logout failed:",h)}};if(!i)return null;const u=`${i.first_name?.[0]||""}${i.last_name?.[0]||""}`.toUpperCase()||"?";return e.jsxs("div",{ref:r,className:zn.wrapper,children:[e.jsxs("button",{className:zn.trigger,onClick:()=>s(!n),"aria-expanded":n,"aria-haspopup":"true",children:[e.jsx("span",{className:zn.avatar,children:u}),e.jsx("svg",{className:`${zn.chevron} ${n?zn.open:""}`,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),n&&e.jsxs("div",{className:zn.menu,children:[e.jsxs("div",{className:zn.userInfo,children:[e.jsx("span",{className:zn.name,children:i.name}),e.jsx("span",{className:zn.email,children:i.email}),e.jsx("span",{className:zn.role,children:i.role})]}),e.jsx("div",{className:zn.divider}),e.jsxs("button",{className:zn.menuItem,onClick:d,children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),e.jsx("span",{children:"Log out"})]})]})]})}const aj="_button_1jsgw_1",rj={button:aj};function ij(){const[n,s]=f.useState(()=>Ds());f.useEffect(()=>{const l=new MutationObserver(()=>{const d=document.documentElement.dataset.theme;d&&d!==n&&s(d)});return l.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>l.disconnect()},[n]);const r=()=>{const l=pv();s(l)},i=mi(n);return e.jsx("button",{className:rj.button,onClick:r,title:`Switch to ${i?"light":"dark"} mode`,"aria-label":`Switch to ${i?"light":"dark"} mode`,children:i?e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]}):e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})}const oj="_button_n3mic_1",lj="_label_n3mic_28",cj="_activeContainer_n3mic_33",dj="_indicator_n3mic_53",uj="_pendingBadge_n3mic_63",hj="_discardButton_n3mic_77",fj="_applyButton_n3mic_78",Ca={button:oj,label:lj,activeContainer:cj,indicator:dj,pendingBadge:uj,discardButton:hj,applyButton:fj};function mj(){const n=G(v=>v.whatIfMode),s=G(v=>v.whatIfPendingOperations),r=G(v=>v.enterWhatIfMode),i=G(v=>v.exitWhatIfMode),[l,d]=f.useState(!1),u=s.length,h=()=>{r()},p=()=>{window.confirm(u>0?`Discard ${u} pending change${u!==1?"s":""}? This cannot be undone.`:"Exit What If mode?")&&i(!1)},m=async()=>{if(u===0){i(!1);return}if(window.confirm(`Apply ${u} change${u!==1?"s":""} to the database?`)){d(!0);try{await i(!0)}finally{d(!1)}}};return n?e.jsxs("div",{className:Ca.activeContainer,children:[e.jsxs("div",{className:Ca.indicator,children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),e.jsx("circle",{cx:"12",cy:"17",r:"0.5",fill:"currentColor"})]}),e.jsx("span",{children:"What If"}),u>0&&e.jsx("span",{className:Ca.pendingBadge,children:u})]}),e.jsx("button",{className:Ca.discardButton,onClick:p,disabled:l,title:"Discard all changes",children:"Discard"}),e.jsx("button",{className:Ca.applyButton,onClick:m,disabled:l,title:u>0?`Apply ${u} change${u!==1?"s":""}`:"Exit What If mode",children:l?"Applying...":u>0?"Apply":"Exit"})]}):e.jsxs("button",{className:Ca.button,onClick:h,title:"Enter What If mode to test changes without saving",children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),e.jsx("circle",{cx:"12",cy:"17",r:"0.5",fill:"currentColor"})]}),e.jsx("span",{className:Ca.label,children:"What If"})]})}const pj="_container_155df_1",gj="_separator_155df_7",_j="_title_155df_14",cd={container:pj,separator:gj,title:_j};function yj(){const n=G(r=>r.instanceSettings),s=n?.instance_title||n?.instance_name;return!s||s==="Milestone"?null:e.jsxs("div",{className:cd.container,children:[e.jsx("span",{className:cd.separator,children:"|"}),e.jsx("span",{className:cd.title,children:s})]})}function vj(n={}){const{onPresenceChange:s,onChangeReceived:r,autoConnect:i=!0}=n,[l,d]=f.useState("disconnected"),[u,h]=f.useState([]),[p,m]=f.useState([]);f.useRef(null),f.useRef(0),f.useRef(null),f.useRef(null),f.useRef(!0),f.useRef(!1);const v=f.useRef(s),y=f.useRef(r);return f.useEffect(()=>{v.current=s},[s]),f.useEffect(()=>{y.current=r},[r]),{connectionState:"disconnected",isConnected:!1,onlineUsers:[],recentChanges:[],connect:()=>{},disconnect:()=>{},isChangeRecent:()=>!1,getChangeInfo:()=>{}}}const Hp=f.createContext(null);function xj({children:n}){const s=G(S=>S.setProjects),r=f.useRef(null),i=f.useRef(!1),l=f.useCallback(async()=>{if(!i.current){i.current=!0;try{console.log("[WebSocket] Refreshing projects due to remote change...");const S=await Rt();s(S),console.log("[WebSocket] Projects refreshed:",S.length)}catch(S){console.error("[WebSocket] Failed to refresh projects:",S)}finally{i.current=!1}}},[s]),d=f.useCallback(S=>{console.log("[WebSocket] Change received, scheduling refresh:",S.entity_type,S.entity_id),r.current&&clearTimeout(r.current),r.current=window.setTimeout(()=>{l()},500)},[l]),{connectionState:u,onlineUsers:h,recentChanges:p,connect:m,disconnect:v}=vj({autoConnect:!0,onChangeReceived:d});f.useEffect(()=>()=>{r.current&&clearTimeout(r.current)},[]);const y=u==="connected",b=f.useCallback((S,C)=>p.filter(B=>B.entity_type===S&&B.entity_id===C),[p]),w=f.useCallback((S,C)=>p.some(B=>B.entity_type===S&&B.entity_id===C),[p]),x=f.useCallback(()=>{v(),setTimeout(m,100)},[m,v]),_=f.useMemo(()=>({connectionState:u,isConnected:y,onlineUsers:h,recentChanges:p,getChangesForEntity:b,isRecentlyChanged:w,reconnect:x}),[u,y,h,p,b,w,x]);return e.jsx(Hp.Provider,{value:_,children:n})}function eu(){const n=f.useContext(Hp);if(!n)throw new Error("useWebSocketContext must be used within a WebSocketProvider");return n}const jj="_container_eflff_3",wj="_statusDot_eflff_18",Sj="_connected_eflff_25",Cj="_connecting_eflff_30",bj="_pulse_eflff_1",kj="_disconnected_eflff_35",Nj="_error_eflff_36",Dj="_avatars_eflff_46",Ej="_avatar_eflff_46",$j="_small_eflff_67",Tj="_medium_eflff_73",Mj="_moreCount_eflff_79",Pj="_dropdown_eflff_95",Ij="_dropdownHeader_eflff_109",Lj="_dropdownList_eflff_120",Aj="_dropdownItem_eflff_125",Rj="_userName_eflff_136",Vn={container:jj,statusDot:wj,connected:Sj,connecting:Cj,pulse:bj,disconnected:kj,error:Nj,avatars:Dj,avatar:Ej,small:$j,medium:Tj,moreCount:Mj,dropdown:Pj,dropdownHeader:Ij,dropdownList:Lj,dropdownItem:Aj,userName:Rj};function Bj(n,s){return`${n.charAt(0)}${s.charAt(0)}`.toUpperCase()}function Oj(n){const s=["#3b82f6","#8b5cf6","#ec4899","#f97316","#10b981","#06b6d4","#f59e0b","#ef4444"];return s[n%s.length]}const km=f.memo(function({user:s,size:r="small"}){return e.jsx("div",{className:`${Vn.avatar} ${Vn[r]}`,style:{backgroundColor:Oj(s.user_id)},title:`${s.first_name} ${s.last_name}`,children:Bj(s.first_name,s.last_name)})}),Fj=f.memo(function(){const{connectionState:s,onlineUsers:r,isConnected:i}=eu(),[l,d]=f.useState(!1);if(console.log("[OnlineUsers] connectionState:",s,"isConnected:",i,"users:",r.length),!i&&s!=="connecting")return null;const u=3,h=r.slice(0,u),p=r.length-u;return e.jsxs("div",{className:Vn.container,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[e.jsx("div",{className:`${Vn.statusDot} ${Vn[s]}`}),e.jsxs("div",{className:Vn.avatars,children:[h.map(m=>e.jsx(km,{user:m},m.user_id)),p>0&&e.jsxs("div",{className:Vn.moreCount,children:["+",p]})]}),l&&r.length>0&&e.jsxs("div",{className:Vn.dropdown,children:[e.jsxs("div",{className:Vn.dropdownHeader,children:["Online Users (",r.length,")"]}),e.jsx("div",{className:Vn.dropdownList,children:r.map(m=>e.jsxs("div",{className:Vn.dropdownItem,children:[e.jsx(km,{user:m,size:"medium"}),e.jsxs("span",{className:Vn.userName,children:[m.first_name," ",m.last_name]})]},m.user_id))})]})]})}),zj="_header_1jmbw_1",Hj="_whatIfActive_1jmbw_14",Wj="_left_1jmbw_23",qj="_logo_1jmbw_30",Uj="_logoImg_1jmbw_35",Vj="_center_1jmbw_44",Gj="_viewModes_1jmbw_54",Yj="_viewModeBtn_1jmbw_62",Qj="_active_1jmbw_80",Xj="_zoomControls_1jmbw_86",Kj="_zoomBtn_1jmbw_95",Zj="_zoomLevel_1jmbw_119",Jj="_right_1jmbw_143",ew="_panelsWrapper_1jmbw_151",tw="_panelsBtn_1jmbw_155",nw="_hasActive_1jmbw_176",sw="_panelsBadge_1jmbw_182",aw="_panelsDropdown_1jmbw_196",rw="_panelsDropdownHeader_1jmbw_210",iw="_panelButtons_1jmbw_219",ow="_panelToggleBtn_1jmbw_224",lw="_equipment_1jmbw_257",cw="_panelsHint_1jmbw_276",dw="_divider_1jmbw_289",it={header:zj,whatIfActive:Hj,left:Wj,logo:qj,logoImg:Uj,center:Vj,viewModes:Gj,viewModeBtn:Yj,active:Qj,zoomControls:Xj,zoomBtn:Kj,zoomLevel:Zj,right:Jj,panelsWrapper:ew,panelsBtn:tw,hasActive:nw,panelsBadge:sw,panelsDropdown:aw,panelsDropdownHeader:rw,panelButtons:iw,panelToggleBtn:ow,equipment:lw,panelsHint:cw,divider:dw},uw=[{value:"week",label:"W",title:"Week view"},{value:"month",label:"M",title:"Month view"},{value:"quarter",label:"Q",title:"Quarter view"},{value:"year",label:"Y",title:"Year view"}],Nm=12,Dm=120,Em=4,dd=36;function hw(){const n=G(k=>k.currentUser),s=G(k=>k.whatIfMode),r=G(k=>k.currentView),i=G(k=>k.viewMode),l=G(k=>k.setViewMode),d=G(k=>k.cellWidth),u=G(k=>k.setCellWidth),h=G(k=>k.showStaffOverview),p=G(k=>k.showEquipmentOverview),m=G(k=>k.toggleShowStaffOverview),v=G(k=>k.toggleShowEquipmentOverview),[y,b]=f.useState(()=>Ds()),[w,x]=f.useState(""),[_,S]=f.useState(""),[C,B]=f.useState(!1),D=f.useRef(null);f.useEffect(()=>{(async()=>{try{const[P,F]=await Promise.all([Nd("header_logo_dark").catch(()=>({value:null})),Nd("header_logo_light").catch(()=>({value:null}))]);P.value&&x(P.value),F.value&&S(F.value)}catch{}})()},[]),f.useEffect(()=>{const k=new MutationObserver(()=>{const P=document.documentElement.dataset.theme;P&&P!==y&&b(P)});return k.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>k.disconnect()},[y]),f.useEffect(()=>{const k=P=>{D.current&&!D.current.contains(P.target)&&B(!1)};return C&&document.addEventListener("mousedown",k),()=>document.removeEventListener("mousedown",k)},[C]);const O=n?.role==="admin"||n?.role==="superuser",z=n?.role==="admin"||n?.role==="superuser",R=r==="gantt",Q=Math.round(d/dd*100),H=d<Dm,J=d>Nm,q=()=>{const k=Math.min(d+Em,Dm);k!==d&&u(k)},E=()=>{const k=Math.max(d-Em,Nm);k!==d&&u(k)},L=()=>{d!==dd&&u(dd)},$=f.useMemo(()=>mi(y)?w||"/img/milestone_logo_dark_theme.svg":_||"/img/milestone_logo_light_theme.svg",[y,w,_]),M=(h?1:0)+(p?1:0);return e.jsxs("header",{className:`${it.header} ${s?it.whatIfActive:""}`,children:[e.jsxs("div",{className:it.left,children:[e.jsx("div",{className:it.logo,children:e.jsx("img",{src:$,alt:"Milestone",className:it.logoImg})}),e.jsx(yj,{}),e.jsx("div",{className:it.divider}),e.jsx(B0,{})]}),e.jsxs("div",{className:it.center,children:[e.jsx(q0,{}),e.jsx("div",{className:it.divider}),e.jsx("div",{className:it.viewModes,children:uw.map(k=>e.jsx("button",{className:`${it.viewModeBtn} ${i===k.value?it.active:""}`,onClick:()=>l(k.value),title:k.title,children:k.label},k.value))}),e.jsx("div",{className:it.divider}),e.jsxs("div",{className:it.zoomControls,children:[e.jsx("button",{className:it.zoomBtn,onClick:E,disabled:!J,title:"Zoom out",children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 13H5v-2h14v2z"})})}),e.jsxs("button",{className:it.zoomLevel,onClick:L,title:"Reset zoom to 100%",children:[Q,"%"]}),e.jsx("button",{className:it.zoomBtn,onClick:q,disabled:!H,title:"Zoom in",children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})})})]})]}),e.jsxs("div",{className:it.right,children:[z&&R&&e.jsxs("div",{ref:D,className:it.panelsWrapper,children:[e.jsxs("button",{className:`${it.panelsBtn} ${M>0?it.hasActive:""}`,onClick:()=>B(!C),title:"Toggle overview panels",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),e.jsx("line",{x1:"3",y1:"15",x2:"21",y2:"15"})]}),e.jsx("span",{children:"Panels"}),M>0&&e.jsx("span",{className:it.panelsBadge,children:M})]}),C&&e.jsxs("div",{className:it.panelsDropdown,children:[e.jsx("div",{className:it.panelsDropdownHeader,children:"Overview Panels"}),e.jsxs("div",{className:it.panelButtons,children:[e.jsxs("button",{className:`${it.panelToggleBtn} ${h?it.active:""}`,onClick:()=>{m(),B(!1)},children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),e.jsx("span",{children:"Staff"})]}),e.jsxs("button",{className:`${it.panelToggleBtn} ${it.equipment} ${p?it.active:""}`,onClick:()=>{v(),B(!1)},children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]}),e.jsx("span",{children:"Equipment"})]})]}),e.jsx("div",{className:it.panelsHint,children:"Click to toggle  Drag staff/equipment to assign"})]})]}),O&&e.jsx(mj,{}),e.jsx("div",{className:it.divider}),e.jsx(ij,{}),e.jsx(Fj,{}),e.jsx(sj,{})]})]})}const fw="_nav_7yrvb_1",mw="_collapsed_7yrvb_7",pw="_navItem_7yrvb_7",gw="_active_7yrvb_34",_w="_icon_7yrvb_44",yw="_label_7yrvb_53",nr={nav:fw,collapsed:mw,navItem:pw,active:gw,icon:_w,label:yw},vw=[{view:"gantt",label:"Gantt Chart",icon:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"4",y1:"9",x2:"20",y2:"9"}),e.jsx("line",{x1:"4",y1:"15",x2:"12",y2:"15"}),e.jsx("line",{x1:"4",y1:"21",x2:"16",y2:"21"}),e.jsx("rect",{x:"4",y:"3",width:"16",height:"2",rx:"1"})]})},{view:"staff",label:"Staff Overview",icon:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})},{view:"equipment",label:"Equipment",icon:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})},{view:"crosssite",label:"Cross-Site",icon:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),e.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]})},{view:"archived",label:"Archived",icon:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"21 8 21 21 3 21 3 8"}),e.jsx("rect",{x:"1",y:"3",width:"22",height:"5"}),e.jsx("line",{x1:"10",y1:"12",x2:"14",y2:"12"})]})}];function xw({collapsed:n=!1}){const s=G(i=>i.currentView),r=G(i=>i.setCurrentView);return e.jsx("nav",{className:`${nr.nav} ${n?nr.collapsed:""}`,children:vw.map(i=>e.jsxs("button",{className:`${nr.navItem} ${s===i.view?nr.active:""}`,onClick:()=>r(i.view),title:n?i.label:void 0,children:[e.jsx("span",{className:nr.icon,children:i.icon}),!n&&e.jsx("span",{className:nr.label,children:i.label})]},i.view))})}const jw="_section_18spk_1",ww="_collapsed_18spk_7",Sw="_item_18spk_7",Cw="_icon_18spk_39",bw="_label_18spk_48",ni={section:jw,collapsed:ww,item:Sw,icon:Cw,label:bw},kw=[{id:"users",label:"Manage Users",modal:"userManagement",icon:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("line",{x1:"19",y1:"8",x2:"19",y2:"14"}),e.jsx("line",{x1:"22",y1:"11",x2:"16",y2:"11"})]})},{id:"equipment",label:"Manage Equipment",modal:"manageEquipment",icon:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]})},{id:"sites",label:"Manage Sites",modal:"manageSites",icon:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]})},{id:"phases",label:"Predefined Phases",modal:"predefinedPhases",icon:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),e.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),e.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),e.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),e.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),e.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]})},{id:"sso",label:"SSO Configuration",modal:"ssoConfig",adminOnly:!0,icon:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})},{id:"settings",label:"Settings",modal:"settings",icon:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]})}];function Nw({collapsed:n=!1}){const s=xe(u=>u.setActiveModal),i=G(u=>u.currentUser)?.role==="admin",l=u=>{s(u)},d=kw.filter(u=>!u.adminOnly||i);return e.jsx("div",{className:`${ni.section} ${n?ni.collapsed:""}`,children:d.map(u=>e.jsxs("button",{className:ni.item,onClick:()=>l(u.modal),title:n?u.label:void 0,children:[e.jsx("span",{className:ni.icon,children:u.icon}),!n&&e.jsx("span",{className:ni.label,children:u.label})]},u.id))})}const Dw="_stats_sfjfp_1",Ew="_stat_sfjfp_1",$w="_value_sfjfp_14",Tw="_label_sfjfp_21",Mw="_detail_sfjfp_26",as={stats:Dw,stat:Ew,value:$w,label:Tw,detail:Mw};function Pw(){const n=G(m=>m.projects),s=G(m=>m.staff),r=G(m=>m.equipment),i=G(m=>m.currentSite),l=i?n.filter(m=>m.site_id===i.id&&!m.archived):n.filter(m=>!m.archived),d=i?s.filter(m=>m.site_id===i.id&&m.active):s.filter(m=>m.active),u=i?r.filter(m=>m.site_id===i.id&&m.active):r.filter(m=>m.active),h=l.filter(m=>m.confirmed).length,p=l.filter(m=>!m.confirmed).length;return e.jsxs("div",{className:as.stats,children:[e.jsxs("div",{className:as.stat,children:[e.jsx("span",{className:as.value,children:l.length}),e.jsx("span",{className:as.label,children:"Projects"}),e.jsxs("span",{className:as.detail,children:[h," confirmed, ",p," pending"]})]}),e.jsxs("div",{className:as.stat,children:[e.jsx("span",{className:as.value,children:d.length}),e.jsx("span",{className:as.label,children:"Staff"})]}),e.jsxs("div",{className:as.stat,children:[e.jsx("span",{className:as.value,children:u.length}),e.jsx("span",{className:as.label,children:"Equipment"})]})]})}const Iw="_sidebar_vk433_1",Lw="_collapsed_vk433_14",Aw="_collapseBtn_vk433_18",Rw="_content_vk433_51",Bw="_section_vk433_64",Ow="_sectionTitle_vk433_70",fs={sidebar:Iw,collapsed:Lw,collapseBtn:Aw,content:Rw,section:Bw,sectionTitle:Ow};function Fw(){const n=G(d=>d.sidebarCollapsed),s=G(d=>d.setSidebarCollapsed),r=G(d=>d.currentUser),i=r?.role==="admin"||r?.role==="superuser",l=()=>{s(!n)};return e.jsxs("aside",{className:`${fs.sidebar} ${n?fs.collapsed:""}`,children:[e.jsx("button",{className:fs.collapseBtn,onClick:l,title:n?"Expand sidebar":"Collapse sidebar","aria-label":n?"Expand sidebar":"Collapse sidebar",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})})}),e.jsxs("div",{className:fs.content,children:[e.jsxs("div",{className:fs.section,children:[!n&&e.jsx("div",{className:fs.sectionTitle,children:"Views"}),e.jsx(xw,{collapsed:n})]}),i&&e.jsxs("div",{className:fs.section,children:[!n&&e.jsx("div",{className:fs.sectionTitle,children:"Admin"}),e.jsx(Nw,{collapsed:n})]}),!n&&e.jsxs("div",{className:fs.section,children:[e.jsx("div",{className:fs.sectionTitle,children:"Quick Stats"}),e.jsx(Pw,{})]})]})]})}const Wp=f.createContext(null);function zw({children:n}){const[s,r]=f.useState(null),[i,l]=f.useState(null),d=f.useRef(null),u=G(_=>_.setProjects),h=f.useCallback(()=>{r(null),l(null),d.current&&d.current.parentNode&&(d.current.parentNode.removeChild(d.current),d.current=null)},[]),p=f.useCallback((_,S,C,B,D,O)=>{_.stopPropagation(),_.dataTransfer.effectAllowed="move",_.dataTransfer.setData("text/plain",JSON.stringify({type:S,id:C}));const z=_.currentTarget,R=z.getBoundingClientRect(),Q=z.cloneNode(!0);Q.style.cssText=`
      position: absolute;
      top: -1000px;
      left: -1000px;
      width: ${R.width}px;
      opacity: 0.9;
      background: var(--bg-tertiary);
      border-radius: 4px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      pointer-events: none;
    `,document.body.appendChild(Q),d.current=Q,_.dataTransfer.setDragImage(Q,20,R.height/2),r({type:S,id:C,projectId:B,parentId:D,parentType:O}),requestAnimationFrame(()=>{z.style.opacity="0.4"})},[]),m=f.useCallback((_,S,C)=>{if(!s||s.type!==S||s.id===C)return;_.preventDefault(),_.stopPropagation(),_.dataTransfer.dropEffect="move";const D=_.currentTarget.getBoundingClientRect(),O=D.top+D.height/2,z=_.clientY<O?"before":"after";l({type:S,id:C,position:z})},[s]),v=f.useCallback(_=>{_.preventDefault();const S=_.relatedTarget;_.currentTarget.contains(S)||l(null)},[]),y=f.useCallback(async(_,S,C,B,D,O)=>{if(_.preventDefault(),_.stopPropagation(),!s||!i||s.id===C){h();return}const z=B.map(H=>H.id),R=z.indexOf(s.id);let Q=z.indexOf(C);if(R===-1||Q===-1){h();return}z.splice(R,1),Q=z.indexOf(C),i.position==="after"&&(Q+=1),z.splice(Q,0,s.id);try{S==="phase"?await wt(`/api/projects/${s.projectId}/phases/reorder`,{phase_order:z}):await wt(`/api/subphases/${D}/reorder`,{parent_type:O,subphase_order:z});const H=await Rt();u(H)}catch(H){console.error("Failed to reorder:",H)}h()},[s,i,h,u]),b=f.useCallback(_=>{_.preventDefault();const S=_.currentTarget;S.style.opacity="",h()},[h]),w=f.useCallback((_,S)=>s?.type===_&&s?.id===S,[s]),x=f.useCallback((_,S)=>i?.type===_&&i?.id===S?i.position:null,[i]);return e.jsx(Wp.Provider,{value:{dragState:s,dropTarget:i,handleDragStart:p,handleDragOver:m,handleDragLeave:v,handleDrop:y,handleDragEnd:b,isDragging:w,getDropPosition:x},children:n})}function qp(){const n=f.useContext(Wp);if(!n)throw new Error("useReorder must be used within ReorderProvider");return n}var Up=Gm();const Hw="_row_276wc_1",Ww="_editable_276wc_12",qw="_typeBadge_276wc_20",Uw="_staff_276wc_33",Vw="_equipment_276wc_38",Gw="_icon_276wc_43",Yw="_name_276wc_51",Qw="_detail_276wc_60",Xw="_allocation_276wc_64",Hn={row:Hw,editable:Ww,typeBadge:qw,staff:Uw,equipment:Vw,icon:Gw,name:Yw,detail:Qw,allocation:Xw},lr=f.memo(function({type:s,assignmentId:r,projectId:i,phaseId:l,subphaseId:d,staffId:u,equipmentId:h,name:p,role:m,equipmentType:v,allocation:y,depth:b,phaseType:w,phaseColor:x,startDate:_,endDate:S}){const C=xe(R=>R.showContextMenu),B=G(R=>R.currentUser),D=B?.role==="admin"||B?.role==="superuser",O=b*16+28,z=f.useCallback(R=>{if(!D)return;R.preventDefault(),R.stopPropagation(),C(s==="equipment"?"equipmentAssignment":"staffAssignment",r,R.clientX,R.clientY,i,l,d,{staffId:u,equipmentId:h,name:p,allocation:y,startDate:_,endDate:S})},[D,C,s,r,i,l,d,u,h,p,y,_,S]);return s==="phase-staff"||s==="subphase-staff"?e.jsxs("div",{className:`${Hn.row} ${D?Hn.editable:""}`,style:{paddingLeft:O},onContextMenu:z,children:[e.jsxs("span",{className:Hn.typeBadge,style:{backgroundColor:x?`${x}33`:"rgba(139, 92, 246, 0.2)",color:x||"var(--accent-purple)"},children:[" ",w||(s==="subphase-staff"?"Subphase":"Phase")]}),e.jsx("span",{className:Hn.name,title:p,children:p}),y!==void 0&&e.jsxs("span",{className:Hn.allocation,children:[y,"%"]})]}):e.jsxs("div",{className:`${Hn.row} ${D?Hn.editable:""}`,style:{paddingLeft:O},onContextMenu:z,children:[e.jsx("span",{className:`${Hn.typeBadge} ${Hn[s]}`,children:s==="staff"?"STAFF":"EQUIP"}),e.jsxs("span",{className:Hn.name,title:`${p}${m?` - ${m}`:""}${v?` - ${v}`:""}`,children:[p,(m||v)&&e.jsxs("span",{className:Hn.detail,children:["  ",m||v]})]}),s==="staff"&&y!==void 0&&e.jsxs("span",{className:Hn.allocation,children:[y,"%"]})]})}),Kw="_phantomRow_uvscd_3",Zw="_typeBadge_uvscd_19",Jw="_instructions_uvscd_28",e2="_cancelBtn_uvscd_37",si={phantomRow:Kw,typeBadge:Zw,instructions:Jw,cancelBtn:e2};function tu({onComplete:n,onCancel:s}){const r=xe(h=>h.phantomSiblingMode);if(!r)return null;const{type:i,phantomColor:l,dependencyType:d}=r,u=d==="SS"?"Start-to-Start":"Finish-to-Start";return e.jsxs("div",{className:si.phantomRow,onClick:h=>{h.target.closest(`.${si.cancelBtn}`)||(h.stopPropagation(),n())},children:[e.jsxs("span",{className:si.typeBadge,style:{backgroundColor:`${l}40`,color:l},children:["New ",i==="phase"?"Phase":"Subphase"]}),e.jsxs("span",{className:si.instructions,children:["Move & click to place... (",u,")"]}),e.jsx("button",{className:si.cancelBtn,onClick:h=>{h.stopPropagation(),s()},title:"Cancel (Esc)",children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})}const t2="_popover_1m2ej_3",n2="_header_1m2ej_14",s2="_title_1m2ej_21",a2="_calculatedNote_1m2ej_27",r2="_sliderContainer_1m2ej_33",i2="_valueDisplay_1m2ej_40",o2="_sliderWrapper_1m2ej_50",l2="_sliderTrack_1m2ej_58",c2="_sliderInput_1m2ej_69",d2="_tickMarks_1m2ej_122",u2="_tick_1m2ej_122",h2="_quickSelect_1m2ej_134",f2="_quickBtn_1m2ej_140",m2="_active_1m2ej_159",p2="_actions_1m2ej_165",g2="_clearBtn_1m2ej_173",_2="_applyBtn_1m2ej_191",zt={popover:t2,header:n2,title:s2,calculatedNote:a2,sliderContainer:r2,valueDisplay:i2,sliderWrapper:o2,sliderTrack:l2,sliderInput:c2,tickMarks:d2,tick:u2,quickSelect:h2,quickBtn:f2,active:m2,actions:p2,clearBtn:g2,applyBtn:_2};function Vp({value:n,onChange:s,onClose:r,anchorEl:i,isCalculated:l=!1}){const[d,u]=f.useState(n??0),h=f.useRef(null);f.useEffect(()=>{if(!i||!h.current)return;const b=i.getBoundingClientRect(),w=h.current;w.style.top=`${b.bottom+8}px`,w.style.left=`${b.left}px`;const x=w.getBoundingClientRect();x.right>window.innerWidth-16&&(w.style.left=`${window.innerWidth-x.width-16}px`),x.bottom>window.innerHeight-16&&(w.style.top=`${b.top-x.height-8}px`)},[i]),f.useEffect(()=>{const b=x=>{h.current&&!h.current.contains(x.target)&&r()},w=x=>{x.key==="Escape"&&r()};return document.addEventListener("mousedown",b),document.addEventListener("keydown",w),()=>{document.removeEventListener("mousedown",b),document.removeEventListener("keydown",w)}},[r]);const p=b=>{const w=parseInt(b.target.value,10),x=Math.round(w/5)*5;u(x)},m=()=>{s(d),r()},v=()=>{s(-1),r()},y=[0,25,50,75,100];return e.jsxs("div",{ref:h,className:zt.popover,children:[e.jsxs("div",{className:zt.header,children:[e.jsx("span",{className:zt.title,children:"Set Completion"}),l&&e.jsx("span",{className:zt.calculatedNote,children:"Currently calculated from children"})]}),e.jsxs("div",{className:zt.sliderContainer,children:[e.jsxs("div",{className:zt.valueDisplay,children:[d,"%"]}),e.jsxs("div",{className:zt.sliderWrapper,children:[e.jsx("div",{className:zt.sliderTrack,style:{width:`${d}%`}}),e.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:d,onChange:p,className:zt.sliderInput})]}),e.jsxs("div",{className:zt.tickMarks,children:[e.jsx("span",{className:zt.tick,children:"0"}),e.jsx("span",{className:zt.tick,children:"25"}),e.jsx("span",{className:zt.tick,children:"50"}),e.jsx("span",{className:zt.tick,children:"75"}),e.jsx("span",{className:zt.tick,children:"100"})]})]}),e.jsx("div",{className:zt.quickSelect,children:y.map(b=>e.jsxs("button",{type:"button",className:`${zt.quickBtn} ${d===b?zt.active:""}`,onClick:()=>u(b),children:[b,"%"]},b))}),e.jsxs("div",{className:zt.actions,children:[e.jsx("button",{type:"button",className:zt.clearBtn,onClick:v,children:"Clear"}),e.jsx("button",{type:"button",className:zt.applyBtn,onClick:m,children:"Apply"})]})]})}const y2="_cellWrapper_1uh67_4",v2="_textCell_1uh67_20",x2="_booleanCell_1uh67_21",j2="_listCell_1uh67_22",w2="_readOnly_1uh67_40",S2="_empty_1uh67_48",C2="_cellText_1uh67_58",b2="_textInput_1uh67_65",k2="_checkbox_1uh67_88",N2="_checked_1uh67_106",D2="_listValue_1uh67_116",E2="_chevron_1uh67_133",$2="_open_1uh67_139",T2="_dropdown_1uh67_143",M2="_option_1uh67_170",P2="_selected_1uh67_182",I2="_clearOption_1uh67_187",Gt={cellWrapper:y2,textCell:v2,booleanCell:x2,listCell:j2,readOnly:w2,empty:S2,cellText:C2,textInput:b2,checkbox:k2,checked:N2,listValue:D2,chevron:E2,open:$2,dropdown:T2,option:M2,selected:P2,clearOption:I2};function Gp({column:n,entityType:s,entityId:r,readOnly:i=!1,childEntities:l=[]}){const d=G(y=>y.customColumnValues),u=G(y=>y.setCustomColumnValue),h=$y(n.id,s,r),p=d[h]??null,m=f.useCallback(async y=>{u(n.id,s,r,y);for(const b of l)u(n.id,b.entityType,b.entityId,y);try{await lm({custom_column_id:n.id,entity_type:s,entity_id:r,value:y});for(const b of l)await lm({custom_column_id:n.id,entity_type:b.entityType,entity_id:b.entityId,value:y})}catch(b){console.error("[CustomColumnCell] Failed to save value:",b)}},[n.id,s,r,u,l]),v=()=>{switch(n.column_type){case"boolean":return e.jsx(A2,{value:p,onChange:m,readOnly:i});case"list":return e.jsx(R2,{value:p,options:n.list_options||[],onChange:m,readOnly:i});default:return e.jsx(L2,{value:p,onChange:m,readOnly:i})}};return e.jsx("div",{className:Gt.cellWrapper,children:v()})}function L2({value:n,onChange:s,readOnly:r}){const[i,l]=f.useState(!1),[d,u]=f.useState(n||""),h=f.useRef(null);f.useEffect(()=>{i&&h.current&&(h.current.focus(),h.current.select())},[i]);const p=()=>{r||(u(n||""),l(!0))},m=()=>{l(!1);const y=d.trim();y!==(n||"")&&s(y||null)},v=y=>{y.key==="Enter"?m():y.key==="Escape"&&(l(!1),u(n||""))};return i?e.jsx("input",{ref:h,type:"text",className:Gt.textInput,value:d,onChange:y=>u(y.target.value),onBlur:m,onKeyDown:v}):e.jsx("div",{className:`${Gt.textCell} ${n?"":Gt.empty} ${r?Gt.readOnly:""}`,onClick:p,title:n||"Click to edit",children:e.jsx("span",{className:Gt.cellText,children:n||""})})}function A2({value:n,onChange:s,readOnly:r}){const i=n?.toLowerCase()==="true",l=()=>{r||s(i?"false":"true")};return e.jsx("div",{className:`${Gt.booleanCell} ${r?Gt.readOnly:""}`,onClick:l,children:e.jsx("div",{className:`${Gt.checkbox} ${i?Gt.checked:""}`,children:i&&e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})})})}function R2({value:n,options:s,onChange:r,readOnly:i}){const[l,d]=f.useState(!1),u=f.useRef(null);f.useEffect(()=>{const m=v=>{u.current&&!u.current.contains(v.target)&&d(!1)};return l&&document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}},[l]);const h=m=>{r(m),d(!1)},p=m=>{m.stopPropagation(),r(null),d(!1)};return e.jsxs("div",{ref:u,className:`${Gt.listCell} ${i?Gt.readOnly:""}`,children:[e.jsxs("div",{className:`${Gt.listValue} ${n?"":Gt.empty}`,onClick:()=>!i&&d(!l),children:[e.jsx("span",{children:n||""}),!i&&e.jsx("svg",{className:`${Gt.chevron} ${l?Gt.open:""}`,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),l&&e.jsxs("div",{className:Gt.dropdown,children:[n&&e.jsx("div",{className:Gt.clearOption,onClick:p,children:"Clear selection"}),s.map(m=>e.jsx("div",{className:`${Gt.option} ${m===n?Gt.selected:""}`,onClick:()=>h(m),children:m},m))]})]})}const B2="_header_5z3zo_3",O2="_resizing_5z3zo_25",F2="_filtered_5z3zo_29",z2="_content_5z3zo_33",H2="_icon_5z3zo_42",W2="_name_5z3zo_50",q2="_filterBtn_5z3zo_57",U2="_active_5z3zo_83",V2="_filterDropdown_5z3zo_89",G2="_filterHeader_5z3zo_114",Y2="_clearFilterBtn_5z3zo_125",Q2="_filterActions_5z3zo_141",X2="_filterOptions_5z3zo_165",K2="_filterOption_5z3zo_165",Z2="_filterValue_5z3zo_193",J2="_filterValueEmpty_5z3zo_200",eS="_filterEmpty_5z3zo_206",tS="_resizeHandle_5z3zo_227",Xt={header:B2,resizing:O2,filtered:F2,content:z2,icon:H2,name:W2,filterBtn:q2,active:U2,filterDropdown:V2,filterHeader:G2,clearFilterBtn:Y2,filterActions:Q2,filterOptions:X2,filterOption:K2,filterValue:Z2,filterValueEmpty:J2,filterEmpty:eS,resizeHandle:tS};function nS({column:n,onEdit:s,onWidthChange:r}){const i=f.useRef(null),[l,d]=f.useState(!1),[u,h]=f.useState(!1),p=G(R=>R.customColumnValues),m=G(R=>R.customColumnFilters),v=G(R=>R.setCustomColumnFilter),y=G(R=>R.clearCustomColumnFilter),b=m[n.id]||[],w=b.length>0,x=f.useMemo(()=>{const R=new Set;return Object.entries(p).forEach(([Q,H])=>{Q.startsWith(`${n.id}-`)&&H&&R.add(H)}),Array.from(R).sort()},[n.id,p]);f.useEffect(()=>{const R=Q=>{i.current&&!i.current.contains(Q.target)&&h(!1)};return u&&document.addEventListener("mousedown",R),()=>{document.removeEventListener("mousedown",R)}},[u]);const _=f.useCallback(R=>{R.preventDefault(),R.stopPropagation();const Q=R.clientX,H=n.width;d(!0);const J=E=>{const L=E.clientX-Q,$=Math.max(60,Math.min(400,H+L));r(n.id,$)},q=async()=>{d(!1),document.removeEventListener("mousemove",J),document.removeEventListener("mouseup",q);try{await Gd(n.id,{width:n.width})}catch(E){console.error("[CustomColumnHeader] Failed to save width:",E)}};document.addEventListener("mousemove",J),document.addEventListener("mouseup",q)},[n.id,n.width,r]),S=()=>{s(n)},C=R=>{R.stopPropagation(),h(!u)},B=R=>{const Q=b.includes(R)?b.filter(H=>H!==R):[...b,R];Q.length===0?y(n.id):v(n.id,Q)},D=()=>{y(n.id),h(!1)},O=()=>{v(n.id,x)},z=()=>{switch(n.column_type){case"boolean":return e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("polyline",{points:"9 11 12 14 22 4"})]});case"list":return e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"6 9 12 15 18 9"})});default:return e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"17",y1:"10",x2:"3",y2:"10"}),e.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),e.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),e.jsx("line",{x1:"17",y1:"18",x2:"3",y2:"18"})]})}};return e.jsxs("div",{ref:i,className:`${Xt.header} ${l?Xt.resizing:""} ${w?Xt.filtered:""}`,style:{width:n.width},onDoubleClick:S,title:`${n.name} (double-click to edit)`,children:[e.jsxs("div",{className:Xt.content,children:[e.jsx("span",{className:Xt.icon,children:z()}),e.jsx("span",{className:Xt.name,children:n.name})]}),e.jsx("button",{className:`${Xt.filterBtn} ${w?Xt.active:""}`,onClick:C,title:"Filter column",children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})})}),u&&e.jsxs("div",{className:Xt.filterDropdown,children:[e.jsxs("div",{className:Xt.filterHeader,children:[e.jsx("span",{children:"Filter by value"}),w&&e.jsx("button",{className:Xt.clearFilterBtn,onClick:D,children:"Clear"})]}),x.length===0?e.jsx("div",{className:Xt.filterEmpty,children:"No values"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:Xt.filterActions,children:[e.jsx("button",{onClick:O,children:"Select All"}),e.jsx("button",{onClick:D,children:"Clear All"})]}),e.jsxs("div",{className:Xt.filterOptions,children:[e.jsxs("label",{className:Xt.filterOption,children:[e.jsx("input",{type:"checkbox",checked:b.includes("__empty__"),onChange:()=>B("__empty__")}),e.jsx("span",{className:Xt.filterValueEmpty,children:"(Empty)"})]}),x.map(R=>e.jsxs("label",{className:Xt.filterOption,children:[e.jsx("input",{type:"checkbox",checked:b.includes(R),onChange:()=>B(R)}),e.jsx("span",{className:Xt.filterValue,children:n.column_type==="boolean"?R==="true"?" Yes":" No":R})]},R))]})]})]}),e.jsx("div",{className:Xt.resizeHandle,onMouseDown:_})]})}function jt(n){return n?n.includes("T")?n.split("T")[0]:n:""}function sS(){return navigator.language||"en-US"}function Md(n){const s=sS();return new Intl.DateTimeFormat(s,{day:"numeric",month:"short"}).format(n)}function Yp(n,s){const r=new Date(n),i=new Date(s),l=Md(r),d=Md(i);return`${l} - ${d}`}function Qp(n){const s=new Date(n);return Md(s)}const aS="_row_q9wpc_1",rS="_nameColumn_q9wpc_18",iS="_customCells_q9wpc_30",oS="_customCell_q9wpc_30",lS="_dragging_q9wpc_47",cS="_dropBefore_q9wpc_51",dS="_dropAfter_q9wpc_63",uS="_dragHandle_q9wpc_76",hS="_criticalPathDot_q9wpc_91",fS="_expandBtn_q9wpc_114",mS="_expanded_q9wpc_144",pS="_wbsLevel_q9wpc_148",gS="_completionBadge_q9wpc_174",_S="_manual_q9wpc_187",yS="_calculated_q9wpc_198",vS="_empty_q9wpc_208",xS="_colorDot_q9wpc_220",jS="_name_q9wpc_18",wS="_dateDisplay_q9wpc_237",on={row:aS,nameColumn:rS,customCells:iS,customCell:oS,dragging:lS,dropBefore:cS,dropAfter:dS,dragHandle:uS,criticalPathDot:hS,expandBtn:fS,expanded:mS,wbsLevel:pS,completionBadge:gS,manual:_S,calculated:yS,empty:vS,colorDot:xS,name:jS,dateDisplay:wS};function SS(n){const s=[];function r(i){for(const l of i)s.push({entityType:"subphase",entityId:l.id}),l.children&&l.children.length>0&&r(l.children)}return r(n),s}function Jo(n){if(!n)return{completion:null,isCalculated:!1};const s=n.children||[];let r=!1;for(const i of s){if(!i)continue;const l=Jo(i);if(l&&l.completion!==null){r=!0;break}}if(r){let i=0,l=0;for(const d of s){if(!d)continue;const u=Jo(d),h=Math.max(1,Math.ceil((new Date(d.end_date).getTime()-new Date(d.start_date).getTime())/(1e3*60*60*24))),p=u.completion??0;l+=p*h,i+=h}if(i>0)return{completion:Math.round(l/i),isCalculated:!0}}return{completion:n.completion??null,isCalculated:!1}}const Xp=f.memo(function({subphase:s,phaseId:r,projectId:i,depth:l,wbsLevel:d=1,siblings:u,parentId:h,parentType:p,customColumns:m=[],nameColumnWidth:v,criticalPathItems:y=new Set}){const b=G(ae=>ae.expandedSubphases),w=G(ae=>ae.toggleSubphaseExpanded),x=G(ae=>ae.staff),_=G(ae=>ae.equipment),S=G(ae=>ae.currentUser),C=G(ae=>ae.showAssignments),B=xe(ae=>ae.openSubphaseModal),D=xe(ae=>ae.triggerScrollToDate),O=G(ae=>ae.projects),z=G(ae=>ae.setProjects),R=S?.role==="admin"||S?.role==="superuser",[Q,H]=f.useState(null),J=!!Q,{handleDragStart:q,handleDragOver:E,handleDragLeave:L,handleDrop:$,handleDragEnd:M,isDragging:k,getDropPosition:P}=qp(),F=b.has(s.id),A=ae=>{ae.stopPropagation(),w(s.id)},I=()=>{B(s,r,i)},U=f.useCallback(ae=>{ae.stopPropagation(),D(s.start_date)},[s.start_date,D]),N=f.useCallback(ae=>{ae.stopPropagation(),!Jo(s).isCalculated&&H(ae.currentTarget)},[s]),W=f.useCallback((ae,ue,we)=>ae.map(ie=>ie.id===ue?{...ie,completion:we}:ie.children&&ie.children.length>0?{...ie,children:W(ie.children,ue,we)}:ie),[]),K=f.useCallback(async ae=>{try{const ue=ae===-1?null:ae;await ia(s.id,{completion:ue});const we=O.map(ie=>ie.id!==i?ie:{...ie,phases:ie.phases?.map(Ae=>Ae.id!==r?Ae:{...Ae,children:W(Ae.children||[],s.id,ue)})});z(we)}catch(ue){console.error("Failed to update completion:",ue)}},[s.id,i,r,O,z,W]),te=(s.children?.length??0)>0||(s.staffAssignments?.length??0)>0||(s.equipmentAssignments?.length??0)>0,Y=l*16+8,me=f.useMemo(()=>s.is_milestone?Qp(s.start_date):Yp(s.start_date,s.end_date),[s.start_date,s.end_date,s.is_milestone]),ge=f.useMemo(()=>Jo(s),[s]),pe=f.useMemo(()=>SS(s.children??[]),[s.children]),oe=xe(ae=>ae.showContextMenu),le=f.useCallback(ae=>{ae.preventDefault(),oe("subphase",s.id,ae.clientX,ae.clientY,i,r)},[oe,s.id,i,r]),se=f.useCallback(ae=>{q(ae,"subphase",s.id,i,h,p)},[q,s.id,i,h,p]),De=f.useCallback(ae=>{E(ae,"subphase",s.id)},[E,s.id]),We=f.useCallback(ae=>{$(ae,"subphase",s.id,u,h,p)},[$,s.id,u,h,p]),ot=k("subphase",s.id),ce=P("subphase",s.id);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${on.row} ${ot?on.dragging:""} ${ce?on[`drop${ce.charAt(0).toUpperCase()+ce.slice(1)}`]:""}`,"data-subphase-id":s.id,onDragOver:De,onDragLeave:L,onDrop:We,onDoubleClick:I,onContextMenu:le,children:[e.jsxs("div",{className:on.nameColumn,style:{width:v,paddingLeft:Y},children:[y.has(`subphase-${s.id}`)&&e.jsx("span",{className:on.criticalPathDot,title:"On Critical Path"}),e.jsx("div",{className:on.dragHandle,draggable:!0,onDragStart:se,onDragEnd:M,title:"Drag to reorder",children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("circle",{cx:"9",cy:"6",r:"2"}),e.jsx("circle",{cx:"15",cy:"6",r:"2"}),e.jsx("circle",{cx:"9",cy:"12",r:"2"}),e.jsx("circle",{cx:"15",cy:"12",r:"2"}),e.jsx("circle",{cx:"9",cy:"18",r:"2"}),e.jsx("circle",{cx:"15",cy:"18",r:"2"})]})}),e.jsx("button",{className:`${on.expandBtn} ${F?on.expanded:""}`,onClick:A,disabled:!te,children:te&&e.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})}),e.jsx("button",{className:`${on.completionBadge} ${ge.completion!==null?ge.isCalculated?on.calculated:on.manual:on.empty}`,onClick:N,title:ge.completion!==null?ge.isCalculated?"Calculated from children":"Click to edit":"Click to set completion",children:ge.completion!==null?`${ge.completion}%`:""}),e.jsxs("button",{className:on.wbsLevel,style:{backgroundColor:s.color},onClick:U,title:`Level ${d} - Click to scroll to start date`,children:["L",d]}),e.jsx("span",{className:on.name,title:s.name,children:s.name}),e.jsx("span",{className:on.dateDisplay,children:me})]}),m.length>0&&e.jsx("div",{className:on.customCells,children:m.map(ae=>e.jsx("div",{className:on.customCell,style:{width:ae.width},children:e.jsx(Gp,{column:ae,entityType:"subphase",entityId:s.id,readOnly:!R,childEntities:pe})},ae.id))})]}),J&&Up.createPortal(e.jsx(Vp,{value:s.completion??null,onChange:K,onClose:()=>H(null),anchorEl:Q,isCalculated:ge.isCalculated}),document.body),F&&e.jsxs(e.Fragment,{children:[e.jsx(CS,{subphases:s.children??[],phaseId:r,projectId:i,depth:l+1,wbsLevel:d+1,parentId:s.id,parentType:"subphase",customColumns:m,nameColumnWidth:v,criticalPathItems:y}),C&&(s.staffAssignments??[]).map(ae=>{const ue=x.find(we=>we.id===ae.staff_id);return e.jsx(lr,{type:"subphase-staff",assignmentId:ae.id,projectId:i,phaseId:r,subphaseId:s.id,staffId:ae.staff_id,name:ue?.name||ae.staff_name||"Unknown",role:ue?.role,allocation:ae.allocation,phaseType:s.name,phaseColor:s.color,depth:l+1},`staff-${ae.id}`)}),C&&(s.equipmentAssignments??[]).map(ae=>{const ue=_.find(we=>we.id===ae.equipment_id);return e.jsx(lr,{type:"equipment",assignmentId:ae.id,projectId:i,phaseId:r,subphaseId:s.id,equipmentId:ae.equipment_id,name:ue?.name||ae.equipment_name||"Unknown",equipmentType:ue?.type,depth:l+1},`equip-${ae.id}`)})]})]})});function CS({subphases:n,phaseId:s,projectId:r,depth:i,wbsLevel:l,parentId:d,parentType:u,customColumns:h,nameColumnWidth:p,criticalPathItems:m}){const v=xe(D=>D.phantomSiblingMode),y=G(D=>D.customColumnFilters),b=G(D=>D.customColumnValues),{completePhantom:w,cancelPhantom:x}=yi(),_=v?.type==="subphase"&&v.projectId===r?v.sourceId:null,S=f.useCallback((D,O)=>{const z=Object.keys(y).filter(R=>y[Number(R)]?.length>0);if(z.length===0)return!0;for(const R of z){const Q=Number(R),H=y[Q],J=`${Q}-${D}-${O}`,q=b[J]??null;if(q===null){if(!H.includes("__empty__"))return!1}else if(!H.includes(q))return!1}return!0},[y,b]),C=f.useCallback(D=>{for(const O of D)if(S("subphase",O.id)||O.children&&O.children.length>0&&C(O.children))return!0;return!1},[S]),B=f.useMemo(()=>n.filter(D=>S("subphase",D.id)||C(D.children??[])),[n,S,C]);return e.jsx(e.Fragment,{children:B.map(D=>e.jsxs(f.Fragment,{children:[e.jsx(Xp,{subphase:D,phaseId:s,projectId:r,depth:i,wbsLevel:l,siblings:n,parentId:d,parentType:u,customColumns:h,nameColumnWidth:p,criticalPathItems:m}),_===D.id&&e.jsx(tu,{onComplete:w,onCancel:x})]},D.id))})}const bS="_row_1otko_1",kS="_nameColumn_1otko_18",NS="_customCells_1otko_30",DS="_customCell_1otko_30",ES="_dragging_1otko_47",$S="_dropBefore_1otko_51",TS="_dropAfter_1otko_63",MS="_dragHandle_1otko_76",PS="_criticalPathDot_1otko_91",IS="_expandBtn_1otko_114",LS="_expanded_1otko_144",AS="_completionBadge_1otko_148",RS="_manual_1otko_161",BS="_calculated_1otko_172",OS="_empty_1otko_182",FS="_typeBadge_1otko_194",zS="_colorDot_1otko_207",HS="_name_1otko_18",WS="_dateDisplay_1otko_223",mn={row:bS,nameColumn:kS,customCells:NS,customCell:DS,dragging:ES,dropBefore:$S,dropAfter:TS,dragHandle:MS,criticalPathDot:PS,expandBtn:IS,expanded:LS,completionBadge:AS,manual:RS,calculated:BS,empty:OS,typeBadge:FS,colorDot:zS,name:HS,dateDisplay:WS};function qS(n){const s=[];function r(i){for(const l of i)s.push({entityType:"subphase",entityId:l.id}),l.children&&l.children.length>0&&r(l.children)}return r(n),s}function el(n){if(!n)return{completion:null,isCalculated:!1};const s=n.children||[];let r=!1;for(const i of s){if(!i)continue;const l=el(i);if(l&&l.completion!==null){r=!0;break}}if(r){let i=0,l=0;for(const d of s){if(!d)continue;const u=el(d),h=Math.max(1,Math.ceil((new Date(d.end_date).getTime()-new Date(d.start_date).getTime())/(1e3*60*60*24))),p=u.completion??0;l+=p*h,i+=h}if(i>0)return{completion:Math.round(l/i),isCalculated:!0}}return{completion:n.completion??null,isCalculated:!1}}const US=f.memo(function({phase:s,projectId:r,depth:i,phases:l,customColumns:d=[],nameColumnWidth:u,criticalPathItems:h=new Set}){const p=G(oe=>oe.expandedPhases),m=G(oe=>oe.togglePhaseExpanded),v=G(oe=>oe.staff),y=G(oe=>oe.equipment),b=G(oe=>oe.currentUser),w=G(oe=>oe.showAssignments),x=G(oe=>oe.projects),_=G(oe=>oe.setProjects),S=xe(oe=>oe.openPhaseModal),C=b?.role==="admin"||b?.role==="superuser",[B,D]=f.useState(null),O=!!B,{handleDragStart:z,handleDragOver:R,handleDragLeave:Q,handleDrop:H,handleDragEnd:J,isDragging:q,getDropPosition:E}=qp(),L=p.has(s.id),$=oe=>{oe.stopPropagation(),m(s.id)},M=()=>{S(s,r)},k=f.useCallback(oe=>{oe.stopPropagation(),!el(s).isCalculated&&D(oe.currentTarget)},[s]),P=f.useCallback(async oe=>{try{const le=oe===-1?null:oe;await ra(s.id,{completion:le});const se=x.map(De=>De.id!==r?De:{...De,phases:(De.phases??[]).map(We=>We.id===s.id?{...We,completion:le}:We)});_(se)}catch(le){console.error("Failed to update phase completion:",le)}},[s.id,r,x,_]),F=(s.children?.length??0)>0||(s.staffAssignments?.length??0)>0||(s.equipmentAssignments?.length??0)>0,A=i*16+8,I=f.useMemo(()=>s.is_milestone?Qp(s.start_date):Yp(s.start_date,s.end_date),[s.start_date,s.end_date,s.is_milestone]),U=f.useMemo(()=>el(s),[s]),N=f.useMemo(()=>qS(s.children??[]),[s.children]),W=xe(oe=>oe.showContextMenu),K=f.useCallback(oe=>{oe.preventDefault(),W("phase",s.id,oe.clientX,oe.clientY,r)},[W,s.id,r]),te=f.useCallback(oe=>{z(oe,"phase",s.id,r)},[z,s.id,r]),Y=f.useCallback(oe=>{R(oe,"phase",s.id)},[R,s.id]),me=f.useCallback(oe=>{H(oe,"phase",s.id,l)},[H,s.id,l]),ge=q("phase",s.id),pe=E("phase",s.id);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${mn.row} ${ge?mn.dragging:""} ${pe?mn[`drop${pe.charAt(0).toUpperCase()+pe.slice(1)}`]:""}`,"data-phase-id":s.id,onDragOver:Y,onDragLeave:Q,onDrop:me,onDoubleClick:M,onContextMenu:K,children:[e.jsxs("div",{className:mn.nameColumn,style:{width:u,paddingLeft:A},children:[h.has(`phase-${s.id}`)&&e.jsx("span",{className:mn.criticalPathDot,title:"On Critical Path"}),e.jsx("div",{className:mn.dragHandle,draggable:!0,onDragStart:te,onDragEnd:J,title:"Drag to reorder",children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("circle",{cx:"9",cy:"6",r:"2"}),e.jsx("circle",{cx:"15",cy:"6",r:"2"}),e.jsx("circle",{cx:"9",cy:"12",r:"2"}),e.jsx("circle",{cx:"15",cy:"12",r:"2"}),e.jsx("circle",{cx:"9",cy:"18",r:"2"}),e.jsx("circle",{cx:"15",cy:"18",r:"2"})]})}),e.jsx("button",{className:`${mn.expandBtn} ${L?mn.expanded:""}`,onClick:$,disabled:!F,children:F&&e.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})}),e.jsx("span",{className:`${mn.completionBadge} ${U.completion!==null?U.isCalculated?mn.calculated:mn.manual:mn.empty}`,style:{cursor:U.isCalculated?"default":"pointer"},title:U.completion!==null?U.isCalculated?"Calculated from children":"Click to edit":"Click to set completion",onClick:k,children:U.completion!==null?`${U.completion}%`:""}),e.jsxs("span",{className:mn.typeBadge,style:{backgroundColor:`${s.color}33`,color:s.color},children:[s.is_milestone?"":"",s.name]}),e.jsx("span",{className:mn.dateDisplay,children:I})]}),d.length>0&&e.jsx("div",{className:mn.customCells,children:d.map(oe=>e.jsx("div",{className:mn.customCell,style:{width:oe.width},children:e.jsx(Gp,{column:oe,entityType:"phase",entityId:s.id,readOnly:!C,childEntities:N})},oe.id))})]}),L&&e.jsxs(e.Fragment,{children:[e.jsx(VS,{subphases:s.children??[],phaseId:s.id,projectId:r,depth:i+1,customColumns:d,nameColumnWidth:u,criticalPathItems:h}),w&&(s.staffAssignments??[]).map(oe=>{const le=v.find(se=>se.id===oe.staff_id);return e.jsx(lr,{type:"phase-staff",assignmentId:oe.id,projectId:r,phaseId:s.id,staffId:oe.staff_id,name:le?.name||oe.staff_name||"Unknown",role:le?.role,allocation:oe.allocation,phaseType:s.name,phaseColor:s.color,depth:i+1},`staff-${oe.id}`)}),w&&(s.equipmentAssignments??[]).map(oe=>{const le=y.find(se=>se.id===oe.equipment_id);return e.jsx(lr,{type:"equipment",assignmentId:oe.id,projectId:r,phaseId:s.id,equipmentId:oe.equipment_id,name:le?.name||oe.equipment_name||"Unknown",equipmentType:le?.type,depth:i+1},`equip-${oe.id}`)})]}),O&&e.jsx(Vp,{value:s.completion??null,onClose:()=>D(null),anchorEl:B,onChange:P})]})});function VS({subphases:n,phaseId:s,projectId:r,depth:i,customColumns:l,nameColumnWidth:d,criticalPathItems:u}){const h=xe(S=>S.phantomSiblingMode),p=G(S=>S.customColumnFilters),m=G(S=>S.customColumnValues),{completePhantom:v,cancelPhantom:y}=yi(),b=h?.type==="subphase"&&h.projectId===r&&h.parentType==="phase"&&h.parentId===s?h.sourceId:null,w=f.useCallback((S,C)=>{const B=Object.keys(p).filter(D=>p[Number(D)]?.length>0);if(B.length===0)return!0;for(const D of B){const O=Number(D),z=p[O],R=`${O}-${S}-${C}`,Q=m[R]??null;if(Q===null){if(!z.includes("__empty__"))return!1}else if(!z.includes(Q))return!1}return!0},[p,m]),x=f.useCallback(S=>{for(const C of S)if(w("subphase",C.id)||C.children&&C.children.length>0&&x(C.children))return!0;return!1},[w]),_=f.useMemo(()=>n.filter(S=>w("subphase",S.id)||x(S.children??[])),[n,w,x]);return e.jsx(e.Fragment,{children:_.map(S=>e.jsxs(f.Fragment,{children:[e.jsx(Xp,{subphase:S,phaseId:s,projectId:r,depth:i,wbsLevel:1,siblings:n,parentId:s,parentType:"phase",customColumns:l,nameColumnWidth:d,criticalPathItems:u}),b===S.id&&e.jsx(tu,{onComplete:v,onCancel:y})]},S.id))})}const GS="_row_sp6pd_1",YS="_unconfirmed_sp6pd_16",QS="_name_sp6pd_20",XS="_nameColumn_sp6pd_25",KS="_levelControls_sp6pd_37",ZS="_levelBtn_sp6pd_47",JS="_status_sp6pd_118",eC="_confirmed_sp6pd_126",tC="_pending_sp6pd_130",nC="_completionBadge_sp6pd_135",sC="_info_sp6pd_150",aC="_meta_sp6pd_166",rC="_pm_sp6pd_175",iC="_customer_sp6pd_179",oC="_children_sp6pd_197",lC="_customCells_sp6pd_202",cC="_customCell_sp6pd_202",dC="_emptyCell_sp6pd_218",uC="_criticalPathBtn_sp6pd_224",hC="_active_sp6pd_246",fC="_dragHandle_sp6pd_264",mC="_dropAbove_sp6pd_294",pC="_dropBelow_sp6pd_310",gC="_dragging_sp6pd_333",bt={row:GS,unconfirmed:YS,name:QS,nameColumn:XS,levelControls:KS,levelBtn:ZS,status:JS,confirmed:eC,pending:tC,completionBadge:nC,info:sC,meta:aC,pm:rC,customer:iC,children:oC,customCells:lC,customCell:cC,emptyCell:dC,criticalPathBtn:uC,active:hC,dragHandle:fC,dropAbove:mC,dropBelow:pC,dragging:gC};function Pd(n){if(!n)return{completion:null,isCalculated:!1};const s=n.children||[];let r=!1;for(const i of s){if(!i)continue;const l=Pd(i);if(l&&l.completion!==null){r=!0;break}}if(r){let i=0,l=0;for(const d of s){if(!d)continue;const u=Pd(d),h=Math.max(1,Math.ceil((new Date(d.end_date).getTime()-new Date(d.start_date).getTime())/(1e3*60*60*24))),p=u.completion??0;l+=p*h,i+=h}if(i>0)return{completion:Math.round(l/i),isCalculated:!0}}return{completion:n.completion??null,isCalculated:!1}}function _C(n){const s=n.phases??[];if(s.length===0)return null;let r=0,i=0;return s.forEach(l=>{const d=Pd(l),u=new Date(l.start_date),h=new Date(l.end_date),p=Math.max(1,(h.getTime()-u.getTime())/(1e3*60*60*24)),m=d.completion??0;r+=m*p,i+=p}),i>0?Math.round(r/i):null}const yC=f.memo(function({project:s,customColumns:r=[],nameColumnWidth:i,onReorder:l,siblingIds:d=[],index:u=0}){const h=G(Y=>Y.expandedProjects),p=G(Y=>Y.expandedPhases),m=G(Y=>Y.expandedSubphases),v=G(Y=>Y.toggleProjectExpanded),y=G(Y=>Y.expandProjectLevel),b=G(Y=>Y.collapseProjectLevel),w=G(Y=>Y.staff),x=G(Y=>Y.equipment),_=G(Y=>Y.showAssignments),S=G(Y=>Y.toggleCriticalPath),C=G(Y=>Y.isCriticalPathEnabled),B=G(Y=>Y.criticalPathItems),D=xe(Y=>Y.openProjectModal),O=h.has(s.id),z=f.useMemo(()=>_C(s),[s]),R=B.get(s.id)||new Set,Q=f.useMemo(()=>{if(!h.has(s.id))return 0;const Y=s.phases??[];if(!Y.some(pe=>p.has(pe.id)))return 1;let ge=!1;return Y.forEach(pe=>{const oe=le=>{le?.forEach(se=>{m.has(se.id)&&(ge=!0),oe(se.children)})};oe(pe.children)}),ge?3:2},[s,h,p,m]),H=f.useMemo(()=>{const Y=s.phases??[];let me=1;return Y.forEach(ge=>{if(ge.children?.length>0){me=Math.max(me,2);const pe=(oe,le)=>{oe?.forEach(se=>{me=Math.max(me,le),se.children?.length>0&&pe(se.children,le+1)})};pe(ge.children,3)}}),me},[s]),J=Y=>{Y.stopPropagation(),v(s.id)},q=Y=>{Y.stopPropagation(),y(s.id)},E=Y=>{Y.stopPropagation(),b(s.id)},L=Y=>{Y.stopPropagation(),S(s.id)},$=()=>{D(s)},M=xe(Y=>Y.showContextMenu),k=f.useCallback(Y=>{Y.preventDefault(),M("project",s.id,Y.clientX,Y.clientY)},[M,s.id]),[P,F]=f.useState(null),[A,I]=f.useState(!1),U=f.useCallback(Y=>{Y.stopPropagation(),I(!0),Y.dataTransfer.effectAllowed="move",Y.dataTransfer.setData("application/x-project-reorder",String(s.id))},[s.id]),N=f.useCallback(()=>{I(!1),F(null)},[]),W=f.useCallback(Y=>{if(!Y.dataTransfer.types.includes("application/x-project-reorder"))return;Y.preventDefault(),Y.stopPropagation();const me=Y.currentTarget.getBoundingClientRect(),ge=me.top+me.height/2,pe=Y.clientY<ge?"above":"below";F(pe)},[]),K=f.useCallback(Y=>{const me=Y.relatedTarget,ge=Y.currentTarget;me&&ge.contains(me)||F(null)},[]),te=f.useCallback(Y=>{Y.preventDefault(),Y.stopPropagation();const me=parseInt(Y.dataTransfer.getData("application/x-project-reorder"),10);if(isNaN(me)||me===s.id){F(null);return}const ge=Y.currentTarget.getBoundingClientRect(),pe=ge.top+ge.height/2,oe=Y.clientY<pe;let le=s.id;if(!oe&&d.length>0){const se=d.indexOf(s.id);se<d.length-1&&(le=d[se+1])}l&&l(me,le),F(null)},[s.id,d,l]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${bt.row} ${s.confirmed?"":bt.unconfirmed} ${P==="above"?bt.dropAbove:""} ${P==="below"?bt.dropBelow:""} ${A?bt.dragging:""}`,"data-project-id":s.id,onDoubleClick:$,onContextMenu:k,onDragOver:W,onDragLeave:K,onDrop:te,children:[e.jsxs("div",{className:bt.nameColumn,style:{width:i},children:[l&&e.jsx("div",{className:bt.dragHandle,draggable:!0,onDragStart:U,onDragEnd:N,onClick:Y=>Y.stopPropagation(),onDoubleClick:Y=>Y.stopPropagation(),title:"Drag to reorder",children:e.jsxs("svg",{width:"8",height:"12",viewBox:"0 0 8 12",fill:"currentColor",children:[e.jsx("circle",{cx:"2",cy:"2",r:"1.2"}),e.jsx("circle",{cx:"6",cy:"2",r:"1.2"}),e.jsx("circle",{cx:"2",cy:"6",r:"1.2"}),e.jsx("circle",{cx:"6",cy:"6",r:"1.2"}),e.jsx("circle",{cx:"2",cy:"10",r:"1.2"}),e.jsx("circle",{cx:"6",cy:"10",r:"1.2"})]})}),e.jsxs("div",{className:bt.levelControls,onClick:Y=>Y.stopPropagation(),onDoubleClick:Y=>Y.stopPropagation(),children:[e.jsx("button",{className:bt.levelBtn,onClick:E,onDoubleClick:Y=>Y.stopPropagation(),disabled:Q===0,title:"Collapse one level",children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})})}),e.jsx("button",{className:bt.levelBtn,onClick:q,onDoubleClick:Y=>Y.stopPropagation(),disabled:Q>=H,title:"Expand one level",children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})]}),e.jsx("button",{className:`${bt.criticalPathBtn} ${C(s.id)?bt.active:""}`,onClick:L,onDoubleClick:Y=>Y.stopPropagation(),title:C(s.id)?"Hide Critical Path":"Show Critical Path",children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})})}),e.jsx("span",{className:`${bt.status} ${s.confirmed?bt.confirmed:bt.pending}`,title:s.confirmed?"Confirmed":"Unconfirmed",onClick:J}),z!==null&&e.jsxs("span",{className:bt.completionBadge,title:"Project completion (calculated from phases)",children:[z,"%"]}),e.jsxs("div",{className:bt.info,onClick:J,children:[e.jsx("span",{className:bt.name,title:s.name,children:s.name}),e.jsxs("span",{className:bt.meta,children:[s.pm_name&&e.jsx("span",{className:bt.pm,children:s.pm_name}),s.customer&&e.jsxs("span",{className:bt.customer,children:["  ",s.customer]})]})]})]}),r.length>0&&e.jsx("div",{className:bt.customCells,children:r.map(Y=>e.jsx("div",{className:`${bt.customCell} ${bt.emptyCell}`,style:{width:Y.width}},Y.id))})]}),O&&e.jsxs("div",{className:bt.children,children:[e.jsx(vC,{phases:s.phases??[],projectId:s.id,customColumns:r,nameColumnWidth:i,criticalPathItems:R}),_&&(s.staffAssignments??[]).map(Y=>{const me=w.find(ge=>ge.id===Y.staff_id);return e.jsx(lr,{type:"staff",assignmentId:Y.id,projectId:s.id,staffId:Y.staff_id,name:me?.name||Y.staff_name||"Unknown",role:me?.role,allocation:Y.allocation,startDate:Y.start_date,endDate:Y.end_date,depth:1},`staff-${Y.id}`)}),_&&(s.equipmentAssignments??[]).map(Y=>{const me=x.find(ge=>ge.id===Y.equipment_id);return e.jsx(lr,{type:"equipment",assignmentId:Y.id,projectId:s.id,equipmentId:Y.equipment_id,name:me?.name||Y.equipment_name||"Unknown",equipmentType:me?.type,startDate:Y.start_date,endDate:Y.end_date,depth:1},`equip-${Y.id}`)})]})]})});function vC({phases:n,projectId:s,customColumns:r,nameColumnWidth:i,criticalPathItems:l}){const d=xe(x=>x.phantomSiblingMode),u=G(x=>x.customColumnFilters),h=G(x=>x.customColumnValues),{completePhantom:p,cancelPhantom:m}=yi(),v=d?.type==="phase"&&d.projectId===s?d.sourceId:null,y=f.useCallback((x,_)=>{const S=Object.keys(u).filter(C=>u[Number(C)]?.length>0);if(S.length===0)return!0;for(const C of S){const B=Number(C),D=u[B],O=`${B}-${x}-${_}`,z=h[O]??null;if(z===null){if(!D.includes("__empty__"))return!1}else if(!D.includes(z))return!1}return!0},[u,h]),b=f.useCallback(x=>{for(const _ of x)if(y("subphase",_.id)||_.children&&_.children.length>0&&b(_.children))return!0;return!1},[y]),w=f.useMemo(()=>n.filter(x=>y("phase",x.id)||b(x.children??[])),[n,y,b]);return e.jsx(e.Fragment,{children:w.map(x=>e.jsxs(f.Fragment,{children:[e.jsx(US,{phase:x,projectId:s,depth:1,phases:n,customColumns:r,nameColumnWidth:i,criticalPathItems:l}),v===x.id&&e.jsx(tu,{onComplete:p,onCancel:m})]},x.id))})}const xC="_overlay_e3ihd_1",jC="_fadeIn_e3ihd_1",wC="_modal_e3ihd_14",SC="_slideIn_e3ihd_1",CC="_sm_e3ihd_30",bC="_md_e3ihd_35",kC="_lg_e3ihd_40",NC="_xl_e3ihd_45",DC="_xxl_e3ihd_50",EC="_full_e3ihd_55",$C="_header_e3ihd_62",TC="_title_e3ihd_71",MC="_closeBtn_e3ihd_78",PC="_body_e3ihd_103",IC="_footer_e3ihd_109",ea={overlay:xC,fadeIn:jC,modal:wC,slideIn:SC,sm:CC,md:bC,lg:kC,xl:NC,xxl:DC,full:EC,header:$C,title:TC,closeBtn:MC,body:PC,footer:IC};function qt({isOpen:n,onClose:s,title:r,children:i,size:l="md",footer:d,closeOnOverlayClick:u=!1,closeOnEscape:h=!0}){const p=f.useRef(null),m=f.useRef(null),v=f.useRef(!1),y=f.useRef(s);y.current=s;const b=f.useCallback(x=>{u&&x.target===p.current&&y.current()},[u]);if(f.useEffect(()=>{if(!n||!h)return;const x=_=>{_.key==="Escape"&&y.current()};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[n,h]),f.useEffect(()=>(n&&!v.current?(document.body.style.overflow="hidden",m.current?.focus(),v.current=!0):!n&&v.current&&(document.body.style.overflow="",v.current=!1),()=>{v.current&&(document.body.style.overflow="")}),[n]),!n)return null;const w=[ea.modal,ea[l]].join(" ");return Up.createPortal(e.jsx("div",{ref:p,className:ea.overlay,onClick:b,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:e.jsxs("div",{ref:m,className:w,tabIndex:-1,children:[e.jsxs("div",{className:ea.header,children:[e.jsx("h2",{id:"modal-title",className:ea.title,children:r}),e.jsx("button",{className:ea.closeBtn,onClick:s,"aria-label":"Close modal",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("div",{className:ea.body,children:i}),d&&e.jsx("div",{className:ea.footer,children:d})]})}),document.body)}const LC="_button_4ftbf_1",AC="_sm_4ftbf_21",RC="_md_4ftbf_27",BC="_lg_4ftbf_33",OC="_primary_4ftbf_40",FC="_secondary_4ftbf_53",zC="_danger_4ftbf_64",HC="_ghost_4ftbf_73",WC="_icon_4ftbf_83",qC="_disabled_4ftbf_107",UC="_loading_4ftbf_113",VC="_content_4ftbf_117",GC="_spinner_4ftbf_123",YC="_spin_4ftbf_123",ks={button:LC,sm:AC,md:RC,lg:BC,primary:OC,secondary:FC,danger:zC,ghost:HC,icon:WC,disabled:qC,loading:UC,content:VC,spinner:GC,spin:YC},Ee=f.forwardRef(({variant:n="primary",size:s="md",loading:r=!1,icon:i,iconPosition:l="left",children:d,className:u,disabled:h,...p},m)=>{const v=[ks.button,ks[n],ks[s],r&&ks.loading,h&&ks.disabled,u].filter(Boolean).join(" ");return e.jsxs("button",{ref:m,className:v,disabled:r||h,...p,children:[r&&e.jsx("span",{className:ks.spinner}),!r&&i&&l==="left"&&e.jsx("span",{className:ks.icon,children:i}),d&&e.jsx("span",{className:ks.content,children:d}),!r&&i&&l==="right"&&e.jsx("span",{className:ks.icon,children:i})]})});Ee.displayName="Button";function ar(n){if(!n)return"";try{const s=os(n);return kt(s,"MM/dd/yyyy")}catch{return n}}function Id(n,s){if(!n||!s)return 1;try{const r=os(n),i=os(s);return Ns(i,r)+1}catch{return 1}}function Kp(n,s){return n===s}function $m(n,s){return!n||n.length===0?"":n.map(r=>{const i=`phase-${r.id}`,l=`subphase-${r.id}`;let d=s[i]||s[l];if(!d)return null;let u=`${d}${r.type}`;return r.lag&&r.lag!==0&&(u+=r.lag>0?`+${r.lag}d`:`${r.lag}d`),u}).filter(Boolean).join(",")}function Zp(n,s,r,i,l){const d=n.filter(u=>u.parent_subphase_id===s);for(const u of d){const h=i.length+1,p=`subphase-${u.id}`;l[p]=h;const m=Kp(u.start_date,u.end_date);i.push({id:h,name:m?` ${u.name}`:u.name,outlineLevel:r,start:ar(u.start_date),finish:ar(u.end_date),duration:m?"0d":`${Id(u.start_date,u.end_date)}d`,predecessors:"",percentComplete:u.completion||0,milestone:m?"Yes":"No",notes:"",internalId:p}),Zp(n,u.id,r+1,i,l)}}function Tm(n){const s=[];function r(i){if(i)for(const l of i)s.push(l),l.children&&r(l.children)}return r(n.children),s}function QC(n){const s=[],r={};for(const d of n){const u=s.length+1,h=`project-${d.id}`;r[h]=u,s.push({id:u,name:d.name,outlineLevel:1,start:ar(d.start_date),finish:ar(d.end_date),duration:`${Id(d.start_date,d.end_date)}d`,predecessors:"",percentComplete:0,milestone:"No",notes:[d.customer?`Customer: ${d.customer}`:"",d.pm_name?`PM: ${d.pm_name}`:"",d.confirmed?"":"UNCONFIRMED"].filter(Boolean).join("; "),internalId:h});for(const p of d.phases||[]){const m=s.length+1,v=`phase-${p.id}`;r[v]=m;const y=Kp(p.start_date,p.end_date);s.push({id:m,name:y?` ${p.name}`:p.name,outlineLevel:2,start:ar(p.start_date),finish:ar(p.end_date),duration:y?"0d":`${Id(p.start_date,p.end_date)}d`,predecessors:"",percentComplete:p.completion||0,milestone:y?"Yes":"No",notes:"",internalId:v});const b=Tm(p);b.length>0&&Zp(b,null,3,s,r)}}for(const d of n)for(const u of d.phases||[]){const h=s.find(m=>m.internalId===`phase-${u.id}`);h&&u.dependencies&&(h.predecessors=$m(u.dependencies,r));const p=Tm(u);for(const m of p){const v=s.find(y=>y.internalId===`subphase-${m.id}`);v&&m.dependencies&&(v.predecessors=$m(m.dependencies,r))}}return[["ID","Name","Outline Level","Start","Finish","Duration","Predecessors","% Complete","Milestone","Notes"].join(","),...s.map(d=>[d.id,`"${d.name.replace(/"/g,'""')}"`,d.outlineLevel,d.start,d.finish,d.duration,d.predecessors,d.percentComplete,d.milestone,`"${d.notes.replace(/"/g,'""')}"`].join(","))].join(`
`)}function XC(n,s){const r=new Blob([n],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(r),l=document.createElement("a");l.href=i,l.download=s,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i)}function KC(n,s){const r=QC(n),i=kt(new Date,"yyyy-MM-dd"),l=s?`${s.toLowerCase().replace(/\s+/g,"-")}-projects-${i}.csv`:`projects-export-${i}.csv`;XC(r,l)}function ZC(n){const s=[];s.push('<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'),s.push('<Project xmlns="http://schemas.microsoft.com/project">'),s.push(`  <Name>${Io(n.name)}</Name>`),s.push(`  <Title>${Io(n.name)}</Title>`),s.push(`  <Company>${Io(n.customer||"")}</Company>`),n.start_date&&s.push(`  <StartDate>${n.start_date}T08:00:00</StartDate>`),n.end_date&&s.push(`  <FinishDate>${n.end_date}T17:00:00</FinishDate>`),s.push("  <ScheduleFromStart>1</ScheduleFromStart>"),s.push(`  <CurrentDate>${kt(new Date,"yyyy-MM-dd'T'HH:mm:ss")}</CurrentDate>`),s.push("  <CalendarUID>1</CalendarUID>"),s.push("  <Calendars>"),s.push("    <Calendar>"),s.push("      <UID>1</UID>"),s.push("      <Name>Standard</Name>"),s.push("      <IsBaseCalendar>1</IsBaseCalendar>"),s.push("    </Calendar>"),s.push("  </Calendars>"),s.push("  <Tasks>");let r=0;const i=(l,d,u,h,p=!1,m=0)=>{r++,s.push("    <Task>"),s.push(`      <UID>${r}</UID>`),s.push(`      <ID>${r}</ID>`),s.push(`      <Name>${Io(l)}</Name>`),s.push(`      <OutlineLevel>${h}</OutlineLevel>`),d&&s.push(`      <Start>${d}T08:00:00</Start>`),u&&s.push(`      <Finish>${u}T17:00:00</Finish>`),s.push(`      <Milestone>${p?"1":"0"}</Milestone>`),s.push(`      <PercentComplete>${m||0}</PercentComplete>`),s.push("    </Task>")};i(n.name,n.start_date,n.end_date,0);for(const l of n.phases||[]){const d=l.start_date===l.end_date;i(l.name,l.start_date,l.end_date,1,d,l.completion||0);const u=(h,p)=>{for(const m of h||[]){const v=m.start_date===m.end_date;i(m.name,m.start_date,m.end_date,p,v,m.completion||0),m.children&&m.children.length>0&&u(m.children,p+1)}};u(l.children,2)}return s.push("  </Tasks>"),s.push("  <Resources/>"),s.push("  <Assignments/>"),s.push("</Project>"),s.join(`
`)}function Io(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function JC(n,s){const r=new Blob([n],{type:"application/xml;charset=utf-8;"}),i=URL.createObjectURL(r),l=document.createElement("a");l.href=i,l.download=s,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i)}function eb(n){const s=ZC(n),r=`${n.name.replace(/\s+/g,"_")}.xml`;JC(s,r)}const tb="_form_b7hew_3",nb="_formGroup_b7hew_9",sb="_formRow_b7hew_15",ab="_label_b7hew_21",rb="_input_b7hew_27",ib="_checkbox_b7hew_63",ob="_phaseTags_b7hew_79",lb="_phaseTag_b7hew_79",cb="_selected_b7hew_102",db="_error_b7hew_109",ub="_footer_b7hew_119",hb="_exportButtons_b7hew_126",fb="_actionButtons_b7hew_141",Qe={form:tb,formGroup:nb,formRow:sb,label:ab,input:rb,checkbox:ib,phaseTags:ob,phaseTag:lb,selected:cb,error:db,footer:ub,exportButtons:hb,actionButtons:fb};function mb(){const{activeModal:n,editingProject:s,closeModal:r}=xe(),{currentSite:i,staff:l,setProjects:d}=G(),u=n==="project",h=!!s,[p,m]=f.useState(""),[v,y]=f.useState(""),[b,w]=f.useState(""),[x,_]=f.useState(""),[S,C]=f.useState(""),[B,D]=f.useState(!1),[O,z]=f.useState(!1),[R,Q]=f.useState(""),[H,J]=f.useState(""),[q,E]=f.useState(new Set),[L,$]=f.useState([]),[M,k]=f.useState(!1),[P,F]=f.useState(null),A=f.useMemo(()=>i?l.filter(pe=>pe.site_id===i.id):[],[l,i]);f.useEffect(()=>{u&&Dy().then(pe=>{const le=pe.filter(se=>se.is_active!==!1);$(le),h||E(new Set(le.map(se=>se.name)))}).catch(pe=>console.error("Failed to load predefined phases:",pe))},[u,h]),f.useEffect(()=>{if(u){if(s)m(s.name),y(s.customer||""),w(s.pm_id?.toString()||""),_(s.sales_pm||""),C(s.volume?.toString()||""),D(s.confirmed),z(s.archived||!1),Q(jt(s.start_date)),J(jt(s.end_date)),E(new Set);else{const pe=new Date,oe=new Date(pe);oe.setMonth(oe.getMonth()+1),m(""),y(""),w(""),_(""),C(""),D(!1),z(!1),Q(pe.toISOString().split("T")[0]),J(oe.toISOString().split("T")[0])}F(null)}},[u,s]);const I=pe=>{E(oe=>{const le=new Set(oe);return le.has(pe)?le.delete(pe):le.add(pe),le})},U=async pe=>{if(pe.preventDefault(),!p.trim()){F("Please enter a project name");return}if(!R||!H){F("Please select start and end dates");return}if(!i){F("No site selected");return}k(!0),F(null);try{const oe=[];if(q.size>0&&!h){const De=new Date(R),We=new Date(H),ce=(We.getTime()-De.getTime())/q.size;let ae=0;for(const ue of L)if(q.has(ue.name)){const we=new Date(De.getTime()+ce*ae),ie=new Date(De.getTime()+ce*(ae+1)),Ae=ie>We?We:ie;oe.push({type:ue.name,start_date:we.toISOString().split("T")[0],end_date:Ae.toISOString().split("T")[0]}),ae++}}const le={name:p.trim(),site_id:i.id,customer:v.trim()||null,pm_id:b?parseInt(b):null,sales_pm:x.trim()||null,volume:S?parseInt(S):null,confirmed:B,archived:O,start_date:R,end_date:H,phases:h?void 0:oe};h&&s?await fi(s.id,le):await ny(le);const se=await Rt();d(se),r()}catch(oe){F(oe instanceof Error?oe.message:"Failed to save project")}finally{k(!1)}},[N,W]=f.useState(!1),K=G(pe=>pe.projects),te=f.useMemo(()=>s?K.find(pe=>pe.id===s.id):null,[s,K]),Y=()=>{te&&KC([te],te.name)},me=()=>{if(te){W(!0);try{eb(te)}catch(pe){console.error("Export failed:",pe),alert("Failed to export to MS Project format")}finally{W(!1)}}},ge=e.jsxs("div",{className:Qe.footer,children:[h&&e.jsxs("div",{className:Qe.exportButtons,children:[e.jsxs(Ee,{variant:"secondary",onClick:Y,disabled:M||N,title:"Export to CSV (MS Project compatible)",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7,10 12,15 17,10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"CSV"]}),e.jsxs(Ee,{variant:"secondary",onClick:me,disabled:M||N,title:"Export to MS Project XML format",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7,10 12,15 17,10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),N?"Exporting...":"XML"]})]}),e.jsxs("div",{className:Qe.actionButtons,children:[e.jsx(Ee,{variant:"secondary",onClick:r,disabled:M,children:"Cancel"}),e.jsx(Ee,{variant:"primary",onClick:U,disabled:M,children:M?"Saving...":h?"Save Changes":"Create Project"})]})]});return e.jsx(qt,{isOpen:u,onClose:r,title:h?"Edit Project":"New Project",size:"lg",footer:ge,children:e.jsxs("form",{onSubmit:U,className:Qe.form,children:[P&&e.jsx("div",{className:Qe.error,children:P}),e.jsxs("div",{className:Qe.formGroup,children:[e.jsx("label",{className:Qe.label,children:"Project Name *"}),e.jsx("input",{type:"text",className:Qe.input,value:p,onChange:pe=>m(pe.target.value),placeholder:"Enter project name",autoFocus:!0})]}),e.jsxs("div",{className:Qe.formRow,children:[e.jsxs("div",{className:Qe.formGroup,children:[e.jsx("label",{className:Qe.label,children:"Start Date *"}),e.jsx("input",{type:"date",className:Qe.input,value:R,onChange:pe=>Q(pe.target.value)})]}),e.jsxs("div",{className:Qe.formGroup,children:[e.jsx("label",{className:Qe.label,children:"End Date *"}),e.jsx("input",{type:"date",className:Qe.input,value:H,onChange:pe=>J(pe.target.value)})]})]}),e.jsxs("div",{className:Qe.formRow,children:[e.jsxs("div",{className:Qe.formGroup,children:[e.jsx("label",{className:Qe.label,children:"Project Manager"}),e.jsxs("select",{className:Qe.input,value:b,onChange:pe=>w(pe.target.value),children:[e.jsx("option",{value:"",children:"Select PM"}),A.map(pe=>e.jsx("option",{value:pe.id,children:pe.name},pe.id))]})]}),e.jsxs("div",{className:Qe.formGroup,children:[e.jsx("label",{className:Qe.label,children:"Customer"}),e.jsx("input",{type:"text",className:Qe.input,value:v,onChange:pe=>y(pe.target.value),placeholder:"Customer name"})]})]}),e.jsxs("div",{className:Qe.formRow,children:[e.jsxs("div",{className:Qe.formGroup,children:[e.jsx("label",{className:Qe.label,children:"Sales PM"}),e.jsx("input",{type:"text",className:Qe.input,value:x,onChange:pe=>_(pe.target.value),placeholder:"Sales contact"})]}),e.jsxs("div",{className:Qe.formGroup,children:[e.jsx("label",{className:Qe.label,children:"Project Volume (CHF)"}),e.jsx("input",{type:"number",className:Qe.input,value:S,onChange:pe=>C(pe.target.value),placeholder:"0"})]})]}),!h&&e.jsxs("div",{className:Qe.formGroup,children:[e.jsx("label",{className:Qe.label,children:"Project Phases"}),e.jsx("div",{className:Qe.phaseTags,children:L.map(pe=>e.jsx("span",{className:`${Qe.phaseTag} ${q.has(pe.name)?Qe.selected:""}`,onClick:()=>I(pe.name),style:{"--phase-color":pe.default_color||pe.color||"var(--accent-blue)"},children:pe.name},pe.id))})]}),e.jsxs("div",{className:Qe.formRow,children:[e.jsx("div",{className:Qe.formGroup,children:e.jsxs("label",{className:Qe.checkbox,children:[e.jsx("input",{type:"checkbox",checked:B,onChange:pe=>D(pe.target.checked)}),e.jsx("span",{children:"Project Confirmed"})]})}),h&&e.jsx("div",{className:Qe.formGroup,children:e.jsxs("label",{className:Qe.checkbox,children:[e.jsx("input",{type:"checkbox",checked:O,onChange:pe=>z(pe.target.checked)}),e.jsx("span",{children:"Archived"})]})})]})]})})}const pb="_form_9p8sk_3",gb="_formGroup_9p8sk_9",_b="_formRow_9p8sk_15",yb="_label_9p8sk_21",vb="_input_9p8sk_27",xb="_checkbox_9p8sk_63",jb="_error_9p8sk_79",wb="_contextInfo_9p8sk_89",Sb="_footer_9p8sk_102",Cb="_footerRight_9p8sk_109",bb="_deleteBtn_9p8sk_115",kb="_assignmentsSection_9p8sk_120",Nb="_assignmentsList_9p8sk_126",Db="_assignmentItem_9p8sk_133",Eb="_assignmentName_9p8sk_142",$b="_assignmentAllocation_9p8sk_147",Ve={form:pb,formGroup:gb,formRow:_b,label:yb,input:vb,checkbox:xb,error:jb,contextInfo:wb,footer:Sb,footerRight:Cb,deleteBtn:bb,assignmentsSection:kb,assignmentsList:Nb,assignmentItem:Db,assignmentName:Eb,assignmentAllocation:$b};function Tb(n){const s=n.phases||[];if(s.length===0)return null;let r=null,i=null;for(const l of s){const d=new Date(l.start_date),u=new Date(l.end_date);(!r||d<r)&&(r=d),(!i||u>i)&&(i=u)}return r&&i?{start:r,end:i}:null}async function Mm(n,s,r,i){if(!n.start_date||!n.end_date)return!1;const l=new Date(n.start_date),d=new Date(n.end_date);let u=l,h=d;if(s==="expand"&&r&&i)r<l&&(u=r),i>d&&(h=i);else if(s==="shrink"){const p=Tb(n);p&&(u=p.start,h=p.end)}return u.getTime()!==l.getTime()||h.getTime()!==d.getTime()?(console.log("[PhaseModal] Cascading project dates:",{projectId:n.id,mode:s,oldStart:n.start_date,oldEnd:n.end_date,newStart:u.toISOString().split("T")[0],newEnd:h.toISOString().split("T")[0]}),await fi(n.id,{start_date:u.toISOString().split("T")[0],end_date:h.toISOString().split("T")[0]}),!0):!1}function Mb(){const{activeModal:n,editingPhase:s,modalContext:r,closeModal:i}=xe(),{projects:l,setProjects:d,ensureProjectExpanded:u}=G(),h=n==="phase",p=!!s,m=s?.project_id||r.projectId,[v,y]=f.useState(""),[b,w]=f.useState(!1),[x,_]=f.useState(""),[S,C]=f.useState(""),[B,D]=f.useState(!1),[O,z]=f.useState(null),R=f.useMemo(()=>l.find(q=>q.id===m),[l,m]);f.useEffect(()=>{if(h){if(s)y(s.name),w(!!s.is_milestone),_(jt(s.start_date)),C(jt(s.end_date));else if(r.phantomPreset)y(""),w(!1),_(jt(r.phantomPreset.startDate)),C(jt(r.phantomPreset.endDate));else{const q=new Date().toISOString().split("T")[0],E=jt(R?.start_date)||q,L=jt(R?.end_date)||q;y(""),w(!1),_(E),C(L)}z(null)}},[h,s,R,r.phantomPreset]),f.useEffect(()=>{b&&x&&C(x)},[b,x]);const Q=async q=>{if(q.preventDefault(),!v.trim()){z("Please enter a phase name");return}if(!x){z("Please select a start date");return}if(!b&&!S){z("Please select an end date");return}if(!m){z("No project selected");return}D(!0),z(null);try{const E={name:v.trim(),start_date:x,end_date:b?x:S,is_milestone:b,color:s?.color||rl()};if(r.phantomPreset){const{predecessorId:$,dependencyType:M}=r.phantomPreset,k=R?.phases?.find(P=>P.id===$);if(k){let P=0;const F=new Date(x),A=new Date(k.start_date.split("T")[0]),I=new Date(k.end_date.split("T")[0]);if(M==="SS")P=Math.round((F.getTime()-A.getTime())/(1e3*60*60*24));else{const N=new Date(I);N.setDate(N.getDate()+1),P=Math.round((F.getTime()-N.getTime())/(1e3*60*60*24))}E.dependencies=[{id:$,type:M,lag:P}];const U=k.order_index??0;E.order_index=U+1}else console.warn("[PhaseModal] sourcePhase not found for predecessorId:",$)}if(p&&s)await ra(s.id,E);else if(await ay(m,E),u(m),R){const $=new Date(E.start_date),M=new Date(E.end_date);await Mm(R,"expand",$,M)}const L=await Rt();d(L),i()}catch(E){z(E instanceof Error?E.message:"Failed to save phase")}finally{D(!1)}},H=async()=>{if(!(!p||!s||!m)&&confirm("Are you sure you want to delete this phase? This will also delete all subphases and assignments.")){D(!0),z(null);try{await lp(s.id);const q=await Rt();if(R){const E=q.find(L=>L.id===R.id);if(E)if(await Mm(E,"shrink")){const $=await Rt();d($)}else d(q);else d(q)}else d(q);i()}catch(q){z(q instanceof Error?q.message:"Failed to delete phase")}finally{D(!1)}}},J=e.jsxs("div",{className:Ve.footer,children:[p&&e.jsx(Ee,{variant:"danger",onClick:H,disabled:B,className:Ve.deleteBtn,children:"Delete Phase"}),e.jsxs("div",{className:Ve.footerRight,children:[e.jsx(Ee,{variant:"secondary",onClick:i,disabled:B,children:"Cancel"}),e.jsx(Ee,{variant:"primary",onClick:Q,disabled:B,children:B?"Saving...":p?"Save Changes":"Add Phase"})]})]});return e.jsx(qt,{isOpen:h,onClose:i,title:p?"Edit Phase":"Add Phase",size:"md",footer:J,children:e.jsxs("form",{onSubmit:Q,className:Ve.form,children:[O&&e.jsx("div",{className:Ve.error,children:O}),e.jsxs("div",{className:Ve.formGroup,children:[e.jsx("label",{className:Ve.label,children:"Phase Name *"}),e.jsx("input",{type:"text",className:Ve.input,value:v,onChange:q=>y(q.target.value),placeholder:"e.g., Preparation, Analytics, Trial, etc.",autoFocus:!0})]}),e.jsx("div",{className:Ve.formGroup,children:e.jsxs("label",{className:Ve.checkbox,children:[e.jsx("input",{type:"checkbox",checked:b,onChange:q=>w(q.target.checked)}),e.jsx("span",{children:"Milestone (single date, shown as diamond)"})]})}),e.jsxs("div",{className:Ve.formRow,children:[e.jsxs("div",{className:Ve.formGroup,children:[e.jsx("label",{className:Ve.label,children:b?"Date *":"Start Date *"}),e.jsx("input",{type:"date",className:Ve.input,value:x,onChange:q=>_(q.target.value)})]}),!b&&e.jsxs("div",{className:Ve.formGroup,children:[e.jsx("label",{className:Ve.label,children:"End Date *"}),e.jsx("input",{type:"date",className:Ve.input,value:S,onChange:q=>C(q.target.value)})]})]}),p&&s?.staffAssignments&&s.staffAssignments.length>0&&e.jsxs("div",{className:Ve.assignmentsSection,children:[e.jsx("label",{className:Ve.label,children:"Assigned Staff"}),e.jsx("div",{className:Ve.assignmentsList,children:s.staffAssignments.map(q=>e.jsxs("div",{className:Ve.assignmentItem,children:[e.jsx("span",{className:Ve.assignmentName,children:q.staff_name||`Staff #${q.staff_id}`}),e.jsxs("span",{className:Ve.assignmentAllocation,children:[q.allocation,"%"]})]},q.id))})]})]})})}function tl(n,s){for(const r of n){const i=nu(r.children||[],s);if(i)return i}return null}function nu(n,s){for(const r of n){if(r.id===s)return r;if(r.children&&r.children.length>0){const i=nu(r.children,s);if(i)return i}}return null}function Pb(n,s){for(const r of n){const i=Jp(r.children||[],s,1);if(i!==null)return i}return 1}function Jp(n,s,r){for(const i of n){if(i.id===s)return r;if(i.children&&i.children.length>0){const l=Jp(i.children,s,r+1);if(l!==null)return l}}return null}function Ib(n,s){for(const r of n)if(nu(r.children||[],s))return r;return null}function Lb(n){const s=n.children||[];if(s.length===0)return null;let r=null,i=null;const l=d=>{for(const u of d){const h=new Date(u.start_date),p=new Date(u.end_date);(!r||h<r)&&(r=h),(!i||p>i)&&(i=p),u.children&&u.children.length>0&&l(u.children)}};return l(s),r&&i?{start:r,end:i}:null}function Ab(n){const s=n.phases||[];if(s.length===0)return null;let r=null,i=null;for(const l of s){const d=new Date(l.start_date),u=new Date(l.end_date);(!r||d<r)&&(r=d),(!i||u>i)&&(i=u)}return r&&i?{start:r,end:i}:null}function Rb(n){const s=n.children||[];if(s.length===0)return null;let r=null,i=null;const l=d=>{for(const u of d){const h=new Date(u.start_date),p=new Date(u.end_date);(!r||h<r)&&(r=h),(!i||p>i)&&(i=p),u.children&&u.children.length>0&&l(u.children)}};return l(s),r&&i?{start:r,end:i}:null}function Bb(n,s){const r=[],i=tl(n,s);if(!i)return r;let l=i;for(;l&&l.parent_subphase_id;){const d=tl(n,l.parent_subphase_id);if(d)r.push(d),l=d;else break}return r}async function Pm(n,s,r,i,l,d){const u={subphasesUpdated:0,phaseUpdated:!1,projectUpdated:!1},h=n.phases?.find(B=>B.id===s);if(!h||!n.start_date||!n.end_date)return u;let p=i,m=l;if(d){const B=Bb(n.phases||[],d),D=tl(n.phases||[],d);D&&B.unshift(D);for(const O of B){const z=new Date(O.start_date),R=new Date(O.end_date);let Q=z,H=R;if(r==="expand"&&p&&m)p<z&&(Q=p),m>R&&(H=m);else if(r==="shrink"){const J=Rb(O);J&&(Q=J.start,H=J.end)}(Q.getTime()!==z.getTime()||H.getTime()!==R.getTime())&&(console.log("[Cascade] Updating parent subphase dates:",{subphaseId:O.id,name:O.name,oldStart:O.start_date,oldEnd:O.end_date,newStart:Q.toISOString().split("T")[0],newEnd:H.toISOString().split("T")[0]}),await ia(O.id,{start_date:Q.toISOString().split("T")[0],end_date:H.toISOString().split("T")[0]}),u.subphasesUpdated++,O.start_date=Q.toISOString().split("T")[0],O.end_date=H.toISOString().split("T")[0]),p=Q,m=H}}const v=new Date(h.start_date),y=new Date(h.end_date);let b=v,w=y;if(r==="expand"&&p&&m)p<v&&(b=p),m>y&&(w=m);else if(r==="shrink"){const B=Lb(h);B&&(b=B.start,w=B.end)}(b.getTime()!==v.getTime()||w.getTime()!==y.getTime())&&(console.log("[Cascade] Updating phase dates:",{phaseId:s,oldStart:h.start_date,oldEnd:h.end_date,newStart:b.toISOString().split("T")[0],newEnd:w.toISOString().split("T")[0]}),await ra(s,{start_date:b.toISOString().split("T")[0],end_date:w.toISOString().split("T")[0]}),u.phaseUpdated=!0,h.start_date=b.toISOString().split("T")[0],h.end_date=w.toISOString().split("T")[0]);const x=new Date(n.start_date),_=new Date(n.end_date);let S=x,C=_;if(r==="expand")b<x&&(S=b),w>_&&(C=w);else if(r==="shrink"){const B=Ab(n);B&&(S=B.start,C=B.end)}return(S.getTime()!==x.getTime()||C.getTime()!==_.getTime())&&(console.log("[Cascade] Updating project dates:",{projectId:n.id,oldStart:n.start_date,oldEnd:n.end_date,newStart:S.toISOString().split("T")[0],newEnd:C.toISOString().split("T")[0]}),await fi(n.id,{start_date:S.toISOString().split("T")[0],end_date:C.toISOString().split("T")[0]}),u.projectUpdated=!0),u}function Ob(){const{activeModal:n,editingSubphase:s,modalContext:r,closeModal:i}=xe(),{projects:l,setProjects:d,ensurePhaseExpanded:u,ensureSubphaseExpanded:h}=G(),p=n==="subphase",m=!!s,v=r.projectId,y=s?.parent_phase_id||r.phaseId,b=r.subphaseId,[w,x]=f.useState(""),[_,S]=f.useState(!1),[C,B]=f.useState(""),[D,O]=f.useState(""),[z,R]=f.useState(!1),[Q,H]=f.useState(null),J=f.useMemo(()=>v&&l.find(M=>M.id===v)||null,[l,v]),q=f.useMemo(()=>!J||!y?null:J.phases?.find(M=>M.id===y)||null,[J,y]);f.useEffect(()=>{if(p){if(s)x(s.name),S(!!s.is_milestone),B(jt(s.start_date)),O(jt(s.end_date));else if(r.phantomPreset)x(""),S(!1),B(jt(r.phantomPreset.startDate)),O(jt(r.phantomPreset.endDate));else{const M=new Date().toISOString().split("T")[0],k=jt(q?.start_date)||M,P=jt(q?.end_date)||M;x(""),S(!1),B(k),O(P)}H(null)}},[p,s,q,r.phantomPreset]),f.useEffect(()=>{_&&C&&O(C)},[_,C]);const E=async M=>{if(M.preventDefault(),!w.trim()){H("Please enter a subphase name");return}if(!C){H("Please select a start date");return}if(!_&&!D){H("Please select an end date");return}if(!y){H("No parent phase selected");return}R(!0),H(null);try{let k;if(s?.color)k=s.color;else if(b&&J){const U=Pb(J.phases||[],b);k=Wo(U+1)}else k=Wo(1);const P={name:w.trim(),start_date:C,end_date:_?C:D,is_milestone:_,color:k};if(r.phantomPreset){const{predecessorId:U,dependencyType:N}=r.phantomPreset,W=l.find(te=>te.id===v),K=tl(W?.phases||[],U);if(K){let te=0;const Y=new Date(C),me=new Date(K.start_date.split("T")[0]),ge=new Date(K.end_date.split("T")[0]);if(N==="SS")te=Math.round((Y.getTime()-me.getTime())/(1e3*60*60*24));else{const oe=new Date(ge);oe.setDate(oe.getDate()+1),te=Math.round((Y.getTime()-oe.getTime())/(1e3*60*60*24))}P.dependencies=[{id:U,type:N,lag:te}];const pe=K.order_index??0;P.order_index=pe+1}}let F=null,A;if(m&&s)await ia(s.id,P);else if(b&&v)await iy(b,v,P),h(b),F=y||null,A=b;else if(y&&v)await ry(y,v,P),u(y),F=y;else throw new Error("Missing phaseId or projectId");if(F&&!m&&J){const U=new Date(P.start_date),N=new Date(P.end_date);await Pm(J,F,"expand",U,N,A)}const I=await Rt();d(I),i()}catch(k){H(k instanceof Error?k.message:"Failed to save subphase")}finally{R(!1)}},L=async()=>{if(!(!m||!s)&&confirm("Are you sure you want to delete this subphase? This will also delete all nested subphases and assignments.")){R(!0),H(null);try{const M=J?Ib(J.phases||[],s.id):null,k=s.parent_subphase_id||void 0;await cp(s.id);const P=await Rt();if(M&&J){const F=P.find(A=>A.id===J.id);if(F){await Pm(F,M.id,"shrink",void 0,void 0,k);const A=await Rt();d(A)}else d(P)}else d(P);i()}catch(M){H(M instanceof Error?M.message:"Failed to delete subphase")}finally{R(!1)}}},$=e.jsxs("div",{className:Ve.footer,children:[m&&e.jsx(Ee,{variant:"danger",onClick:L,disabled:z,className:Ve.deleteBtn,children:"Delete Subphase"}),e.jsxs("div",{className:Ve.footerRight,children:[e.jsx(Ee,{variant:"secondary",onClick:i,disabled:z,children:"Cancel"}),e.jsx(Ee,{variant:"primary",onClick:E,disabled:z,children:z?"Saving...":m?"Save Changes":"Add Subphase"})]})]});return e.jsx(qt,{isOpen:p,onClose:i,title:m?"Edit Subphase":"Add Subphase",size:"md",footer:$,children:e.jsxs("form",{onSubmit:E,className:Ve.form,children:[Q&&e.jsx("div",{className:Ve.error,children:Q}),q&&e.jsxs("div",{className:Ve.contextInfo,children:["Parent: ",e.jsx("strong",{children:q.name})]}),e.jsxs("div",{className:Ve.formGroup,children:[e.jsx("label",{className:Ve.label,children:"Subphase Name *"}),e.jsx("input",{type:"text",className:Ve.input,value:w,onChange:M=>x(M.target.value),placeholder:"e.g., Task 1, Setup, Review, etc.",autoFocus:!0})]}),e.jsx("div",{className:Ve.formGroup,children:e.jsxs("label",{className:Ve.checkbox,children:[e.jsx("input",{type:"checkbox",checked:_,onChange:M=>S(M.target.checked)}),e.jsx("span",{children:"Milestone (single date, shown as diamond)"})]})}),e.jsxs("div",{className:Ve.formRow,children:[e.jsxs("div",{className:Ve.formGroup,children:[e.jsx("label",{className:Ve.label,children:_?"Date *":"Start Date *"}),e.jsx("input",{type:"date",className:Ve.input,value:C,onChange:M=>B(M.target.value)})]}),!_&&e.jsxs("div",{className:Ve.formGroup,children:[e.jsx("label",{className:Ve.label,children:"End Date *"}),e.jsx("input",{type:"date",className:Ve.input,value:D,onChange:M=>O(M.target.value)})]})]})]})})}const Fb="_form_1hx5k_3",zb="_formGroup_1hx5k_9",Hb="_formRow_1hx5k_15",Wb="_label_1hx5k_21",qb="_input_1hx5k_27",Ub="_contextInfo_1hx5k_48",Vb="_error_1hx5k_60",Gb="_sliderContainer_1hx5k_70",Yb="_slider_1hx5k_70",Qb="_sliderOverallocated_1hx5k_113",Xb="_sliderLabels_1hx5k_131",Kb="_maxCapacityMarker_1hx5k_138",Zb="_capacityHint_1hx5k_143",Jb="_overallocationWarning_1hx5k_149",ek="_footer_1hx5k_160",tk="_footerRight_1hx5k_167",nk="_deleteBtn_1hx5k_173",sk="_infoBox_1hx5k_195",qe={form:Fb,formGroup:zb,formRow:Hb,label:Wb,input:qb,contextInfo:Ub,error:Vb,sliderContainer:Gb,slider:Yb,sliderOverallocated:Qb,sliderLabels:Xb,maxCapacityMarker:Kb,capacityHint:Zb,overallocationWarning:Jb,footer:ek,footerRight:tk,deleteBtn:nk,infoBox:sk},Im=n=>Math.round(n/5)*5;function ak(){const{activeModal:n,editingStaffAssignment:s,modalContext:r,closeModal:i}=xe(),{projects:l,staff:d,currentSite:u,setProjects:h}=G(),p=n==="staffAssignment",m=!!s,[v,y]=f.useState(""),[b,w]=f.useState(100),[x,_]=f.useState(""),[S,C]=f.useState(""),[B,D]=f.useState(!1),[O,z]=f.useState(null),R=s?.project_id||r.projectId,Q=s?.phase_id||r.phaseId,H=s?.subphase_id||r.subphaseId,J=f.useMemo(()=>u?d.filter(W=>W.site_id===u.id):[],[d,u]),q=f.useMemo(()=>v?d.find(K=>K.id===parseInt(v))?.max_capacity??100:100,[v,d]),E=b>q,L=f.useMemo(()=>{if(!R)return null;const W=l.find(K=>K.id===R);return W?H?(te=>{for(const Y of te||[]){const me=pe=>{for(const oe of pe||[]){if(oe.id===H)return oe;const le=me(oe.children||[]);if(le)return le}return null},ge=me(Y.children||[]);if(ge)return ge}return null})(W.phases||[]):Q?W.phases?.find(K=>K.id===Q)||null:W:null},[l,R,Q,H]);f.useEffect(()=>{if(p){if(s)y(s.staff_id.toString()),w(s.allocation),_(jt(s.start_date)),C(jt(s.end_date));else{const W=new Date().toISOString().split("T")[0];y(""),w(100),_(jt(L?.start_date)||W),C(jt(L?.end_date)||W)}z(null)}},[p,s,L]);const $=f.useCallback(W=>{if(y(W),W&&!m){const te=d.find(Y=>Y.id===parseInt(W))?.max_capacity??100;w(Im(te))}},[d,m]),M=f.useCallback(W=>{const K=parseInt(W.target.value);w(Im(K))},[]),k=H?"subphase":Q?"phase":"project",P=k!=="project",F=async W=>{if(W.preventDefault(),!v){z("Please select a staff member");return}if(!P&&(!x||!S)){z("Please select start and end dates");return}if(b<5){z("Allocation must be at least 5%");return}D(!0),z(null);try{if(m&&s){const te=P?{allocation:b}:{allocation:b,start_date:x,end_date:S};await il(s.id,te,k)}else{const te={staff_id:parseInt(v),allocation:b,start_date:x,end_date:S,project_id:R||void 0,phase_id:Q||void 0,subphase_id:H||void 0};await Wd(te)}const K=await Rt();h(K),i()}catch(K){z(K instanceof Error?K.message:"Failed to save assignment")}finally{D(!1)}},A=async()=>{if(!(!m||!s)&&confirm("Are you sure you want to remove this staff assignment?")){D(!0),z(null);try{await dp(s.id,k);const W=await Rt();h(W),i()}catch(W){z(W instanceof Error?W.message:"Failed to delete assignment")}finally{D(!1)}}},I=H?"Subphase":Q?"Phase":"Project",U=L?.name||"Unknown",N=e.jsxs("div",{className:qe.footer,children:[m&&e.jsx(Ee,{variant:"danger",onClick:A,disabled:B,className:qe.deleteBtn,children:"Remove Assignment"}),e.jsxs("div",{className:qe.footerRight,children:[e.jsx(Ee,{variant:"secondary",onClick:i,disabled:B,children:"Cancel"}),e.jsx(Ee,{variant:"primary",onClick:F,disabled:B,children:B?"Saving...":m?"Save Changes":"Assign Staff"})]})]});return e.jsx(qt,{isOpen:p,onClose:i,title:m?"Edit Staff Assignment":"Assign Staff",size:"md",footer:N,children:e.jsxs("form",{onSubmit:F,className:qe.form,children:[O&&e.jsx("div",{className:qe.error,children:O}),e.jsxs("div",{className:qe.contextInfo,children:[I,": ",e.jsx("strong",{children:U})]}),e.jsxs("div",{className:qe.formGroup,children:[e.jsx("label",{className:qe.label,children:"Staff Member *"}),e.jsxs("select",{className:qe.input,value:v,onChange:W=>$(W.target.value),disabled:m,children:[e.jsx("option",{value:"",children:"Select staff member"}),J.map(W=>{const K=W.max_capacity??100,te=K<100?` - ${K}% capacity`:"";return e.jsxs("option",{value:W.id,children:[W.name," (",W.role||"No role",")",te]},W.id)})]})]}),e.jsxs("div",{className:qe.formGroup,children:[e.jsxs("label",{className:qe.label,children:["Allocation: ",b,"%",q<100&&e.jsxs("span",{className:qe.capacityHint,children:[" (Max capacity: ",q,"%)"]})]}),e.jsxs("div",{className:qe.sliderContainer,children:[e.jsx("input",{type:"range",className:`${qe.slider} ${E?qe.sliderOverallocated:""}`,min:"5",max:"100",step:"5",value:Math.min(b,100),onChange:M}),e.jsxs("div",{className:qe.sliderLabels,children:[e.jsx("span",{children:"5%"}),q<100&&q>25&&q<75&&e.jsxs("span",{className:qe.maxCapacityMarker,children:[q,"%"]}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"100%"})]})]}),E&&e.jsxs("div",{className:qe.overallocationWarning,children:[" Allocation exceeds staff's max capacity of ",q,"%"]})]}),!P&&e.jsxs("div",{className:qe.formRow,children:[e.jsxs("div",{className:qe.formGroup,children:[e.jsx("label",{className:qe.label,children:"Start Date *"}),e.jsx("input",{type:"date",className:qe.input,value:x,onChange:W=>_(W.target.value)})]}),e.jsxs("div",{className:qe.formGroup,children:[e.jsx("label",{className:qe.label,children:"End Date *"}),e.jsx("input",{type:"date",className:qe.input,value:S,onChange:W=>C(W.target.value)})]})]}),P&&e.jsx("div",{className:qe.infoBox,children:e.jsxs("p",{children:[" This assignment uses the ",I.toLowerCase(),"'s dates automatically."]})})]})})}function rk(){const{activeModal:n,editingEquipmentAssignment:s,modalContext:r,closeModal:i}=xe(),{projects:l,equipment:d,currentSite:u,setProjects:h}=G(),p=n==="equipmentAssignment",m=!!s,[v,y]=f.useState(""),[b,w]=f.useState(""),[x,_]=f.useState(""),[S,C]=f.useState(!1),[B,D]=f.useState(null),O=s?.project_id||r.projectId,z=s?.phase_id||r.phaseId,R=s?.subphase_id||r.subphaseId,Q=f.useMemo(()=>u?d.filter(M=>M.site_id===u.id):[],[d,u]),H=f.useMemo(()=>{if(!O)return null;const M=l.find(k=>k.id===O);return M?R?(P=>{for(const F of P||[]){const A=U=>{for(const N of U||[]){if(N.id===R)return N;const W=A(N.children||[]);if(W)return W}return null},I=A(F.children||[]);if(I)return I}return null})(M.phases||[]):z?M.phases?.find(k=>k.id===z)||null:M:null},[l,O,z,R]);f.useEffect(()=>{if(p){if(s)y(s.equipment_id.toString()),w(jt(s.start_date)),_(jt(s.end_date));else{const M=new Date().toISOString().split("T")[0];y(""),w(jt(H?.start_date)||M),_(jt(H?.end_date)||M)}D(null)}},[p,s,H]);const J=async M=>{if(M.preventDefault(),!v){D("Please select equipment");return}if(!b||!x){D("Please select start and end dates");return}C(!0),D(null);try{const k={equipment_id:parseInt(v),start_date:b,end_date:x,project_id:O||void 0,phase_id:z||void 0,subphase_id:R||void 0};m&&s?await ol(s.id,k):await qd(k);const P=await Rt();h(P),i()}catch(k){D(k instanceof Error?k.message:"Failed to save assignment")}finally{C(!1)}},q=async()=>{if(!(!m||!s)&&confirm("Are you sure you want to remove this equipment assignment?")){C(!0),D(null);try{await up(s.id);const M=await Rt();h(M),i()}catch(M){D(M instanceof Error?M.message:"Failed to delete assignment")}finally{C(!1)}}},E=R?"Subphase":z?"Phase":"Project",L=H?.name||"Unknown",$=e.jsxs("div",{className:qe.footer,children:[m&&e.jsx(Ee,{variant:"danger",onClick:q,disabled:S,className:qe.deleteBtn,children:"Remove Assignment"}),e.jsxs("div",{className:qe.footerRight,children:[e.jsx(Ee,{variant:"secondary",onClick:i,disabled:S,children:"Cancel"}),e.jsx(Ee,{variant:"primary",onClick:J,disabled:S,children:S?"Saving...":m?"Save Changes":"Assign Equipment"})]})]});return e.jsx(qt,{isOpen:p,onClose:i,title:m?"Edit Equipment Assignment":"Assign Equipment",size:"md",footer:$,children:e.jsxs("form",{onSubmit:J,className:qe.form,children:[B&&e.jsx("div",{className:qe.error,children:B}),e.jsxs("div",{className:qe.contextInfo,children:[E,": ",e.jsx("strong",{children:L})]}),e.jsxs("div",{className:qe.formGroup,children:[e.jsx("label",{className:qe.label,children:"Equipment *"}),e.jsxs("select",{className:qe.input,value:v,onChange:M=>y(M.target.value),disabled:m,children:[e.jsx("option",{value:"",children:"Select equipment"}),Q.map(M=>e.jsxs("option",{value:M.id,children:[M.name," (",M.type||"No type",")"]},M.id))]})]}),e.jsxs("div",{className:qe.formRow,children:[e.jsxs("div",{className:qe.formGroup,children:[e.jsx("label",{className:qe.label,children:"Start Date *"}),e.jsx("input",{type:"date",className:qe.input,value:b,onChange:M=>w(M.target.value)})]}),e.jsxs("div",{className:qe.formGroup,children:[e.jsx("label",{className:qe.label,children:"End Date *"}),e.jsx("input",{type:"date",className:qe.input,value:x,onChange:M=>_(M.target.value)})]})]})]})})}const ik="_content_1b4jo_3",ok="_error_1b4jo_9",lk="_staffDisplay_1b4jo_19",ck="_staffAvatar_1b4jo_29",dk="_staffInfo_1b4jo_43",uk="_staffName_1b4jo_50",hk="_staffRole_1b4jo_56",fk="_noStaff_1b4jo_62",mk="_section_1b4jo_76",pk="_sectionLabel_1b4jo_82",gk="_optional_1b4jo_90",_k="_dateRow_1b4jo_98",yk="_dateField_1b4jo_104",vk="_label_1b4jo_111",xk="_dateSeparator_1b4jo_117",jk="_input_1b4jo_127",wk="_duration_1b4jo_154",Sk="_footer_1b4jo_170",Ck="_exportBtn_1b4jo_181",bk="_select_1b4jo_205",kk="_dropZone_1b4jo_249",Nk="_dragging_1b4jo_270",Dk="_dropZoneText_1b4jo_285",Ek="_dropZoneHint_1b4jo_290",$k="_fileInput_1b4jo_295",Tk="_dividerRow_1b4jo_300",Mk="_dividerLine_1b4jo_307",Pk="_dividerText_1b4jo_313",Ik="_importHeader_1b4jo_321",Lk="_importActions_1b4jo_327",Ak="_linkBtn_1b4jo_334",Rk="_actionSeparator_1b4jo_349",Bk="_eventsList_1b4jo_355",Ok="_eventItem_1b4jo_364",Fk="_selected_1b4jo_380",zk="_eventCheckbox_1b4jo_385",Hk="_eventInfo_1b4jo_394",Wk="_eventSummary_1b4jo_402",qk="_eventDates_1b4jo_411",Uk="_eventDuration_1b4jo_420",Vk="_recurringToggle_1b4jo_426",Gk="_checkbox_1b4jo_434",Yk="_recurringLabel_1b4jo_441",Qk="_recurringOptions_1b4jo_454",Xk="_recurringHint_1b4jo_465",Kk="_daySelector_1b4jo_471",Zk="_dayButton_1b4jo_477",Jk="_recurringPreview_1b4jo_505",Me={content:ik,error:ok,staffDisplay:lk,staffAvatar:ck,staffInfo:dk,staffName:uk,staffRole:hk,noStaff:fk,section:mk,sectionLabel:pk,optional:gk,dateRow:_k,dateField:yk,label:vk,dateSeparator:xk,input:jk,duration:wk,footer:Sk,exportBtn:Ck,select:bk,dropZone:kk,dragging:Nk,dropZoneText:Dk,dropZoneHint:Ek,fileInput:$k,dividerRow:Tk,dividerLine:Mk,dividerText:Pk,importHeader:Ik,importActions:Lk,linkBtn:Ak,actionSeparator:Rk,eventsList:Bk,eventItem:Ok,selected:Fk,eventCheckbox:zk,eventInfo:Hk,eventSummary:Wk,eventDates:qk,eventDuration:Uk,recurringToggle:Vk,checkbox:Gk,recurringLabel:Yk,recurringOptions:Qk,recurringHint:Xk,daySelector:Kk,dayButton:Zk,recurringPreview:Jk};function eN(n){return(n.includes("\0")||n.charCodeAt(1)===0)&&(n=n.replace(/\x00/g,"")),n=n.replace(/^\uFEFF/,"").replace(/^\uFFFE/,""),n}function tN(n){n=eN(n);const s=[],r=n.replace(/\r\n /g,"").split(/\r?\n/);let i=!1,l={};for(const d of r)if(d==="BEGIN:VEVENT")i=!0,l={selected:!0};else if(d==="END:VEVENT")i=!1,l.startDate&&l.endDate&&s.push({summary:l.summary||"Vacation",startDate:l.startDate,endDate:l.endDate,selected:!0}),l={};else if(i)if(d.startsWith("DTSTART")){const u=Lm(d);u&&(l.startDate=u)}else if(d.startsWith("DTEND")){const u=Lm(d);if(u)if(d.includes("VALUE=DATE:")||!d.includes("T")){const p=new Date(u);p.setDate(p.getDate()-1),l.endDate=p.toISOString().split("T")[0]}else l.endDate=u}else d.startsWith("SUMMARY:")&&(l.summary=nN(d.substring(8)));return s}function Lm(n){const s=n.match(/VALUE=DATE:(\d{8})/);if(s){const i=s[1];return`${i.slice(0,4)}-${i.slice(4,6)}-${i.slice(6,8)}`}const r=n.match(/:(\d{8})(T\d{6}Z?)?/);if(r){const i=r[1];return`${i.slice(0,4)}-${i.slice(4,6)}-${i.slice(6,8)}`}return null}function nN(n){return n.replace(/\\n/g,`
`).replace(/\\,/g,",").replace(/\\;/g,";").replace(/\\\\/g,"\\")}const sN=f.memo(function({onCancel:s,onSaveAndExport:r,onSave:i,isSubmitting:l,canSubmit:d,isImportMode:u,importCount:h}){return e.jsxs("div",{className:Me.footer,children:[e.jsx(Ee,{type:"button",variant:"secondary",onClick:s,disabled:l,children:"Cancel"}),!u&&e.jsxs(Ee,{type:"button",variant:"secondary",onClick:r,disabled:l||!d,title:"Save vacation and export to Outlook calendar",className:Me.exportBtn,children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Save & Export to Outlook"]}),e.jsx(Ee,{type:"button",variant:"primary",onClick:i,disabled:l||!d,children:l?"Saving...":u?`Import ${h} vacation${h!==1?"s":""}`:"Save"})]})});function aN(){const{activeModal:n,editingVacation:s,modalContext:r,closeModal:i}=xe(),{staff:l,setVacations:d}=G(),u=G(G1),h=n==="vacation",p=!!s,[m,v]=f.useState(null),[y,b]=f.useState(""),[w,x]=f.useState(""),[_,S]=f.useState(!1),[C,B]=f.useState(null),[D,O]=f.useState(!1),[z,R]=f.useState([]),[Q,H]=f.useState(!1),[J,q]=f.useState([]),[E,L]=f.useState(!1),$=f.useRef(null),M=f.useRef(null),k=f.useRef(!1),P=f.useMemo(()=>m?l.find(ce=>ce.id===m):null,[l,m]),F=f.useMemo(()=>J.filter(ce=>ce.selected).length,[J]);f.useEffect(()=>{if(h&&!k.current){if(k.current=!0,H(!1),q([]),s){v(s.staff_id),b(jt(s.start_date)),x(jt(s.end_date));const ce=_i(s.description);ce?(O(!0),R(ce.daysOfWeek),M.current&&(M.current.value=ce.cleanDescription)):(O(!1),R([]),M.current&&(M.current.value=s.description||""))}else{v(r.staffId||null),O(!1),R([]);const ce=new Date,ae=new Date(ce);ae.setDate(ce.getDate()+((8-ce.getDay())%7||7));const ue=new Date(ae);ue.setDate(ae.getDate()+4),b(jt(ae.toISOString())),x(jt(ue.toISOString())),M.current&&(M.current.value="")}B(null)}h||(k.current=!1)},[h,s,r.staffId]);const A=f.useMemo(()=>{if(!y||!w)return 0;const ce=new Date(y),ue=new Date(w).getTime()-ce.getTime();return Math.ceil(ue/(1e3*60*60*24))+1},[y,w]),I=f.useCallback(()=>{i(),B(null),H(!1),q([])},[i]),U=f.useCallback(ce=>{if(!ce.name.toLowerCase().endsWith(".ics")){B("Please select an ICS file");return}const ae=new FileReader;ae.onload=ue=>{const we=ue.target?.result;try{const ie=tN(we);if(ie.length===0){B("No events found in the ICS file");return}q(ie),H(!0),B(null)}catch(ie){console.error("Failed to parse ICS:",ie),B("Failed to parse ICS file")}},ae.onerror=()=>{B("Failed to read file")},ae.readAsText(ce)},[]),N=f.useCallback(ce=>{const ae=ce.target.files?.[0];ae&&U(ae),ce.target.value=""},[U]),W=f.useCallback(ce=>{ce.preventDefault(),ce.stopPropagation(),L(!0)},[]),K=f.useCallback(ce=>{ce.preventDefault(),ce.stopPropagation(),L(!1)},[]),te=f.useCallback(ce=>{ce.preventDefault(),ce.stopPropagation(),L(!1);const ae=ce.dataTransfer.files?.[0];ae&&U(ae)},[U]),Y=f.useCallback(ce=>{q(ae=>ae.map((ue,we)=>we===ce?{...ue,selected:!ue.selected}:ue))},[]),me=f.useCallback(ce=>{q(ae=>ae.map(ue=>({...ue,selected:ce})))},[]),ge=f.useCallback(async()=>{const ce=M.current?.value||"";if(!m)return B("No staff member selected"),!1;if(!y||!w)return B("Please select start and end dates"),!1;if(new Date(y)>new Date(w))return B("Start date must be before end date"),!1;if(D&&z.length===0)return B("Please select at least one day for the recurring pattern"),!1;S(!0),B(null);try{const ae=D?x0(z,ce||"Recurring absence"):ce||"Vacation",ue={staff_id:m,start_date:y,end_date:w,description:ae};p&&s?await xy(s.id,ue):await om(ue);const we=await qo();return d(we),!0}catch(ae){return console.error("Failed to save vacation:",ae),B(ae instanceof Error?ae.message:"Failed to save vacation"),!1}finally{S(!1)}},[m,y,w,p,s,d,D,z]),pe=f.useCallback(async()=>{if(!m)return B("No staff member selected"),!1;const ce=J.filter(ae=>ae.selected);if(ce.length===0)return B("No events selected for import"),!1;S(!0),B(null);try{for(const ue of ce)await om({staff_id:m,start_date:ue.startDate,end_date:ue.endDate,description:ue.summary||"Vacation"});const ae=await qo();return d(ae),!0}catch(ae){return console.error("Failed to import vacations:",ae),B(ae instanceof Error?ae.message:"Failed to import vacations"),!1}finally{S(!1)}},[m,J,d]),oe=f.useCallback(async()=>{(Q?await pe():await ge())&&I()},[Q,pe,ge,I]),le=f.useCallback(()=>{const ce=P?.name||"Staff",ae=M.current?.value||"Vacation",ue=rN({summary:ae,description:`${ce} - Time Off`,startDate:new Date(y),endDate:new Date(w)}),we=new Blob([ue],{type:"text/calendar;charset=utf-8"}),ie=URL.createObjectURL(we),Ae=document.createElement("a");Ae.href=ie,Ae.download=`vacation-${ce.replace(/\s+/g,"-").toLowerCase()}-${y}.ics`,document.body.appendChild(Ae),Ae.click(),document.body.removeChild(Ae),URL.revokeObjectURL(ie)},[P?.name,y,w]),se=f.useCallback(async()=>{await ge()&&(le(),I())},[ge,le,I]),De=f.useCallback(()=>{H(!1),q([]),B(null)},[]),We=Q?!!m&&F>0:!!m&&!!y&&!!w,ot=f.useMemo(()=>e.jsx(sN,{onCancel:I,onSaveAndExport:se,onSave:oe,isSubmitting:_,canSubmit:We,isImportMode:Q,importCount:F}),[I,se,oe,_,We,Q,F]);return h?e.jsx(qt,{isOpen:h,onClose:I,title:p?"Edit Vacation":Q?"Import Vacations from ICS":"Add Vacation",size:"md",footer:ot,children:e.jsxs("div",{className:Me.content,children:[C&&e.jsx("div",{className:Me.error,children:C}),u&&!p?e.jsxs("div",{className:Me.section,children:[e.jsx("label",{className:Me.sectionLabel,children:"Staff Member"}),e.jsxs("select",{className:Me.select,value:m||"",onChange:ce=>v(ce.target.value?Number(ce.target.value):null),children:[e.jsx("option",{value:"",children:"Select staff member..."}),l.map(ce=>e.jsx("option",{value:ce.id,children:ce.name},ce.id))]})]}):P?e.jsxs("div",{className:Me.staffDisplay,children:[e.jsx("div",{className:Me.staffAvatar,children:P.name?.charAt(0).toUpperCase()||"?"}),e.jsxs("div",{className:Me.staffInfo,children:[e.jsx("div",{className:Me.staffName,children:P.name}),P.role&&e.jsx("div",{className:Me.staffRole,children:P.role})]})]}):e.jsxs("div",{className:Me.noStaff,children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"8",r:"4"}),e.jsx("path",{d:"M20 21a8 8 0 1 0-16 0"})]}),e.jsx("span",{children:"No staff member selected"})]}),Q?e.jsx(e.Fragment,{children:e.jsxs("div",{className:Me.section,children:[e.jsxs("div",{className:Me.importHeader,children:[e.jsxs("label",{className:Me.sectionLabel,children:["Events to Import (",F," of ",J.length," selected)"]}),e.jsxs("div",{className:Me.importActions,children:[e.jsx("button",{type:"button",className:Me.linkBtn,onClick:()=>me(!0),children:"Select All"}),e.jsx("span",{className:Me.actionSeparator,children:"|"}),e.jsx("button",{type:"button",className:Me.linkBtn,onClick:()=>me(!1),children:"Deselect All"}),e.jsx("span",{className:Me.actionSeparator,children:"|"}),e.jsx("button",{type:"button",className:Me.linkBtn,onClick:De,children:"Cancel Import"})]})]}),e.jsx("div",{className:Me.eventsList,children:J.map((ce,ae)=>e.jsxs("label",{className:`${Me.eventItem} ${ce.selected?Me.selected:""}`,children:[e.jsx("input",{type:"checkbox",checked:ce.selected,onChange:()=>Y(ae),className:Me.eventCheckbox}),e.jsxs("div",{className:Me.eventInfo,children:[e.jsx("div",{className:Me.eventSummary,children:ce.summary}),e.jsxs("div",{className:Me.eventDates,children:[Am(ce.startDate)," - ",Am(ce.endDate),e.jsxs("span",{className:Me.eventDuration,children:["(",Rm(ce.startDate,ce.endDate)," day",Rm(ce.startDate,ce.endDate)!==1?"s":"",")"]})]})]})]},ae))})]})}):e.jsxs(e.Fragment,{children:[!p&&e.jsxs("div",{className:`${Me.dropZone} ${E?Me.dragging:""}`,onDragOver:W,onDragLeave:K,onDrop:te,onClick:()=>$.current?.click(),children:[e.jsx("input",{ref:$,type:"file",accept:".ics",onChange:N,className:Me.fileInput}),e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),e.jsx("span",{className:Me.dropZoneText,children:"Drop ICS file here or click to browse"}),e.jsx("span",{className:Me.dropZoneHint,children:"Import vacation dates from Outlook or other calendar apps"})]}),e.jsxs("div",{className:Me.dividerRow,children:[e.jsx("span",{className:Me.dividerLine}),e.jsx("span",{className:Me.dividerText,children:p?"":"or enter manually"}),e.jsx("span",{className:Me.dividerLine})]}),e.jsxs("div",{className:Me.section,children:[e.jsx("label",{className:Me.sectionLabel,children:"Duration"}),e.jsxs("div",{className:Me.dateRow,children:[e.jsxs("div",{className:Me.dateField,children:[e.jsx("label",{className:Me.label,children:"From"}),e.jsx("input",{type:"date",className:Me.input,value:y,onChange:ce=>b(ce.target.value)})]}),e.jsx("div",{className:Me.dateSeparator,children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),e.jsx("polyline",{points:"12 5 19 12 12 19"})]})}),e.jsxs("div",{className:Me.dateField,children:[e.jsx("label",{className:Me.label,children:"To"}),e.jsx("input",{type:"date",className:Me.input,value:w,onChange:ce=>x(ce.target.value)})]})]}),A>0&&e.jsxs("div",{className:Me.duration,children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),A," day",A!==1?"s":""]})]}),e.jsxs("div",{className:Me.section,children:[e.jsxs("label",{className:Me.recurringToggle,children:[e.jsx("input",{type:"checkbox",checked:D,onChange:ce=>{O(ce.target.checked),ce.target.checked||R([])},className:Me.checkbox}),e.jsxs("span",{className:Me.recurringLabel,children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17 1l4 4-4 4"}),e.jsx("path",{d:"M3 11V9a4 4 0 0 1 4-4h14"}),e.jsx("path",{d:"M7 23l-4-4 4-4"}),e.jsx("path",{d:"M21 13v2a4 4 0 0 1-4 4H3"})]}),"Recurring Absence"]})]}),D&&e.jsxs("div",{className:Me.recurringOptions,children:[e.jsx("div",{className:Me.recurringHint,children:"Select which days of the week this person is unavailable within the date range above"}),e.jsx("div",{className:Me.daySelector,children:Op.map((ce,ae)=>e.jsx("button",{type:"button",className:`${Me.dayButton} ${z.includes(ae)?Me.selected:""}`,onClick:()=>{R(ue=>ue.includes(ae)?ue.filter(we=>we!==ae):[...ue,ae].sort((we,ie)=>we-ie))},children:ce},ce))}),z.length>0&&e.jsx("div",{className:Me.recurringPreview,children:Td(z)})]})]}),e.jsxs("div",{className:Me.section,children:[e.jsxs("label",{className:Me.sectionLabel,htmlFor:"vacation-description",children:["Description ",e.jsx("span",{className:Me.optional,children:"(optional)"})]}),e.jsx("input",{ref:M,id:"vacation-description",type:"text",className:Me.input,defaultValue:s?.description||"",placeholder:D?"e.g., Part-time, Childcare...":"e.g., Annual Leave, Personal Day...",autoComplete:"off"})]})]})]})}):null}function Am(n){return new Date(n).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}function Rm(n,s){const r=new Date(n),i=new Date(s);return Math.ceil((i.getTime()-r.getTime())/(1e3*60*60*24))+1}function rN(n){const{summary:s,description:r,startDate:i,endDate:l}=n,d=(v,y)=>{const b=v.getFullYear(),w=String(v.getMonth()+1).padStart(2,"0"),x=String(v.getDate()).padStart(2,"0");if(y)return`${b}${w}${x}`;const _=String(v.getUTCHours()).padStart(2,"0"),S=String(v.getUTCMinutes()).padStart(2,"0"),C=String(v.getUTCSeconds()).padStart(2,"0");return`${b}${w}${x}T${_}${S}${C}Z`},u=new Date(l);u.setDate(u.getDate()+1);const h=`vacation-${Date.now()}-${Array.from(crypto.getRandomValues(new Uint8Array(16))).map(v=>v.toString(36)).join("").slice(0,9)}@milestone`,p=d(new Date,!1);return["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Milestone//Vacation Export//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${h}`,`DTSTAMP:${p}`,`DTSTART;VALUE=DATE:${d(i,!0)}`,`DTEND;VALUE=DATE:${d(u,!0)}`,`SUMMARY:${Bm(s)}`,`DESCRIPTION:${Bm(r)}`,"STATUS:CONFIRMED","TRANSP:OPAQUE","X-MICROSOFT-CDO-BUSYSTATUS:OOF","X-MICROSOFT-CDO-ALLDAYEVENT:TRUE","END:VEVENT","END:VCALENDAR"].join(`\r
`)}function Bm(n){return n.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n")}const iN="_container_18znu_3",oN="_error_18znu_10",lN="_toolbar_18znu_19",cN="_yearSelector_18znu_28",dN="_label_18znu_34",uN="_select_18znu_40",hN="_toolbarActions_18znu_55",fN="_addForm_18znu_61",mN="_addFormRow_18znu_70",pN="_input_18znu_76",gN="_addFormActions_18znu_94",_N="_holidaysList_18znu_101",yN="_loading_18znu_107",vN="_empty_18znu_108",xN="_section_18znu_118",jN="_sectionTitle_18znu_122",wN="_holidayItems_18znu_131",SN="_holidayItem_18znu_131",CN="_custom_18znu_148",bN="_holidayDate_18znu_153",kN="_holidayName_18znu_159",NN="_deleteBtn_18znu_163",DN="_footer_18znu_184",EN="_footerInfo_18znu_192",at={container:iN,error:oN,toolbar:lN,yearSelector:cN,label:dN,select:uN,toolbarActions:hN,addForm:fN,addFormRow:mN,input:pN,addFormActions:gN,holidaysList:_N,loading:yN,empty:vN,section:xN,sectionTitle:jN,holidayItems:wN,holidayItem:SN,custom:CN,holidayDate:bN,holidayName:kN,deleteBtn:NN,footer:DN,footerInfo:EN};function $N(){const{activeModal:n,closeModal:s}=xe(),{currentSite:r,bankHolidays:i,setBankHolidays:l}=G(),d=n==="bankHoliday",[u,h]=f.useState(new Date().getFullYear()),[p,m]=f.useState(!1),[v,y]=f.useState(!1),[b,w]=f.useState(null),[x,_]=f.useState(""),[S,C]=f.useState(""),[B,D]=f.useState(""),O=f.useMemo(()=>{const k=new Date().getFullYear();return[k-1,k,k+1,k+2]},[]),z=f.useMemo(()=>i.filter(k=>new Date(k.date).getFullYear()===u).sort((k,P)=>new Date(k.date).getTime()-new Date(P.date).getTime()),[i,u]),R=z.filter(k=>k.is_custom),Q=z.filter(k=>!k.is_custom);f.useEffect(()=>{d&&r&&H()},[d,r,u]);const H=async()=>{if(r){m(!0),w(null);try{const k=await sa(r.id,u);l(k,gs(k))}catch(k){console.error("Failed to load holidays:",k),w("Failed to load holidays")}finally{m(!1)}}},J=async()=>{if(r){m(!0),w(null);try{const k=await pp(r.id);l(k,gs(k))}catch(k){console.error("Failed to refresh holidays:",k),w("Failed to refresh holidays from API")}finally{m(!1)}}},q=async k=>{if(k.preventDefault(),!(!r||!x||!B)){m(!0),w(null);try{await py(r.id,{date:x,end_date:S||void 0,name:B});const P=await sa(r.id);l(P,gs(P)),_(""),C(""),D(""),y(!1)}catch(P){console.error("Failed to add holiday:",P),w("Failed to add custom holiday")}finally{m(!1)}}},E=async k=>{if(r&&window.confirm(`Delete "${k.name}"?`)){m(!0),w(null);try{await gy(r.id,k.id);const P=await sa(r.id);l(P,gs(P))}catch(P){console.error("Failed to delete holiday:",P),w("Failed to delete holiday")}finally{m(!1)}}},L=()=>{if(z.length===0)return;const k=TN(z,r?.name||"Site"),P=new Blob([k],{type:"text/calendar;charset=utf-8"}),F=URL.createObjectURL(P),A=document.createElement("a");A.href=F,A.download=`bank-holidays-${r?.name?.toLowerCase().replace(/\s+/g,"-")||"site"}-${u}.ics`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(F)},$=()=>{s(),y(!1),w(null)},M=k=>new Date(k).toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"});return d?e.jsx(qt,{isOpen:d,onClose:$,title:`Bank Holidays - ${r?.name||""}`,size:"md",children:e.jsxs("div",{className:at.container,children:[b&&e.jsx("div",{className:at.error,children:b}),e.jsxs("div",{className:at.toolbar,children:[e.jsxs("div",{className:at.yearSelector,children:[e.jsx("label",{className:at.label,children:"Year:"}),e.jsx("select",{className:at.select,value:u,onChange:k=>h(parseInt(k.target.value,10)),children:O.map(k=>e.jsx("option",{value:k,children:k},k))})]}),e.jsxs("div",{className:at.toolbarActions,children:[e.jsx(Ee,{variant:"secondary",size:"sm",onClick:J,disabled:p,title:"Refresh from Nager.Date API",children:p?"Refreshing...":"Refresh"}),e.jsx(Ee,{variant:"secondary",size:"sm",onClick:L,disabled:z.length===0,title:"Export all holidays to ICS",children:"Export ICS"}),e.jsx(Ee,{variant:"primary",size:"sm",onClick:()=>y(!0),disabled:v,children:"Add Custom"})]})]}),v&&e.jsxs("form",{onSubmit:q,className:at.addForm,children:[e.jsxs("div",{className:at.addFormRow,children:[e.jsx("input",{type:"text",className:at.input,placeholder:"Holiday name...",value:B,onChange:k=>D(k.target.value),required:!0}),e.jsx("input",{type:"date",className:at.input,value:x,onChange:k=>_(k.target.value),required:!0}),e.jsx("input",{type:"date",className:at.input,value:S,onChange:k=>C(k.target.value),placeholder:"End date (optional)"})]}),e.jsxs("div",{className:at.addFormActions,children:[e.jsx(Ee,{type:"button",variant:"secondary",size:"sm",onClick:()=>y(!1),children:"Cancel"}),e.jsx(Ee,{type:"submit",variant:"primary",size:"sm",disabled:p||!B||!x,children:"Add"})]})]}),e.jsx("div",{className:at.holidaysList,children:p&&z.length===0?e.jsx("div",{className:at.loading,children:"Loading holidays..."}):z.length===0?e.jsxs("div",{className:at.empty,children:["No holidays for ",u]}):e.jsxs(e.Fragment,{children:[Q.length>0&&e.jsxs("div",{className:at.section,children:[e.jsxs("h3",{className:at.sectionTitle,children:["Public Holidays (",Q.length,")"]}),e.jsx("div",{className:at.holidayItems,children:Q.map(k=>e.jsxs("div",{className:at.holidayItem,children:[e.jsxs("div",{className:at.holidayDate,children:[M(k.date),k.end_date&&k.end_date!==k.date&&e.jsxs("span",{children:[" - ",M(k.end_date)]})]}),e.jsx("div",{className:at.holidayName,children:k.name})]},k.id))})]}),R.length>0&&e.jsxs("div",{className:at.section,children:[e.jsxs("h3",{className:at.sectionTitle,children:["Custom Holidays (",R.length,")"]}),e.jsx("div",{className:at.holidayItems,children:R.map(k=>e.jsxs("div",{className:`${at.holidayItem} ${at.custom}`,children:[e.jsxs("div",{className:at.holidayDate,children:[M(k.date),k.end_date&&k.end_date!==k.date&&e.jsxs("span",{children:[" - ",M(k.end_date)]})]}),e.jsx("div",{className:at.holidayName,children:k.name}),e.jsx("button",{className:at.deleteBtn,onClick:()=>E(k),title:"Delete custom holiday",children:""})]},k.id))})]})]})}),e.jsxs("div",{className:at.footer,children:[e.jsx("span",{className:at.footerInfo,children:r?.country_code?`Country: ${r.country_code}`:"No country configured"}),e.jsx(Ee,{variant:"secondary",onClick:$,children:"Close"})]})]})}):null}function TN(n,s){const r=["BEGIN:VCALENDAR","VERSION:2.0",`PRODID:-//Milestone//${s} Holidays//EN`,"CALSCALE:GREGORIAN","METHOD:PUBLISH"];return n.forEach(i=>{const l=new Date(i.date),d=i.end_date?new Date(i.end_date):l,u=new Date(d);u.setDate(u.getDate()+1);const h=v=>{const y=v.getFullYear(),b=String(v.getMonth()+1).padStart(2,"0"),w=String(v.getDate()).padStart(2,"0");return`${y}${b}${w}`},p=`holiday-${i.id}-${Date.now()}@milestone`,m=new Date().toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"");r.push("BEGIN:VEVENT",`UID:${p}`,`DTSTAMP:${m}`,`DTSTART;VALUE=DATE:${h(l)}`,`DTEND;VALUE=DATE:${h(u)}`,`SUMMARY:${Om(i.name)}`,`DESCRIPTION:${Om(`${s} - Bank Holiday`)}`,"STATUS:CONFIRMED","TRANSP:TRANSPARENT","END:VEVENT")}),r.push("END:VCALENDAR"),r.join(`\r
`)}function Om(n){return n.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n")}const MN="_error_17myg_3",PN="_formGroup_17myg_13",IN="_formRow_17myg_17",LN="_label_17myg_26",AN="_input_17myg_34",RN="_help_17myg_60",BN="_footer_17myg_66",vt={error:MN,formGroup:PN,formRow:IN,label:LN,input:AN,help:RN,footer:BN};function ON(){const{activeModal:n,closeModal:s}=xe(),r=G(C=>C.currentSite),i=G(C=>C.setBankHolidays),l=n==="customHoliday",[d,u]=f.useState(""),[h,p]=f.useState(""),[m,v]=f.useState(""),[y,b]=f.useState(!1),[w,x]=f.useState(null);f.useEffect(()=>{l&&(u(""),p(""),v(""),x(null))},[l]);const _=async()=>{if(!r){x("No site selected");return}if(!d.trim()){x("Please enter a holiday name");return}if(!h){x("Please select a start date");return}if(m&&m<h){x("End date must be on or after start date");return}b(!0),x(null);try{await fp(r.id,{name:d.trim(),date:h,end_date:m||void 0});const C=await sa(r.id),B=gs(C);i(C,B),s()}catch(C){x(C instanceof Error?C.message:"Failed to add custom holiday")}finally{b(!1)}},S=e.jsxs("div",{className:vt.footer,children:[e.jsx(Ee,{variant:"secondary",onClick:s,children:"Cancel"}),e.jsx(Ee,{variant:"primary",onClick:_,disabled:y,children:y?"Adding...":"Add Holiday"})]});return e.jsxs(qt,{isOpen:l,onClose:s,title:"Add Custom Holiday",size:"sm",footer:S,children:[w&&e.jsx("div",{className:vt.error,children:w}),e.jsxs("div",{className:vt.formGroup,children:[e.jsx("label",{className:vt.label,children:"Holiday Name"}),e.jsx("input",{type:"text",className:vt.input,value:d,onChange:C=>u(C.target.value),placeholder:"e.g., Company Anniversary",autoFocus:!0})]}),e.jsxs("div",{className:vt.formRow,children:[e.jsxs("div",{className:vt.formGroup,children:[e.jsx("label",{className:vt.label,children:"Start Date"}),e.jsx("input",{type:"date",className:vt.input,value:h,onChange:C=>p(C.target.value)})]}),e.jsxs("div",{className:vt.formGroup,children:[e.jsx("label",{className:vt.label,children:"End Date"}),e.jsx("input",{type:"date",className:vt.input,value:m,onChange:C=>v(C.target.value)})]})]}),e.jsxs("p",{className:vt.help,children:["Leave end date empty for a single-day holiday. Custom holidays will be applied to ",r?.name||"the current site"," only."]})]})}function FN(){const{activeModal:n,closeModal:s}=xe(),r=G(C=>C.currentSite),i=G(C=>C.setCompanyEvents),l=n==="companyEvent",[d,u]=f.useState(""),[h,p]=f.useState(""),[m,v]=f.useState(""),[y,b]=f.useState(!1),[w,x]=f.useState(null);f.useEffect(()=>{l&&(u(""),p(""),v(""),x(null))},[l]);const _=async()=>{if(!r){x("No site selected");return}if(!d.trim()){x("Please enter an event name");return}if(!h){x("Please select a start date");return}if(m&&m<h){x("End date must be on or after start date");return}b(!0),x(null);try{await _y(r.id,{name:d.trim(),date:h,end_date:m||void 0});const C=await ci(r.id),B=di(C);i(C,B),s()}catch(C){x(C instanceof Error?C.message:"Failed to add company event")}finally{b(!1)}},S=e.jsxs("div",{className:vt.footer,children:[e.jsx(Ee,{variant:"secondary",onClick:s,children:"Cancel"}),e.jsx(Ee,{variant:"primary",onClick:_,disabled:y,children:y?"Adding...":"Add Event"})]});return e.jsxs(qt,{isOpen:l,onClose:s,title:"Add Company Event",size:"sm",footer:S,children:[w&&e.jsx("div",{className:vt.error,children:w}),e.jsxs("div",{className:vt.formGroup,children:[e.jsx("label",{className:vt.label,children:"Event Name"}),e.jsx("input",{type:"text",className:vt.input,value:d,onChange:C=>u(C.target.value),placeholder:"e.g., ISO Audit, All-Hands Meeting",autoFocus:!0})]}),e.jsxs("div",{className:vt.formRow,children:[e.jsxs("div",{className:vt.formGroup,children:[e.jsx("label",{className:vt.label,children:"Start Date"}),e.jsx("input",{type:"date",className:vt.input,value:h,onChange:C=>p(C.target.value)})]}),e.jsxs("div",{className:vt.formGroup,children:[e.jsx("label",{className:vt.label,children:"End Date"}),e.jsx("input",{type:"date",className:vt.input,value:m,onChange:C=>v(C.target.value)})]})]}),e.jsx("p",{className:vt.help,children:"Company events are shown as red markers on the timeline. Unlike holidays, they do not affect working day calculations. Leave end date empty for a single-day event."})]})}const zN="_error_6ynm4_3",HN="_section_6ynm4_13",WN="_sectionTitle_6ynm4_28",qN="_formGroup_6ynm4_44",UN="_formRow_6ynm4_48",VN="_label_6ynm4_57",GN="_input_6ynm4_65",YN="_select_6ynm4_87",QN="_help_6ynm4_120",XN="_checkbox_6ynm4_126",KN="_footer_6ynm4_146",ZN="_warning_6ynm4_153",JN="_holidayStatusBox_6ynm4_177",eD="_holidayInfo_6ynm4_188",tD="_holidayCount_6ynm4_194",nD="_lastFetch_6ynm4_203",mt={error:zN,section:HN,sectionTitle:WN,formGroup:qN,formRow:UN,label:VN,input:GN,select:YN,help:QN,checkbox:XN,footer:KN,warning:ZN,holidayStatusBox:JN,holidayInfo:eD,holidayCount:tD,lastFetch:nD},Lo={europe:[{code:"AT",name:"Austria"},{code:"BE",name:"Belgium"},{code:"CH",name:"Switzerland"},{code:"CZ",name:"Czech Republic"},{code:"DE",name:"Germany"},{code:"DK",name:"Denmark"},{code:"ES",name:"Spain"},{code:"FI",name:"Finland"},{code:"FR",name:"France"},{code:"GB",name:"United Kingdom"},{code:"GR",name:"Greece"},{code:"HR",name:"Croatia"},{code:"HU",name:"Hungary"},{code:"IE",name:"Ireland"},{code:"IT",name:"Italy"},{code:"NL",name:"Netherlands"},{code:"NO",name:"Norway"},{code:"PL",name:"Poland"},{code:"PT",name:"Portugal"},{code:"RO",name:"Romania"},{code:"SE",name:"Sweden"}],americas:[{code:"AR",name:"Argentina"},{code:"BR",name:"Brazil"},{code:"CA",name:"Canada"},{code:"CL",name:"Chile"},{code:"CO",name:"Colombia"},{code:"MX",name:"Mexico"},{code:"US",name:"United States"}],asiaPacific:[{code:"AU",name:"Australia"},{code:"CN",name:"China"},{code:"IN",name:"India"},{code:"JP",name:"Japan"},{code:"KR",name:"South Korea"},{code:"NZ",name:"New Zealand"},{code:"SG",name:"Singapore"}],africaMiddleEast:[{code:"AE",name:"United Arab Emirates"},{code:"IL",name:"Israel"},{code:"SA",name:"Saudi Arabia"},{code:"ZA",name:"South Africa"}]};function sD(){const{activeModal:n,editingSite:s,openModal:r}=xe(),i=G(F=>F.currentSite),l=G(F=>F.bankHolidays),d=G(F=>F.setBankHolidays),u=G(F=>F.setCurrentSite),h=G(F=>F.sites),p=G(F=>F.setSites),m=n==="site",v=s||i,[y,b]=f.useState(""),[w,x]=f.useState(""),[_,S]=f.useState(""),[C,B]=f.useState(""),[D,O]=f.useState(!0),[z,R]=f.useState(!1),[Q,H]=f.useState(!1),[J,q]=f.useState(null);f.useEffect(()=>{m&&v&&(b(v.name||""),x(v.city||""),S(v.country_code||""),B(v.region_code||""),O(v.active!==!1&&v.active!==0),q(null))},[m,v]);const E=l.filter(F=>v&&F.site_id===v.id).length,L=async()=>{if(v){if(!y.trim()){q("Site name is required");return}R(!0),q(null);try{const F=await my(v.id,{name:y.trim(),city:w.trim()||void 0,country_code:_||void 0,region_code:C.trim()||void 0,active:D}),A=h.map(I=>I.id===v.id?{...I,...F}:I);p(A),i?.id===v.id&&u({...i,...F}),r("manageSites")}catch(F){q(F instanceof Error?F.message:"Failed to save site")}finally{R(!1)}}},$=async()=>{if(v&&confirm("This will refresh bank holidays from the Nager.Date API. Continue?")){H(!0),q(null);try{const F=await pp(v.id),A=gs(F);d(F,A);const I=h.map(U=>U.id===v.id?{...U,last_holiday_fetch:new Date().toISOString()}:U);p(I),i?.id===v.id&&u({...i,last_holiday_fetch:new Date().toISOString()})}catch(F){q(F instanceof Error?F.message:"Failed to refresh holidays")}finally{H(!1)}}},M=()=>{r("manageSites")},k=e.jsxs("div",{className:mt.footer,children:[e.jsx(Ee,{variant:"secondary",onClick:M,children:"Back"}),e.jsx(Ee,{variant:"primary",onClick:L,disabled:z,children:z?"Saving...":"Save Changes"})]});if(!v)return null;const P=v.last_holiday_fetch?new Date(v.last_holiday_fetch).toLocaleDateString():"Never";return e.jsxs(qt,{isOpen:m,onClose:M,title:`Edit Site: ${v.name}`,size:"lg",footer:k,children:[J&&e.jsx("div",{className:mt.error,children:J}),e.jsxs("div",{className:mt.section,children:[e.jsx("h3",{className:mt.sectionTitle,children:"Site Details"}),e.jsxs("div",{className:mt.formGroup,children:[e.jsx("label",{className:mt.label,children:"Site Name"}),e.jsx("input",{type:"text",className:mt.input,value:y,onChange:F=>b(F.target.value),placeholder:"e.g., Winterthur HQ"})]}),e.jsxs("div",{className:mt.formGroup,children:[e.jsx("label",{className:mt.label,children:"City"}),e.jsx("input",{type:"text",className:mt.input,value:w,onChange:F=>x(F.target.value),placeholder:"e.g., Winterthur"})]}),e.jsxs("div",{className:mt.formRow,children:[e.jsxs("div",{className:mt.formGroup,children:[e.jsx("label",{className:mt.label,children:"Country"}),e.jsxs("select",{className:mt.select,value:_,onChange:F=>S(F.target.value),children:[e.jsx("option",{value:"",children:"Select country..."}),e.jsx("optgroup",{label:"Europe",children:Lo.europe.map(F=>e.jsxs("option",{value:F.code,children:[F.name," (",F.code,")"]},F.code))}),e.jsx("optgroup",{label:"Americas",children:Lo.americas.map(F=>e.jsxs("option",{value:F.code,children:[F.name," (",F.code,")"]},F.code))}),e.jsx("optgroup",{label:"Asia & Pacific",children:Lo.asiaPacific.map(F=>e.jsxs("option",{value:F.code,children:[F.name," (",F.code,")"]},F.code))}),e.jsx("optgroup",{label:"Africa & Middle East",children:Lo.africaMiddleEast.map(F=>e.jsxs("option",{value:F.code,children:[F.name," (",F.code,")"]},F.code))})]})]}),e.jsxs("div",{className:mt.formGroup,children:[e.jsx("label",{className:mt.label,children:"Region/State Code"}),e.jsx("input",{type:"text",className:mt.input,value:C,onChange:F=>B(F.target.value),placeholder:"e.g., ZH, HE, ARA"})]})]}),e.jsx("p",{className:mt.help,children:"Region codes vary by country. For Switzerland: ZH, BE, GE, etc. For Germany: BY, HE, NW, etc."}),e.jsx("div",{className:mt.checkbox,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:D,onChange:F=>O(F.target.checked)}),e.jsx("span",{children:"Active"})]})})]}),e.jsxs("div",{className:mt.section,children:[e.jsx("h3",{className:mt.sectionTitle,children:"Bank Holidays"}),_?e.jsxs("div",{className:mt.holidayStatusBox,children:[e.jsxs("div",{className:mt.holidayInfo,children:[e.jsxs("span",{className:mt.holidayCount,children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),E," bank holidays"]}),e.jsxs("span",{className:mt.lastFetch,children:["Last updated: ",P]})]}),e.jsxs(Ee,{variant:"secondary",size:"sm",onClick:$,disabled:Q,children:[e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:4},children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("polyline",{points:"1 20 1 14 7 14"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),Q?"Refreshing...":"Refresh"]})]}):e.jsxs("div",{className:mt.warning,children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),"Set a country code above to enable automatic bank holiday fetching"]}),e.jsx("p",{className:mt.help,children:"Bank holidays are fetched from the Nager.Date public API. Custom holidays can be added in the Staff View under the Bank Holidays section."})]})]})}const aD="_footer_nlv1i_3",rD="_error_nlv1i_8",iD="_siteList_nlv1i_18",oD="_empty_nlv1i_24",lD="_siteRow_nlv1i_31",cD="_inactive_nlv1i_43",dD="_siteInfo_nlv1i_47",uD="_siteName_nlv1i_52",hD="_siteCountry_nlv1i_58",fD="_siteActions_nlv1i_64",mD="_inactiveBadge_nlv1i_70",pD="_editBtn_nlv1i_78",gD="_addSection_nlv1i_97",_D="_addForm_nlv1i_102",yD="_input_nlv1i_107",vD="_help_nlv1i_127",pn={footer:aD,error:rD,siteList:iD,empty:oD,siteRow:lD,inactive:cD,siteInfo:dD,siteName:uD,siteCountry:hD,siteActions:fD,inactiveBadge:mD,editBtn:pD,addSection:gD,addForm:_D,input:yD,help:vD},xD={AT:"Austria",BE:"Belgium",CH:"Switzerland",CZ:"Czech Republic",DE:"Germany",DK:"Denmark",ES:"Spain",FI:"Finland",FR:"France",GB:"United Kingdom",GR:"Greece",HR:"Croatia",HU:"Hungary",IE:"Ireland",IT:"Italy",NL:"Netherlands",NO:"Norway",PL:"Poland",PT:"Portugal",RO:"Romania",SE:"Sweden",AR:"Argentina",BR:"Brazil",CA:"Canada",CL:"Chile",CO:"Colombia",MX:"Mexico",US:"United States",AU:"Australia",CN:"China",IN:"India",JP:"Japan",KR:"South Korea",NZ:"New Zealand",SG:"Singapore",AE:"UAE",IL:"Israel",SA:"Saudi Arabia",ZA:"South Africa"};function jD(n){return n?xD[n]||n:""}function wD(){const{activeModal:n,closeModal:s,setEditingSite:r,openModal:i}=xe(),l=G(C=>C.sites),d=G(C=>C.setSites),u=n==="manageSites"||n==="siteManagement",[h,p]=f.useState(""),[m,v]=f.useState(!1),[y,b]=f.useState(null),w=async()=>{if(!h.trim()){b("Please enter a site name");return}v(!0),b(null);try{const C=await fy({name:h.trim()});d([...l,C]),p("")}catch(C){b(C instanceof Error?C.message:"Failed to add site")}finally{v(!1)}},x=C=>{r(C),i("site")},_=()=>{p(""),b(null),s()},S=e.jsx("div",{className:pn.footer,children:e.jsx(Ee,{variant:"secondary",onClick:_,children:"Close"})});return e.jsxs(qt,{isOpen:u,onClose:_,title:"Site Management",footer:S,size:"md",children:[y&&e.jsx("div",{className:pn.error,children:y}),e.jsx("div",{className:pn.siteList,children:l.length===0?e.jsx("div",{className:pn.empty,children:"No sites configured. Add one below."}):l.map(C=>e.jsxs("div",{className:`${pn.siteRow} ${!C.active&&C.active!==void 0?pn.inactive:""}`,children:[e.jsxs("div",{className:pn.siteInfo,children:[e.jsx("div",{className:pn.siteName,children:C.name}),e.jsx("div",{className:pn.siteCountry,children:jD(C.country_code)||C.country_code||""})]}),e.jsxs("div",{className:pn.siteActions,children:[!C.active&&C.active!==void 0&&e.jsx("span",{className:pn.inactiveBadge,children:"Inactive"}),e.jsx("button",{className:pn.editBtn,onClick:()=>x(C),title:"Edit site",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})]})]},C.id))}),e.jsxs("div",{className:pn.addSection,children:[e.jsxs("div",{className:pn.addForm,children:[e.jsx("input",{type:"text",className:pn.input,placeholder:"New site name",value:h,onChange:C=>p(C.target.value),onKeyDown:C=>C.key==="Enter"&&w()}),e.jsx(Ee,{variant:"primary",onClick:w,disabled:m,children:"Add"})]}),e.jsx("p",{className:pn.help,children:"After adding, click the edit button to set country and region codes for automatic bank holidays."})]})]})}const SD="_container_1yt18_5",CD="_toolbar_1yt18_10",bD="_count_1yt18_19",kD="_error_1yt18_25",ND="_listWrapper_1yt18_36",DD="_loading_1yt18_41",ED="_empty_1yt18_42",$D="_emptyHint_1yt18_48",TD="_list_1yt18_36",MD="_skillItem_1yt18_59",PD="_skillInfo_1yt18_74",ID="_colorDot_1yt18_82",LD="_skillText_1yt18_89",AD="_skillName_1yt18_96",RD="_skillDesc_1yt18_101",BD="_skillActions_1yt18_109",OD="_actionBtn_1yt18_116",FD="_deleteBtn_1yt18_136",zD="_form_1yt18_145",HD="_formHeader_1yt18_151",WD="_backBtn_1yt18_166",qD="_field_1yt18_182",UD="_colorPicker_1yt18_215",VD="_colorOption_1yt18_222",GD="_selected_1yt18_235",YD="_customColor_1yt18_240",QD="_colorPreview_1yt18_259",XD="_previewDot_1yt18_269",KD="_previewText_1yt18_275",ZD="_formActions_1yt18_281",Ze={container:SD,toolbar:CD,count:bD,error:kD,listWrapper:ND,loading:DD,empty:ED,emptyHint:$D,list:TD,skillItem:MD,skillInfo:PD,colorDot:ID,skillText:LD,skillName:AD,skillDesc:RD,skillActions:BD,actionBtn:OD,deleteBtn:FD,form:zD,formHeader:HD,backBtn:WD,field:qD,colorPicker:UD,colorOption:VD,selected:GD,customColor:YD,colorPreview:QD,previewDot:XD,previewText:KD,formActions:ZD},Fm=["#3b82f6","#8b5cf6","#10b981","#f59e0b","#ef4444","#06b6d4","#ec4899","#84cc16","#f97316","#6366f1"];function JD({isOpen:n,onClose:s}){const r=G(D=>D.setSkills),[i,l]=f.useState([]),[d,u]=f.useState(!1),[h,p]=f.useState(null),[m,v]=f.useState(!1),[y,b]=f.useState(null),w=f.useCallback(async()=>{u(!0),b(null);try{const D=await or.getAll();l(D),r(D)}catch(D){console.error("Failed to load skills:",D),b("Failed to load skills")}finally{u(!1)}},[r]);f.useEffect(()=>{n&&w()},[n,w]);const x=D=>{p(D),v(!1)},_=()=>{p(null),v(!0)},S=()=>{p(null),v(!1)},C=async()=>{await w(),S()},B=async D=>{const O=i.find(R=>R.id===D);if(!(!O||!window.confirm(`Are you sure you want to delete "${O.name}"?

This will remove the skill from all users who have it assigned.`)))try{await or.delete(D),await w()}catch(R){console.error("Failed to delete skill:",R),b("Failed to delete skill")}};return e.jsx(qt,{isOpen:n,onClose:s,title:"Manage Skills",size:"md",children:e.jsx("div",{className:Ze.container,children:h||m?e.jsx(eE,{skill:h,onSave:C,onCancel:S}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:Ze.toolbar,children:[e.jsxs("span",{className:Ze.count,children:[i.length," skills"]}),e.jsxs(Ee,{onClick:_,children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Skill"]})]}),y&&e.jsx("div",{className:Ze.error,children:y}),e.jsx("div",{className:Ze.listWrapper,children:d?e.jsx("div",{className:Ze.loading,children:"Loading skills..."}):i.length===0?e.jsxs("div",{className:Ze.empty,children:[e.jsx("p",{children:"No skills defined yet"}),e.jsx("p",{className:Ze.emptyHint,children:'Click "Add Skill" to create your first skill'})]}):e.jsx("div",{className:Ze.list,children:i.map(D=>e.jsxs("div",{className:Ze.skillItem,children:[e.jsxs("div",{className:Ze.skillInfo,children:[e.jsx("span",{className:Ze.colorDot,style:{backgroundColor:D.color}}),e.jsxs("div",{className:Ze.skillText,children:[e.jsx("span",{className:Ze.skillName,children:D.name}),D.description&&e.jsx("span",{className:Ze.skillDesc,children:D.description})]})]}),e.jsxs("div",{className:Ze.skillActions,children:[e.jsx("button",{className:Ze.actionBtn,onClick:()=>x(D),title:"Edit skill",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),e.jsx("button",{className:`${Ze.actionBtn} ${Ze.deleteBtn}`,onClick:()=>B(D.id),title:"Delete skill",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})]},D.id))})})]})})})}function eE({skill:n,onSave:s,onCancel:r}){const i=!!n,[l,d]=f.useState(n?.name||""),[u,h]=f.useState(n?.description||""),[p,m]=f.useState(n?.color||Fm[0]),[v,y]=f.useState(!1),[b,w]=f.useState(null),x=async _=>{if(_.preventDefault(),w(null),!l.trim()){w("Skill name is required");return}y(!0);try{i&&n?await or.update(n.id,{name:l.trim(),description:u.trim()||void 0,color:p}):await or.create({name:l.trim(),description:u.trim()||void 0,color:p}),s()}catch(S){console.error("Failed to save skill:",S);let C="Failed to save skill";S instanceof Error&&(C=S.message),w(C)}finally{y(!1)}};return e.jsxs("form",{onSubmit:x,className:Ze.form,children:[e.jsxs("div",{className:Ze.formHeader,children:[e.jsx("h3",{children:i?"Edit Skill":"Add Skill"}),e.jsx("button",{type:"button",className:Ze.backBtn,onClick:r,children:" Back to list"})]}),b&&e.jsx("div",{className:Ze.error,children:b}),e.jsxs("div",{className:Ze.field,children:[e.jsx("label",{htmlFor:"skillName",children:"Name *"}),e.jsx("input",{type:"text",id:"skillName",value:l,onChange:_=>d(_.target.value),placeholder:"e.g., Project Management",required:!0,maxLength:100})]}),e.jsxs("div",{className:Ze.field,children:[e.jsx("label",{htmlFor:"skillDesc",children:"Description"}),e.jsx("input",{type:"text",id:"skillDesc",value:u,onChange:_=>h(_.target.value),placeholder:"Optional description"})]}),e.jsxs("div",{className:Ze.field,children:[e.jsx("label",{children:"Color"}),e.jsxs("div",{className:Ze.colorPicker,children:[Fm.map(_=>e.jsx("button",{type:"button",className:`${Ze.colorOption} ${p===_?Ze.selected:""}`,style:{backgroundColor:_},onClick:()=>m(_),title:_},_)),e.jsx("input",{type:"color",value:p,onChange:_=>m(_.target.value),className:Ze.customColor,title:"Custom color"})]}),e.jsxs("div",{className:Ze.colorPreview,children:[e.jsx("span",{className:Ze.previewDot,style:{backgroundColor:p}}),e.jsx("span",{className:Ze.previewText,children:l||"Skill Name"})]})]}),e.jsxs("div",{className:Ze.formActions,children:[e.jsx(Ee,{type:"button",variant:"secondary",onClick:r,disabled:v,children:"Cancel"}),e.jsx(Ee,{type:"submit",disabled:v,children:v?"Saving...":i?"Save Changes":"Create Skill"})]})]})}const tE="_container_1anr4_6",nE="_toolbar_1anr4_13",sE="_toolbarLeft_1anr4_24",aE="_toolbarRight_1anr4_30",rE="_resultCount_1anr4_36",iE="_filterWrapper_1anr4_42",oE="_filterTrigger_1anr4_46",lE="_hasFilters_1anr4_67",cE="_chevron_1anr4_73",dE="_open_1anr4_77",uE="_filterDropdown_1anr4_81",hE="_filterActions_1anr4_94",fE="_clearFilters_1anr4_100",mE="_filterGrid_1anr4_113",pE="_filterField_1anr4_119",gE="_tableWrapper_1anr4_147",_E="_table_1anr4_147",yE="_disabled_1anr4_186",vE="_nameCell_1anr4_191",xE="_nameInfo_1anr4_197",jE="_userName_1anr4_203",wE="_userEmail_1anr4_208",SE="_disabledBadge_1anr4_213",CE="_jobTitleCell_1anr4_224",bE="_noValue_1anr4_229",kE="_roleBadge_1anr4_234",NE="_skillsCell_1anr4_243",DE="_skillBadge_1anr4_250",EE="_moreSkills_1anr4_262",$E="_sitesCell_1anr4_269",TE="_editBtn_1anr4_279",ME="_loading_1anr4_300",PE="_empty_1anr4_301",IE="_form_1anr4_311",LE="_formHeader_1anr4_317",AE="_backBtn_1anr4_332",RE="_error_1anr4_348",BE="_formGrid_1anr4_358",OE="_field_1anr4_371",FE="_toggleLabel_1anr4_414",zE="_hint_1anr4_433",HE="_optionButtons_1anr4_505",WE="_optionButton_1anr4_505",qE="_selected_1anr4_530",UE="_addNew_1anr4_537",VE="_skillOption_1anr4_546",GE="_skillColorDot_1anr4_552",YE="_noOptions_1anr4_559",QE="_newItemInput_1anr4_566",XE="_confirmBtn_1anr4_587",KE="_cancelBtn_1anr4_588",ZE="_formActions_1anr4_684",JE="_rightActions_1anr4_693",e$="_sliderContainer_1anr4_701",t$="_slider_1anr4_701",n$="_sliderLabels_1anr4_743",Ce={container:tE,toolbar:nE,toolbarLeft:sE,toolbarRight:aE,resultCount:rE,filterWrapper:iE,filterTrigger:oE,hasFilters:lE,chevron:cE,open:dE,filterDropdown:uE,filterActions:hE,clearFilters:fE,filterGrid:mE,filterField:pE,tableWrapper:gE,table:_E,disabled:yE,nameCell:vE,nameInfo:xE,userName:jE,userEmail:wE,disabledBadge:SE,jobTitleCell:CE,noValue:bE,roleBadge:kE,skillsCell:NE,skillBadge:DE,moreSkills:EE,sitesCell:$E,editBtn:TE,loading:ME,empty:PE,form:IE,formHeader:LE,backBtn:AE,error:RE,formGrid:BE,field:OE,toggleLabel:FE,hint:zE,optionButtons:HE,optionButton:WE,selected:qE,addNew:UE,skillOption:VE,skillColorDot:GE,noOptions:YE,newItemInput:QE,confirmBtn:XE,cancelBtn:KE,formActions:ZE,rightActions:JE,sliderContainer:e$,slider:t$,sliderLabels:n$},ud={admin:{label:"Admin",color:"#ef4444"},superuser:{label:"SuperUser",color:"#f97316"},user:{label:"User",color:"#3b82f6"}};function s$(){const n=xe(se=>se.activeModal),s=xe(se=>se.closeModal),r=G(se=>se.sites),i=G(se=>se.skills),l=G(se=>se.currentUser),{refreshStaff:d}=ll(),u=n==="userManagement",[h,p]=f.useState(!1),[m,v]=f.useState([]),[y,b]=f.useState(!1),[w,x]=f.useState(null),[_,S]=f.useState(!1),[C,B]=f.useState(!1),[D,O]=f.useState("all"),[z,R]=f.useState("all"),[Q,H]=f.useState("active"),[J,q]=f.useState("all"),[E,L]=f.useState("all"),[$,M]=f.useState(!1),k=f.useRef(null),P=l?.role==="admin",F=l?.role==="superuser",A=P||F,I=f.useCallback(async()=>{b(!0);try{const se=await wy(!0);v(se)}catch(se){console.error("Failed to load users:",se)}finally{b(!1)}},[]);f.useEffect(()=>{u&&I()},[u,I]),f.useEffect(()=>{const se=De=>{k.current&&!k.current.contains(De.target)&&M(!1)};return $&&document.addEventListener("mousedown",se),()=>document.removeEventListener("mousedown",se)},[$]);const U=f.useMemo(()=>{const se=new Set;return m.forEach(De=>{De.job_title&&se.add(De.job_title)}),Array.from(se).sort()},[m]),N=f.useMemo(()=>m.filter(se=>{if(D!=="all"&&se.role!==D||z!=="all"&&se.job_title!==z||Q==="active"&&!se.active||Q==="disabled"&&se.active||J!=="all"&&!se.site_ids.includes(parseInt(J)))return!1;if(E!=="all"){const De=parseInt(E);if(!se.skills?.some(We=>We.id===De))return!1}return!0}),[m,D,z,Q,J,E]),W=f.useMemo(()=>{let se=0;return D!=="all"&&se++,z!=="all"&&se++,Q!=="active"&&se++,J!=="all"&&se++,E!=="all"&&se++,se},[D,z,Q,J,E]),K=()=>{O("all"),R("all"),H("active"),q("all"),L("all")},te=se=>!se||se.length===0?"":se.map(De=>r.find(We=>We.id===De)?.name).filter(Boolean).join(", "),Y=se=>{x(se),S(!1)},me=()=>{x(null),S(!0)},ge=()=>{x(null),S(!1)},pe=async()=>{await I(),p(!0),ge()},oe=async()=>{await I(),p(!0),ge()},le=async()=>{h&&(await d(),p(!1)),s()};return e.jsxs(e.Fragment,{children:[e.jsx(qt,{isOpen:u,onClose:le,title:"User Management",size:"xxl",children:e.jsx("div",{className:Ce.container,children:w||_?e.jsx(a$,{user:w,sites:r,skills:i,currentUser:l,onSave:pe,onDelete:oe,onCancel:ge}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:Ce.toolbar,children:[e.jsxs("div",{className:Ce.toolbarLeft,children:[e.jsxs("div",{ref:k,className:Ce.filterWrapper,children:[e.jsxs("button",{className:`${Ce.filterTrigger} ${W>0?Ce.hasFilters:""}`,onClick:()=>M(!$),children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),e.jsx("span",{children:W>0?`${W} filter${W>1?"s":""}`:"Filter"}),e.jsx("svg",{className:`${Ce.chevron} ${$?Ce.open:""}`,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),$&&e.jsxs("div",{className:Ce.filterDropdown,children:[W>0&&e.jsx("div",{className:Ce.filterActions,children:e.jsx("button",{className:Ce.clearFilters,onClick:K,children:"Clear all filters"})}),e.jsxs("div",{className:Ce.filterGrid,children:[e.jsxs("div",{className:Ce.filterField,children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:Q,onChange:se=>H(se.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"disabled",children:"Disabled"})]})]}),e.jsxs("div",{className:Ce.filterField,children:[e.jsx("label",{children:"Role"}),e.jsxs("select",{value:D,onChange:se=>O(se.target.value),children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"superuser",children:"SuperUser"}),e.jsx("option",{value:"user",children:"User"})]})]}),e.jsxs("div",{className:Ce.filterField,children:[e.jsx("label",{children:"Job Title"}),e.jsxs("select",{value:z,onChange:se=>R(se.target.value),children:[e.jsx("option",{value:"all",children:"All Job Titles"}),U.map(se=>e.jsx("option",{value:se,children:se},se))]})]}),e.jsxs("div",{className:Ce.filterField,children:[e.jsx("label",{children:"Site"}),e.jsxs("select",{value:J,onChange:se=>q(se.target.value),children:[e.jsx("option",{value:"all",children:"All Sites"}),r.map(se=>e.jsx("option",{value:se.id,children:se.name},se.id))]})]}),e.jsxs("div",{className:Ce.filterField,children:[e.jsx("label",{children:"Skill"}),e.jsxs("select",{value:E,onChange:se=>L(se.target.value),children:[e.jsx("option",{value:"all",children:"All Skills"}),i.map(se=>e.jsx("option",{value:se.id,children:se.name},se.id))]})]})]})]})]}),e.jsxs("span",{className:Ce.resultCount,children:[N.length," user",N.length!==1?"s":"",W>0&&` (filtered from ${m.length})`]})]}),e.jsx("div",{className:Ce.toolbarRight,children:A&&e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{variant:"secondary",onClick:()=>B(!0),children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"6px"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),"Manage Skills"]}),e.jsxs(Ee,{onClick:me,children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"6px"},children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add User"]})]})})]}),e.jsx("div",{className:Ce.tableWrapper,children:y?e.jsx("div",{className:Ce.loading,children:"Loading users..."}):N.length===0?e.jsx("div",{className:Ce.empty,children:W>0?"No users match the selected filters":"No users found"}):e.jsxs("table",{className:Ce.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Job Title"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Skills"}),e.jsx("th",{children:"Sites"}),e.jsx("th",{style:{width:60}})]})}),e.jsx("tbody",{children:N.map(se=>e.jsxs("tr",{className:se.active?"":Ce.disabled,children:[e.jsx("td",{children:e.jsxs("div",{className:Ce.nameCell,children:[e.jsxs("div",{className:Ce.nameInfo,children:[e.jsxs("span",{className:Ce.userName,children:[se.first_name," ",se.last_name]}),e.jsx("span",{className:Ce.userEmail,children:se.email})]}),!se.active&&e.jsx("span",{className:Ce.disabledBadge,children:"Disabled"})]})}),e.jsx("td",{className:Ce.jobTitleCell,children:se.job_title||e.jsx("span",{className:Ce.noValue,children:""})}),e.jsx("td",{children:e.jsx("span",{className:Ce.roleBadge,style:{backgroundColor:`${ud[se.role].color}20`,color:ud[se.role].color},children:ud[se.role].label})}),e.jsx("td",{children:e.jsx("div",{className:Ce.skillsCell,children:se.skills&&se.skills.length>0?e.jsxs(e.Fragment,{children:[se.skills.slice(0,3).map(De=>e.jsx("span",{className:Ce.skillBadge,style:{backgroundColor:`${De.color}20`,color:De.color},title:De.name,children:De.name},De.id)),se.skills.length>3&&e.jsxs("span",{className:Ce.moreSkills,children:["+",se.skills.length-3]})]}):e.jsx("span",{className:Ce.noValue,children:""})})}),e.jsx("td",{className:Ce.sitesCell,title:te(se.site_ids),children:te(se.site_ids)}),e.jsx("td",{children:e.jsx("button",{className:Ce.editBtn,onClick:()=>Y(se),title:"Edit user",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})})]},se.id))})]})})]})})}),e.jsx(JD,{isOpen:C,onClose:()=>B(!1)})]})}function a$({user:n,sites:s,skills:r,currentUser:i,onSave:l,onDelete:d,onCancel:u}){const h=!!n,p=i?.role==="admin",m=i?.role==="superuser",[v,y]=f.useState(n?.first_name||""),[b,w]=f.useState(n?.last_name||""),[x,_]=f.useState(n?.email||""),[S,C]=f.useState(""),[B,D]=f.useState(n?.job_title||""),[O,z]=f.useState(n?.role||"user"),[R,Q]=f.useState(n?.max_capacity??100),[H,J]=f.useState(n?.active??!0),[q,E]=f.useState(n?.site_ids||[]),[L,$]=f.useState(n?.skills?.map(ce=>ce.id)||[]),[M,k]=f.useState(!1),[P,F]=f.useState(""),[A,I]=f.useState(!1),U=G(ce=>ce.setSkills),[N,W]=f.useState(!1),[K,te]=f.useState(null),Y=p,me=p||m,ge=p,pe=h&&(p&&n?.id!==i?.id||m&&n?.role!=="admin"),oe=ce=>{E(ae=>ae.includes(ce)?ae.filter(ue=>ue!==ce):[...ae,ce])},le=ce=>{$(ae=>ae.includes(ce)?ae.filter(ue=>ue!==ce):[...ae,ce])},se=async()=>{if(P.trim()){I(!0);try{const{skillsApi:ce}=await zo(async()=>{const{skillsApi:we}=await Promise.resolve().then(()=>Ty);return{skillsApi:we}},void 0),ae=await ce.create({name:P.trim(),color:"#6366f1"}),ue=await ce.getAll();U(ue),$(we=>[...we,ae.id]),k(!1),F("")}catch(ce){console.error("Failed to create skill:",ce),te(ce instanceof Error?ce.message:"Failed to create skill")}finally{I(!1)}}},De=()=>{k(!1),F("")},We=async ce=>{if(ce.preventDefault(),te(null),!v.trim()||!b.trim()||!x.trim()){te("Please fill in all required fields");return}if(!h&&!S){te("Password is required for new users");return}if(!h&&S.length<6){te("Password must be at least 6 characters");return}W(!0);try{if(h&&n){const ae={first_name:v.trim(),last_name:b.trim(),email:x.trim(),job_title:B.trim()||void 0,role:O,max_capacity:R,active:H,site_ids:q,skill_ids:L};S&&(ae.password=S),await Cy(n.id,ae)}else{const ae={first_name:v.trim(),last_name:b.trim(),email:x.trim(),password:S,job_title:B.trim()||void 0,role:O,max_capacity:R,site_ids:q,skill_ids:L};await Sy(ae)}l()}catch(ae){console.error("Failed to save user:",ae),te(ae instanceof Error?ae.message:"Failed to save user")}finally{W(!1)}},ot=async()=>{if(!(!n||!window.confirm(`Are you sure you want to delete "${n.first_name} ${n.last_name}"?

This action cannot be undone.`))){W(!0);try{await by(n.id),d()}catch(ae){console.error("Failed to delete user:",ae),te(ae instanceof Error?ae.message:"Failed to delete user")}finally{W(!1)}}};return e.jsxs("form",{onSubmit:We,className:Ce.form,children:[e.jsxs("div",{className:Ce.formHeader,children:[e.jsx("h3",{children:h?"Edit User":"Add User"}),e.jsx("button",{type:"button",className:Ce.backBtn,onClick:u,children:" Back to list"})]}),K&&e.jsx("div",{className:Ce.error,children:K}),e.jsxs("div",{className:Ce.formGrid,children:[e.jsxs("div",{className:Ce.field,children:[e.jsx("label",{htmlFor:"firstName",children:"First Name *"}),e.jsx("input",{type:"text",id:"firstName",value:v,onChange:ce=>y(ce.target.value),placeholder:"Enter first name",required:!0})]}),e.jsxs("div",{className:Ce.field,children:[e.jsx("label",{htmlFor:"lastName",children:"Last Name *"}),e.jsx("input",{type:"text",id:"lastName",value:b,onChange:ce=>w(ce.target.value),placeholder:"Enter last name",required:!0})]}),e.jsxs("div",{className:Ce.field,children:[e.jsx("label",{htmlFor:"email",children:"Email *"}),e.jsx("input",{type:"email",id:"email",value:x,onChange:ce=>_(ce.target.value),placeholder:"Enter email address",required:!0})]}),e.jsxs("div",{className:Ce.field,children:[e.jsxs("label",{htmlFor:"password",children:["Password ",h?"(leave blank to keep)":"*"]}),e.jsx("input",{type:"password",id:"password",value:S,onChange:ce=>C(ce.target.value),placeholder:h?"":"Min 6 characters",required:!h,minLength:6})]}),e.jsxs("div",{className:Ce.field,children:[e.jsx("label",{htmlFor:"jobTitle",children:"Job Title"}),e.jsx("input",{type:"text",id:"jobTitle",value:B,onChange:ce=>D(ce.target.value),placeholder:"e.g., Project Manager"})]}),e.jsxs("div",{className:Ce.field,children:[e.jsxs("label",{htmlFor:"maxCapacity",children:["Max Capacity: ",R,"%"]}),e.jsxs("div",{className:Ce.sliderContainer,children:[e.jsx("input",{type:"range",className:Ce.slider,id:"maxCapacity",min:"5",max:"100",step:"5",value:R,onChange:ce=>Q(parseInt(ce.target.value))}),e.jsxs("div",{className:Ce.sliderLabels,children:[e.jsx("span",{children:"5%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"100%"})]})]}),e.jsx("span",{className:Ce.hint,children:R<100?`Part-time worker (${R}% capacity)`:"Full-time worker"})]}),e.jsxs("div",{className:Ce.field,children:[e.jsx("label",{htmlFor:"role",children:"Role *"}),e.jsxs("select",{id:"role",value:O,onChange:ce=>z(ce.target.value),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"superuser",disabled:!me,children:"SuperUser"}),e.jsxs("option",{value:"admin",disabled:!Y,children:["Admin ",Y?"":"(admin only)"]})]})]}),h&&e.jsxs("div",{className:Ce.field,children:[e.jsx("label",{children:"Status"}),e.jsxs("label",{className:Ce.toggleLabel,children:[e.jsx("input",{type:"checkbox",checked:H,onChange:ce=>J(ce.target.checked),disabled:!pe}),e.jsx("span",{children:"Active"})]}),!pe&&e.jsx("span",{className:Ce.hint,children:n?.id===i?.id?"Can't disable yourself":"Insufficient permissions"})]})]}),e.jsxs("div",{className:Ce.field,children:[e.jsx("label",{children:"Site Assignments"}),e.jsxs("div",{className:Ce.optionButtons,children:[s.map(ce=>e.jsx("button",{type:"button",className:`${Ce.optionButton} ${q.includes(ce.id)?Ce.selected:""}`,onClick:()=>oe(ce.id),children:ce.name},ce.id)),s.length===0&&e.jsx("span",{className:Ce.noOptions,children:"No sites available"})]}),e.jsx("span",{className:Ce.hint,children:"Select which sites this user can access"})]}),e.jsxs("div",{className:Ce.field,children:[e.jsx("label",{children:"Skills"}),e.jsxs("div",{className:Ce.optionButtons,children:[r.map(ce=>e.jsxs("button",{type:"button",className:`${Ce.optionButton} ${Ce.skillOption} ${L.includes(ce.id)?Ce.selected:""}`,onClick:()=>le(ce.id),style:{"--skill-color":ce.color},children:[e.jsx("span",{className:Ce.skillColorDot,style:{backgroundColor:ce.color}}),ce.name]},ce.id)),M?e.jsxs("div",{className:Ce.newItemInput,children:[e.jsx("input",{type:"text",value:P,onChange:ce=>F(ce.target.value),placeholder:"New skill name",autoFocus:!0,disabled:A,onKeyDown:ce=>{ce.key==="Enter"?(ce.preventDefault(),se()):ce.key==="Escape"&&De()}}),e.jsx("button",{type:"button",className:Ce.confirmBtn,onClick:se,disabled:A,children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("button",{type:"button",className:Ce.cancelBtn,onClick:De,disabled:A,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}):e.jsx("button",{type:"button",className:`${Ce.optionButton} ${Ce.addNew}`,onClick:()=>k(!0),children:"+ New skill"})]}),e.jsx("span",{className:Ce.hint,children:"Click to toggle skills. Skills are shared across all users."})]}),e.jsxs("div",{className:Ce.formActions,children:[h&&ge&&e.jsx(Ee,{type:"button",variant:"danger",onClick:ot,disabled:N,children:"Delete User"}),e.jsxs("div",{className:Ce.rightActions,children:[e.jsx(Ee,{type:"button",variant:"secondary",onClick:u,disabled:N,children:"Cancel"}),e.jsx(Ee,{type:"submit",disabled:N,children:N?"Saving...":h?"Save Changes":"Create User"})]})]})]})}const r$="_container_1s6nv_5",i$="_loading_1s6nv_11",o$="_error_1s6nv_17",l$="_success_1s6nv_26",c$="_toggleSection_1s6nv_36",d$="_toggle_1s6nv_36",u$="_toggleSwitch_1s6nv_52",h$="_toggleLabel_1s6nv_81",f$="_section_1s6nv_87",m$="_field_1s6nv_103",p$="_hint_1s6nv_143",g$="_checkbox_1s6nv_150",_$="_actions_1s6nv_170",Lt={container:r$,loading:i$,error:o$,success:l$,toggleSection:c$,toggle:d$,toggleSwitch:u$,toggleLabel:h$,section:f$,field:m$,hint:p$,checkbox:g$,actions:_$};function y$(){const n=xe(P=>P.activeModal),s=xe(P=>P.closeModal),r=G(P=>P.currentUser),i=n==="ssoConfig",l=r?.role==="admin",[d,u]=f.useState(!1),[h,p]=f.useState(""),[m,v]=f.useState(""),[y,b]=f.useState(""),[w,x]=f.useState(""),[_,S]=f.useState(""),[C,B]=f.useState(!1),[D,O]=f.useState("user"),[z,R]=f.useState(!1),[Q,H]=f.useState(!1),[J,q]=f.useState(null),[E,L]=f.useState(null),$=typeof window<"u"?`${window.location.origin}/api/auth/sso/callback`:"/api/auth/sso/callback";f.useEffect(()=>{i&&l&&M()},[i,l]);const M=async()=>{R(!0),q(null);try{const P=await Je("/api/sso/config/full");u(P.enabled),p(P.tenant_id||""),v(P.client_id||""),x(P.client_secret_masked||"Enter client secret"),S(P.redirect_uri||$),B(P.auto_create_users),O(P.default_role||"user")}catch(P){console.error("Failed to load SSO config:",P),q(P instanceof Error?P.message:"Failed to load configuration")}finally{R(!1)}},k=async()=>{if(q(null),L(null),d&&(!h.trim()||!m.trim()||!_.trim())){q("Please fill in Tenant ID, Client ID, and Redirect URI to enable SSO");return}H(!0);try{const P={enabled:d,tenant_id:h.trim(),client_id:m.trim(),redirect_uri:_.trim(),auto_create_users:C,default_role:D};y&&(P.client_secret=y),await wt("/api/sso/config",P),L("SSO configuration saved successfully"),b(""),await M()}catch(P){console.error("Failed to save SSO config:",P),q(P instanceof Error?P.message:"Failed to save configuration")}finally{H(!1)}};return l?e.jsx(qt,{isOpen:i,onClose:s,title:"SSO Configuration",size:"md",children:e.jsx("div",{className:Lt.container,children:z?e.jsx("div",{className:Lt.loading,children:"Loading configuration..."}):e.jsxs(e.Fragment,{children:[J&&e.jsx("div",{className:Lt.error,children:J}),E&&e.jsx("div",{className:Lt.success,children:E}),e.jsxs("div",{className:Lt.toggleSection,children:[e.jsxs("label",{className:Lt.toggle,children:[e.jsx("input",{type:"checkbox",checked:d,onChange:P=>u(P.target.checked)}),e.jsx("span",{className:Lt.toggleSwitch}),e.jsx("span",{className:Lt.toggleLabel,children:"Enable SSO"})]}),e.jsx("p",{className:Lt.hint,children:"When enabled, users can sign in using Microsoft Entra (Azure AD)."})]}),e.jsxs("div",{className:Lt.section,children:[e.jsx("h4",{children:"Microsoft Entra Settings"}),e.jsxs("div",{className:Lt.field,children:[e.jsx("label",{htmlFor:"tenantId",children:"Tenant ID *"}),e.jsx("input",{type:"text",id:"tenantId",value:h,onChange:P=>p(P.target.value),placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",disabled:!d}),e.jsx("span",{className:Lt.hint,children:"Found in Azure Portal  Microsoft Entra ID  Overview"})]}),e.jsxs("div",{className:Lt.field,children:[e.jsx("label",{htmlFor:"clientId",children:"Client ID (Application ID) *"}),e.jsx("input",{type:"text",id:"clientId",value:m,onChange:P=>v(P.target.value),placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",disabled:!d}),e.jsx("span",{className:Lt.hint,children:"Found in App Registration  Overview  Application (client) ID"})]}),e.jsxs("div",{className:Lt.field,children:[e.jsx("label",{htmlFor:"clientSecret",children:"Client Secret"}),e.jsx("input",{type:"password",id:"clientSecret",value:y,onChange:P=>b(P.target.value),placeholder:w||"Enter client secret",disabled:!d}),e.jsx("span",{className:Lt.hint,children:"Leave blank to keep existing secret. Create in App Registration  Certificates & secrets"})]}),e.jsxs("div",{className:Lt.field,children:[e.jsx("label",{htmlFor:"redirectUri",children:"Redirect URI *"}),e.jsx("input",{type:"text",id:"redirectUri",value:_,onChange:P=>S(P.target.value),placeholder:$,disabled:!d}),e.jsx("span",{className:Lt.hint,children:"Must be registered in App Registration  Authentication  Redirect URIs"})]})]}),e.jsxs("div",{className:Lt.section,children:[e.jsx("h4",{children:"User Management"}),e.jsxs("label",{className:Lt.checkbox,children:[e.jsx("input",{type:"checkbox",checked:C,onChange:P=>B(P.target.checked),disabled:!d}),e.jsx("span",{children:"Auto-create users on first SSO login"})]}),e.jsxs("div",{className:Lt.field,children:[e.jsx("label",{htmlFor:"defaultRole",children:"Default role for new users"}),e.jsxs("select",{id:"defaultRole",value:D,onChange:P=>O(P.target.value),disabled:!d||!C,children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"superuser",children:"SuperUser"}),e.jsx("option",{value:"admin",children:"Admin"})]})]})]}),e.jsxs("div",{className:Lt.actions,children:[e.jsx(Ee,{variant:"secondary",onClick:s,children:"Cancel"}),e.jsx(Ee,{onClick:k,disabled:Q,children:Q?"Saving...":"Save Configuration"})]})]})})}):null}const v$="_container_rlhcs_5",x$="_toolbar_rlhcs_10",j$="_count_rlhcs_19",w$="_error_rlhcs_25",S$="_listWrapper_rlhcs_36",C$="_loading_rlhcs_41",b$="_empty_rlhcs_42",k$="_emptyHint_rlhcs_48",N$="_list_rlhcs_36",D$="_typeItem_rlhcs_59",E$="_typeInfo_rlhcs_74",$$="_typeName_rlhcs_80",T$="_typeCount_rlhcs_85",M$="_typeActions_rlhcs_90",P$="_actionBtn_rlhcs_97",I$="_deleteBtn_rlhcs_122",L$="_infoNote_rlhcs_128",A$="_form_rlhcs_144",R$="_formHeader_rlhcs_150",B$="_backBtn_rlhcs_165",O$="_field_rlhcs_181",F$="_renameWarning_rlhcs_214",z$="_createNote_rlhcs_227",H$="_formActions_rlhcs_239",yt={container:v$,toolbar:x$,count:j$,error:w$,listWrapper:S$,loading:C$,empty:b$,emptyHint:k$,list:N$,typeItem:D$,typeInfo:E$,typeName:$$,typeCount:T$,typeActions:M$,actionBtn:P$,deleteBtn:I$,infoNote:L$,form:A$,formHeader:R$,backBtn:B$,field:O$,renameWarning:F$,createNote:z$,formActions:H$};function W$({isOpen:n,onClose:s,onTypesChanged:r}){const[i,l]=f.useState([]),[d,u]=f.useState([]),[h,p]=f.useState(!1),[m,v]=f.useState(null),[y,b]=f.useState(!1),[w,x]=f.useState(null),_=f.useCallback(async()=>{p(!0),x(null);try{const z=await Je("/api/equipment/all");u(z);const R=new Map;z.forEach(H=>{H.type&&R.set(H.type,(R.get(H.type)||0)+1)});const Q=Array.from(R.entries()).map(([H,J])=>({name:H,count:J})).sort((H,J)=>H.name.localeCompare(J.name));l(Q)}catch(z){console.error("Failed to load equipment types:",z),x("Failed to load equipment types")}finally{p(!1)}},[]);f.useEffect(()=>{n&&_()},[n,_]);const S=z=>{v(z),b(!1)},C=()=>{v(null),b(!0)},B=()=>{v(null),b(!1)},D=async()=>{await _(),r?.(),B()},O=async z=>{const R=i.find(Q=>Q.name===z);if(R){if(R.count>0){x(`Cannot delete "${z}": ${R.count} equipment item(s) still use this type. Change their type first.`);return}l(Q=>Q.filter(H=>H.name!==z))}};return e.jsx(qt,{isOpen:n,onClose:s,title:"Manage Equipment Types",size:"md",children:e.jsx("div",{className:yt.container,children:m||y?e.jsx(q$,{typeName:m,existingTypes:i.map(z=>z.name),allEquipment:d,onSave:D,onCancel:B}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:yt.toolbar,children:[e.jsxs("span",{className:yt.count,children:[i.length," type",i.length!==1?"s":""]}),e.jsxs(Ee,{onClick:C,children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"6px"},children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Type"]})]}),w&&e.jsx("div",{className:yt.error,children:w}),e.jsx("div",{className:yt.listWrapper,children:h?e.jsx("div",{className:yt.loading,children:"Loading types..."}):i.length===0?e.jsxs("div",{className:yt.empty,children:[e.jsx("p",{children:"No equipment types defined yet"}),e.jsx("p",{className:yt.emptyHint,children:"Types are created when you add equipment"})]}):e.jsx("div",{className:yt.list,children:i.map(z=>e.jsxs("div",{className:yt.typeItem,children:[e.jsxs("div",{className:yt.typeInfo,children:[e.jsx("span",{className:yt.typeName,children:z.name}),e.jsxs("span",{className:yt.typeCount,children:[z.count," equipment item",z.count!==1?"s":""]})]}),e.jsxs("div",{className:yt.typeActions,children:[e.jsx("button",{className:yt.actionBtn,onClick:()=>S(z.name),title:"Rename type",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),e.jsx("button",{className:`${yt.actionBtn} ${yt.deleteBtn}`,onClick:()=>O(z.name),title:z.count>0?"Cannot delete: type is in use":"Delete type",disabled:z.count>0,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})]},z.name))})}),e.jsxs("div",{className:yt.infoNote,children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),e.jsx("span",{children:"Equipment types are shared across all sites"})]})]})})})}function q$({typeName:n,existingTypes:s,allEquipment:r,onSave:i,onCancel:l}){const d=!!n,[u,h]=f.useState(n||""),[p,m]=f.useState(!1),[v,y]=f.useState(null),b=d?r.filter(x=>x.type===n).length:0,w=async x=>{x.preventDefault(),y(null);const _=u.trim();if(!_){y("Type name is required");return}if(s.some(C=>C.toLowerCase()===_.toLowerCase()&&C!==n)){y("A type with this name already exists");return}m(!0);try{d&&n&&await wt(`/api/equipment-types/${encodeURIComponent(n)}?new_type=${encodeURIComponent(_)}`),i()}catch(C){console.error("Failed to save type:",C);let B="Failed to save type";C instanceof Error&&(B=C.message),y(B)}finally{m(!1)}};return e.jsxs("form",{onSubmit:w,className:yt.form,children:[e.jsxs("div",{className:yt.formHeader,children:[e.jsx("h3",{children:d?"Rename Type":"Add Type"}),e.jsx("button",{type:"button",className:yt.backBtn,onClick:l,children:" Back to list"})]}),v&&e.jsx("div",{className:yt.error,children:v}),e.jsxs("div",{className:yt.field,children:[e.jsx("label",{htmlFor:"typeName",children:"Name *"}),e.jsx("input",{type:"text",id:"typeName",value:u,onChange:x=>h(x.target.value),placeholder:"e.g., Pilot Plant, Analytical Device",required:!0,autoFocus:!0})]}),d&&b>0&&e.jsxs("div",{className:yt.renameWarning,children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),e.jsxs("span",{children:["Renaming will update ",b," equipment item",b!==1?"s":""]})]}),!d&&e.jsxs("div",{className:yt.createNote,children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),e.jsx("span",{children:"New types become available when creating equipment"})]}),e.jsxs("div",{className:yt.formActions,children:[e.jsx(Ee,{type:"button",variant:"secondary",onClick:l,disabled:p,children:"Cancel"}),e.jsx(Ee,{type:"submit",disabled:p,children:p?"Saving...":d?"Rename Type":"Add Type"})]})]})}const U$="_container_129gp_5",V$="_toolbar_129gp_10",G$="_toolbarButtons_129gp_20",Y$="_filters_129gp_26",Q$="_filterGroup_129gp_32",X$="_checkbox_129gp_61",K$="_tableWrapper_129gp_78",Z$="_table_129gp_78",J$="_inactive_129gp_117",e4="_nameCell_129gp_122",t4="_equipName_129gp_128",n4="_inactiveBadge_129gp_133",s4="_typeBadge_129gp_144",a4="_siteCell_129gp_154",r4="_editBtn_129gp_160",i4="_loading_129gp_181",o4="_empty_129gp_182",l4="_form_129gp_192",c4="_formHeader_129gp_198",d4="_backBtn_129gp_213",u4="_error_129gp_229",h4="_formFields_129gp_239",f4="_field_129gp_245",m4="_typeOptions_129gp_280",p4="_typeOption_129gp_280",g4="_addNew_129gp_302",_4="_selectedTypeDisplay_129gp_312",y4="_selectedTypeBadge_129gp_318",v4="_changeTypeBtn_129gp_329",x4="_newTypeInput_129gp_346",j4="_confirmBtn_129gp_366",w4="_cancelBtn_129gp_367",S4="_siteOptions_129gp_399",C4="_siteOption_129gp_399",b4="_selected_129gp_312",k4="_siteOptionLabel_129gp_430",N4="_toggleLabel_129gp_441",D4="_hint_129gp_455",E4="_formActions_129gp_461",$4="_rightActions_129gp_469",He={container:U$,toolbar:V$,toolbarButtons:G$,filters:Y$,filterGroup:Q$,checkbox:X$,tableWrapper:K$,table:Z$,inactive:J$,nameCell:e4,equipName:t4,inactiveBadge:n4,typeBadge:s4,siteCell:a4,editBtn:r4,loading:i4,empty:o4,form:l4,formHeader:c4,backBtn:d4,error:u4,formFields:h4,field:f4,typeOptions:m4,typeOption:p4,addNew:g4,selectedTypeDisplay:_4,selectedTypeBadge:y4,changeTypeBtn:v4,newTypeInput:x4,confirmBtn:j4,cancelBtn:w4,siteOptions:S4,siteOption:C4,selected:b4,siteOptionLabel:k4,toggleLabel:N4,hint:D4,formActions:E4,rightActions:$4};function T4(){const n=xe(k=>k.activeModal),s=xe(k=>k.closeModal),r=G(k=>k.sites),i=G(k=>k.currentUser),l=G(k=>k.currentSite),d=G(k=>k.setEquipment),u=n==="manageEquipment",h=i?.role==="admin"||i?.role==="superuser",[p,m]=f.useState([]),[v,y]=f.useState(l?.id||"all"),[b,w]=f.useState(!1),[x,_]=f.useState(!1),[S,C]=f.useState(null),[B,D]=f.useState(!1),[O,z]=f.useState(!1),R=f.useMemo(()=>{const k=new Set;return p.forEach(P=>{P.type&&k.add(P.type)}),Array.from(k).sort()},[p]),Q=f.useCallback(async()=>{_(!0);try{const k=await Je("/api/equipment/all");m(k)}catch(k){console.error("Failed to load equipment:",k)}finally{_(!1)}},[]);f.useEffect(()=>{u&&(Q(),y(l?.id||"all"))},[u,Q,l?.id]);const H=p.filter(k=>!(v!=="all"&&k.site_id!==v||!b&&!k.active)),J=k=>r.find(P=>P.id===k)?.name||"Unknown",q=k=>{C(k),D(!1)},E=()=>{C(null),D(!0)},L=()=>{C(null),D(!1)},$=async()=>{await Q();const k=await Je("/api/equipment/all");d(k),L()},M=async()=>{await Q();const k=await Je("/api/equipment/all");d(k),L()};return e.jsxs(e.Fragment,{children:[e.jsx(qt,{isOpen:u,onClose:s,title:"Equipment Management",size:"lg",children:e.jsx("div",{className:He.container,children:S||B?e.jsx(M4,{equipment:S,sites:r,existingTypes:R,defaultSiteId:v!=="all"?v:l?.id||null,onSave:$,onDelete:M,onCancel:L,canDelete:i?.role==="admin"||i?.role==="superuser"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:He.toolbar,children:[e.jsxs("div",{className:He.filters,children:[e.jsxs("div",{className:He.filterGroup,children:[e.jsx("label",{children:"Site"}),e.jsxs("select",{value:v,onChange:k=>y(k.target.value==="all"?"all":parseInt(k.target.value)),children:[e.jsx("option",{value:"all",children:"All Sites"}),r.map(k=>e.jsx("option",{value:k.id,children:k.name},k.id))]})]}),e.jsxs("label",{className:He.checkbox,children:[e.jsx("input",{type:"checkbox",checked:b,onChange:k=>w(k.target.checked)}),e.jsx("span",{children:"Show inactive"})]})]}),h&&e.jsxs("div",{className:He.toolbarButtons,children:[e.jsxs(Ee,{variant:"secondary",onClick:()=>z(!0),children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"6px"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),"Manage Types"]}),e.jsxs(Ee,{onClick:E,children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"6px"},children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Equipment"]})]})]}),e.jsx("div",{className:He.tableWrapper,children:x?e.jsx("div",{className:He.loading,children:"Loading equipment..."}):H.length===0?e.jsx("div",{className:He.empty,children:p.length===0?"No equipment found":"No equipment matching filters"}):e.jsxs("table",{className:He.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Site"}),e.jsx("th",{style:{width:60}})]})}),e.jsx("tbody",{children:H.map(k=>e.jsxs("tr",{className:k.active?"":He.inactive,children:[e.jsx("td",{children:e.jsxs("div",{className:He.nameCell,children:[e.jsx("span",{className:He.equipName,children:k.name}),!k.active&&e.jsx("span",{className:He.inactiveBadge,children:"Inactive"})]})}),e.jsx("td",{children:e.jsx("span",{className:He.typeBadge,children:k.type})}),e.jsx("td",{className:He.siteCell,children:J(k.site_id)}),e.jsx("td",{children:e.jsx("button",{className:He.editBtn,onClick:()=>q(k),title:"Edit equipment",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})})]},k.id))})]})})]})})}),e.jsx(W$,{isOpen:O,onClose:()=>z(!1),onTypesChanged:Q})]})}function M4({equipment:n,sites:s,existingTypes:r,defaultSiteId:i,onSave:l,onDelete:d,onCancel:u,canDelete:h}){const p=!!n,[m,v]=f.useState(n?.name||""),[y,b]=f.useState(n?.type||""),[w,x]=f.useState(!1),[_,S]=f.useState(""),[C,B]=f.useState(n?.site_id||i),[D,O]=f.useState(n?.active??!0),[z,R]=f.useState(!1),[Q,H]=f.useState(null),J=()=>{_.trim()&&(b(_.trim()),x(!1))},q=()=>{x(!1),S("")},E=async $=>{if($.preventDefault(),H(null),!m.trim()){H("Equipment name is required");return}if(!y.trim()){H("Equipment type is required");return}if(!C){H("Please select a site");return}R(!0);try{const M={name:m.trim(),type:y.trim(),site_id:C,active:D};p&&n?await wt(`/api/equipment/${n.id}`,M):await rt("/api/equipment",M),l()}catch(M){console.error("Failed to save equipment:",M),H(M instanceof Error?M.message:"Failed to save equipment")}finally{R(!1)}},L=async()=>{if(!(!n||!window.confirm(`Are you sure you want to delete "${n.name}"?

This will also remove all assignments for this equipment.`))){R(!0);try{await Zt(`/api/equipment/${n.id}`),d()}catch(M){console.error("Failed to delete equipment:",M),H(M instanceof Error?M.message:"Failed to delete equipment")}finally{R(!1)}}};return e.jsxs("form",{onSubmit:E,className:He.form,children:[e.jsxs("div",{className:He.formHeader,children:[e.jsx("h3",{children:p?"Edit Equipment":"Add Equipment"}),e.jsx("button",{type:"button",className:He.backBtn,onClick:u,children:" Back to list"})]}),Q&&e.jsx("div",{className:He.error,children:Q}),e.jsxs("div",{className:He.formFields,children:[e.jsxs("div",{className:He.field,children:[e.jsx("label",{htmlFor:"equipName",children:"Name *"}),e.jsx("input",{type:"text",id:"equipName",value:m,onChange:$=>v($.target.value),placeholder:"e.g., Pilot Plant A, Mass Spec 1",required:!0})]}),e.jsxs("div",{className:He.field,children:[e.jsx("label",{children:"Type *"}),w?e.jsxs("div",{className:He.newTypeInput,children:[e.jsx("input",{type:"text",value:_,onChange:$=>S($.target.value),placeholder:"Enter new equipment type",autoFocus:!0,onKeyDown:$=>{$.key==="Enter"?($.preventDefault(),J()):$.key==="Escape"&&q()}}),e.jsx("button",{type:"button",className:He.confirmBtn,onClick:J,children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("button",{type:"button",className:He.cancelBtn,onClick:q,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}):y?e.jsxs("div",{className:He.selectedTypeDisplay,children:[e.jsx("span",{className:He.selectedTypeBadge,children:y}),e.jsx("button",{type:"button",className:He.changeTypeBtn,onClick:()=>b(""),children:"Change"})]}):e.jsxs("div",{className:He.typeOptions,children:[r.map($=>e.jsx("button",{type:"button",className:He.typeOption,onClick:()=>b($),children:$},$)),e.jsx("button",{type:"button",className:`${He.typeOption} ${He.addNew}`,onClick:()=>{x(!0),S("")},children:"+ New type"})]}),e.jsx("span",{className:He.hint,children:"Equipment types are shared across all sites"})]}),e.jsxs("div",{className:He.field,children:[e.jsx("label",{children:"Site *"}),e.jsx("div",{className:He.siteOptions,children:s.map($=>e.jsxs("label",{className:`${He.siteOption} ${C===$.id?He.selected:""}`,children:[e.jsx("input",{type:"radio",name:"equipSite",value:$.id,checked:C===$.id,onChange:()=>B($.id),required:!0}),e.jsx("span",{className:He.siteOptionLabel,children:$.name})]},$.id))})]}),p&&e.jsxs("div",{className:He.field,children:[e.jsx("label",{children:"Status"}),e.jsxs("label",{className:He.toggleLabel,children:[e.jsx("input",{type:"checkbox",checked:D,onChange:$=>O($.target.checked)}),e.jsx("span",{children:"Active"})]}),e.jsx("span",{className:He.hint,children:"Inactive equipment won't appear in booking lists"})]})]}),e.jsxs("div",{className:He.formActions,children:[p&&h&&e.jsx(Ee,{type:"button",variant:"danger",onClick:L,disabled:z,children:"Delete Equipment"}),e.jsxs("div",{className:He.rightActions,children:[e.jsx(Ee,{type:"button",variant:"secondary",onClick:u,disabled:z,children:"Cancel"}),e.jsx(Ee,{type:"submit",disabled:z,children:z?"Saving...":p?"Save Changes":"Create Equipment"})]})]})]})}const P4="_container_400gt_5",I4="_description_400gt_11",L4="_phaseList_400gt_19",A4="_loading_400gt_32",R4="_empty_400gt_33",B4="_phaseItem_400gt_41",O4="_inactive_400gt_57",F4="_dragging_400gt_61",z4="_dropBefore_400gt_65",H4="_dropAfter_400gt_77",W4="_dragHandle_400gt_90",q4="_phaseName_400gt_111",U4="_editable_400gt_122",V4="_phaseActions_400gt_151",G4="_actionBtn_400gt_157",Y4="_active_400gt_176",Q4="_addSection_400gt_190",X4="_footer_400gt_217",Vt={container:P4,description:I4,phaseList:L4,loading:A4,empty:R4,phaseItem:B4,inactive:O4,dragging:F4,dropBefore:z4,dropAfter:H4,dragHandle:W4,phaseName:q4,editable:U4,phaseActions:V4,actionBtn:G4,active:Y4,delete:"_delete_400gt_184",addSection:Q4,footer:X4};function K4(){const n=xe(A=>A.activeModal),s=xe(A=>A.closeModal),r=G(A=>A.currentUser),i=n==="predefinedPhases",l=r?.role==="admin"||r?.role==="superuser",[d,u]=f.useState([]),[h,p]=f.useState(!1),[m,v]=f.useState(""),[y,b]=f.useState(!1),[w,x]=f.useState(null),[_,S]=f.useState(""),[C,B]=f.useState(null),[D,O]=f.useState(null),[z,R]=f.useState(null),Q=f.useCallback(async()=>{p(!0);try{const A=await Je("/api/predefined-phases/all");u(A)}catch(A){console.error("Failed to load predefined phases:",A)}finally{p(!1)}},[]);f.useEffect(()=>{i&&Q()},[i,Q]);const H=async()=>{if(m.trim()){b(!0);try{await rt("/api/predefined-phases",{name:m.trim()}),v(""),await Q()}catch(A){console.error("Failed to add phase:",A),alert(A instanceof Error?A.message:"Failed to add phase")}finally{b(!1)}}},J=async A=>{if(!_.trim()){x(null);return}try{await wt(`/api/predefined-phases/${A}`,{name:_.trim()}),x(null),await Q()}catch(I){console.error("Failed to update phase:",I),alert(I instanceof Error?I.message:"Failed to update phase")}},q=async A=>{try{await wt(`/api/predefined-phases/${A.id}`,{is_active:!A.is_active}),await Q()}catch(I){console.error("Failed to toggle phase:",I),alert(I instanceof Error?I.message:"Failed to update phase")}},E=async A=>{if(window.confirm(`Are you sure you want to delete "${A.name}"?`))try{await Zt(`/api/predefined-phases/${A.id}`),await Q()}catch(U){console.error("Failed to delete phase:",U),alert(U instanceof Error?U.message:"Failed to delete phase")}},L=A=>{x(A.id),S(A.name)},$=(A,I)=>{B(I),A.dataTransfer.effectAllowed="move"},M=(A,I)=>{if(A.preventDefault(),C===I)return;const U=A.currentTarget.getBoundingClientRect(),N=U.top+U.height/2,W=A.clientY<N?"before":"after";O(I),R(W)},k=()=>{O(null),R(null)},P=async A=>{if(A.preventDefault(),!C||!D||C===D){B(null),O(null),R(null);return}const I=d.map(W=>W.id),U=I.indexOf(C);let N=I.indexOf(D);I.splice(U,1),N=I.indexOf(D),z==="after"&&(N+=1),I.splice(N,0,C),B(null),O(null),R(null);try{await wt("/api/predefined-phases/reorder",{phase_order:I}),await Q()}catch(W){console.error("Failed to reorder phases:",W),await Q()}},F=()=>{B(null),O(null),R(null)};return e.jsx(qt,{isOpen:i,onClose:s,title:"Predefined Phases",size:"md",children:e.jsxs("div",{className:Vt.container,children:[e.jsx("p",{className:Vt.description,children:"Predefined phases appear as quick-add options when creating new projects. Drag to reorder. Inactive phases won't appear in the list."}),e.jsx("div",{className:Vt.phaseList,children:h?e.jsx("div",{className:Vt.loading,children:"Loading phases..."}):d.length===0?e.jsx("div",{className:Vt.empty,children:"No predefined phases. Add one below."}):d.map(A=>e.jsxs("div",{className:`
                  ${Vt.phaseItem} 
                  ${A.is_active?"":Vt.inactive}
                  ${C===A.id?Vt.dragging:""}
                  ${D===A.id&&z==="before"?Vt.dropBefore:""}
                  ${D===A.id&&z==="after"?Vt.dropAfter:""}
                `,draggable:l,onDragStart:I=>$(I,A.id),onDragOver:I=>M(I,A.id),onDragLeave:k,onDrop:P,onDragEnd:F,children:[l&&e.jsx("div",{className:Vt.dragHandle,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"8",y1:"6",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"}),e.jsx("line",{x1:"8",y1:"18",x2:"16",y2:"18"})]})}),e.jsx("div",{className:Vt.phaseName,children:w===A.id?e.jsx("input",{type:"text",value:_,onChange:I=>S(I.target.value),onBlur:()=>J(A.id),onKeyDown:I=>{I.key==="Enter"&&J(A.id),I.key==="Escape"&&x(null)},autoFocus:!0}):e.jsx("span",{onClick:()=>l&&L(A),className:l?Vt.editable:"",children:A.name})}),l&&e.jsxs("div",{className:Vt.phaseActions,children:[e.jsx("button",{className:`${Vt.actionBtn} ${A.is_active?Vt.active:""}`,onClick:()=>q(A),title:A.is_active?"Deactivate":"Activate",children:A.is_active?e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}):e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("circle",{cx:"12",cy:"12",r:"10"})})}),e.jsx("button",{className:`${Vt.actionBtn} ${Vt.delete}`,onClick:()=>E(A),title:"Delete",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})]},A.id))}),l&&e.jsxs("div",{className:Vt.addSection,children:[e.jsx("input",{type:"text",value:m,onChange:A=>v(A.target.value),placeholder:"New phase name...",onKeyDown:A=>{A.key==="Enter"&&H()}}),e.jsx(Ee,{onClick:H,disabled:y||!m.trim(),children:y?"Adding...":"Add Phase"})]}),e.jsx("div",{className:Vt.footer,children:e.jsx(Ee,{variant:"secondary",onClick:s,children:"Close"})})]})})}const Z4="_container_17tds_5",J4="_dropZone_17tds_12",eT="_dragging_17tds_31",tT="_hasFile_17tds_36",nT="_fileInput_17tds_41",sT="_dropContent_17tds_46",aT="_dropText_17tds_58",rT="_dropHint_17tds_64",iT="_selectedFile_17tds_70",oT="_fileIcon_17tds_77",lT="_fileName_17tds_81",cT="_fileSize_17tds_89",dT="_clearBtn_17tds_95",uT="_progressSection_17tds_112",hT="_progressBar_17tds_119",fT="_progressFill_17tds_126",mT="_progressMessage_17tds_133",pT="_error_17tds_140",gT="_javaError_17tds_150",_T="_javaErrorHeader_17tds_160",yT="_javaErrorMessage_17tds_173",vT="_javaErrorTip_17tds_179",xT="_setupInstructions_17tds_191",jT="_success_17tds_221",wT="_successContent_17tds_237",ST="_successTitle_17tds_243",CT="_successDetails_17tds_248",bT="_actions_17tds_260",ht={container:Z4,dropZone:J4,dragging:eT,hasFile:tT,fileInput:nT,dropContent:sT,dropText:aT,dropHint:rT,selectedFile:iT,fileIcon:oT,fileName:lT,fileSize:cT,clearBtn:dT,progressSection:uT,progressBar:hT,progressFill:fT,progressMessage:mT,error:pT,javaError:gT,javaErrorHeader:_T,javaErrorMessage:yT,javaErrorTip:vT,setupInstructions:xT,success:jT,successContent:wT,successTitle:ST,successDetails:CT,actions:bT};function kT(){const n=xe(E=>E.activeModal),s=xe(E=>E.closeModal),r=G(E=>E.setProjects),i=G(E=>E.currentSite),l=n==="importProject",[d,u]=f.useState(null),[h,p]=f.useState(!1),[m,v]=f.useState(!1),[y,b]=f.useState(null),[w,x]=f.useState(null),[_,S]=f.useState(null),C=f.useRef(null),B=E=>{const L=E.name.toLowerCase();if(!L.endsWith(".mpp")&&!L.endsWith(".csv")&&!L.endsWith(".mpt")&&!L.endsWith(".mpx")&&!L.endsWith(".xml")){x("Please select an MPP, CSV, or XML file");return}u(E),x(null),S(null)},D=E=>{E.preventDefault(),p(!0)},O=E=>{E.preventDefault(),p(!1)},z=E=>{E.preventDefault(),p(!1);const L=E.dataTransfer.files[0];L&&B(L)},R=E=>{const L=E.target.files?.[0];L&&B(L)},Q=async()=>{if(d){v(!0),x(null),S(null);try{b({percent:10,message:"Uploading file..."});const E=new FormData;E.append("file",d),i?.id&&E.append("site_id",i.id.toString()),b({percent:30,message:"Parsing and creating project..."});let L="/api/import/project";window.location.port==="3333"&&(L=`${window.location.protocol}//${window.location.hostname}:8485/api/import/project`);const $=window.location.pathname.match(/^(\/t\/[a-z0-9][a-z0-9-]*)/);$&&(L=L.replace("/api/",`${$[1]}/api/`)),console.log("Import URL:",L);const M=await fetch(L,{method:"POST",body:E,credentials:"include"}),k=await M.text();let P;try{P=k?JSON.parse(k):{success:!1,error:"Empty response from server"}}catch{throw console.error("Server response:",k),new Error(`Server error: ${M.status} ${M.statusText}. Check server logs.`)}if(!M.ok||!P.success){const A=P.error||"";if(P.java_error||A.includes("JVM")||A.includes("Java")||A.includes("libjvm")||A.includes("package")&&A.includes("not found")){x(P.error||"Java/JVM not found"),S({success:!1,java_error:!0,setup_instructions:P.setup_instructions||`
MPXJ Setup Required
===================

MPP file import requires the mpxj Python package.

Install with:
  pip install mpxj

This package includes the MPXJ Java library needed to parse
Microsoft Project files.

Note: Java must also be installed:
  sudo apt install default-jre-headless  (Ubuntu/WSL)
  brew install openjdk                    (macOS)
`,error:P.error});return}throw new Error(P.error||`Import failed: ${M.status}`)}b({percent:90,message:"Refreshing project list..."});const F=await Rt();r(F),b({percent:100,message:"Import complete!"}),S(P)}catch(E){console.error("Import error:",E),x(E instanceof Error?E.message:"Failed to import project"),b(null)}finally{v(!1)}}},H=()=>{u(null),b(null),x(null),S(null),v(!1),s()},J=()=>{u(null),x(null),S(null),C.current&&(C.current.value="")},q=E=>E.toLowerCase().split(".").pop()==="csv"?e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"8",y1:"13",x2:"16",y2:"13"}),e.jsx("line",{x1:"8",y1:"17",x2:"16",y2:"17"}),e.jsx("line",{x1:"8",y1:"9",x2:"10",y2:"9"})]}):e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]});return e.jsx(qt,{isOpen:l,onClose:H,title:"Import Project",size:"md",children:e.jsxs("div",{className:ht.container,children:[!m&&!_&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${ht.dropZone} ${h?ht.dragging:""} ${d?ht.hasFile:""}`,onDragOver:D,onDragLeave:O,onDrop:z,onClick:()=>C.current?.click(),children:[e.jsx("input",{ref:C,type:"file",accept:".mpp,.mpt,.mpx,.xml,.csv",onChange:R,className:ht.fileInput}),d?e.jsxs("div",{className:ht.selectedFile,children:[e.jsx("div",{className:ht.fileIcon,children:q(d.name)}),e.jsx("div",{className:ht.fileName,children:d.name}),e.jsxs("div",{className:ht.fileSize,children:[(d.size/1024).toFixed(1)," KB"]})]}):e.jsxs("div",{className:ht.dropContent,children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),e.jsx("div",{className:ht.dropText,children:"Drop file here or click to browse"}),e.jsx("div",{className:ht.dropHint,children:"Supports MPP, MPT, MPX, XML, and CSV files"})]})]}),d&&e.jsx("button",{className:ht.clearBtn,onClick:J,children:"Choose different file"})]}),m&&y&&e.jsxs("div",{className:ht.progressSection,children:[e.jsx("div",{className:ht.progressBar,children:e.jsx("div",{className:ht.progressFill,style:{width:`${y.percent}%`}})}),e.jsx("div",{className:ht.progressMessage,children:y.message})]}),w&&!_?.java_error&&e.jsx("div",{className:ht.error,children:w}),_?.java_error&&e.jsxs("div",{className:ht.javaError,children:[e.jsxs("div",{className:ht.javaErrorHeader,children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),e.jsx("span",{children:"Java Required for MPP Import"})]}),e.jsx("div",{className:ht.javaErrorMessage,children:_.error||"Java/JVM not found. MPP import requires Java to be installed."}),e.jsxs("div",{className:ht.javaErrorTip,children:[e.jsx("strong",{children:"Tip:"})," CSV files don't require Java and can be imported without additional setup."]}),_.setup_instructions&&e.jsxs("details",{className:ht.setupInstructions,children:[e.jsx("summary",{children:"Setup Instructions"}),e.jsx("pre",{children:_.setup_instructions})]})]}),_&&_.success&&!_.java_error&&e.jsxs("div",{className:ht.success,children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),e.jsxs("div",{className:ht.successContent,children:[e.jsx("div",{className:ht.successTitle,children:"Import Complete!"}),e.jsxs("div",{className:ht.successDetails,children:[e.jsx("strong",{children:_.project_name}),e.jsxs("span",{children:[_.phases_created," phase",_.phases_created!==1?"s":"",_.subphases_created?`, ${_.subphases_created} subphase${_.subphases_created!==1?"s":""}`:""]})]})]})]}),e.jsxs("div",{className:ht.actions,children:[e.jsx(Ee,{variant:"secondary",onClick:H,children:_&&_.success?"Close":"Cancel"}),(!_||_.java_error)&&e.jsx(Ee,{onClick:Q,disabled:!d||m,children:m?"Importing...":"Import Project"})]})]})})}const NT="_container_oug0j_3",DT="_loading_oug0j_10",ET="_section_oug0j_19",$T="_sectionTitle_oug0j_25",TT="_field_oug0j_37",MT="_label_oug0j_43",PT="_hint_oug0j_49",IT="_input_oug0j_54",LT="_select_oug0j_74",AT="_buttonGroup_oug0j_92",RT="_optionButton_oug0j_97",BT="_selected_oug0j_116",OT="_themeOptions_oug0j_123",FT="_themeOption_oug0j_123",zT="_themeName_oug0j_152",HT="_themeDescription_oug0j_162",WT="_toggleField_oug0j_168",qT="_toggleInfo_oug0j_176",UT="_toggle_oug0j_168",VT="_toggleOn_oug0j_198",GT="_toggleSlider_oug0j_203",YT="_error_oug0j_220",QT="_success_oug0j_229",XT="_actions_oug0j_239",KT="_rightActions_oug0j_249",ZT="_logoSection_oug0j_255",JT="_logoField_oug0j_261",eM="_logoUploader_oug0j_267",tM="_logoPreview_oug0j_273",nM="_dark_oug0j_287",sM="_light_oug0j_291",aM="_dragActive_oug0j_299",rM="_logoImage_oug0j_304",iM="_logoOverlay_oug0j_310",oM="_logoInput_oug0j_329",lM="_logoRemoveBtn_oug0j_333",ke={container:NT,loading:DT,section:ET,sectionTitle:$T,field:TT,label:MT,hint:PT,input:IT,select:LT,buttonGroup:AT,optionButton:RT,selected:BT,themeOptions:OT,themeOption:FT,themeName:zT,themeDescription:HT,toggleField:WT,toggleInfo:qT,toggle:UT,toggleOn:VT,toggleSlider:GT,error:YT,success:QT,actions:XT,rightActions:KT,logoSection:ZT,logoField:JT,logoUploader:eM,logoPreview:tM,dark:nM,light:sM,dragActive:aM,logoImage:rM,logoOverlay:iM,logoInput:oM,logoRemoveBtn:lM},Ao={instance_title:"",default_view:"month",week_start:"monday",show_weekends:"true",auto_expand_projects:"false",header_logo_dark:"",header_logo_light:""},cM=[{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"quarter",label:"Quarter"},{value:"year",label:"Year"}],dM=[{value:"monday",label:"Monday"},{value:"sunday",label:"Sunday"}];function uM(){const n=xe(H=>H.activeModal),s=xe(H=>H.closeModal),r=G(H=>H.instanceSettings),i=G(H=>H.setInstanceSettings),l=n==="settings",[d,u]=f.useState(Ao),[h,p]=f.useState(Ao),[m,v]=f.useState(()=>gv()),[y,b]=f.useState(!0),[w,x]=f.useState(!1),[_,S]=f.useState(null),[C,B]=f.useState(null);f.useEffect(()=>{l&&D()},[l]);const D=async()=>{b(!0),S(null);try{const H={...Ao};for(const J of Object.keys(Ao))try{const q=await Nd(J);q.value!==null&&(H[J]=q.value)}catch{}u(H),p(H)}catch(H){S("Failed to load settings"),console.error("Load settings error:",H)}finally{b(!1)}},O=f.useMemo(()=>JSON.stringify(d)!==JSON.stringify(h),[d,h]),z=async()=>{x(!0),S(null),B(null);try{for(const q of Object.keys(d))d[q]!==h[q]&&await ky(q,d[q]);const H={...r,instance_title:d.instance_title};i(H);const J=d.instance_title||"Milestone";document.title=J,p(d),B("Settings saved successfully")}catch(H){S("Failed to save settings"),console.error("Save settings error:",H)}finally{x(!1)}},R=f.useCallback(()=>{u(h),B(null),S(null)},[h]),Q=f.useCallback(()=>{O&&!confirm("You have unsaved changes. Are you sure you want to close?")||s()},[O,s]);return e.jsx(qt,{isOpen:l,onClose:Q,title:"Settings",size:"md",children:e.jsx("div",{className:ke.container,children:y?e.jsx("div",{className:ke.loading,children:"Loading settings..."}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:ke.section,children:[e.jsx("h3",{className:ke.sectionTitle,children:"Instance"}),e.jsxs("div",{className:ke.field,children:[e.jsx("label",{className:ke.label,htmlFor:"instance-title",children:"Application Title"}),e.jsx("input",{id:"instance-title",type:"text",className:ke.input,value:d.instance_title,onChange:H=>{const J=H.target.value;u(q=>({...q,instance_title:J})),B(null)},placeholder:"Milestone",autoComplete:"off"}),e.jsx("span",{className:ke.hint,children:"Displayed in the header and browser tab"})]})]}),e.jsxs("section",{className:ke.section,children:[e.jsx("h3",{className:ke.sectionTitle,children:"Appearance"}),e.jsxs("div",{className:ke.field,children:[e.jsx("label",{className:ke.label,children:"Theme"}),e.jsx("div",{className:ke.themeOptions,children:mv.map(H=>e.jsxs("button",{type:"button",className:`${ke.themeOption} ${m===H.id?ke.selected:""}`,onClick:()=>{v(H.id),_v(H.id)},children:[e.jsx("span",{className:ke.themeName,children:H.name}),e.jsx("span",{className:ke.themeDescription,children:H.description})]},H.id))}),e.jsx("span",{className:ke.hint,children:"Use the sun/moon toggle in the header to switch between light and dark modes"})]})]}),e.jsxs("section",{className:ke.section,children:[e.jsx("h3",{className:ke.sectionTitle,children:"Branding"}),e.jsxs("div",{className:ke.logoSection,children:[e.jsxs("div",{className:ke.logoField,children:[e.jsx("label",{className:ke.label,children:"Dark Theme Logo"}),e.jsx(zm,{value:d.header_logo_dark,onChange:H=>{u(J=>({...J,header_logo_dark:H})),B(null)},theme:"dark"}),e.jsx("span",{className:ke.hint,children:"Used when dark theme is active"})]}),e.jsxs("div",{className:ke.logoField,children:[e.jsx("label",{className:ke.label,children:"Light Theme Logo"}),e.jsx(zm,{value:d.header_logo_light,onChange:H=>{u(J=>({...J,header_logo_light:H})),B(null)},theme:"light"}),e.jsx("span",{className:ke.hint,children:"Used when light theme is active"})]})]})]}),e.jsxs("section",{className:ke.section,children:[e.jsx("h3",{className:ke.sectionTitle,children:"Display"}),e.jsxs("div",{className:ke.field,children:[e.jsx("label",{className:ke.label,children:"Default View"}),e.jsx("div",{className:ke.buttonGroup,children:cM.map(H=>e.jsx("button",{type:"button",className:`${ke.optionButton} ${d.default_view===H.value?ke.selected:""}`,onClick:()=>{u(J=>({...J,default_view:H.value})),B(null)},children:H.label},H.value))})]}),e.jsxs("div",{className:ke.field,children:[e.jsx("label",{className:ke.label,children:"Week Starts On"}),e.jsx("div",{className:ke.buttonGroup,children:dM.map(H=>e.jsx("button",{type:"button",className:`${ke.optionButton} ${d.week_start===H.value?ke.selected:""}`,onClick:()=>{u(J=>({...J,week_start:H.value})),B(null)},children:H.label},H.value))})]})]}),e.jsxs("section",{className:ke.section,children:[e.jsx("h3",{className:ke.sectionTitle,children:"Gantt Chart"}),e.jsxs("div",{className:ke.toggleField,children:[e.jsxs("div",{className:ke.toggleInfo,children:[e.jsx("label",{className:ke.label,children:"Show Weekends"}),e.jsx("span",{className:ke.hint,children:"Display Saturday and Sunday columns in the timeline"})]}),e.jsx("button",{type:"button",className:`${ke.toggle} ${d.show_weekends==="true"?ke.toggleOn:""}`,onClick:()=>{u(H=>({...H,show_weekends:H.show_weekends==="true"?"false":"true"})),B(null)},children:e.jsx("span",{className:ke.toggleSlider})})]}),e.jsxs("div",{className:ke.toggleField,children:[e.jsxs("div",{className:ke.toggleInfo,children:[e.jsx("label",{className:ke.label,children:"Auto-expand Projects"}),e.jsx("span",{className:ke.hint,children:"Automatically expand projects to show phases on load"})]}),e.jsx("button",{type:"button",className:`${ke.toggle} ${d.auto_expand_projects==="true"?ke.toggleOn:""}`,onClick:()=>{u(H=>({...H,auto_expand_projects:H.auto_expand_projects==="true"?"false":"true"})),B(null)},children:e.jsx("span",{className:ke.toggleSlider})})]})]}),_&&e.jsx("div",{className:ke.error,children:_}),C&&e.jsx("div",{className:ke.success,children:C}),e.jsxs("div",{className:ke.actions,children:[e.jsx(Ee,{variant:"secondary",onClick:Q,children:"Cancel"}),e.jsxs("div",{className:ke.rightActions,children:[O&&e.jsx(Ee,{variant:"ghost",onClick:R,children:"Reset"}),e.jsx(Ee,{onClick:z,disabled:!O||w,children:w?"Saving...":"Save Changes"})]})]})]})})})}function zm({value:n,onChange:s,theme:r}){const i=f.useRef(null),[l,d]=f.useState(!1),u=r==="dark"?"/img/milestone_logo_dark_theme.svg":"/img/milestone_logo_light_theme.svg",h=f.useCallback(_=>{if(!["image/png","image/jpeg","image/svg+xml","image/webp"].includes(_.type)){alert("Please upload a PNG, JPG, SVG, or WebP image");return}if(_.size>500*1024){alert("Logo must be smaller than 500KB");return}const C=new FileReader;C.onload=B=>{const D=B.target?.result;s(D)},C.readAsDataURL(_)},[s]),p=f.useCallback(_=>{_.preventDefault(),d(!1);const S=_.dataTransfer.files[0];S&&h(S)},[h]),m=f.useCallback(_=>{_.preventDefault(),d(!0)},[]),v=f.useCallback(_=>{_.preventDefault(),d(!1)},[]),y=f.useCallback(_=>{const S=_.target.files?.[0];S&&h(S)},[h]),b=f.useCallback(()=>{s(""),i.current&&(i.current.value="")},[s]),w=n||u,x=!!n;return e.jsxs("div",{className:ke.logoUploader,children:[e.jsxs("div",{className:`${ke.logoPreview} ${ke[r]} ${l?ke.dragActive:""}`,onDrop:p,onDragOver:m,onDragLeave:v,onClick:()=>i.current?.click(),children:[e.jsx("img",{src:w,alt:`${r} theme logo`,className:ke.logoImage}),e.jsxs("div",{className:ke.logoOverlay,children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),e.jsx("span",{children:"Upload"})]})]}),e.jsx("input",{ref:i,type:"file",accept:"image/png,image/jpeg,image/svg+xml,image/webp",onChange:y,className:ke.logoInput}),x&&e.jsxs("button",{type:"button",className:ke.logoRemoveBtn,onClick:_=>{_.stopPropagation(),b()},title:"Remove custom logo",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),"Remove"]})]})}const hM="_wrapper_10yst_1",fM="_fullWidth_10yst_7",mM="_label_10yst_11",pM="_inputWrapper_10yst_17",gM="_input_10yst_17",_M="_error_10yst_55",yM="_hasLeftIcon_10yst_63",vM="_hasRightIcon_10yst_67",xM="_leftIcon_10yst_71",jM="_rightIcon_10yst_72",wM="_errorText_10yst_97",SM="_hint_10yst_102",Wn={wrapper:hM,fullWidth:fM,label:mM,inputWrapper:pM,input:gM,error:_M,hasLeftIcon:yM,hasRightIcon:vM,leftIcon:xM,rightIcon:jM,errorText:wM,hint:SM},Ld=f.forwardRef(({label:n,error:s,hint:r,leftIcon:i,rightIcon:l,fullWidth:d=!1,className:u,id:h,...p},m)=>{const v=h||`input-${Math.random().toString(36).substr(2,9)}`,y=[Wn.wrapper,d&&Wn.fullWidth,u].filter(Boolean).join(" "),b=[Wn.input,s&&Wn.error,i&&Wn.hasLeftIcon,l&&Wn.hasRightIcon].filter(Boolean).join(" ");return e.jsxs("div",{className:y,children:[n&&e.jsx("label",{htmlFor:v,className:Wn.label,children:n}),e.jsxs("div",{className:Wn.inputWrapper,children:[i&&e.jsx("span",{className:Wn.leftIcon,children:i}),e.jsx("input",{ref:m,id:v,className:b,...p}),l&&e.jsx("span",{className:Wn.rightIcon,children:l})]}),s&&e.jsx("span",{className:Wn.errorText,children:s}),r&&!s&&e.jsx("span",{className:Wn.hint,children:r})]})});Ld.displayName="Input";const CM="_wrapper_1tq09_1",bM="_fullWidth_1tq09_7",kM="_label_1tq09_11",NM="_selectWrapper_1tq09_17",DM="_select_1tq09_17",EM="_error_1tq09_53",$M="_hasIcon_1tq09_61",TM="_icon_1tq09_65",MM="_chevron_1tq09_82",PM="_errorText_1tq09_91",IM="_hint_1tq09_96",rs={wrapper:CM,fullWidth:bM,label:kM,selectWrapper:NM,select:DM,error:EM,hasIcon:$M,icon:TM,chevron:MM,errorText:PM,hint:IM},eg=f.forwardRef(({label:n,error:s,hint:r,options:i,placeholder:l,fullWidth:d=!1,icon:u,className:h,id:p,...m},v)=>{const y=p||`select-${Math.random().toString(36).substr(2,9)}`,b=[rs.wrapper,d&&rs.fullWidth,h].filter(Boolean).join(" "),w=[rs.select,s&&rs.error,u&&rs.hasIcon].filter(Boolean).join(" ");return e.jsxs("div",{className:b,children:[n&&e.jsx("label",{htmlFor:y,className:rs.label,children:n}),e.jsxs("div",{className:rs.selectWrapper,children:[u&&e.jsx("span",{className:rs.icon,children:u}),e.jsxs("select",{ref:v,id:y,className:w,...m,children:[l&&e.jsx("option",{value:"",disabled:!0,children:l}),i.map(x=>e.jsx("option",{value:x.value,disabled:x.disabled,children:x.label},x.value))]}),e.jsx("span",{className:rs.chevron,children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"6 9 12 15 18 9"})})})]}),s&&e.jsx("span",{className:rs.errorText,children:s}),r&&!s&&e.jsx("span",{className:rs.hint,children:r})]})});eg.displayName="Select";const LM="_form_1deyf_3",AM="_error_1deyf_10",RM="_field_1deyf_19",BM="_label_1deyf_25",OM="_checkboxField_1deyf_31",FM="_checkboxLabel_1deyf_37",zM="_checkboxText_1deyf_50",HM="_hint_1deyf_55",WM="_listOptions_1deyf_62",qM="_listOptionRow_1deyf_68",UM="_removeOptionBtn_1deyf_74",VM="_addOptionBtn_1deyf_95",GM="_widthControl_1deyf_116",YM="_widthSlider_1deyf_122",QM="_widthValue_1deyf_156",XM="_actions_1deyf_164",KM="_rightActions_1deyf_173",Ht={form:LM,error:AM,field:RM,label:BM,checkboxField:OM,checkboxLabel:FM,checkboxText:zM,hint:HM,listOptions:WM,listOptionRow:qM,removeOptionBtn:UM,addOptionBtn:VM,widthControl:GM,widthSlider:YM,widthValue:QM,actions:XM,rightActions:KM};function Ad({isOpen:n,onClose:s,column:r,onSave:i}){const l=G(E=>E.currentSite),[d,u]=f.useState(""),[h,p]=f.useState("text"),[m,v]=f.useState(!1),[y,b]=f.useState([""]),[w,x]=f.useState(120),[_,S]=f.useState(!1),[C,B]=f.useState(!1),[D,O]=f.useState(null),z=!!r;f.useEffect(()=>{n&&(r?(u(r.name),p(r.column_type),v(r.site_id===null),b(r.list_options?.length?r.list_options:[""]),x(r.width)):(u(""),p("text"),v(!1),b([""]),x(120)),O(null))},[n,r]);const R=()=>{b([...y,""])},Q=E=>{y.length>1&&b(y.filter((L,$)=>$!==E))},H=(E,L)=>{const $=[...y];$[E]=L,b($)},J=async()=>{if(!d.trim()){O("Column name is required");return}if(h==="list"&&y.filter(L=>L.trim()).length===0){O("At least one list option is required");return}S(!0),O(null);try{if(z&&r)await Gd(r.id,{name:d.trim(),list_options:h==="list"?y.filter(E=>E.trim()):void 0,width:w});else{const E={name:d.trim(),column_type:h,site_id:m?null:l?.id,width:w};h==="list"&&(E.list_options=y.filter(L=>L.trim())),await Ey(E)}i(),s()}catch(E){O(E instanceof Error?E.message:"Failed to save column")}finally{S(!1)}},q=async()=>{if(!(!r||!confirm("Are you sure you want to delete this column? All values will be lost."))){B(!0),O(null);try{await _p(r.id),i(),s()}catch(E){O(E instanceof Error?E.message:"Failed to delete column")}finally{B(!1)}}};return e.jsxs(qt,{isOpen:n,onClose:s,title:z?"Edit Custom Column":"Add Custom Column",size:"md",children:[e.jsxs("div",{className:Ht.form,children:[D&&e.jsx("div",{className:Ht.error,children:D}),e.jsx("div",{className:Ht.field,children:e.jsx(Ld,{label:"Column Name",value:d,onChange:E=>u(E.target.value),placeholder:"e.g., Priority, Status, Owner",fullWidth:!0})}),!z&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:Ht.field,children:e.jsx(eg,{label:"Column Type",value:h,onChange:E=>p(E.target.value),options:[{value:"text",label:"Text"},{value:"boolean",label:"Checkbox"},{value:"list",label:"Dropdown List"}],fullWidth:!0})}),e.jsxs("div",{className:Ht.checkboxField,children:[e.jsxs("label",{className:Ht.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:m,onChange:E=>v(E.target.checked)}),e.jsx("span",{className:Ht.checkboxText,children:"Global column (available to all sites)"})]}),e.jsx("span",{className:Ht.hint,children:m?"This column will be visible across all sites":`This column will only be visible to ${l?.name||"this site"}`})]})]}),h==="list"&&e.jsxs("div",{className:Ht.field,children:[e.jsx("label",{className:Ht.label,children:"List Options"}),e.jsxs("div",{className:Ht.listOptions,children:[y.map((E,L)=>e.jsxs("div",{className:Ht.listOptionRow,children:[e.jsx(Ld,{value:E,onChange:$=>H(L,$.target.value),placeholder:`Option ${L+1}`,fullWidth:!0}),y.length>1&&e.jsx("button",{type:"button",className:Ht.removeOptionBtn,onClick:()=>Q(L),title:"Remove option",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},L)),e.jsxs("button",{type:"button",className:Ht.addOptionBtn,onClick:R,children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Option"]})]})]}),e.jsxs("div",{className:Ht.field,children:[e.jsx("label",{className:Ht.label,children:"Column Width"}),e.jsxs("div",{className:Ht.widthControl,children:[e.jsx("input",{type:"range",min:"60",max:"300",value:w,onChange:E=>x(parseInt(E.target.value)),className:Ht.widthSlider}),e.jsxs("span",{className:Ht.widthValue,children:[w,"px"]})]})]})]}),e.jsxs("div",{className:Ht.actions,children:[z&&e.jsx(Ee,{variant:"danger",onClick:q,disabled:C||_,children:C?"Deleting...":"Delete"}),e.jsxs("div",{className:Ht.rightActions,children:[e.jsx(Ee,{variant:"ghost",onClick:s,disabled:_||C,children:"Cancel"}),e.jsx(Ee,{onClick:J,disabled:_||C,children:_?"Saving...":z?"Update":"Create"})]})]})]})}const ZM="_content_1iwdq_1",JM="_empty_1iwdq_6",eP="_emptyHint_1iwdq_27",tP="_columnList_1iwdq_33",nP="_listHeader_1iwdq_39",sP="_columnItem_1iwdq_52",aP="_dragging_1iwdq_70",rP="_dragOver_1iwdq_74",iP="_colDrag_1iwdq_79",oP="_colName_1iwdq_97",lP="_colType_1iwdq_103",cP="_colScope_1iwdq_113",dP="_scopeGlobal_1iwdq_119",uP="_scopeLocal_1iwdq_126",hP="_colWidth_1iwdq_133",fP="_colActions_1iwdq_141",mP="_actionBtn_1iwdq_150",pP="_deleteBtn_1iwdq_171",gP="_addSection_1iwdq_177",_P="_footer_1iwdq_189",yP="_hint_1iwdq_198",ft={content:ZM,empty:JM,emptyHint:eP,columnList:tP,listHeader:nP,columnItem:sP,dragging:aP,dragOver:rP,colDrag:iP,colName:oP,colType:lP,colScope:cP,scopeGlobal:dP,scopeLocal:uP,colWidth:hP,colActions:fP,actionBtn:mP,deleteBtn:pP,addSection:gP,footer:_P,hint:yP};function vP({isOpen:n,onClose:s}){const r=G(H=>H.customColumns),i=G(H=>H.currentSite),l=G(H=>H.setCustomColumns),d=G(H=>H.setCustomColumnValues),[u,h]=f.useState(null),[p,m]=f.useState(!1),[v,y]=f.useState(null),[b,w]=f.useState(null),x=f.useRef(null),_=f.useCallback(async()=>{if(i)try{const H=await Uo(i.id);l(H.columns),d(H.values)}catch(H){console.error("Failed to refresh columns:",H)}},[i,l,d]),S=(H,J,q)=>{y(J),x.current=q,H.dataTransfer.effectAllowed="move";const E=H.target;E.style.opacity="0.5"},C=H=>{const J=H.target;J.style.opacity="1",y(null),w(null),x.current=null},B=(H,J)=>{H.preventDefault(),x.current!==J&&w(J)},D=()=>{w(null)},O=async(H,J)=>{if(H.preventDefault(),!v||x.current===null||x.current===J){w(null);return}try{const q=[...r],[E]=q.splice(x.current,1);q.splice(J,0,E);const L=q.map((M,k)=>({id:M.id,display_order:k})),$=q.map((M,k)=>({...M,display_order:k}));l($);for(const M of L)await Gd(M.id,{display_order:M.display_order})}catch(q){console.error("Failed to reorder columns:",q),_()}finally{w(null)}},z=async H=>{if(confirm(`Delete column "${H.name}"? All values will be lost.`))try{await _p(H.id),_()}catch(J){console.error("Failed to delete column:",J)}},R=H=>{switch(H){case"boolean":return"Checkbox";case"list":return"Dropdown";default:return"Text"}},Q=H=>{switch(H){case"boolean":return e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"9 11 12 14 22 4"}),e.jsx("path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"})]});case"list":return e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"6 9 12 15 18 9"})});default:return e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"17",y1:"10",x2:"3",y2:"10"}),e.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),e.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),e.jsx("line",{x1:"17",y1:"18",x2:"3",y2:"18"})]})}};return e.jsxs(e.Fragment,{children:[e.jsxs(qt,{isOpen:n,onClose:s,title:"Manage Custom Columns",size:"lg",children:[e.jsxs("div",{className:ft.content,children:[r.length===0?e.jsxs("div",{className:ft.empty,children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),e.jsx("line",{x1:"9",y1:"21",x2:"9",y2:"9"})]}),e.jsx("p",{children:"No custom columns yet"}),e.jsx("span",{className:ft.emptyHint,children:"Add columns to track additional properties on phases and subphases"})]}):e.jsxs("div",{className:ft.columnList,children:[e.jsxs("div",{className:ft.listHeader,children:[e.jsx("span",{className:ft.colDrag}),e.jsx("span",{className:ft.colName,children:"Name"}),e.jsx("span",{className:ft.colType,children:"Type"}),e.jsx("span",{className:ft.colScope,children:"Scope"}),e.jsx("span",{className:ft.colWidth,children:"Width"}),e.jsx("span",{className:ft.colActions,children:"Actions"})]}),r.map((H,J)=>e.jsxs("div",{className:`${ft.columnItem} ${b===J?ft.dragOver:""} ${v?.id===H.id?ft.dragging:""}`,draggable:!0,onDragStart:q=>S(q,H,J),onDragEnd:C,onDragOver:q=>B(q,J),onDragLeave:D,onDrop:q=>O(q,J),children:[e.jsx("span",{className:ft.colDrag,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"8",y1:"6",x2:"8",y2:"6"}),e.jsx("line",{x1:"16",y1:"6",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"12",x2:"8",y2:"12"}),e.jsx("line",{x1:"16",y1:"12",x2:"16",y2:"12"}),e.jsx("line",{x1:"8",y1:"18",x2:"8",y2:"18"}),e.jsx("line",{x1:"16",y1:"18",x2:"16",y2:"18"})]})}),e.jsx("span",{className:ft.colName,children:H.name}),e.jsxs("span",{className:ft.colType,children:[Q(H.column_type),R(H.column_type)]}),e.jsx("span",{className:ft.colScope,children:H.site_id===null?e.jsx("span",{className:ft.scopeGlobal,children:"Global"}):e.jsx("span",{className:ft.scopeLocal,children:"Local"})}),e.jsxs("span",{className:ft.colWidth,children:[H.width,"px"]}),e.jsxs("span",{className:ft.colActions,children:[e.jsx("button",{className:ft.actionBtn,onClick:()=>h(H),title:"Edit column",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),e.jsx("button",{className:`${ft.actionBtn} ${ft.deleteBtn}`,onClick:()=>z(H),title:"Delete column",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})]},H.id))]}),e.jsx("div",{className:ft.addSection,children:e.jsxs(Ee,{variant:"primary",onClick:()=>m(!0),children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Column"]})})]}),e.jsxs("div",{className:ft.footer,children:[e.jsxs("div",{className:ft.hint,children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),"Drag columns to reorder. Changes apply to phases and subphases."]}),e.jsx(Ee,{variant:"ghost",onClick:s,children:"Close"})]})]}),e.jsx(Ad,{isOpen:!!u,onClose:()=>h(null),column:u,onSave:_}),e.jsx(Ad,{isOpen:p,onClose:()=>m(!1),onSave:_})]})}function xP(){return e.jsxs(e.Fragment,{children:[e.jsx(mb,{}),e.jsx(Mb,{}),e.jsx(Ob,{}),e.jsx(ak,{}),e.jsx(rk,{}),e.jsx(aN,{}),e.jsx($N,{}),e.jsx(ON,{}),e.jsx(FN,{}),e.jsx(sD,{}),e.jsx(wD,{}),e.jsx(s$,{}),e.jsx(y$,{}),e.jsx(T4,{}),e.jsx(K4,{}),e.jsx(kT,{}),e.jsx(uM,{})]})}const jP="_panel_1w4a8_1",wP="_header_1w4a8_10",SP="_headerContent_1w4a8_19",CP="_headerColumns_1w4a8_27",bP="_headerColumnPlaceholder_1w4a8_32",kP="_headerLeft_1w4a8_38",NP="_headerTitle_1w4a8_44",DP="_headerCount_1w4a8_50",EP="_headerActions_1w4a8_58",$P="_toggleBtn_1w4a8_64",TP="_toggleOff_1w4a8_83",MP="_columnsBtn_1w4a8_94",PP="_importBtn_1w4a8_115",IP="_newProjectBtn_1w4a8_136",LP="_columnHeaders_1w4a8_160",AP="_nameColumnHeader_1w4a8_168",RP="_body_1w4a8_172",BP="_empty_1w4a8_197",OP="_emptyHint_1w4a8_212",FP="_visibilityWrapper_1w4a8_219",zP="_hasHidden_1w4a8_223",HP="_visibilityDropdown_1w4a8_233",WP="_visibilityHeader_1w4a8_246",qP="_visibilityOption_1w4a8_257",UP="_visibilityCheckbox_1w4a8_281",VP="_visibilityCheckIcon_1w4a8_295",GP="_masterToggle_1w4a8_315",YP="_visibilityDivider_1w4a8_324",QP="_visibilityList_1w4a8_330",tt={panel:jP,header:wP,headerContent:SP,headerColumns:CP,headerColumnPlaceholder:bP,headerLeft:kP,headerTitle:NP,headerCount:DP,headerActions:EP,toggleBtn:$P,toggleOff:TP,columnsBtn:MP,importBtn:PP,newProjectBtn:IP,columnHeaders:LP,nameColumnHeader:AP,body:RP,empty:BP,emptyHint:OP,visibilityWrapper:FP,hasHidden:zP,visibilityDropdown:HP,visibilityHeader:WP,visibilityOption:qP,visibilityCheckbox:UP,visibilityCheckIcon:VP,masterToggle:GP,visibilityDivider:YP,visibilityList:QP},XP=f.forwardRef(function({projects:s,width:r,onProjectReorder:i},l){const d=xe(N=>N.openProjectModal),u=xe(N=>N.setActiveModal),h=G(N=>N.currentUser),p=G(N=>N.currentSite),m=G(N=>N.customColumns),v=G(N=>N.setCustomColumns),y=G(N=>N.showAssignments),b=G(N=>N.toggleShowAssignments),w=G(N=>N.showAllCustomColumns),x=G(N=>N.hiddenCustomColumns),_=G(N=>N.setShowAllCustomColumns),S=G(N=>N.toggleCustomColumnVisibility),{refreshCustomColumns:C}=ll(),[B,D]=f.useState(!1),[O,z]=f.useState(!1),[R,Q]=f.useState(!1),[H,J]=f.useState(null),q=f.useRef(null),E=h?.role==="admin"||h?.role==="superuser",L=w?m.filter(N=>!x.has(N.id)):[];f.useEffect(()=>{const N=W=>{q.current&&!q.current.contains(W.target)&&Q(!1)};return R&&document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[R]);const $=()=>{D(!0)},M=N=>{J(N),z(!0)},k=()=>{p&&C(p.id)},P=f.useCallback((N,W)=>{v(m.map(K=>K.id===N?{...K,width:W}:K))},[m,v]),F=()=>{_(!w)},A=L.reduce((N,W)=>N+W.width,0),I=r+A,U=m.length-L.length;return e.jsxs(zw,{children:[e.jsxs("div",{className:tt.panel,style:{width:I},children:[e.jsxs("div",{className:tt.header,children:[e.jsxs("div",{className:tt.headerContent,style:{width:r},children:[e.jsxs("div",{className:tt.headerLeft,children:[e.jsx("span",{className:tt.headerTitle,children:"Projects"}),e.jsx("span",{className:tt.headerCount,children:s.length})]}),e.jsxs("div",{className:tt.headerActions,children:[e.jsx("button",{className:`${tt.toggleBtn} ${y?"":tt.toggleOff}`,onClick:b,title:y?"Hide Staff & Equipment":"Show Staff & Equipment",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}),m.length>0&&e.jsxs("div",{ref:q,className:tt.visibilityWrapper,children:[e.jsx("button",{className:`${tt.toggleBtn} ${U>0||!w?tt.hasHidden:""}`,onClick:()=>Q(!R),title:"Column Visibility",children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:w&&U===0?e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})})}),R&&e.jsxs("div",{className:tt.visibilityDropdown,children:[e.jsx("div",{className:tt.visibilityHeader,children:e.jsx("span",{children:"Column Visibility"})}),e.jsxs("label",{className:`${tt.visibilityOption} ${tt.masterToggle}`,children:[e.jsx("input",{type:"checkbox",checked:w,onChange:F}),e.jsx("span",{className:tt.visibilityCheckbox,children:e.jsx("svg",{className:tt.visibilityCheckIcon,width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("span",{children:"Show All Columns"})]}),w&&m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:tt.visibilityDivider}),e.jsx("div",{className:tt.visibilityList,children:m.map(N=>e.jsxs("label",{className:tt.visibilityOption,children:[e.jsx("input",{type:"checkbox",checked:!x.has(N.id),onChange:()=>S(N.id)}),e.jsx("span",{className:tt.visibilityCheckbox,children:e.jsx("svg",{className:tt.visibilityCheckIcon,width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("span",{children:N.name})]},N.id))})]})]})]}),E&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:tt.columnsBtn,onClick:$,title:"Manage Custom Columns",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),e.jsx("line",{x1:"9",y1:"21",x2:"9",y2:"9"})]})}),e.jsx("button",{className:tt.importBtn,onClick:()=>u("importProject"),title:"Import Project",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]})}),e.jsxs("button",{className:tt.newProjectBtn,onClick:()=>d(),title:"New Project",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),e.jsx("span",{children:"New"})]})]})]})]}),L.length>0&&e.jsx("div",{className:tt.headerColumns,children:L.map(N=>e.jsx("div",{className:tt.headerColumnPlaceholder,style:{width:N.width}},N.id))})]}),L.length>0&&e.jsxs("div",{className:tt.columnHeaders,children:[e.jsx("div",{className:tt.nameColumnHeader,style:{width:r}}),L.map(N=>e.jsx(nS,{column:N,onEdit:M,onWidthChange:P},N.id))]}),e.jsx("div",{ref:l,className:tt.body,children:s.length===0?e.jsxs("div",{className:tt.empty,children:[e.jsx("p",{children:"No projects found"}),e.jsx("p",{className:tt.emptyHint,children:E?'Click "New" to create a project':"No projects available for this site"})]}):s.map((N,W)=>e.jsx(yC,{project:N,customColumns:L,nameColumnWidth:r,onReorder:i,siblingIds:s.map(K=>K.id),index:W},N.id))})]}),e.jsx(vP,{isOpen:B,onClose:()=>D(!1)}),e.jsx(Ad,{isOpen:O,onClose:()=>z(!1),column:H,onSave:k})]})}),KP="_header_1xm1y_1",ZP="_headerContent_1xm1y_7",JP="_primaryRow_1xm1y_12",e3="_primaryCell_1xm1y_18",t3="_current_1xm1y_32",n3="_secondaryRow_1xm1y_37",s3="_bgLayer_1xm1y_63",a3="_bgCell_1xm1y_74",r3="_weekendBg_1xm1y_80",i3="_holidayBg_1xm1y_85",o3="_eventBg_1xm1y_90",l3="_todayBg_1xm1y_95",c3="_secondaryCell_1xm1y_99",d3="_todayText_1xm1y_113",u3="_holidayText_1xm1y_118",h3="_eventText_1xm1y_122",f3="_dayLabel_1xm1y_126",m3="_weekLabelTop_1xm1y_131",p3="_weekLabelBottom_1xm1y_143",g3="_monthLabel_1xm1y_152",_3="_customColumnSpacer_1xm1y_161",Wt={header:KP,headerContent:ZP,primaryRow:JP,primaryCell:e3,current:t3,secondaryRow:n3,bgLayer:s3,bgCell:a3,weekendBg:r3,holidayBg:i3,eventBg:o3,todayBg:l3,secondaryCell:c3,todayText:d3,holidayText:u3,eventText:h3,dayLabel:f3,weekLabelTop:m3,weekLabelBottom:p3,monthLabel:g3,customColumnSpacer:_3},vi=f.memo(function({headers:s,cells:r,cellWidth:i,totalWidth:l,viewMode:d,hasCustomColumns:u=!1}){const h=d==="week"||d==="month"||d==="quarter",p=d==="week"||d==="month";return e.jsx("div",{className:Wt.header,children:e.jsxs("div",{className:Wt.headerContent,style:{width:l},children:[e.jsx("div",{className:Wt.primaryRow,children:s.primary.map((m,v)=>e.jsx("div",{className:`${Wt.primaryCell} ${m.isCurrentPeriod?Wt.current:""}`,style:{width:m.span*i},children:m.label},v))}),e.jsxs("div",{className:Wt.secondaryRow,style:{"--cell-width":`${i}px`},children:[p&&e.jsx("div",{className:Wt.bgLayer,children:r.map((m,v)=>{let y="";return m.isToday?y=Wt.todayBg:m.isBankHoliday?y=Wt.holidayBg:m.isCompanyEvent?y=Wt.eventBg:m.isWeekend&&(y=Wt.weekendBg),y?e.jsx("div",{className:`${Wt.bgCell} ${y}`,style:{left:v*i,width:i}},`bg-${v}`):null})}),r.map((m,v)=>{let y="";m.isToday?y=Wt.todayText:m.isBankHoliday?y=Wt.holidayText:m.isCompanyEvent&&(y=Wt.eventText);const b=m.isBankHoliday?m.bankHolidayName:m.isCompanyEvent?m.companyEventName:void 0;return e.jsxs("div",{className:`${Wt.secondaryCell} ${y}`,style:{width:i},title:b,"data-date":m.dateStr,"data-date-end":m.dateEnd||void 0,children:[e.jsx("span",{className:Wt.dayLabel,children:m.label}),h&&m.isFirstOfWeek&&e.jsxs("span",{className:d==="month"?Wt.weekLabelBottom:Wt.weekLabelTop,children:["W",m.weekNumber]}),m.isFirstOfMonth&&i<40&&e.jsx("span",{className:Wt.monthLabel,children:m.monthLabel})]},v)})]}),u&&e.jsx("div",{className:Wt.customColumnSpacer})]})})}),y3="_bar_7th6k_1",v3="_confirmed_7th6k_34",x3="_unconfirmed_7th6k_39",j3="_label_7th6k_51",Ro={bar:y3,confirmed:v3,unconfirmed:x3,label:j3},w3=f.memo(function({left:s,width:r,name:i,confirmed:l,completion:d,projectId:u,startDate:h,endDate:p,onDragStart:m}){return e.jsx("div",{className:`${Ro.bar} ${l?Ro.confirmed:Ro.unconfirmed} gantt-bar`,style:{left:s,width:r},title:`${i}${d!=null?` (${d}%)`:""}
Drag to move project`,"data-project-id":u,"data-start":h,"data-end":p,onMouseDown:m,children:r>60&&e.jsx("span",{className:Ro.label,children:i})})}),S3="_bar_1l1tb_1",C3="_label_1l1tb_16",b3="_subphase_1l1tb_29",k3="_completionBar_1l1tb_54",N3="_resizeHandle_1l1tb_71",D3="_left_1l1tb_95",E3="_right_1l1tb_100",$3="_milestone_1l1tb_122",T3="_milestoneDiamond_1l1tb_138",M3="_milestoneLabel_1l1tb_150",P3="_linkZone_1l1tb_190",I3="_start_1l1tb_204",L3="_end_1l1tb_208",A3="_linkingActive_1l1tb_253",R3="_linkingSource_1l1tb_270",B3="_milestoneZone_1l1tb_281",O3="_criticalPath_1l1tb_303",F3="_criticalPathDiamond_1l1tb_315",z3="_recentlyChanged_1l1tb_341",H3="_changedByBadge_1l1tb_358",Ke={bar:S3,label:C3,subphase:b3,completionBar:k3,resizeHandle:N3,left:D3,right:E3,milestone:$3,milestoneDiamond:T3,milestoneLabel:M3,linkZone:P3,start:I3,end:L3,linkingActive:A3,linkingSource:R3,milestoneZone:B3,criticalPath:O3,criticalPathDiamond:F3,recentlyChanged:z3,changedByBadge:H3},Hm=5;function Wm(n){return"touches"in n&&n.touches.length>0?{clientX:n.touches[0].clientX,clientY:n.touches[0].clientY}:"changedTouches"in n&&n.changedTouches.length>0?{clientX:n.changedTouches[0].clientX,clientY:n.changedTouches[0].clientY}:{clientX:n.clientX,clientY:n.clientY}}function hd(n,s="mousedown"){const r=n.touches[0]||n.changedTouches[0];return{...n,type:s,clientX:r.clientX,clientY:r.clientY,screenX:r.screenX,screenY:r.screenY,pageX:r.pageX,pageY:r.pageY,button:0,buttons:1}}const tg=f.memo(function({left:s,width:r,color:i,name:l,isSubphase:d=!1,isMilestone:u=!1,completion:h=null,isCriticalPath:p=!1,changedBy:m=null,phaseId:v,projectId:y,onDragStart:b,onResizeStart:w,onClick:x,onLinkZoneClick:_,isLinkingSource:S=!1,isLinkingActive:C=!1,onPhantomStart:B}){const D=f.useRef(null),O=f.useRef({isDragging:!1,startX:0,startY:0,hasMoved:!1,originalEvent:null,isTouch:!1}),z=d?16:20,R=f.useCallback(k=>{if(k.target.classList.contains(Ke.resizeHandle))return;k.preventDefault();const F="touches"in k,A=Wm(k),I=F?hd(k):k;O.current={isDragging:!0,startX:A.clientX,startY:A.clientY,hasMoved:!1,originalEvent:I,isTouch:F};const U=W=>{const K=O.current;if(!K.isDragging)return;const te=Wm(W),Y=Math.abs(te.clientX-K.startX),me=Math.abs(te.clientY-K.startY);!K.hasMoved&&(Y>Hm||me>Hm)&&(K.hasMoved=!0,"touches"in W&&W.preventDefault(),b&&D.current&&K.originalEvent&&b(K.originalEvent,D.current))},N=()=>{const W=O.current;document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",N),document.removeEventListener("touchmove",U),document.removeEventListener("touchend",N),document.removeEventListener("touchcancel",N),!W.hasMoved&&x&&W.originalEvent&&x(W.originalEvent),O.current={isDragging:!1,startX:0,startY:0,hasMoved:!1,originalEvent:null,isTouch:!1}};document.addEventListener("mousemove",U),document.addEventListener("mouseup",N),document.addEventListener("touchmove",U,{passive:!1}),document.addEventListener("touchend",N),document.addEventListener("touchcancel",N)},[b,x]),Q=f.useCallback(k=>{k.stopPropagation(),k.preventDefault(),O.current.hasMoved=!0;const F="touches"in k?hd(k):k;w&&D.current&&w(F,"left",D.current)},[w]),H=f.useCallback(k=>{k.stopPropagation(),k.preventDefault(),O.current.hasMoved=!0;const F="touches"in k?hd(k):k;w&&D.current&&w(F,"right",D.current)},[w]),J=f.useCallback(k=>{if(k.stopPropagation(),k.preventDefault(),k.shiftKey&&B){B("start");return}_&&_(k,"start")},[_,B]),q=f.useCallback(k=>{if(k.stopPropagation(),k.preventDefault(),k.shiftKey&&B){B("end");return}_&&_(k,"end")},[_,B]);if(u){const k=d?{"data-subphase-id":v,"data-project-id":y}:{"data-phase-id":v,"data-project-id":y};return e.jsxs("div",{ref:D,className:`${Ke.milestone} ${d?Ke.subphase:""} ${S?Ke.linkingSource:""} ${p?Ke.criticalPath:""} ${m?Ke.recentlyChanged:""}`,style:{left:s+r/2-12},title:p?`${l} (Critical Path)`:l,onMouseDown:R,onTouchStart:R,...k,children:[_&&e.jsx("div",{className:`${Ke.linkZone} ${Ke.start} ${Ke.milestoneZone} ${C?Ke.linkingActive:""}`,onClick:J,onMouseDown:P=>P.stopPropagation(),onTouchStart:P=>P.stopPropagation(),title:"Click to start linking (SS or SF)"}),e.jsx("div",{className:`${Ke.milestoneDiamond} ${p?Ke.criticalPathDiamond:""}`,style:{backgroundColor:i}}),l&&e.jsx("span",{className:Ke.milestoneLabel,children:l}),m&&e.jsxs("span",{className:Ke.changedByBadge,children:[" ",m]}),_&&e.jsx("div",{className:`${Ke.linkZone} ${Ke.end} ${Ke.milestoneZone} ${C?Ke.linkingActive:""}`,onClick:q,onMouseDown:P=>P.stopPropagation(),onTouchStart:P=>P.stopPropagation(),title:"Click to start linking (FS or FF)"})]})}const E=h!==null&&h>=0,L=E?Math.min(100,Math.max(0,h)):0,$=d?{"data-subphase-id":v,"data-project-id":y}:{"data-phase-id":v,"data-project-id":y};let M=l;return E&&(M+=` (${h}%)`),p&&(M+=" - Critical Path"),e.jsxs("div",{ref:D,className:`${Ke.bar} ${d?Ke.subphase:""} ${S?Ke.linkingSource:""} ${p?Ke.criticalPath:""} ${m?Ke.recentlyChanged:""}`,style:{left:s,width:r,height:z,backgroundColor:i},title:M,onMouseDown:R,onTouchStart:R,...$,children:[E&&L>0&&e.jsx("div",{className:Ke.completionBar,style:{width:`${L}%`}}),_&&e.jsx("div",{className:`${Ke.linkZone} ${Ke.start} ${C?Ke.linkingActive:""}`,onClick:J,onMouseDown:k=>k.stopPropagation(),onTouchStart:k=>k.stopPropagation(),title:"Click to start linking (SS or SF)"}),!u&&w&&e.jsx("div",{className:`${Ke.resizeHandle} ${Ke.left}`,onMouseDown:Q,onTouchStart:Q}),r>40&&e.jsx("span",{className:Ke.label,children:l}),m&&e.jsxs("span",{className:Ke.changedByBadge,children:[" ",m]}),!u&&w&&e.jsx("div",{className:`${Ke.resizeHandle} ${Ke.right}`,onMouseDown:H,onTouchStart:H}),_&&e.jsx("div",{className:`${Ke.linkZone} ${Ke.end} ${C?Ke.linkingActive:""}`,onClick:q,onMouseDown:k=>k.stopPropagation(),onTouchStart:k=>k.stopPropagation(),title:"Click to start linking (FS or FF)"})]})}),W3="_row_engsr_1",q3="_projectRow_engsr_8",U3="_assignmentBar_engsr_16",V3="_staff_engsr_34",G3="_equipment_engsr_38",Y3="_interactive_engsr_49",Q3="_dragging_engsr_61",X3="_resizeHandle_engsr_67",K3="_left_engsr_83",Z3="_right_engsr_88",J3="_phaseStaff_engsr_94",eI="_subphaseStaff_engsr_99",tI="_barLabel_engsr_105",nI="_vacationCellMarker_engsr_115",sI="_phantomRow_engsr_138",Dt={row:W3,projectRow:q3,assignmentBar:U3,staff:V3,equipment:G3,interactive:Y3,dragging:Q3,resizeHandle:X3,left:K3,right:Z3,phaseStaff:J3,subphaseStaff:eI,barLabel:tI,vacationCellMarker:nI,phantomRow:sI};function hi(n){const s=n.children??[];let r=!1;for(const i of s)if(hi(i)!==null){r=!0;break}if(r){let i=0,l=0;for(const d of s){const u=hi(d),h=Math.max(1,Math.ceil((new Date(d.end_date).getTime()-new Date(d.start_date).getTime())/(1e3*60*60*24)));l+=(u??0)*h,i+=h}if(i>0)return Math.round(l/i)}return n.completion??null}function ng(n){const s=n.children??[];let r=!1;for(const i of s)if(hi(i)!==null){r=!0;break}if(r){let i=0,l=0;for(const d of s){const u=hi(d),h=Math.max(1,Math.ceil((new Date(d.end_date).getTime()-new Date(d.start_date).getTime())/(1e3*60*60*24)));l+=(u??0)*h,i+=h}if(i>0)return Math.round(l/i)}return n.completion??null}function aI(n){const s=n.phases??[];if(s.length===0)return null;let r=0,i=0;return s.forEach(l=>{const d=ng(l);if(d!=null){const u=new Date(l.start_date),h=new Date(l.end_date),p=Math.max(1,(h.getTime()-u.getTime())/(1e3*60*60*24));r+=d*p,i+=p}}),i>0?Math.round(r/i):null}const rI=f.memo(function({project:s,cells:r,cellWidth:i,isExpanded:l,expandedPhases:d,expandedSubphases:u}){const{openPhaseModal:h,openSubphaseModal:p,setEditingPhase:m,setEditingSubphase:v}=xe(),y=xe(ue=>ue.phantomSiblingMode),b=G(ue=>ue.viewMode),w=G(ue=>ue.customColumnFilters),x=G(ue=>ue.customColumnValues),_=G(ue=>ue.showAssignments),S=G(ue=>ue.criticalPathEnabled),C=G(ue=>ue.criticalPathItems),B=S.has(s.id)?C.get(s.id)||new Set:new Set,{startProjectDrag:D,startPhaseDrag:O,startSubphaseDrag:z,startStaffAssignmentDrag:R,startEquipmentAssignmentDrag:Q}=y0(),{startPhaseResize:H,startSubphaseResize:J,startStaffAssignmentResize:q,startEquipmentAssignmentResize:E}=v0(),{isLinkingDependency:L,linkingFrom:$,handleLinkZoneClick:M}=k0(),{startPhantom:k,isPhantomMode:P}=yi(),F=f.useCallback((ue,we)=>{const ie=Object.keys(w).filter(Ae=>w[Number(Ae)]?.length>0);if(ie.length===0)return!0;for(const Ae of ie){const Bt=Number(Ae),Es=w[Bt],$s=`${Bt}-${ue}-${we}`,Xn=x[$s]??null;if(Xn===null){if(!Es.includes("__empty__"))return!1}else if(!Es.includes(Xn))return!1}return!0},[w,x]),A=f.useCallback(ue=>{for(const we of ue)if(F("subphase",we.id)||we.children&&we.children.length>0&&A(we.children))return!0;return!1},[F]),I=f.useMemo(()=>(s.phases??[]).filter(ue=>F("phase",ue.id)||A(ue.children??[])),[s.phases,F,A]),U=f.useMemo(()=>{if(!s.start_date||!s.end_date){let ue=null,we=null;return(s.phases??[]).forEach(ie=>{(!ue||ie.start_date<ue)&&(ue=ie.start_date),(!we||ie.end_date>we)&&(we=ie.end_date)}),ue&&we?xn(ue,we,r,i,b):null}return xn(s.start_date,s.end_date,r,i,b)},[s,r,i,b]),N=f.useMemo(()=>aI(s),[s]),W=f.useCallback(ue=>{if(!s.start_date||!s.end_date){console.warn("Project has no dates, cannot drag");return}D(ue,s.id,s.start_date,s.end_date)},[D,s.id,s.start_date,s.end_date]),K=f.useCallback((ue,we,ie)=>{O(ue,we.id,s.id,we.start_date,we.end_date,we.is_milestone,ie)},[O,s.id]),te=f.useCallback((ue,we,ie,Ae)=>{H(ue,we.id,s.id,ie,we.start_date,we.end_date,Ae)},[H,s.id]),Y=f.useCallback(ue=>{m(ue),h(ue,s.id)},[m,h,s.id]),me=f.useCallback((ue,we,ie,Ae)=>{z(ue,we.id,s.id,ie,we.start_date,we.end_date,we.is_milestone,Ae)},[z,s.id]),ge=f.useCallback((ue,we,ie,Ae)=>{J(ue,we.id,s.id,ie,we.start_date,we.end_date,Ae)},[J,s.id]),pe=f.useCallback((ue,we)=>{v(ue),p(ue,we,s.id)},[v,p,s.id]),oe=f.useCallback((ue,we,ie,Ae)=>{R(ue,we,s.id,ie,Ae)},[R,s.id]),le=f.useCallback((ue,we,ie,Ae,Bt)=>{q(ue,we,s.id,ie,Ae,Bt)},[q,s.id]),se=f.useCallback((ue,we,ie,Ae)=>{Q(ue,we,s.id,ie,Ae)},[Q,s.id]),De=f.useCallback((ue,we,ie,Ae,Bt)=>{E(ue,we,s.id,ie,Ae,Bt)},[E,s.id]),We=f.useCallback((ue,we,ie,Ae)=>{M(ue,s.id,we,ie,Ae)},[M,s.id]),ot=f.useCallback((ue,we,ie)=>{P||L||k({projectId:s.id,sourceId:ue,type:we,zone:ie})},[k,s.id,P,L]),ce=$?.projectId===s.id?$.itemId:null,ae=$?.projectId===s.id?$.itemType:null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`${Dt.row} ${Dt.projectRow}`,"data-project-id":s.id,children:U&&e.jsx(w3,{left:U.left,width:U.width,name:s.name,confirmed:s.confirmed,completion:N,projectId:s.id,startDate:s.start_date||"",endDate:s.end_date||"",onDragStart:W})}),l&&e.jsxs(e.Fragment,{children:[I.map(ue=>{const we=y?.type==="phase"&&y.projectId===s.id&&y.sourceId===ue.id;return e.jsxs(f.Fragment,{children:[e.jsx(iI,{phase:ue,projectId:s.id,cells:r,cellWidth:i,viewMode:b,isExpanded:d.has(ue.id),expandedSubphases:u,depth:1,onPhaseDragStart:K,onPhaseResizeStart:te,onPhaseClick:Y,onSubphaseDragStart:me,onSubphaseResizeStart:ge,onSubphaseClick:pe,onLinkZoneClick:We,isLinkingDependency:L,linkingFromId:ce,linkingFromType:ae,onPhantomStart:ot,entityPassesFilters:F,anyDescendantMatches:A,showAssignments:_,criticalPathItems:B}),we&&e.jsx("div",{className:Dt.phantomRow})]},ue.id)}),_&&(s.staffAssignments??[]).map(ue=>e.jsx("div",{className:Dt.row,children:e.jsx(cr,{assignmentId:ue.id,assignmentType:"staff",projectId:s.id,startDate:ue.start_date,endDate:ue.end_date,cells:r,cellWidth:i,viewMode:b,type:"staff",name:ue.staff_name,allocation:ue.allocation,staffId:ue.staff_id,interactive:!0,onDragStart:we=>oe(we,ue.id,ue.start_date,ue.end_date),onResizeStart:(we,ie)=>le(we,ue.id,ie,ue.start_date,ue.end_date)})},`staff-${ue.id}`)),_&&(s.equipmentAssignments??[]).map(ue=>e.jsx("div",{className:Dt.row,children:e.jsx(cr,{assignmentId:ue.id,assignmentType:"equipment",projectId:s.id,startDate:ue.start_date,endDate:ue.end_date,cells:r,cellWidth:i,viewMode:b,type:"equipment",name:ue.equipment_name,equipmentId:ue.equipment_id,interactive:!0,onDragStart:we=>se(we,ue.id,ue.start_date,ue.end_date),onResizeStart:(we,ie)=>De(we,ue.id,ie,ue.start_date,ue.end_date)})},`equip-${ue.id}`))]})]})}),iI=f.memo(function({phase:s,projectId:r,cells:i,cellWidth:l,viewMode:d,isExpanded:u,expandedSubphases:h,depth:p,onPhaseDragStart:m,onPhaseResizeStart:v,onPhaseClick:y,onSubphaseDragStart:b,onSubphaseResizeStart:w,onSubphaseClick:x,onLinkZoneClick:_,isLinkingDependency:S,linkingFromId:C,linkingFromType:B,onPhantomStart:D,entityPassesFilters:O,anyDescendantMatches:z,showAssignments:R,criticalPathItems:Q}){const H=xe(N=>N.phantomSiblingMode),{recentChanges:J}=eu(),E=f.useMemo(()=>J.find(N=>N.entity_type==="phase"&&N.entity_id===s.id),[J,s.id])?.user_name??null,L=f.useMemo(()=>(s.children??[]).filter(N=>O("subphase",N.id)||z(N.children??[])),[s.children,O,z]),$=f.useMemo(()=>xn(s.start_date,s.end_date,i,l,d),[s.start_date,s.end_date,i,l,d]),M=f.useMemo(()=>ng(s),[s]),k=f.useCallback((N,W)=>{m(N,s,W)},[m,s]),P=f.useCallback((N,W,K)=>{v(N,s,W,K)},[v,s]),F=f.useCallback(N=>{N.stopPropagation(),y(s)},[y,s]),A=f.useCallback((N,W)=>{_(N,s.id,"phase",W)},[_,s.id]),I=f.useCallback(N=>{D(s.id,"phase",N)},[D,s.id]),U=S&&B==="phase"&&C===s.id;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:Dt.row,"data-phase-id":s.id,children:$&&e.jsx(tg,{left:$.left,width:$.width,color:s.color,name:s.name,isMilestone:!!s.is_milestone,completion:M,isCriticalPath:Q.has(`phase-${s.id}`),changedBy:E,phaseId:s.id,projectId:r,startDate:s.start_date,endDate:s.end_date,onDragStart:k,onResizeStart:s.is_milestone?void 0:P,onClick:F,onLinkZoneClick:A,isLinkingSource:U,isLinkingActive:S,onPhantomStart:I})}),u&&e.jsxs(e.Fragment,{children:[L.map(N=>{const W=H?.type==="subphase"&&H.projectId===r&&H.parentType==="phase"&&H.parentId===s.id&&H.sourceId===N.id;return e.jsxs(f.Fragment,{children:[e.jsx(oI,{subphase:N,phaseId:s.id,projectId:r,cells:i,cellWidth:l,viewMode:d,isExpanded:h.has(N.id),expandedSubphases:h,depth:p+1,onSubphaseDragStart:b,onSubphaseResizeStart:w,onSubphaseClick:x,onLinkZoneClick:_,isLinkingDependency:S,linkingFromId:C,linkingFromType:B,onPhantomStart:D,entityPassesFilters:O,anyDescendantMatches:z,showAssignments:R,criticalPathItems:Q}),W&&e.jsx("div",{className:Dt.phantomRow})]},N.id)}),R&&(s.staffAssignments??[]).map(N=>e.jsx("div",{className:Dt.row,children:e.jsx(cr,{assignmentId:N.id,assignmentType:"staff",projectId:r,phaseId:s.id,startDate:s.start_date,endDate:s.end_date,cells:i,cellWidth:l,viewMode:d,type:"phase-staff",name:N.staff_name,allocation:N.allocation,phaseColor:s.color,staffId:N.staff_id})},`staff-${N.id}`)),R&&(s.equipmentAssignments??[]).map(N=>e.jsx("div",{className:Dt.row,children:e.jsx(cr,{assignmentId:N.id,assignmentType:"equipment",projectId:r,phaseId:s.id,startDate:s.start_date,endDate:s.end_date,cells:i,cellWidth:l,viewMode:d,type:"equipment",name:N.equipment_name,equipmentId:N.equipment_id})},`equip-${N.id}`))]})]})}),oI=f.memo(function n({subphase:s,phaseId:r,projectId:i,cells:l,cellWidth:d,viewMode:u,isExpanded:h,expandedSubphases:p,depth:m,onSubphaseDragStart:v,onSubphaseResizeStart:y,onSubphaseClick:b,onLinkZoneClick:w,isLinkingDependency:x,linkingFromId:_,linkingFromType:S,onPhantomStart:C,entityPassesFilters:B,anyDescendantMatches:D,showAssignments:O,criticalPathItems:z}){const R=xe(I=>I.phantomSiblingMode),{recentChanges:Q}=eu(),J=f.useMemo(()=>Q.find(I=>I.entity_type==="subphase"&&I.entity_id===s.id),[Q,s.id])?.user_name??null,q=f.useMemo(()=>(s.children??[]).filter(I=>B("subphase",I.id)||D(I.children??[])),[s.children,B,D]),E=f.useMemo(()=>xn(s.start_date,s.end_date,l,d,u),[s.start_date,s.end_date,l,d,u]),L=f.useMemo(()=>hi(s),[s]),$=f.useCallback((I,U)=>{v(I,s,r,U)},[v,s,r]),M=f.useCallback((I,U,N)=>{y(I,s,U,N)},[y,s]),k=f.useCallback(I=>{I.stopPropagation(),b(s,r)},[b,s,r]),P=f.useCallback((I,U)=>{w(I,s.id,"subphase",U)},[w,s.id]),F=f.useCallback(I=>{C(s.id,"subphase",I)},[C,s.id]),A=x&&S==="subphase"&&_===s.id;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:Dt.row,"data-subphase-id":s.id,children:E&&e.jsx(tg,{left:E.left,width:E.width,color:s.color,name:s.name,isSubphase:!0,isMilestone:!!s.is_milestone,completion:L,isCriticalPath:z.has(`subphase-${s.id}`),changedBy:J,phaseId:s.id,projectId:i,startDate:s.start_date,endDate:s.end_date,onDragStart:$,onResizeStart:s.is_milestone?void 0:M,onClick:k,onLinkZoneClick:P,isLinkingSource:A,isLinkingActive:x,onPhantomStart:F})}),h&&e.jsxs(e.Fragment,{children:[q.map(I=>{const U=R?.type==="subphase"&&R.projectId===i&&R.sourceId===I.id;return e.jsxs(f.Fragment,{children:[e.jsx(n,{subphase:I,phaseId:r,projectId:i,cells:l,cellWidth:d,viewMode:u,isExpanded:p.has(I.id),expandedSubphases:p,depth:m+1,onSubphaseDragStart:v,onSubphaseResizeStart:y,onSubphaseClick:b,onLinkZoneClick:w,isLinkingDependency:x,linkingFromId:_,linkingFromType:S,onPhantomStart:C,entityPassesFilters:B,anyDescendantMatches:D,showAssignments:O,criticalPathItems:z}),U&&e.jsx("div",{className:Dt.phantomRow})]},I.id)}),O&&(s.staffAssignments??[]).map(I=>e.jsx("div",{className:Dt.row,children:e.jsx(cr,{assignmentId:I.id,assignmentType:"staff",projectId:i,phaseId:r,subphaseId:s.id,startDate:s.start_date,endDate:s.end_date,cells:l,cellWidth:d,viewMode:u,type:"subphase-staff",name:I.staff_name,allocation:I.allocation,phaseColor:s.color,staffId:I.staff_id})},`staff-${I.id}`)),O&&(s.equipmentAssignments??[]).map(I=>e.jsx("div",{className:Dt.row,children:e.jsx(cr,{assignmentId:I.id,assignmentType:"equipment",projectId:i,phaseId:r,subphaseId:s.id,startDate:s.start_date,endDate:s.end_date,cells:l,cellWidth:d,viewMode:u,type:"equipment",name:I.equipment_name,equipmentId:I.equipment_id})},`equip-${I.id}`))]})]})}),cr=f.memo(function({assignmentId:s,assignmentType:r,projectId:i,phaseId:l,subphaseId:d,startDate:u,endDate:h,cells:p,cellWidth:m,viewMode:v,type:y,name:b,allocation:w,phaseColor:x,staffId:_,equipmentId:S,onDragStart:C,onResizeStart:B,interactive:D=!1}){const O=G(M=>M.vacations),z=f.useMemo(()=>xn(u,h,p,m,v),[u,h,p,m,v]),R=f.useMemo(()=>{if(!_||r!=="staff")return[];const M=O.filter(P=>!(P.staff_id!==_||_i(P.description)));if(M.length===0)return[];const k=[];return p.forEach((P,F)=>{const A=new Date(P.date),I=new Date(A);I.setDate(I.getDate()+1);const U=M.find(N=>{const W=new Date(N.start_date),K=new Date(N.end_date);return K.setDate(K.getDate()+1),W<I&&K>A});if(U){const N=k[k.length-1],W=F*m;N&&N.left+N.width===W&&N.title===(U.description||"Vacation")?N.width+=m:k.push({left:W,width:m,title:U.description||"Vacation"})}}),k},[_,r,O,p,m]);if(!z)return null;const Q=y==="phase-staff",H=y==="subphase-staff",J=y==="phase-staff"||y==="subphase-staff"?"staff":y,q={left:z.left,width:z.width};Q&&(q.opacity=.7,x&&(q.background=x),q.border="1px dashed rgba(255,255,255,0.4)"),H&&(q.opacity=.7,q.height="14px",x&&(q.background=x));const E=b?w?`${b} (${w}%)`:b:w?`${w}%`:"",L=M=>{M.target.classList.contains("resize-handle")||C&&C(M)},$=(M,k)=>{M.stopPropagation(),B&&B(M,k)};return e.jsxs(e.Fragment,{children:[R.map((M,k)=>e.jsx("div",{className:Dt.vacationCellMarker,style:{left:M.left,width:M.width},title:M.title},`vac-${k}`)),e.jsxs("div",{className:`${Dt.assignmentBar} ${Dt[J]} ${Q?Dt.phaseStaff:""} ${H?Dt.subphaseStaff:""} ${D?Dt.interactive:""}`,style:q,title:E,"data-assignment-id":s,"data-assignment-type":r,"data-start":u,"data-end":h,onMouseDown:D?L:void 0,children:[D&&e.jsx("div",{className:`${Dt.resizeHandle} ${Dt.left} resize-handle`,onMouseDown:M=>$(M,"left")}),e.jsx("span",{className:Dt.barLabel,children:E}),D&&e.jsx("div",{className:`${Dt.resizeHandle} ${Dt.right} resize-handle`,onMouseDown:M=>$(M,"right")})]})]})}),lI="_line_16bxs_1",cI="_marker_16bxs_11",qm={line:lI,marker:cI},gl=f.memo(function({position:s}){return e.jsx("div",{className:qm.line,style:{left:s},children:e.jsx("div",{className:qm.marker})})}),dI="_popup_17gls_3",uI="_header_17gls_15",hI="_typeLabel_17gls_24",fI="_closeButton_17gls_30",mI="_content_17gls_50",pI="_connection_17gls_54",gI="_fromTo_17gls_66",_I="_name_17gls_71",yI="_footer_17gls_79",vI="_deleteButton_17gls_85",Mn={popup:dI,header:uI,typeLabel:hI,closeButton:fI,content:mI,connection:pI,fromTo:gI,name:_I,footer:yI,deleteButton:vI},xI={FS:"Finish-to-Start",SS:"Start-to-Start",FF:"Finish-to-Finish",SF:"Start-to-Finish"},jI=f.memo(function({visible:s,x:r,y:i,dependencyType:l,fromName:d,toName:u,onClose:h,onDelete:p}){const m=f.useRef(null);f.useEffect(()=>{if(!s)return;const w=_=>{m.current&&!m.current.contains(_.target)&&h()},x=setTimeout(()=>{document.addEventListener("mousedown",w)},100);return()=>{clearTimeout(x),document.removeEventListener("mousedown",w)}},[s,h]),f.useEffect(()=>{if(!s)return;const w=x=>{x.key==="Escape"&&h()};return document.addEventListener("keydown",w),()=>document.removeEventListener("keydown",w)},[s,h]);const v=f.useCallback(()=>{confirm(`Remove this ${l} dependency?`)&&p()},[l,p]);if(!s)return null;const y=Math.min(r,window.innerWidth-250),b=Math.min(i,window.innerHeight-180);return e.jsxs("div",{ref:m,className:Mn.popup,style:{left:y,top:b},children:[e.jsxs("div",{className:Mn.header,children:[e.jsx("span",{className:Mn.typeLabel,children:xI[l]}),e.jsx("button",{className:Mn.closeButton,onClick:h,title:"Close",children:""})]}),e.jsxs("div",{className:Mn.content,children:[e.jsxs("div",{className:Mn.connection,children:[e.jsx("span",{className:Mn.fromTo,children:"From:"}),e.jsx("span",{className:Mn.name,children:d})]}),e.jsxs("div",{className:Mn.connection,children:[e.jsx("span",{className:Mn.fromTo,children:"To:"}),e.jsx("span",{className:Mn.name,children:u})]})]}),e.jsx("div",{className:Mn.footer,children:e.jsx("button",{className:Mn.deleteButton,onClick:v,children:"Delete Dependency"})})]})}),wI="_layer_7cyyn_5",SI="_dependency_7cyyn_16",CI="_arrow_7cyyn_20",bI="_hitArea_7cyyn_24",Bo={layer:wI,dependency:SI,arrow:CI,hitArea:bI},kI=f.memo(function({projects:s,cells:r,cellWidth:i,rowPositions:l}){const d=G(q=>q.viewMode),u=G(q=>q.setProjects),h=G(q=>q.showAssignments),p=G(q=>q.customColumnFilters),m=xe(q=>q.isDragging),v=f.useRef(null),[y,b]=f.useState(new Map),[w,x]=f.useState(0),[_,S]=f.useState(null);f.useEffect(()=>{if(!m)return;const q=setInterval(()=>{x(E=>E+1)},33);return()=>clearInterval(q)},[m]),f.useEffect(()=>{const q=requestAnimationFrame(()=>{if(!v.current)return;const E=v.current.parentElement?.querySelector('[class*="rows"]');if(!E)return;const L=new Map;E.querySelectorAll("[data-phase-id]").forEach(k=>{const P=k.getAttribute("data-phase-id");if(P){const F=k.getBoundingClientRect(),A=E.getBoundingClientRect();L.set(`phase-${P}`,{top:F.top-A.top,height:F.height})}}),E.querySelectorAll("[data-subphase-id]").forEach(k=>{const P=k.getAttribute("data-subphase-id");if(P){const F=k.getBoundingClientRect(),A=E.getBoundingClientRect();L.set(`subphase-${P}`,{top:F.top-A.top,height:F.height})}}),b(L)});return()=>cancelAnimationFrame(q)},[s,l,h,p,m,w]);const C=y.size>0?y:l,B=f.useMemo(()=>h0(s),[s]),D=f.useMemo(()=>B.filter(q=>{const E=`${q.fromType}-${q.fromId}`,L=`${q.toType}-${q.toId}`;return l.has(E)&&l.has(L)}),[B,l]),O=f.useMemo(()=>{const q=new Map;return s.forEach(E=>{(E.phases??[]).forEach(L=>{q.set(`phase-${L.id}`,{start_date:L.start_date,end_date:L.end_date,color:L.color});const $=(M,k)=>{(M??[]).forEach(P=>{q.set(`subphase-${P.id}`,{start_date:P.start_date,end_date:P.end_date,color:P.color||k}),P.children?.length&&$(P.children,P.color||k)})};$(L.children,L.color)})}),q},[s]),z=f.useMemo(()=>D.map(q=>{const E=`${q.fromType}-${q.fromId}`,L=`${q.toType}-${q.toId}`,$=C.get(E),M=C.get(L),k=O.get(E),P=O.get(L);if(!$||!M||!k||!P)return null;const F=xn(k.start_date,k.end_date,r,i,d),A=xn(P.start_date,P.end_date,r,i,d);if(!F||!A)return null;const{sourceEdge:I,targetEdge:U}=p0(q.type),N=I==="start"?F.left:F.left+F.width,W=U==="start"?A.left:A.left+A.width,K=$.top+$.height/2,te=M.top+M.height/2,Y=m0(N,K,W,te,q.type);return{...q,path:Y,fromX:N,fromY:K,toX:W,toY:te,sourceColor:k.color}}).filter(q=>q!==null),[D,C,O,r,i,d]),R=f.useMemo(()=>{const q=new Map;return s.forEach(E=>{(E.phases??[]).forEach(L=>{q.set(`phase-${L.id}`,L.name);const $=M=>{(M??[]).forEach(k=>{q.set(`subphase-${k.id}`,k.name),k.children?.length&&$(k.children)})};$(L.children)})}),q},[s]),Q=f.useCallback((q,E)=>{if(!E)return;const L=R.get(`${E.fromType}-${E.fromId}`)||"Unknown",$=R.get(`${E.toType}-${E.toId}`)||"Unknown";S({id:E.id,type:E.type,fromId:E.fromId,toId:E.toId,fromType:E.fromType,toType:E.toType,projectId:E.projectId,fromName:L,toName:$,x:q.clientX,y:q.clientY})},[R]),H=f.useCallback(()=>{S(null)},[]),J=f.useCallback(async()=>{if(_)try{const q=s.map(L=>{if(L.id!==_.projectId)return L;if(_.toType==="phase")return{...L,phases:(L.phases??[]).map($=>{if($.id!==_.toId)return $;const M=($.dependencies??[]).filter(k=>!(k.id===_.fromId&&k.type===_.type));return{...$,dependencies:M}})};{const $=M=>M.map(k=>{if(k.id===_.toId){const P=(k.dependencies??[]).filter(F=>!(F.id===_.fromId&&F.type===_.type));return{...k,dependencies:P}}return k.children?.length?{...k,children:$(k.children)}:k});return{...L,phases:(L.phases??[]).map(M=>({...M,children:$(M.children??[])}))}}});u(q),S(null);const E=s.find(L=>L.id===_.projectId);if(!E)return;if(_.toType==="phase"){const L=(E.phases??[]).find($=>$.id===_.toId);if(L){const $=(L.dependencies??[]).filter(M=>!(M.id===_.fromId&&M.type===_.type));await ra(_.toId,{start_date:L.start_date,end_date:L.end_date,dependencies:$})}}else{const L=M=>{for(const k of M){if(k.id===_.toId)return k;if(k.children?.length){const P=L(k.children);if(P)return P}}return null};let $=null;for(const M of E.phases??[])if($=L(M.children??[]),$)break;if($){const M=($.dependencies??[]).filter(k=>!(k.id===_.fromId&&k.type===_.type));await ia(_.toId,{start_date:$.start_date,end_date:$.end_date,dependencies:M})}}}catch(q){console.error("Failed to delete dependency:",q);const E=await Rt();u(E)}},[_,s,u]);return e.jsxs(e.Fragment,{children:[e.jsx("svg",{ref:v,className:Bo.layer,style:z.length===0?{display:"none"}:void 0,children:z.map(q=>{if(!q)return null;const E=f0[q.type],L=q.sourceColor||rl(),$=`arrow-${q.id}`;return e.jsxs("g",{className:Bo.dependency,children:[e.jsx("defs",{children:e.jsx("marker",{id:$,markerWidth:"6",markerHeight:"5",refX:"5",refY:"2.5",orient:"auto",markerUnits:"strokeWidth",children:e.jsx("polygon",{points:"0 0, 6 2.5, 0 5",fill:L})})}),e.jsx("path",{d:q.path,stroke:L,strokeWidth:"1.5",fill:"none",strokeLinejoin:"round",strokeLinecap:"round",strokeDasharray:E.dashArray,markerEnd:`url(#${$})`,className:Bo.arrow}),e.jsx("path",{d:q.path,stroke:"transparent",strokeWidth:"10",fill:"none",className:Bo.hitArea,"data-dependency-id":q.id,onClick:M=>Q(M,q)})]},q.id)})}),e.jsx(jI,{visible:_!==null,x:_?.x??0,y:_?.y??0,dependencyType:_?.type??"FS",fromName:_?.fromName??"",toName:_?.toName??"",onClose:H,onDelete:J})]})}),NI="_lagIndicator_1so8k_5",DI="_positive_1so8k_18",EI="_negative_1so8k_23",$I="_resizeIndicator_1so8k_29",TI="_duration_1so8k_47",MI="_date_1so8k_52",sr={lagIndicator:NI,positive:DI,negative:EI,resizeIndicator:$I,duration:TI,date:MI};function PI(n){return new Date(n).toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"})}const II=f.memo(function({visible:s,left:r,top:i,type:l,lagDays:d,date:u,duration:h,edge:p}){if(!s)return null;if(l==="drag"&&d!==void 0){const m=d>=0,v=m?`+${d}d`:`${d}d`;return e.jsx("div",{className:`${sr.lagIndicator} ${m?sr.positive:sr.negative}`,style:{left:r,top:i},children:v})}if(l==="resize"&&u){const m=p==="left"?"translateX(-100%)":"translateX(0)";return e.jsxs("div",{className:sr.resizeIndicator,style:{left:r,top:i,transform:m},children:[e.jsxs("span",{className:sr.duration,children:[h,"d"]}),e.jsx("span",{className:sr.date,children:PI(u)})]})}return null}),LI="_overlay_yits3_3",AI="_phantomRow_yits3_11",RI="_phantomBar_yits3_22",BI="_barLabel_yits3_40",OI="_indicator_yits3_51",FI="_positive_yits3_70",zI="_negative_yits3_74",HI="_lag_yits3_78",WI="_depType_yits3_82",qI="_arrowSvg_yits3_90",qn={overlay:LI,phantomRow:AI,phantomBar:RI,barLabel:BI,indicator:OI,positive:FI,negative:zI,lag:HI,depType:WI,arrowSvg:qI};function UI(n,s,r){const i=s==="phase"?"data-phase-id":"data-subphase-id",l=r.querySelector(`[${i}="${n}"]`);if(!l)return null;const d=l.querySelector('[class*="phaseBar"], [class*="bar"], [class*="milestone"]');if(!d)return null;const u=d.getBoundingClientRect(),h=r.getBoundingClientRect();return{left:u.left-h.left+r.scrollLeft,width:u.width,top:l.offsetTop,height:l.clientHeight||32}}function VI(n,s){for(const r of n){const i=sg(r.children||[],s);if(i)return i}return null}function sg(n,s){for(const r of n){if(r.id===s)return r;if(r.children&&r.children.length>0){const i=sg(r.children,s);if(i)return i}}return null}function fd(n){const s=n.split("T")[0];return new Date(s+"T12:00:00")}function GI({cells:n,cellWidth:s,viewMode:r,timelineRef:i,containerWidth:l,containerHeight:d,phantomRowTop:u}){const h=xe(q=>q.phantomSiblingMode),p=xe(q=>q.updatePhantomPosition),m=G(q=>q.projects),{completePhantom:v}=yi(),[y,b]=f.useState(null);f.useEffect(()=>{if(!h||!i.current){b(null);return}const{sourceId:q,type:E}=h,L=()=>{if(i.current){const M=UI(q,E,i.current);b(M)}},$=requestAnimationFrame(()=>{L(),requestAnimationFrame(L)});return()=>cancelAnimationFrame($)},[h,i]);const w=f.useCallback(q=>{if(!h||!i.current)return;const{siblingDurationDays:E}=h,L=i.current.getBoundingClientRect(),$=i.current.scrollLeft,M=q.clientX-L.left+$;if(n.length===0)return;const k=new Date(n[0].date);k.setHours(0,0,0,0);const P=n[n.length-1],F=new Date(P.date);F.setHours(23,59,59,999);const A=n.length*s,U=(F.getTime()-k.getTime())/A,N=(E-1)*24*60*60*1e3,W=N/U/2,K=M-W,te=Math.max(0,Math.min(K,A-N/U)),Y=k.getTime()+te*U,me=new Date(Y);me.setHours(0,0,0,0);const ge=Gn(me,E-1);p(kt(me,"yyyy-MM-dd"),kt(ge,"yyyy-MM-dd"))},[h,i,n,s,p]),x=f.useCallback(q=>{if(!h)return;const E=q.target;(E.closest(`.${qn.phantomRow}`)||E.closest(`.${qn.phantomBar}`))&&(q.preventDefault(),q.stopPropagation(),v())},[h,v]);f.useEffect(()=>{if(!h||!i.current)return;const q=i.current;return q.addEventListener("mousemove",w),q.addEventListener("click",x,!0),()=>{q.removeEventListener("mousemove",w),q.removeEventListener("click",x,!0)}},[h,w,x,i]);const _=f.useMemo(()=>{if(!h)return null;const{phantomStart:q,phantomEnd:E,phantomColor:L,type:$,dependencyType:M,sourceId:k,projectId:P}=h,F=xn(q,E,n,s,r);if(!F)return null;const A=m.find(te=>te.id===P);if(!A)return null;let I;if($==="phase"?I=(A.phases||[]).find(te=>te.id===k):I=VI(A.phases||[],k)||void 0,!I)return null;const U=fd(q),N=fd(I.start_date),W=fd(I.end_date);let K;if(M==="SS")K=Ns(U,N);else{const te=Gn(W,1);K=Ns(U,te)}return{barPosition:F,phantomColor:L,type:$,dependencyType:M,lagDays:K,sourceBar:y}},[h,n,s,r,m,y]);if(!h||!_||!_.sourceBar)return null;const{barPosition:S,phantomColor:C,type:B,dependencyType:D,lagDays:O,sourceBar:z}=_,R=O>=0?`+${O}d`:`${O}d`,Q=u??z.top+z.height,H=24,J=Q+(32-H)/2;return e.jsxs("div",{className:qn.overlay,children:[e.jsx("div",{className:qn.phantomRow,style:{top:Q,width:l},onClick:q=>{q.stopPropagation(),v()}}),e.jsx("div",{className:qn.phantomBar,style:{left:S.left,top:J,width:S.width,height:H,backgroundColor:`${C}80`,borderColor:C},onClick:q=>{q.stopPropagation(),v()},children:e.jsxs("span",{className:qn.barLabel,children:["New ",B==="phase"?"Phase":"Subphase"]})}),e.jsxs("div",{className:`${qn.indicator} ${O>=0?qn.positive:qn.negative}`,style:{left:S.left+S.width/2,top:Q-28,borderColor:C},children:[e.jsx("span",{className:qn.lag,children:R}),e.jsx("span",{className:qn.depType,children:D})]}),e.jsxs("svg",{className:qn.arrowSvg,width:l,height:d,children:[e.jsx("defs",{children:e.jsx("marker",{id:"phantomArrowhead",markerWidth:"8",markerHeight:"6",refX:"7",refY:"3",orient:"auto",markerUnits:"strokeWidth",children:e.jsx("path",{d:"M0,0 L0,6 L8,3 z",fill:C})})}),e.jsx("path",{d:YI(z,{left:S.left,top:J+H/2},D),stroke:C,strokeWidth:"2",fill:"none",strokeDasharray:"5,3",markerEnd:"url(#phantomArrowhead)",opacity:"0.8"})]})]})}function YI(n,s,r){const l=n.top+n.height/2;let d;r==="SS"?d=n.left:d=n.left+n.width;const u=s.left,h=s.top;if(r==="SS"){const p=Math.min(d,u)-15;return`M${d},${l} H${p} V${h} H${u}`}else if(u>d+15){const p=d+(u-d)/2;return`M${d},${l} H${p} V${h} H${u}`}else{const p=d+15,m=Math.max(l,h)+20;return`M${d},${l} H${p} V${m} H${u-15} V${h} H${u}`}}const QI="_overlay_12ij7_3",XI="_dropZone_12ij7_14",KI="_previewBar_12ij7_24",ZI="_staff_12ij7_35",JI="_equipment_12ij7_40",e6="_previewLabel_12ij7_45",t6="_instructions_12ij7_56",n6="_hint_12ij7_78",ta={overlay:QI,dropZone:XI,previewBar:KI,staff:ZI,equipment:JI,previewLabel:e6,instructions:t6,hint:n6},Oo=5;function s6({projects:n,cells:s,cellWidth:r,totalWidth:i,containerRef:l,rowPositions:d}){const u=xe(E=>E.resourceDrag),h=xe(E=>E.endResourceDrag),p=G(E=>E.setProjects),m=G(E=>E.staff),v=G(E=>E.ensureProjectExpanded),y=G(E=>E.ensurePhaseExpanded),b=G(E=>E.ensureSubphaseExpanded),w=f.useRef(null),[x,_]=f.useState(null),[S,C]=f.useState(null),B=f.useCallback(E=>m.find($=>$.id===E)?.max_capacity??100,[m]),D=f.useCallback(()=>{h(),document.body.classList.remove("resource-dragging")},[h]);f.useEffect(()=>{const E=L=>{L.key==="Escape"&&D()};return document.addEventListener("keydown",E),()=>document.removeEventListener("keydown",E)},[D]);const O=f.useCallback(E=>{if(s.length===0)return kt(new Date,"yyyy-MM-dd");const L=Math.floor(E/r),$=Math.max(0,Math.min(L,s.length-1));return s[$]?.dateStr||kt(new Date,"yyyy-MM-dd")},[s,r]),z=f.useCallback(E=>{for(const L of n){const $=`project-${L.id}`,M=d.get($);if(M&&E>=M.top&&E<M.top+M.height)return{projectId:L.id,phaseId:null,subphaseId:null,rowKey:$};for(const k of L.phases||[]){const P=`phase-${k.id}`,F=d.get(P);if(F&&E>=F.top&&E<F.top+F.height)return{projectId:L.id,phaseId:k.id,subphaseId:null,rowKey:P};const A=(U,N)=>{for(const W of U||[]){const K=`subphase-${W.id}`,te=d.get(K);if(te&&E>=te.top&&E<te.top+te.height)return{projectId:L.id,phaseId:N,subphaseId:W.id,rowKey:K};if(W.children?.length){const Y=A(W.children,N);if(Y)return Y}}return null},I=A(k.children,k.id);if(I)return I}}return null},[n,d]),R=f.useCallback((E,L)=>{if(!l.current)return;const $=l.current.getBoundingClientRect(),M=l.current.scrollLeft||0,k=l.current.scrollTop||0,P=E-$.left+M,F=L-$.top+k;_(P),C(z(F))},[l,z]),Q=f.useCallback(E=>{E.preventDefault(),E.stopPropagation(),E.dataTransfer.dropEffect="copy",R(E.clientX,E.clientY)},[R]),H=f.useCallback(async E=>{if(E.preventDefault(),E.stopPropagation(),!S||!u.resourceId||x===null){h(),document.body.classList.remove("resource-dragging");return}const L=O(x-r*Oo/2),$=kt(Gn(new Date(L),Oo-1),"yyyy-MM-dd"),M=!S.phaseId&&!S.subphaseId,k=S.phaseId&&!S.subphaseId,P=!!S.subphaseId;try{if(u.type==="staff"){const A=B(u.resourceId);await Wd({staff_id:u.resourceId,allocation:A,start_date:L,end_date:$,project_id:S.projectId,phase_id:k?S.phaseId:void 0,subphase_id:P?S.subphaseId:void 0})}else u.type==="equipment"&&await qd({equipment_id:u.resourceId,start_date:L,end_date:$,project_id:S.projectId,phase_id:k?S.phaseId:void 0,subphase_id:P?S.subphaseId:void 0});M?v(S.projectId):k&&S.phaseId?(v(S.projectId),y(S.phaseId)):P&&S.subphaseId&&(v(S.projectId),S.phaseId&&y(S.phaseId),b(S.subphaseId));const F=await Rt();p(F)}catch(F){console.error("Failed to create assignment:",F)}finally{h(),document.body.classList.remove("resource-dragging")}},[S,u,x,r,O,h,p,v,y,b,B]),J=f.useCallback(E=>{const L=E.relatedTarget;w.current&&!w.current.contains(L)&&(C(null),_(null))},[]),q=f.useMemo(()=>{if(!S||x===null)return null;const E=d.get(S.rowKey);if(!E)return null;const L=r*Oo,$=x-L/2,M=E.top+(E.height-20)/2;return{left:Math.max(0,$),top:M,width:L,height:20}},[S,x,r,d]);return u.active?e.jsxs("div",{ref:w,className:ta.overlay,onDragOver:Q,onDrop:H,onDragLeave:J,children:[S&&e.jsx("div",{className:ta.dropZone,style:{top:d.get(S.rowKey)?.top||0,height:d.get(S.rowKey)?.height||32,width:i}}),q&&e.jsx("div",{className:`${ta.previewBar} ${u.type==="staff"?ta.staff:ta.equipment}`,style:{left:q.left,top:q.top,width:q.width,height:q.height},children:e.jsxs("span",{className:ta.previewLabel,children:[u.resourceName," (",Oo,"d",u.type==="staff"&&u.resourceId?`, ${B(u.resourceId)}%`:"",")"]})}),e.jsxs("div",{className:ta.instructions,children:[e.jsxs("span",{children:["Drop to place ",u.type==="staff"?"staff":"equipment"," assignment"]}),e.jsx("span",{className:ta.hint,children:"Press Esc to cancel"})]})]}):null}const a6="_body_1b8rs_1",r6="_content_1b8rs_25",i6="_grid_1b8rs_32",o6="_gridCell_1b8rs_61",l6="_weekend_1b8rs_69",c6="_holiday_1b8rs_74",d6="_companyEvent_1b8rs_79",u6="_tooltipLayer_1b8rs_84",h6="_tooltipCell_1b8rs_95",f6="_event_1b8rs_110",m6="_rows_1b8rs_140",p6="_dropTarget_1b8rs_146",gn={body:a6,content:r6,grid:i6,gridCell:o6,weekend:l6,holiday:c6,companyEvent:d6,tooltipLayer:u6,tooltipCell:h6,event:f6,rows:m6,dropTarget:p6},g6=f.forwardRef(function({cells:s,projects:r,cellWidth:i,totalWidth:l,viewMode:d},u){const h=G(L=>L.expandedProjects),p=G(L=>L.expandedPhases),m=G(L=>L.expandedSubphases),v=G(L=>L.showAssignments),y=G(L=>L.customColumnFilters),b=G(L=>L.customColumnValues),w=xe(L=>L.dragIndicator),x=xe(L=>L.phantomSiblingMode),_=xe(L=>L.resourceDrag),S=f.useRef(null),C=L=>{S.current=L,typeof u=="function"?u(L):u&&(u.current=L)},B=f.useMemo(()=>fl(s,i),[s,i]),D=f.useCallback((L,$)=>{const M=Object.keys(y).filter(k=>y[Number(k)]?.length>0);if(M.length===0)return!0;for(const k of M){const P=Number(k),F=y[P],A=`${P}-${L}-${$}`,I=b[A]??null;if(I===null){if(!F.includes("__empty__"))return!1}else if(!F.includes(I))return!1}return!0},[y,b]),O=f.useCallback(L=>{for(const $ of L)if(D("subphase",$.id)||$.children&&$.children.length>0&&O($.children))return!0;return!1},[D]),z=x?{projectId:x.projectId,sourceId:x.sourceId,type:x.type,parentId:x.parentId,parentType:x.parentType}:null,R=Object.keys(y).some(L=>y[Number(L)]?.length>0),Q=f.useMemo(()=>g0(r,h,p,m,z,v,R?D:void 0,R?O:void 0),[r,h,p,m,z,v,R,D,O]),H=d==="week"||d==="month",J=Q.totalHeight+100,q=f.useCallback(L=>{(L.dataTransfer.types.includes("application/json")||_.active)&&(L.preventDefault(),L.dataTransfer.dropEffect="copy")},[_.active]),E=f.useCallback(L=>{(L.dataTransfer.types.includes("application/json")||_.active)&&L.preventDefault()},[_.active]);return e.jsx("div",{ref:C,className:gn.body,children:e.jsxs("div",{className:`${gn.content} ${_.active?gn.dropTarget:""}`,style:{width:l,"--cell-width":`${i}px`},onDragOver:q,onDragEnter:E,children:[e.jsxs("div",{className:gn.grid,children:[H&&s.map((L,$)=>L.isWeekend?e.jsx("div",{className:`${gn.gridCell} ${gn.weekend}`,style:{left:$*i,width:i}},`weekend-${$}`):null),H&&s.map((L,$)=>L.isBankHoliday?e.jsx("div",{className:`${gn.gridCell} ${gn.holiday}`,style:{left:$*i,width:i}},`holiday-bg-${$}`):null),H&&s.map((L,$)=>L.isCompanyEvent?e.jsx("div",{className:`${gn.gridCell} ${gn.companyEvent}`,style:{left:$*i,width:i}},`event-bg-${$}`):null)]}),B!==null&&e.jsx(gl,{position:B}),e.jsx("div",{className:gn.rows,children:r.map(L=>e.jsx(rI,{project:L,cells:s,cellWidth:i,isExpanded:h.has(L.id),expandedPhases:p,expandedSubphases:m},L.id))}),H&&e.jsx("div",{className:gn.tooltipLayer,children:s.map((L,$)=>L.isBankHoliday?e.jsx("div",{className:`${gn.tooltipCell} ${gn.holiday}`,style:{left:$*i,width:i},"data-tooltip":L.bankHolidayName||"Holiday"},`tooltip-${$}`):L.isCompanyEvent?e.jsx("div",{className:`${gn.tooltipCell} ${gn.event}`,style:{left:$*i,width:i},"data-tooltip":L.companyEventName||"Company Event"},`tooltip-${$}`):null)}),e.jsx(kI,{projects:r,cells:s,cellWidth:i,rowPositions:Q.positions}),x&&e.jsx(GI,{cells:s,cellWidth:i,viewMode:d,timelineRef:S,containerWidth:l,containerHeight:J,phantomRowTop:Q.phantomRowTop}),e.jsx(II,{visible:w.visible,left:w.left,top:w.top,type:w.type,lagDays:w.lagDays,date:w.date,duration:w.duration,edge:w.edge}),_.active&&e.jsx(s6,{projects:r,cells:s,cellWidth:i,totalWidth:l,containerRef:S,rowPositions:Q.positions})]})})}),ag=f.createContext(null);function _6({children:n}){const s=f.useRef(new Map),r=f.useRef(0),i=f.useRef(null),l=f.useRef(null),d=f.useCallback((m,v)=>{s.current.set(m,v),requestAnimationFrame(()=>{if(s.current.size>1&&v.current){for(const[y,b]of s.current)if(y!==m&&b.current){const w=b.current.scrollLeft;w>0&&(r.current=w,v.current.scrollLeft=w);break}}else v.current&&r.current>0&&(v.current.scrollLeft=r.current)})},[]),u=f.useCallback(m=>{s.current.delete(m)},[]),h=f.useCallback((m,v)=>{i.current&&i.current!==m||(i.current=m,r.current=v,s.current.forEach((y,b)=>{b!==m&&y.current&&(y.current.scrollLeft=v)}),l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{i.current=null},100))},[]),p=f.useCallback(()=>r.current,[]);return e.jsx(ag.Provider,{value:{registerScrollContainer:d,unregisterScrollContainer:u,syncScroll:h,getScrollLeft:p},children:n})}function su(n,s,r=!0){const i=f.useContext(ag),l=f.useRef(()=>{});f.useEffect(()=>{l.current=h=>{!i||!r||i.syncScroll(n,h)}},[i,n,r]),f.useEffect(()=>{if(!(!i||!r))return i.registerScrollContainer(n,s),requestAnimationFrame(()=>{const h=i.getScrollLeft();s.current&&h>0&&(s.current.scrollLeft=h)}),()=>i.unregisterScrollContainer(n)},[i,n,s,r]);const d=f.useCallback(h=>{!i||!r||i.syncScroll(n,h.currentTarget.scrollLeft)},[i,n,r]),u=f.useCallback(h=>{l.current(h)},[]);return{handleScroll:d,syncScrollPosition:u}}const y6="_timeline_44m9x_1",v6="_horizontalScroll_44m9x_9",x6="_scrollContent_44m9x_33",md={timeline:y6,horizontalScroll:v6,scrollContent:x6},j6=200,w6=f.forwardRef(function({cells:s,headers:r,projects:i,cellWidth:l,viewMode:d,hasCustomColumns:u=!1},h){const p=s.length*l,m=f.useRef(null),v=xe(I=>I.scrollToTodayTrigger),y=xe(I=>I.scrollToDateTrigger),b=xe(I=>I.clearScrollToDateTrigger),w=xe(I=>I.zoomTrigger),x=xe(I=>I.clearZoomTrigger),_=G(I=>I.timelineScrollLeft),S=G(I=>I.setTimelineScrollLeft),C=G(I=>I.showStaffOverview),B=G(I=>I.showEquipmentOverview),D=f.useRef(!1),O=f.useRef(null),z=f.useRef(d),R=f.useRef(l),Q=f.useRef(null),H=f.useRef(0),[J,q]=f.useState(_);pl({containerRef:m,cellWidth:l});const E=C||B,{handleScroll:L,syncScrollPosition:$}=su("gantt-timeline",m,E),M=f.useCallback(()=>{const I=m.current;if(!I||s.length===0)return null;const U=I.scrollLeft,N=Math.floor(U/l);return s[Math.min(N,s.length-1)]?.dateStr||null},[s,l]),k=f.useCallback(()=>{const I=m.current;if(!I||s.length===0)return null;const U=I.scrollLeft+I.clientWidth/2,N=Math.floor(U/l);return s[Math.min(N,s.length-1)]?.dateStr||null},[s,l]),P=f.useCallback(I=>{const U=m.current;if(!U||s.length===0)return;let N=s.findIndex(K=>K.dateStr>=I);N===-1?N=s.length-1:N>0&&s[N].dateStr!==I&&(N=N-1);const W=N*l;U.scrollLeft=W},[s,l]),F=f.useCallback(I=>{const U=m.current;if(!U||s.length===0)return;let N=s.findIndex(te=>te.dateStr>=I);N===-1&&(N=s.length-1);const K=N*l+l/2-U.clientWidth/2;U.scrollLeft=Math.max(0,K)},[s,l]);f.useEffect(()=>{const I=m.current;!I||D.current||(_>0?requestAnimationFrame(()=>{I.scrollLeft=_,D.current=!0,Q.current=M(),$(_)}):D.current=!0)},[_,M]),f.useEffect(()=>{if(!w||w.timestamp===H.current)return;H.current=w.timestamp;const I=m.current;if(!I){x();return}const U=k();x(),U&&requestAnimationFrame(()=>{F(U),S(I.scrollLeft),$(I.scrollLeft)})},[w,x,k,F,S]),f.useEffect(()=>{z.current!==d&&D.current&&Q.current&&requestAnimationFrame(()=>{P(Q.current);const U=m.current;U&&(S(U.scrollLeft),$(U.scrollLeft))}),z.current=d,R.current=l},[d,l,P,S]);const A=f.useCallback(I=>{const U=m.current;!U||!D.current||(Q.current=M(),q(U.scrollLeft),O.current&&clearTimeout(O.current),O.current=setTimeout(()=>{S(U.scrollLeft)},j6),L(I))},[S,M,L]);return f.useEffect(()=>{if(v===0)return;const I=m.current;if(!I)return;const U=s.findIndex(N=>N.isToday);if(U!==-1){const N=I.clientWidth,W=U*l,K=Math.max(0,W-N/2+l/2);E?(I.scrollLeft=K,$(K)):I.scrollTo({left:K,behavior:"smooth"})}},[v,s,l,E,$]),f.useEffect(()=>{if(!y)return;const I=m.current;if(!I)return;const U=y.date;let N=s.findIndex(W=>W.dateStr>=U);if(N===-1&&(N=s.length-1),N!==-1){const W=I.clientWidth,K=N*l,te=Math.max(0,K-W/4);E?(I.scrollLeft=te,$(te)):I.scrollTo({left:te,behavior:"smooth"})}b()},[y,s,l,b,E,$]),f.useEffect(()=>()=>{O.current&&clearTimeout(O.current)},[]),e.jsx("div",{className:md.timeline,children:e.jsx("div",{ref:m,className:md.horizontalScroll,onScroll:A,style:{"--print-scroll-left":`${-J}px`},children:e.jsxs("div",{className:md.scrollContent,style:{width:p},children:[e.jsx(vi,{headers:r,cells:s,cellWidth:l,totalWidth:p,viewMode:d,hasCustomColumns:u}),e.jsx(g6,{ref:h,cells:s,projects:i,cellWidth:l,totalWidth:p,viewMode:d})]})})})});function S6(n,s){const r=f.useCallback((i,l)=>{i==="project"&&s.current?s.current.scrollTop=l:i==="timeline"&&n.current&&(n.current.scrollTop=l)},[n,s]);f.useEffect(()=>{const i=n.current,l=s.current;if(!i||!l)return;let d=!1;const u=()=>{d||(d=!0,r("project",i.scrollTop),requestAnimationFrame(()=>{d=!1}))},h=()=>{d||(d=!0,r("timeline",l.scrollTop),requestAnimationFrame(()=>{d=!1}))};return i.addEventListener("scroll",u,{passive:!0}),l.addEventListener("scroll",h,{passive:!0}),()=>{i.removeEventListener("scroll",u),l.removeEventListener("scroll",h)}},[n,s,r])}const C6="_body_9rood_3",b6="_content_9rood_23",k6="_grid_9rood_29",N6="_gridCell_9rood_56",D6="_weekend_9rood_64",E6="_holiday_9rood_68",$6="_companyEvent_9rood_72",T6="_tooltipLayer_9rood_77",M6="_tooltipCell_9rood_88",P6="_event_9rood_103",I6="_rows_9rood_135",L6="_staffWrapper_9rood_141",A6="_bankHolidaysWrapper_9rood_154",R6="_companyEventsWrapper_9rood_169",B6="_row_9rood_135",O6="_bar_9rood_195",F6="_vacationBar_9rood_214",z6="_assignmentBar_9rood_220",H6="_barLabel_9rood_224",W6="_detailBar_9rood_236",q6="_vacationDetailBar_9rood_242",U6="_assignmentDetailBar_9rood_247",V6="_holidayDetailBar_9rood_251",G6="_customHolidayBar_9rood_256",Y6="_eventDetailBar_9rood_261",Q6="_workloadCell_9rood_267",X6="_overloaded_9rood_277",K6="_vacation_9rood_214",Z6="_conflict_9rood_283",J6="_workloadIndicator_9rood_289",eL="_full_9rood_304",tL="_partial_9rood_309",Oe={body:C6,content:b6,grid:k6,gridCell:N6,weekend:D6,holiday:E6,companyEvent:$6,tooltipLayer:T6,tooltipCell:M6,event:P6,rows:I6,staffWrapper:L6,bankHolidaysWrapper:A6,companyEventsWrapper:R6,row:B6,bar:O6,vacationBar:F6,assignmentBar:z6,barLabel:H6,detailBar:W6,vacationDetailBar:q6,assignmentDetailBar:U6,holidayDetailBar:V6,customHolidayBar:G6,eventDetailBar:Y6,workloadCell:Q6,overloaded:X6,vacation:K6,conflict:Z6,workloadIndicator:J6,full:eL,partial:tL},nL=f.forwardRef(function({staff:s,assignmentsMap:r,vacationsMap:i,rowHeights:l,expandedStaff:d,expandedBankHolidays:u,expandedCompanyEvents:h,cells:p,cellWidth:m,totalWidth:v,viewMode:y},b){const w=G(D=>D.bankHolidays),x=G(D=>D.companyEvents),_=G(D=>D.currentUser),S=y==="week"||y==="month",C=f.useMemo(()=>fl(p,m),[p,m]),B=D=>_?_.role==="admin"||_.role==="superuser"?!0:_.id===D:!1;return e.jsx("div",{ref:b,className:Oe.body,children:e.jsxs("div",{className:Oe.content,style:{width:v,"--cell-width":`${m}px`},children:[e.jsxs("div",{className:Oe.grid,children:[S&&p.map((D,O)=>D.isWeekend?e.jsx("div",{className:`${Oe.gridCell} ${Oe.weekend}`,style:{left:O*m,width:m}},`weekend-${O}`):null),S&&p.map((D,O)=>D.isBankHoliday?e.jsx("div",{className:`${Oe.gridCell} ${Oe.holiday}`,style:{left:O*m,width:m}},`holiday-${O}`):null),S&&p.map((D,O)=>D.isCompanyEvent?e.jsx("div",{className:`${Oe.gridCell} ${Oe.companyEvent}`,style:{left:O*m,width:m}},`event-${O}`):null)]}),C!==null&&e.jsx(gl,{position:C}),e.jsxs("div",{className:Oe.rows,children:[s.map(D=>{const O=d.has(D.id),z=i.get(D.id)||[],R=r.get(D.id)||[],Q=B(D.id);return e.jsxs("div",{className:Oe.staffWrapper,children:[e.jsx(sL,{staffMember:D,assignments:R,vacations:z,rowHeight:l.get(D.id)||44,cells:p,cellWidth:m,viewMode:y}),O&&e.jsxs(e.Fragment,{children:[z.map(H=>e.jsx(aL,{vacation:H,cells:p,cellWidth:m,viewMode:y},`v-${H.id}`)),Q&&e.jsx("div",{className:Oe.row,style:{height:Yn}}),R.map(H=>e.jsx(rL,{assignment:H,cells:p,cellWidth:m,viewMode:y},`a-${H.id}-${H.level}`)),R.length===0&&z.length===0&&!Q&&e.jsx("div",{className:Oe.row,style:{height:Yn}})]})]},D.id)}),e.jsx(iL,{isExpanded:u,holidays:w,cells:p,cellWidth:m,viewMode:y}),e.jsx(oL,{isExpanded:h,events:x,cells:p,cellWidth:m,viewMode:y})]}),S&&e.jsx("div",{className:Oe.tooltipLayer,children:p.map((D,O)=>D.isBankHoliday?e.jsx("div",{className:`${Oe.tooltipCell} ${Oe.holiday}`,style:{left:O*m,width:m},"data-tooltip":D.bankHolidayName||"Holiday"},`tooltip-${O}`):D.isCompanyEvent?e.jsx("div",{className:`${Oe.tooltipCell} ${Oe.event}`,style:{left:O*m,width:m},"data-tooltip":D.companyEventName||"Company Event"},`tooltip-${O}`):null)})]})})});function sL({staffMember:n,assignments:s,vacations:r,rowHeight:i,cells:l,cellWidth:d,viewMode:u}){const{openVacationModal:h}=xe(),p=n.max_capacity??100,m=w0(s,r,l,p),v=u==="week"||u==="month",y=f.useMemo(()=>{const x=[];s.forEach(C=>{let B=C.projectName;C.phaseName&&(B+=` - ${C.phaseName}`),B+=` (${C.allocation}%)`,x.push({type:"assignment",id:C.id,startDate:C.start_date,endDate:C.end_date,label:B,allocation:C.allocation,data:C})}),r.forEach(C=>{_i(C.description)||x.push({type:"vacation",id:C.id,startDate:C.start_date,endDate:C.end_date,label:C.description||"Vacation",data:C})}),x.sort((C,B)=>C.startDate.localeCompare(B.startDate));const _=[];x.forEach(C=>{let B=!1;for(const D of _)if(C.startDate>D.end){D.end=C.endDate,D.items.push(C),B=!0;break}B||_.push({end:C.endDate,items:[C]})});const S=[];return _.forEach((C,B)=>{C.items.forEach(D=>{const O=xn(D.startDate,D.endDate,l,d,u);O&&S.push({type:D.type,id:D.id,left:O.left,width:O.width,top:Bd+B*(Rd+rg),label:D.label,allocation:D.allocation,data:D.data})})}),S},[s,r,l,d,u]),b=x=>{x.type==="vacation"&&h(x.data)},w=i-Od;return e.jsxs("div",{className:Oe.row,style:{height:i},children:[v&&m.map((x,_)=>x.total===0&&!x.isOnVacation?null:e.jsx("div",{className:`${Oe.workloadCell} ${Oe[x.state]}`,style:{left:_*d,width:d,top:w,height:Od,...C0(x)},title:S0(x),children:e.jsx("div",{className:`${Oe.workloadIndicator} ${Oe[x.state]}`,children:x.state==="vacation"?"OFF":x.state==="conflict"?"0%":`${x.total}%`})},`workload-${_}`)),y.map((x,_)=>e.jsx("div",{className:`${Oe.bar} ${x.type==="vacation"?Oe.vacationBar:Oe.assignmentBar}`,style:{left:x.left,width:x.width,top:x.top,height:Rd},title:x.label,onClick:()=>b(x),children:e.jsx("span",{className:Oe.barLabel,children:x.label})},`${x.type}-${x.id}-${_}`))]})}function aL({vacation:n,cells:s,cellWidth:r,viewMode:i}){const l=f.useMemo(()=>xn(n.start_date,n.end_date,s,r,i),[n,s,r,i]);return l?e.jsx("div",{className:Oe.row,style:{height:Yn},children:e.jsx("div",{className:`${Oe.detailBar} ${Oe.vacationDetailBar}`,style:{left:l.left,width:l.width,height:20,top:6},title:n.description||"Vacation"})}):e.jsx("div",{className:Oe.row,style:{height:Yn}})}function rL({assignment:n,cells:s,cellWidth:r,viewMode:i}){const l=f.useMemo(()=>xn(n.start_date,n.end_date,s,r,i),[n,s,r,i]);return l?e.jsx("div",{className:Oe.row,style:{height:Yn},children:e.jsx("div",{className:`${Oe.detailBar} ${Oe.assignmentDetailBar}`,style:{left:l.left,width:l.width,height:20,top:6},title:`${n.projectName} (${n.allocation}%)`})}):e.jsx("div",{className:Oe.row,style:{height:Yn}})}function iL({isExpanded:n,holidays:s,cells:r,cellWidth:i,viewMode:l}){const u=G(p=>p.currentUser),h=u?.role==="admin"||u?.role==="superuser";return e.jsxs("div",{className:Oe.bankHolidaysWrapper,children:[e.jsx("div",{className:Oe.row,style:{height:44}}),n&&e.jsxs(e.Fragment,{children:[s.map(p=>{const m=xn(p.date,p.end_date||p.date,r,i,l);return e.jsx("div",{className:Oe.row,style:{height:Yn},children:m&&e.jsx("div",{className:`${Oe.detailBar} ${Oe.holidayDetailBar} ${p.is_custom?Oe.customHolidayBar:""}`,style:{left:m.left,width:m.width,height:20,top:6},title:p.name})},p.id)}),s.length===0&&e.jsx("div",{className:Oe.row,style:{height:Yn}}),h&&e.jsx("div",{className:Oe.row,style:{height:Yn}})]})]})}function oL({isExpanded:n,events:s,cells:r,cellWidth:i,viewMode:l}){const u=G(p=>p.currentUser),h=u?.role==="admin"||u?.role==="superuser";return e.jsxs("div",{className:Oe.companyEventsWrapper,children:[e.jsx("div",{className:Oe.row,style:{height:44}}),n&&e.jsxs(e.Fragment,{children:[s.map(p=>{const m=xn(p.date,p.end_date||p.date,r,i,l);return e.jsx("div",{className:Oe.row,style:{height:Yn},children:m&&e.jsx("div",{className:`${Oe.detailBar} ${Oe.eventDetailBar}`,style:{left:m.left,width:m.width,height:20,top:6},title:p.name})},p.id)}),s.length===0&&e.jsx("div",{className:Oe.row,style:{height:Yn}}),h&&e.jsx("div",{className:Oe.row,style:{height:Yn}})]})]})}const lL="_container_1b7op_3",cL="_embedded_1b7op_11",dL="_panel_1b7op_19",uL="_resizer_1b7op_33",hL="_panelHeader_1b7op_45",fL="_headerLeft_1b7op_61",mL="_headerTitle_1b7op_67",pL="_headerCount_1b7op_73",gL="_panelBody_1b7op_81",_L="_empty_1b7op_101",yL="_staffWrapper_1b7op_113",vL="_bankHolidaysWrapper_1b7op_118",xL="_companyEventsWrapper_1b7op_124",jL="_staffRow_1b7op_130",wL="_draggable_1b7op_145",SL="_dragHandle_1b7op_154",CL="_expandIcon_1b7op_173",bL="_expanded_1b7op_185",kL="_status_1b7op_189",NL="_available_1b7op_198",DL="_overloaded_1b7op_202",EL="_partTime_1b7op_207",$L="_staffInfo_1b7op_211",TL="_staffName_1b7op_217",ML="_partTimeBadge_1b7op_230",PL="_staffMeta_1b7op_240",IL="_overloadedText_1b7op_246",LL="_rowActions_1b7op_251",AL="_iconBtn_1b7op_258",RL="_expandedContent_1b7op_280",BL="_detailRow_1b7op_285",OL="_clickable_1b7op_299",FL="_detailType_1b7op_308",zL="_vacation_1b7op_317",HL="_allocation_1b7op_322",WL="_bankHoliday_1b7op_118",qL="_detailName_1b7op_334",UL="_dateBadge_1b7op_342",VL="_deleteBtn_1b7op_348",GL="_addRow_1b7op_369",YL="_addIcon_1b7op_378",QL="_addText_1b7op_387",XL="_vacationRow_1b7op_392",KL="_recurringRow_1b7op_397",ZL="_recurringBadge_1b7op_407",JL="_recurringDays_1b7op_417",eA="_customHoliday_1b7op_425",tA="_deleteAction_1b7op_430",nA="_bankHolidaysRow_1b7op_457",sA="_companyEventsRow_1b7op_467",aA="_bankHolidayStatus_1b7op_471",rA="_companyEventStatus_1b7op_485",iA="_companyEvent_1b7op_124",oA="_noAssignments_1b7op_495",lA="_timeline_1b7op_501",cA="_timelineScroll_1b7op_509",dA="_timelineContent_1b7op_531",uA="_timelineHeaderSpacer_1b7op_539",hA="_confirmOverlay_1b7op_547",fA="_confirmModal_1b7op_561",mA="_confirmIcon_1b7op_571",pA="_confirmTitle_1b7op_583",gA="_confirmText_1b7op_590",_A="_confirmWarning_1b7op_601",yA="_confirmActions_1b7op_607",vA="_confirmCancel_1b7op_613",xA="_confirmDelete_1b7op_614",jA="_filterWrapper_1b7op_653",wA="_filterTrigger_1b7op_657",SA="_hasFilters_1b7op_678",CA="_filterLabel_1b7op_689",bA="_chevron_1b7op_696",kA="_open_1b7op_701",NA="_filterDropdown_1b7op_705",DA="_filterActions_1b7op_734",EA="_filterActionBtn_1b7op_742",$A="_filterColumns_1b7op_761",TA="_filterColumn_1b7op_761",MA="_filterSectionTitle_1b7op_784",PA="_filterOptions_1b7op_795",IA="_filterOption_1b7op_795",LA="_filterCheckboxInput_1b7op_828",AA="_filterCheckbox_1b7op_828",RA="_checkIcon_1b7op_849",BA="_filterOptionText_1b7op_874",OA="_skillDot_1b7op_882",FA="_filterEmptyColumn_1b7op_896",fe={container:lL,embedded:cL,panel:dL,resizer:uL,panelHeader:hL,headerLeft:fL,headerTitle:mL,headerCount:pL,panelBody:gL,empty:_L,staffWrapper:yL,bankHolidaysWrapper:vL,companyEventsWrapper:xL,staffRow:jL,draggable:wL,dragHandle:SL,expandIcon:CL,expanded:bL,status:kL,available:NL,overloaded:DL,partTime:EL,staffInfo:$L,staffName:TL,partTimeBadge:ML,staffMeta:PL,overloadedText:IL,rowActions:LL,iconBtn:AL,expandedContent:RL,detailRow:BL,clickable:OL,detailType:FL,vacation:zL,allocation:HL,bankHoliday:WL,detailName:qL,dateBadge:UL,deleteBtn:VL,addRow:GL,addIcon:YL,addText:QL,vacationRow:XL,recurringRow:KL,recurringBadge:ZL,recurringDays:JL,customHoliday:eA,deleteAction:tA,bankHolidaysRow:nA,companyEventsRow:sA,bankHolidayStatus:aA,companyEventStatus:rA,companyEvent:iA,noAssignments:oA,timeline:lA,timelineScroll:cA,timelineContent:dA,timelineHeaderSpacer:uA,confirmOverlay:hA,confirmModal:fA,confirmIcon:mA,confirmTitle:pA,confirmText:gA,confirmWarning:_A,confirmActions:yA,confirmCancel:vA,confirmDelete:xA,filterWrapper:jA,filterTrigger:wA,hasFilters:SA,filterLabel:CA,chevron:bA,open:kA,filterDropdown:NA,filterActions:DA,filterActionBtn:EA,filterColumns:$A,filterColumn:TA,filterSectionTitle:MA,filterOptions:PA,filterOption:IA,filterCheckboxInput:LA,filterCheckbox:AA,checkIcon:RA,filterOptionText:BA,skillDot:OA,filterEmptyColumn:FA};function zA({isExpanded:n,onToggle:s}){const r=G(w=>w.currentSite),i=G(w=>w.currentUser),l=G(w=>w.bankHolidays),d=G(w=>w.setBankHolidays),{openModal:u}=xe(),h=i?.role==="admin"||i?.role==="superuser",p=l.reduce((w,x)=>{const _=x.year||new Date(x.date).getFullYear();return w[_]||(w[_]=[]),w[_].push(x),w},{}),m=w=>new Date(w).toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"}),v=()=>{if(l.length===0)return;const w=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Milestone//Bank Holidays//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH"];l.forEach(C=>{const B=C.date.replace(/-/g,""),D=new Date(C.end_date||C.date);D.setDate(D.getDate()+1);const O=D.toISOString().split("T")[0].replace(/-/g,"");w.push("BEGIN:VEVENT"),w.push(`UID:bankholiday-${C.id}@milestone`),w.push(`DTSTART;VALUE=DATE:${B}`),w.push(`DTEND;VALUE=DATE:${O}`),w.push(`SUMMARY:${C.name.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n")}`),w.push("TRANSP:TRANSPARENT"),w.push("END:VEVENT")}),w.push("END:VCALENDAR");const x=new Blob([w.join(`\r
`)],{type:"text/calendar"}),_=URL.createObjectURL(x),S=document.createElement("a");S.href=_,S.download=`bank-holidays-${r?.name||"site"}.ics`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(_)},y=()=>{u("customHoliday")},b=async w=>{if(r&&confirm("Delete this custom holiday?"))try{await mp(r.id,w);const x=await sa(r.id),_=gs(x);d(x,_)}catch(x){console.error("Failed to delete custom holiday:",x),alert("Failed to delete custom holiday")}};return e.jsxs("div",{className:fe.bankHolidaysWrapper,children:[e.jsxs("div",{className:`${fe.staffRow} ${fe.bankHolidaysRow} ${s?"":fe.noExpand}`,onClick:s,style:{cursor:s?"pointer":"default"},children:[s&&e.jsx("div",{className:`${fe.expandIcon} ${n?fe.expanded:""}`,children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})}),e.jsx("div",{className:`${fe.status} ${fe.bankHolidayStatus}`}),e.jsxs("div",{className:fe.staffInfo,children:[e.jsx("div",{className:fe.staffName,children:"Bank Holidays"}),e.jsxs("div",{className:fe.staffMeta,children:[e.jsx("span",{children:r?.name||"Site"}),e.jsx("span",{children:"  "}),e.jsxs("span",{children:[l.length," holidays"]})]})]}),e.jsxs("div",{className:fe.rowActions,onClick:w=>w.stopPropagation(),children:[e.jsx("button",{className:fe.iconBtn,onClick:v,title:"Export to Outlook",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})}),h&&e.jsx("button",{className:fe.iconBtn,onClick:y,title:"Add custom holiday",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})]})]}),n&&e.jsxs("div",{className:fe.expandedContent,children:[Object.keys(p).sort().map(w=>p[Number(w)].map(x=>{const _=x.end_date&&x.end_date!==x.date?`${m(x.date)} - ${m(x.end_date)}`:m(x.date);return e.jsxs("div",{className:`${fe.detailRow} ${x.is_custom?fe.customHoliday:""}`,children:[e.jsx("span",{className:`${fe.detailType} ${fe.bankHoliday}`,children:x.is_custom?"Custom":"Holiday"}),e.jsx("span",{className:fe.detailName,children:x.name}),e.jsx("span",{className:fe.dateBadge,children:_}),h&&x.is_custom&&e.jsx("button",{className:fe.deleteAction,onClick:S=>{S.stopPropagation(),b(x.id)},title:"Delete custom holiday",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},x.id)})),l.length===0&&e.jsx("div",{className:fe.detailRow,children:e.jsx("span",{className:fe.noAssignments,children:"No holidays loaded"})}),h&&e.jsxs("div",{className:`${fe.detailRow} ${fe.addRow}`,onClick:y,children:[e.jsx("span",{className:fe.addIcon,children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),e.jsx("span",{className:fe.addText,children:"Add custom holiday"})]})]})]})}function HA({isExpanded:n,onToggle:s}){const r=G(w=>w.currentSite),i=G(w=>w.currentUser),l=G(w=>w.companyEvents),d=G(w=>w.setCompanyEvents),{openModal:u}=xe(),h=i?.role==="admin"||i?.role==="superuser",p=l.reduce((w,x)=>{const _=new Date(x.date).getFullYear();return w[_]||(w[_]=[]),w[_].push(x),w},{}),m=w=>new Date(w).toLocaleDateString(void 0,{weekday:"short",day:"numeric",month:"short"}),v=()=>{if(l.length===0)return;const w=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Milestone//Company Events//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH"];l.forEach(C=>{const B=C.date.replace(/-/g,""),D=new Date(C.end_date||C.date);D.setDate(D.getDate()+1);const O=D.toISOString().split("T")[0].replace(/-/g,"");w.push("BEGIN:VEVENT"),w.push(`UID:companyevent-${C.id}@milestone`),w.push(`DTSTART;VALUE=DATE:${B}`),w.push(`DTEND;VALUE=DATE:${O}`),w.push(`SUMMARY:${C.name.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n")}`),w.push("TRANSP:TRANSPARENT"),w.push("END:VEVENT")}),w.push("END:VCALENDAR");const x=new Blob([w.join(`\r
`)],{type:"text/calendar"}),_=URL.createObjectURL(x),S=document.createElement("a");S.href=_,S.download=`company-events-${r?.name||"site"}.ics`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(_)},y=()=>{u("companyEvent")},b=async w=>{if(r&&confirm("Delete this company event?"))try{await yy(r.id,w);const x=await ci(r.id),_=di(x);d(x,_)}catch(x){console.error("Failed to delete company event:",x),alert("Failed to delete company event")}};return e.jsxs("div",{className:fe.companyEventsWrapper,children:[e.jsxs("div",{className:`${fe.staffRow} ${fe.companyEventsRow} ${s?"":fe.noExpand}`,onClick:s,style:{cursor:s?"pointer":"default"},children:[s&&e.jsx("div",{className:`${fe.expandIcon} ${n?fe.expanded:""}`,children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})}),e.jsx("div",{className:`${fe.status} ${fe.companyEventStatus}`}),e.jsxs("div",{className:fe.staffInfo,children:[e.jsx("div",{className:fe.staffName,children:"Company Events"}),e.jsxs("div",{className:fe.staffMeta,children:[e.jsx("span",{children:r?.name||"Site"}),e.jsx("span",{children:"  "}),e.jsxs("span",{children:[l.length," event",l.length!==1?"s":""]})]})]}),e.jsxs("div",{className:fe.rowActions,onClick:w=>w.stopPropagation(),children:[e.jsx("button",{className:fe.iconBtn,onClick:v,title:"Export to Outlook",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})}),h&&e.jsx("button",{className:fe.iconBtn,onClick:y,title:"Add company event",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})]})]}),n&&e.jsxs("div",{className:fe.expandedContent,children:[Object.keys(p).sort().map(w=>p[Number(w)].map(x=>{const _=x.end_date&&x.end_date!==x.date?`${m(x.date)} - ${m(x.end_date)}`:m(x.date);return e.jsxs("div",{className:fe.detailRow,children:[e.jsx("span",{className:`${fe.detailType} ${fe.companyEvent}`,children:"Event"}),e.jsx("span",{className:fe.detailName,children:x.name}),e.jsx("span",{className:fe.dateBadge,children:_}),h&&e.jsx("button",{className:fe.deleteAction,onClick:S=>{S.stopPropagation(),b(x.id)},title:"Delete company event",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},x.id)})),l.length===0&&e.jsx("div",{className:fe.detailRow,children:e.jsx("span",{className:fe.noAssignments,children:"No company events"})}),h&&e.jsxs("div",{className:`${fe.detailRow} ${fe.addRow}`,onClick:y,children:[e.jsx("span",{className:fe.addIcon,children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),e.jsx("span",{className:fe.addText,children:"Add company event"})]})]})]})}const Fo=44,Yn=32,Rd=14,rg=2,Bd=4,Od=18;function ig({embedded:n=!1,panelWidth:s,onPanelWidthChange:r,height:i}){const l=f.useRef(null),d=f.useRef(null),u=f.useRef(null),h=f.useRef(null),p=f.useRef(new Map),[m,v]=f.useState(new Map),[y,b]=f.useState(320),x=n?(s||324)-4:y,_=G(de=>de.staff),S=G(de=>de.projects),C=G(de=>de.vacations),B=G(de=>de.setVacations),D=G(de=>de.currentSite),O=G(de=>de.currentUser),z=G(de=>de.skills),R=G(de=>de.viewMode),Q=G(de=>de.currentDate),H=G(de=>de.cellWidth),J=G(de=>de.bankHolidayDates),q=G(de=>de.bankHolidays),E=G(de=>de.companyEventDates),L=G(de=>de.companyEvents),{openVacationModal:$}=xe(),M=xe(de=>de.scrollToTodayTrigger),{handleDragStart:k,handleDragEnd:P}=zp();pl({containerRef:u,cellWidth:H,enabled:!n});const{handleScroll:F}=su("staff-view",u,n),[A,I]=f.useState(new Set),[U,N]=f.useState(!1),[W,K]=f.useState(!1),[te,Y]=f.useState(new Set),[me,ge]=f.useState(new Set),[pe,oe]=f.useState(!1),[le,se]=f.useState(null),[De,We]=f.useState(!1);ml(l,d);const ot=f.useMemo(()=>_.filter(de=>de.site_id===D?.id&&de.active!==!1).sort((de,$e)=>de.name.localeCompare($e.name)),[_,D]),ce=f.useMemo(()=>{const de=new Set;return ot.forEach($e=>{$e.role&&de.add($e.role)}),Array.from(de).sort(($e,Le)=>$e.localeCompare(Le))},[ot]),ae=f.useMemo(()=>{let de=ot;return te.size>0&&(de=de.filter($e=>$e.role&&te.has($e.role))),me.size>0&&(de=de.filter($e=>$e.skills?.some(Le=>me.has(Le.id)))),de},[ot,te,me]);f.useEffect(()=>{const de=$e=>{h.current&&!h.current.contains($e.target)&&oe(!1)};return pe&&document.addEventListener("mousedown",de),()=>{document.removeEventListener("mousedown",de)}},[pe]);const ue=de=>{Y($e=>{const Le=new Set($e);return Le.has(de)?Le.delete(de):Le.add(de),Le})},we=de=>{ge($e=>{const Le=new Set($e);return Le.has(de)?Le.delete(de):Le.add(de),Le})},ie=()=>{Y(new Set),ge(new Set)},Ae=te.size>0||me.size>0,Bt=f.useMemo(()=>pi(Q,R,J,q,E,L),[Q,R,J,q,E,L]),Es=f.useMemo(()=>gi(Bt,R),[Bt,R]),$s=Bt.length*H;f.useEffect(()=>{if(n||!M||!u.current)return;const de=Bt.findIndex(lt=>lt.isToday);if(de===-1)return;const $e=u.current,Le=$e.clientWidth,Ge=de*H,Ue=Math.max(0,Ge-Le/2+H/2);$e.scrollTo({left:Ue,behavior:"smooth"})},[n,M,Bt,H]);const Xn=f.useMemo(()=>{const de=new Map;ae.forEach(Ge=>de.set(Ge.id,[]));let $e=0;const Le=(Ge,Ue,lt)=>{if(Ge)for(const gt of Ge)gt.staffAssignments?.forEach(ut=>{$e++;const ln=de.get(ut.staff_id)||[];ln.push({...ut,start_date:ut.start_date||gt.start_date,end_date:ut.end_date||gt.end_date,projectName:Ue.name,projectId:Ue.id,phaseName:lt.name,phaseId:lt.id,subphaseName:gt.name,subphaseId:gt.id,level:"subphase"}),de.set(ut.staff_id,ln)}),gt.children?.length&&Le(gt.children,Ue,lt)};return S.forEach(Ge=>{Ge.archived||(Ge.staffAssignments?.forEach(Ue=>{$e++;const lt=de.get(Ue.staff_id)||[];lt.push({...Ue,projectName:Ge.name,projectId:Ge.id,level:"project"}),de.set(Ue.staff_id,lt)}),Ge.phases?.forEach(Ue=>{Ue.staffAssignments?.forEach(lt=>{$e++;const gt=de.get(lt.staff_id)||[];gt.push({...lt,start_date:lt.start_date||Ue.start_date,end_date:lt.end_date||Ue.end_date,projectName:Ge.name,projectId:Ge.id,phaseName:Ue.name,phaseId:Ue.id,level:"phase"}),de.set(lt.staff_id,gt)}),Le(Ue.children,Ge,Ue)}))}),console.log("[StaffView] staffAssignmentsMap built:",{projectCount:S.length,staffCount:ae.length,totalAssignments:$e,mapEntries:Array.from(de.entries()).filter(([Ge,Ue])=>Ue.length>0).length}),de},[S,ae]),Ts=f.useMemo(()=>{const de=new Map;return ae.forEach($e=>de.set($e.id,[])),C.forEach($e=>{const Le=de.get($e.staff_id)||[];Le.push($e),de.set($e.staff_id,Le)}),de},[C,ae]),dr=f.useMemo(()=>{const de=new Map;return ae.forEach($e=>{const Le=Xn.get($e.id)||[],Ge=Ts.get($e.id)||[],Ue=WA(Le,Ge),gt=(Ue>0?Bd+(Rd+rg)*Ue:0)+Od+Bd;de.set($e.id,Math.max(Fo,gt))}),de},[ae,Xn,Ts]);f.useLayoutEffect(()=>{const $e=requestAnimationFrame(()=>{const Le=new Map;let Ge=!1;p.current.forEach((Ue,lt)=>{if(Ue){const gt=Ue.offsetHeight;Le.set(lt,gt),m.get(lt)!==gt&&(Ge=!0)}}),(Ge||Le.size!==m.size)&&v(Le)});return()=>cancelAnimationFrame($e)},[ae,y,s,m]);const Da=f.useMemo(()=>{const de=new Map;return ae.forEach($e=>{const Le=dr.get($e.id)||Fo,Ge=m.get($e.id)||0;de.set($e.id,Math.max(Fo,Le,Ge))}),de},[ae,dr,m]),Ea=f.useCallback(de=>$e=>{$e?p.current.set(de,$e):p.current.delete(de)},[]),ur=(de,$e)=>{const Le=new Date;Le.setHours(12,0,0,0);const Ge=new Date(de);Ge.setHours(0,0,0,0);const Ue=new Date($e);return Ue.setHours(23,59,59,999),Le>=Ge&&Le<=Ue},oa=de=>{const Le=(ae.find(ut=>ut.id===de)||ot.find(ut=>ut.id===de))?.max_capacity??100;if((Ts.get(de)||[]).some(ut=>ur(ut.start_date,ut.end_date)))return{available:0,maxCapacity:Le};const gt=(Xn.get(de)||[]).filter(ut=>ut.start_date&&ut.end_date&&ur(ut.start_date,ut.end_date)).reduce((ut,ln)=>ut+(ln.allocation||0),0);return{available:Le-gt,maxCapacity:Le}},la=f.useCallback(de=>{I($e=>{const Le=new Set($e);return Le.has(de)?Le.delete(de):Le.add(de),Le})},[]),_l=f.useCallback(de=>O?O.role==="admin"||O.role==="superuser"?!0:O.id===de:!1,[O]),Ms=O?.role==="admin"||O?.role==="superuser",hr=(de,$e)=>{const Le=new Date(de),Ge=new Date($e),Ue=lt=>lt.toLocaleDateString(void 0,{day:"numeric",month:"short"});return de===$e?Ue(Le):`${Ue(Le)} - ${Ue(Ge)}`},yl=f.useCallback((de,$e,Le)=>{se({vacationId:de,staffName:$e,description:Le})},[]),fr=f.useCallback(async()=>{if(le){We(!0);try{await jy(le.vacationId);const de=await qo();B(de),se(null)}catch(de){console.error("Failed to delete vacation:",de)}finally{We(!1)}}},[le,B]),$a=f.useCallback(()=>{se(null)},[]),mr=f.useCallback(de=>{de.preventDefault();const $e=de.clientX,Le=x,Ge=lt=>{const gt=lt.clientX-$e,ut=Math.max(200,Math.min(500,Le+gt));n&&r?r(ut):b(ut)},Ue=()=>{document.removeEventListener("mousemove",Ge),document.removeEventListener("mouseup",Ue),document.body.style.cursor="",document.body.style.userSelect=""};document.addEventListener("mousemove",Ge),document.addEventListener("mouseup",Ue),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[n,x,r]),pr={width:x},gr=n&&i?{height:i}:void 0,Ps=()=>{const de=te.size+me.size;return de===0?"Filter":`${de} filter${de>1?"s":""}`};return e.jsxs("div",{className:`${fe.container} ${n?fe.embedded:""}`,style:gr,children:[e.jsxs("div",{className:fe.panel,style:pr,children:[e.jsxs("div",{className:fe.panelHeader,children:[e.jsxs("div",{className:fe.headerLeft,children:[e.jsx("span",{className:fe.headerTitle,children:"Staff Overview"}),e.jsxs("span",{className:fe.headerCount,children:[ae.length,Ae?`/${ot.length}`:""]})]}),e.jsxs("div",{ref:h,className:fe.filterWrapper,children:[e.jsxs("button",{className:`${fe.filterTrigger} ${Ae?fe.hasFilters:""}`,onClick:()=>oe(!pe),"aria-expanded":pe,"aria-haspopup":"true",children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),e.jsx("span",{className:fe.filterLabel,children:Ps()}),e.jsx("svg",{className:`${fe.chevron} ${pe?fe.open:""}`,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),pe&&e.jsxs("div",{className:fe.filterDropdown,children:[Ae&&e.jsx("div",{className:fe.filterActions,children:e.jsx("button",{className:fe.filterActionBtn,onClick:ie,children:"Clear all filters"})}),e.jsxs("div",{className:fe.filterColumns,children:[e.jsxs("div",{className:fe.filterColumn,children:[e.jsx("div",{className:fe.filterSectionTitle,children:"Roles"}),e.jsx("div",{className:fe.filterOptions,children:ce.length>0?ce.map(de=>e.jsxs("label",{className:fe.filterOption,children:[e.jsx("input",{type:"checkbox",className:fe.filterCheckboxInput,checked:te.has(de),onChange:()=>ue(de)}),e.jsx("span",{className:fe.filterCheckbox,children:e.jsx("svg",{className:fe.checkIcon,width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("span",{className:fe.filterOptionText,children:de})]},de)):e.jsx("div",{className:fe.filterEmptyColumn,children:"No roles defined"})})]}),e.jsxs("div",{className:fe.filterColumn,children:[e.jsx("div",{className:fe.filterSectionTitle,children:"Skills"}),e.jsx("div",{className:fe.filterOptions,children:z.length>0?z.map(de=>e.jsxs("label",{className:fe.filterOption,children:[e.jsx("input",{type:"checkbox",className:fe.filterCheckboxInput,checked:me.has(de.id),onChange:()=>we(de.id)}),e.jsx("span",{className:fe.filterCheckbox,children:e.jsx("svg",{className:fe.checkIcon,width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsxs("span",{className:fe.filterOptionText,style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{className:fe.skillDot,style:{backgroundColor:de.color}}),de.name]})]},de.id)):e.jsx("div",{className:fe.filterEmptyColumn,children:"No skills defined"})})]})]})]})]})]}),e.jsxs("div",{className:fe.panelBody,ref:l,children:[ae.length===0?e.jsx("div",{className:fe.empty,children:e.jsx("p",{children:"No staff found"})}):ae.map(de=>{const{available:$e,maxCapacity:Le}=oa(de.id),Ge=Le<100,Ue=Da.get(de.id)||Fo,lt=A.has(de.id),gt=Ts.get(de.id)||[],ut=Xn.get(de.id)||[],ln=_l(de.id);return e.jsxs("div",{className:fe.staffWrapper,children:[e.jsxs("div",{ref:Ea(de.id),className:`${fe.staffRow} ${Ms?fe.draggable:""}`,style:{minHeight:Ue},onClick:()=>la(de.id),draggable:Ms,onDragStart:Ms?Et=>{Et.stopPropagation(),k(Et,"staff",de.id,de.name)}:void 0,onDragEnd:Ms?P:void 0,children:[Ms&&e.jsx("div",{className:fe.dragHandle,title:"Drag to assign",children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("circle",{cx:"9",cy:"5",r:"2"}),e.jsx("circle",{cx:"9",cy:"12",r:"2"}),e.jsx("circle",{cx:"9",cy:"19",r:"2"}),e.jsx("circle",{cx:"15",cy:"5",r:"2"}),e.jsx("circle",{cx:"15",cy:"12",r:"2"}),e.jsx("circle",{cx:"15",cy:"19",r:"2"})]})}),e.jsx("div",{className:`${fe.expandIcon} ${lt?fe.expanded:""}`,children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})}),e.jsx("div",{className:`${fe.status} ${$e>0?fe.available:fe.overloaded} ${Ge?fe.partTime:""}`,title:Ge?`Part-time: Max ${Le}% capacity`:"Full-time: 100% capacity"}),e.jsxs("div",{className:fe.staffInfo,children:[e.jsxs("div",{className:fe.staffName,children:[de.name,Ge&&e.jsxs("span",{className:fe.partTimeBadge,children:[Le,"%"]})]}),e.jsxs("div",{className:fe.staffMeta,children:[e.jsx("span",{children:de.role||"No title"}),e.jsx("span",{children:"  "}),e.jsxs("span",{className:$e<=0?fe.overloadedText:"",title:Ge?`${$e}% of ${Le}% max capacity`:void 0,children:[$e,"% available"]})]})]})]}),lt&&e.jsxs("div",{className:fe.expandedContent,children:[gt.map(Et=>{const Nn=_i(Et.description),xi=Nn?Nn.cleanDescription:Et.description||"Time Off";return e.jsxs("div",{className:`${fe.detailRow} ${ln?fe.clickable:""} ${fe.vacationRow} ${Nn?fe.recurringRow:""}`,onClick:ln?()=>$(Et,de.id):void 0,children:[e.jsx("span",{className:`${fe.detailType} ${fe.vacation}`,children:Nn?e.jsxs("span",{className:fe.recurringBadge,title:Td(Nn.daysOfWeek),children:[e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17 1l4 4-4 4"}),e.jsx("path",{d:"M3 11V9a4 4 0 0 1 4-4h14"}),e.jsx("path",{d:"M7 23l-4-4 4-4"}),e.jsx("path",{d:"M21 13v2a4 4 0 0 1-4 4H3"})]}),"Recurring"]}):"Vacation"}),e.jsxs("span",{className:fe.detailName,children:[xi,Nn&&e.jsx("span",{className:fe.recurringDays,children:Td(Nn.daysOfWeek)})]}),e.jsx("span",{className:fe.dateBadge,children:hr(Et.start_date,Et.end_date)}),ln&&e.jsx("span",{className:fe.deleteBtn,onClick:ca=>{ca.stopPropagation(),yl(Et.id,de.name,xi)},title:"Delete vacation",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},`v-${Et.id}`)}),ln&&e.jsxs("div",{className:`${fe.detailRow} ${fe.addRow}`,onClick:()=>$(void 0,de.id),children:[e.jsx("span",{className:fe.addIcon,children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),e.jsx("span",{className:fe.addText,children:"Add vacation / time off"})]}),ut.map(Et=>e.jsxs("div",{className:`${fe.detailRow} ${fe.clickable}`,children:[e.jsxs("span",{className:`${fe.detailType} ${fe.allocation}`,children:[Et.allocation,"%"]}),e.jsxs("span",{className:fe.detailName,children:[Et.projectName,Et.phaseName&&`  ${Et.phaseName}`]}),e.jsx("span",{className:fe.dateBadge,children:hr(Et.start_date,Et.end_date)})]},`a-${Et.id}-${Et.level}`)),ut.length===0&&gt.length===0&&!ln&&e.jsx("div",{className:fe.detailRow,children:e.jsx("span",{className:fe.noAssignments,children:"No assignments"})})]})]},de.id)}),e.jsx(zA,{isExpanded:n?!1:U,onToggle:n?void 0:()=>N(!U)}),e.jsx(HA,{isExpanded:n?!1:W,onToggle:n?void 0:()=>K(!W)})]})]}),e.jsx("div",{className:fe.resizer,onMouseDown:mr}),e.jsxs("div",{className:fe.timeline,children:[n&&e.jsx("div",{className:fe.timelineHeaderSpacer}),e.jsx("div",{className:fe.timelineScroll,ref:u,onScroll:F,children:e.jsxs("div",{className:fe.timelineContent,style:{width:$s},children:[!n&&e.jsx(vi,{headers:Es,cells:Bt,cellWidth:H,totalWidth:$s,viewMode:R}),e.jsx(nL,{ref:d,staff:ae,assignmentsMap:Xn,vacationsMap:Ts,rowHeights:Da,expandedStaff:A,expandedBankHolidays:n?!1:U,expandedCompanyEvents:n?!1:W,cells:Bt,cellWidth:H,totalWidth:$s,viewMode:R})]})})]}),le&&e.jsx("div",{className:fe.confirmOverlay,onClick:$a,children:e.jsxs("div",{className:fe.confirmModal,onClick:de=>de.stopPropagation(),children:[e.jsx("div",{className:fe.confirmIcon,children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e.jsx("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})}),e.jsx("h3",{className:fe.confirmTitle,children:"Delete Vacation"}),e.jsxs("p",{className:fe.confirmText,children:["Are you sure you want to delete ",e.jsx("strong",{children:le.description})," for ",e.jsx("strong",{children:le.staffName}),"?"]}),e.jsx("p",{className:fe.confirmWarning,children:"This action cannot be undone."}),e.jsxs("div",{className:fe.confirmActions,children:[e.jsx("button",{className:fe.confirmCancel,onClick:$a,disabled:De,children:"Cancel"}),e.jsx("button",{className:fe.confirmDelete,onClick:fr,disabled:De,children:De?"Deleting...":"Delete"})]})]})})]})}function WA(n,s){if(n.length===0&&s.length===0)return 0;const r=[...n.map(u=>({start:u.start_date,end:u.end_date})),...s.map(u=>({start:u.start_date,end:u.end_date}))];if(r.length===0)return 0;const i=[];r.forEach(u=>{u.start&&u.end&&(i.push({date:u.start,type:"start"}),i.push({date:u.end,type:"end"}))}),i.sort((u,h)=>u.date!==h.date?u.date.localeCompare(h.date):u.type==="start"?-1:1);let l=0,d=0;return i.forEach(u=>{u.type==="start"?(d++,l=Math.max(l,d)):d--}),l}const qA="_body_3psno_3",UA="_content_3psno_23",VA="_grid_3psno_29",GA="_gridCell_3psno_56",YA="_weekend_3psno_64",QA="_holiday_3psno_68",XA="_companyEvent_3psno_72",KA="_tooltipLayer_3psno_77",ZA="_tooltipCell_3psno_88",JA="_event_3psno_103",eR="_rows_3psno_135",tR="_row_3psno_135",nR="_bookingBar_3psno_148",sR="_barLabel_3psno_170",sn={body:qA,content:UA,grid:VA,gridCell:GA,weekend:YA,holiday:QA,companyEvent:XA,tooltipLayer:KA,tooltipCell:ZA,event:JA,rows:eR,row:tR,bookingBar:nR,barLabel:sR},aR=f.forwardRef(function({equipment:s,bookingsMap:r,cells:i,cellWidth:l,totalWidth:d,viewMode:u},h){const p=u==="week"||u==="month",m=f.useMemo(()=>fl(i,l),[i,l]);return e.jsx("div",{ref:h,className:sn.body,children:e.jsxs("div",{className:sn.content,style:{width:d,"--cell-width":`${l}px`},children:[e.jsxs("div",{className:sn.grid,children:[p&&i.map((v,y)=>v.isWeekend?e.jsx("div",{className:`${sn.gridCell} ${sn.weekend}`,style:{left:y*l,width:l}},`weekend-${y}`):null),p&&i.map((v,y)=>v.isBankHoliday?e.jsx("div",{className:`${sn.gridCell} ${sn.holiday}`,style:{left:y*l,width:l}},`holiday-${y}`):null),p&&i.map((v,y)=>v.isCompanyEvent?e.jsx("div",{className:`${sn.gridCell} ${sn.companyEvent}`,style:{left:y*l,width:l}},`event-${y}`):null)]}),m!==null&&e.jsx(gl,{position:m}),e.jsx("div",{className:sn.rows,children:s.map(v=>e.jsx(rR,{equipment:v,bookings:r.get(v.id)||[],cells:i,cellWidth:l,viewMode:u},v.id))}),p&&e.jsx("div",{className:sn.tooltipLayer,children:i.map((v,y)=>v.isBankHoliday?e.jsx("div",{className:`${sn.tooltipCell} ${sn.holiday}`,style:{left:y*l,width:l},"data-tooltip":v.bankHolidayName||"Holiday"},`tooltip-${y}`):v.isCompanyEvent?e.jsx("div",{className:`${sn.tooltipCell} ${sn.event}`,style:{left:y*l,width:l},"data-tooltip":v.companyEventName||"Company Event"},`tooltip-${y}`):null)})]})})});function rR({bookings:n,cells:s,cellWidth:r,viewMode:i}){const l=f.useMemo(()=>n.map(d=>{const u=xn(d.start_date,d.end_date,s,r,i);return u?{...d,left:u.left,width:u.width}:null}).filter(Boolean),[n,s,r,i]);return e.jsx("div",{className:sn.row,children:l.map(d=>d&&e.jsx("div",{className:sn.bookingBar,style:{left:d.left,width:d.width},title:`${d.projectName}${d.phaseName?` - ${d.phaseName}`:""}`,children:e.jsx("span",{className:sn.barLabel,children:d.projectName})},`booking-${d.id}`))})}const iR="_container_1hvzx_3",oR="_embedded_1hvzx_11",lR="_panel_1hvzx_19",cR="_resizer_1hvzx_33",dR="_panelHeader_1hvzx_45",uR="_headerLeft_1hvzx_61",hR="_headerTitle_1hvzx_67",fR="_headerCount_1hvzx_73",mR="_filterWrapper_1hvzx_82",pR="_filterTrigger_1hvzx_86",gR="_hasFilters_1hvzx_107",_R="_filterLabel_1hvzx_118",yR="_chevron_1hvzx_125",vR="_open_1hvzx_130",xR="_filterDropdown_1hvzx_134",jR="_filterActions_1hvzx_159",wR="_filterActionBtn_1hvzx_165",SR="_filterDivider_1hvzx_184",CR="_filterOptions_1hvzx_189",bR="_filterOption_1hvzx_189",kR="_filterCheckboxInput_1hvzx_221",NR="_filterCheckbox_1hvzx_221",DR="_checkIcon_1hvzx_242",ER="_filterOptionText_1hvzx_267",$R="_panelBody_1hvzx_275",TR="_empty_1hvzx_295",MR="_equipmentRow_1hvzx_307",PR="_draggable_1hvzx_321",IR="_dragHandle_1hvzx_330",LR="_status_1hvzx_347",AR="_available_1hvzx_354",RR="_booked_1hvzx_358",BR="_equipmentInfo_1hvzx_362",OR="_equipmentName_1hvzx_368",FR="_equipmentMeta_1hvzx_377",zR="_timeline_1hvzx_383",HR="_timelineScroll_1hvzx_391",WR="_timelineContent_1hvzx_413",qR="_timelineHeaderSpacer_1hvzx_440",Ye={container:iR,embedded:oR,panel:lR,resizer:cR,panelHeader:dR,headerLeft:uR,headerTitle:hR,headerCount:fR,filterWrapper:mR,filterTrigger:pR,hasFilters:gR,filterLabel:_R,chevron:yR,open:vR,filterDropdown:xR,filterActions:jR,filterActionBtn:wR,filterDivider:SR,filterOptions:CR,filterOption:bR,filterCheckboxInput:kR,filterCheckbox:NR,checkIcon:DR,filterOptionText:ER,panelBody:$R,empty:TR,equipmentRow:MR,draggable:PR,dragHandle:IR,status:LR,available:AR,booked:RR,equipmentInfo:BR,equipmentName:OR,equipmentMeta:FR,timeline:zR,timelineScroll:HR,timelineContent:WR,timelineHeaderSpacer:qR};function og({embedded:n=!1,panelWidth:s,onPanelWidthChange:r,height:i}){const l=f.useRef(null),d=f.useRef(null),u=f.useRef(null),h=f.useRef(null),[p,m]=f.useState(320),y=n?(s||324)-4:p,b=G(le=>le.equipment),w=G(le=>le.projects),x=G(le=>le.currentSite),_=G(le=>le.viewMode),S=G(le=>le.currentDate),C=G(le=>le.cellWidth),B=G(le=>le.bankHolidayDates),D=G(le=>le.bankHolidays),O=G(le=>le.companyEventDates),z=G(le=>le.companyEvents),R=xe(le=>le.scrollToTodayTrigger),Q=G(le=>le.currentUser),{handleDragStart:H,handleDragEnd:J}=zp(),q=Q?.role==="admin"||Q?.role==="superuser";pl({containerRef:u,cellWidth:C,enabled:!n});const{handleScroll:E}=su("equipment-view",u,n),[L,$]=f.useState(new Set),[M,k]=f.useState(!1);ml(l,d);const P=f.useMemo(()=>b.filter(le=>le.site_id===x?.id).sort((le,se)=>le.name.localeCompare(se.name)),[b,x]),F=f.useMemo(()=>{const le=new Set;return P.forEach(se=>{se.type&&le.add(se.type)}),Array.from(le).sort((se,De)=>se.localeCompare(De))},[P]),A=f.useMemo(()=>L.size===0?P:P.filter(le=>le.type&&L.has(le.type)),[P,L]);f.useEffect(()=>{const le=se=>{h.current&&!h.current.contains(se.target)&&k(!1)};return M&&document.addEventListener("mousedown",le),()=>{document.removeEventListener("mousedown",le)}},[M]);const I=le=>{$(se=>{const De=new Set(se);return De.has(le)?De.delete(le):De.add(le),De})},U=()=>{$(new Set(F))},N=()=>{$(new Set)},W=f.useMemo(()=>pi(S,_,B,D,O,z),[S,_,B,D,O,z]),K=f.useMemo(()=>gi(W,_),[W,_]),te=W.length*C;f.useEffect(()=>{if(n||!R||!u.current)return;const le=W.findIndex(ce=>ce.isToday);if(le===-1)return;const se=u.current,De=se.clientWidth,We=le*C,ot=Math.max(0,We-De/2+C/2);se.scrollTo({left:ot,behavior:"smooth"})},[n,R,W,C]);const Y=f.useMemo(()=>{const le=new Map;return A.forEach(se=>le.set(se.id,[])),w.forEach(se=>{se.archived||(se.equipmentAssignments?.forEach(De=>{const We=le.get(De.equipment_id)||[];We.push({...De,projectName:se.name,projectId:se.id,level:"project"}),le.set(De.equipment_id,We)}),se.phases?.forEach(De=>{De.equipmentAssignments?.forEach(We=>{const ot=le.get(We.equipment_id)||[];ot.push({...We,start_date:We.start_date||De.start_date,end_date:We.end_date||De.end_date,projectName:se.name,projectId:se.id,phaseName:De.name,phaseId:De.id,level:"phase"}),le.set(We.equipment_id,ot)})}))}),le},[w,A]),me=le=>(Y.get(le)||[]).length>0?100:0,ge=le=>{le.preventDefault();const se=le.clientX,De=y,We=ce=>{const ae=ce.clientX-se,ue=Math.max(200,Math.min(500,De+ae));n&&r?r(ue):m(ue)},ot=()=>{document.removeEventListener("mousemove",We),document.removeEventListener("mouseup",ot),document.body.style.cursor="",document.body.style.userSelect=""};document.addEventListener("mousemove",We),document.addEventListener("mouseup",ot),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},pe={width:y},oe=n&&i?{height:i}:void 0;return e.jsxs("div",{className:`${Ye.container} ${n?Ye.embedded:""}`,style:oe,children:[e.jsxs("div",{className:Ye.panel,style:pe,children:[e.jsxs("div",{className:Ye.panelHeader,children:[e.jsxs("div",{className:Ye.headerLeft,children:[e.jsx("span",{className:Ye.headerTitle,children:"Equipment Overview"}),e.jsx("span",{className:Ye.headerCount,children:A.length})]}),F.length>0&&e.jsxs("div",{ref:h,className:Ye.filterWrapper,children:[e.jsxs("button",{className:`${Ye.filterTrigger} ${L.size>0?Ye.hasFilters:""}`,onClick:()=>k(!M),"aria-expanded":M,"aria-haspopup":"true",children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),e.jsx("span",{className:Ye.filterLabel,children:L.size===0?"All Types":L.size===1?Array.from(L)[0]:`${L.size} types`}),e.jsx("svg",{className:`${Ye.chevron} ${M?Ye.open:""}`,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),M&&e.jsxs("div",{className:Ye.filterDropdown,children:[e.jsxs("div",{className:Ye.filterActions,children:[e.jsx("button",{className:Ye.filterActionBtn,onClick:U,children:"Select All"}),e.jsx("button",{className:Ye.filterActionBtn,onClick:N,children:"Clear"})]}),e.jsx("div",{className:Ye.filterDivider}),e.jsx("div",{className:Ye.filterOptions,children:F.map(le=>e.jsxs("label",{className:Ye.filterOption,children:[e.jsx("input",{type:"checkbox",checked:L.has(le),onChange:()=>I(le),className:Ye.filterCheckboxInput}),e.jsx("span",{className:Ye.filterCheckbox,children:e.jsx("svg",{className:Ye.checkIcon,width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("span",{className:Ye.filterOptionText,children:le})]},le))})]})]})]}),e.jsx("div",{className:Ye.panelBody,ref:l,children:A.length===0?e.jsx("div",{className:Ye.empty,children:e.jsx("p",{children:"No equipment found"})}):A.map(le=>{const se=me(le.id);return e.jsxs("div",{className:`${Ye.equipmentRow} ${q?Ye.draggable:""}`,draggable:q,onDragStart:q?De=>{De.stopPropagation(),H(De,"equipment",le.id,le.name)}:void 0,onDragEnd:q?J:void 0,children:[q&&e.jsx("div",{className:Ye.dragHandle,title:"Drag to assign",children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("circle",{cx:"9",cy:"5",r:"2"}),e.jsx("circle",{cx:"9",cy:"12",r:"2"}),e.jsx("circle",{cx:"9",cy:"19",r:"2"}),e.jsx("circle",{cx:"15",cy:"5",r:"2"}),e.jsx("circle",{cx:"15",cy:"12",r:"2"}),e.jsx("circle",{cx:"15",cy:"19",r:"2"})]})}),e.jsx("div",{className:`${Ye.status} ${se>0?Ye.booked:Ye.available}`}),e.jsxs("div",{className:Ye.equipmentInfo,children:[e.jsx("div",{className:Ye.equipmentName,children:le.name}),e.jsxs("div",{className:Ye.equipmentMeta,children:[e.jsx("span",{children:le.type||"Equipment"}),e.jsx("span",{children:"  "}),e.jsx("span",{children:se>0?"In use":"Available"})]})]})]},le.id)})})]}),e.jsx("div",{className:Ye.resizer,onMouseDown:ge}),e.jsxs("div",{className:Ye.timeline,children:[n&&e.jsx("div",{className:Ye.timelineHeaderSpacer}),e.jsx("div",{className:Ye.timelineScroll,ref:u,onScroll:E,children:e.jsxs("div",{className:Ye.timelineContent,style:{width:te},children:[!n&&e.jsx(vi,{headers:K,cells:W,cellWidth:C,totalWidth:te,viewMode:_}),e.jsx(aR,{ref:d,equipment:A,bookingsMap:Y,cells:W,cellWidth:C,totalWidth:te,viewMode:_})]})})]})]})}const UR="_container_m1huf_1",VR="_ganttArea_m1huf_9",GR="_resizer_m1huf_16",YR="_horizontalResizer_m1huf_29",QR="_equipment_m1huf_42",ai={container:UR,ganttArea:VR,resizer:GR,horizontalResizer:YR,equipment:QR};function Um(){const n=f.useRef(null),s=f.useRef(null),[r,i]=f.useState(320),[l,d]=f.useState(250),u=G(K=>K.projects),h=G(K=>K.currentSite),p=G(K=>K.viewMode),m=G(K=>K.currentDate),v=G(K=>K.cellWidth),y=G(K=>K.bankHolidayDates),b=G(K=>K.bankHolidays),w=G(K=>K.companyEventDates),x=G(K=>K.companyEvents),_=G(K=>K.customColumns),S=G(K=>K.showAllCustomColumns),C=G(K=>K.hiddenCustomColumns),B=G(K=>K.showStaffOverview),D=G(K=>K.showEquipmentOverview),O=G(K=>K.currentUser),z=O?.role==="superuser"||O?.role==="admin",[R,Q]=f.useState(0),H=S?_.filter(K=>!C.has(K.id)):[],J=f.useMemo(()=>{if(!h?.id)return[];const K=u.filter(Y=>Y.site_id===h.id&&!Y.archived);return Dd(h.id).length>0?hv(K,h.id):[...K].sort((Y,me)=>Y.confirmed!==me.confirmed?Y.confirmed?-1:1:Y.name.localeCompare(me.name))},[u,h,R]),q=f.useCallback((K,te)=>{if(!h?.id)return;let Y=Dd(h.id);Y.length===0&&(Y=J.map(pe=>pe.id));const me=Y.indexOf(K),ge=Y.indexOf(te);me===-1&&Y.push(K),me!==-1&&ge!==-1&&(Y.splice(me,1),Y.splice(ge,0,K)),uv(h.id,Y),Q(pe=>pe+1)},[h,J]),E=f.useMemo(()=>pi(m,p,y,b,w,x),[m,p,y,b,w,x]),L=f.useMemo(()=>gi(E,p),[E,p]);S6(n,s);const $=H.reduce((K,te)=>K+te.width,0),M=r+$,k=K=>{K.preventDefault();const te=K.clientX,Y=r,me=pe=>{const oe=pe.clientX-te,le=Math.max(200,Math.min(600,Y+oe));i(le)},ge=()=>{document.removeEventListener("mousemove",me),document.removeEventListener("mouseup",ge),document.body.style.cursor="",document.body.style.userSelect=""};document.addEventListener("mousemove",me),document.addEventListener("mouseup",ge),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},P=K=>{K.preventDefault();const te=K.clientY,Y=l,me=pe=>{const oe=te-pe.clientY,le=Math.max(100,Math.min(500,Y+oe));d(le)},ge=()=>{document.removeEventListener("mousemove",me),document.removeEventListener("mouseup",ge),document.body.style.cursor="",document.body.style.userSelect=""};document.addEventListener("mousemove",me),document.addEventListener("mouseup",ge),document.body.style.cursor="row-resize",document.body.style.userSelect="none"},F=z&&B,A=z&&D,I=F||A,U=4,N=f.useCallback(K=>{const te=K-U-$,Y=Math.max(200,Math.min(600,te));i(Y)},[$]),W=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:ai.ganttArea,children:[e.jsx(XP,{ref:n,projects:J,width:r,onProjectReorder:q}),e.jsx("div",{className:ai.resizer,onMouseDown:k}),e.jsx(w6,{ref:s,cells:E,headers:L,projects:J,cellWidth:v,viewMode:p,hasCustomColumns:H.length>0})]}),I&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`${ai.horizontalResizer} ${A?ai.equipment:""}`,onMouseDown:P}),F&&e.jsx(ig,{embedded:!0,panelWidth:M+U,onPanelWidthChange:N,height:l}),A&&e.jsx(og,{embedded:!0,panelWidth:M+U,onPanelWidthChange:N,height:l})]})]});return e.jsx(_6,{children:e.jsx("div",{className:ai.container,children:W})})}const XR="_tooltip_yadk0_3",KR="_title_yadk0_28",ZR="_row_yadk0_37",JR="_label_yadk0_46",e5="_confirmed_yadk0_57",t5="_unconfirmed_yadk0_61",n5="_staffSection_yadk0_66",s5="_staffHeader_yadk0_72",a5="_staffRow_yadk0_81",r5="_staffName_yadk0_89",i5="_staffAllocation_yadk0_96",pt={tooltip:XR,title:KR,row:ZR,label:JR,confirmed:e5,unconfirmed:t5,staffSection:n5,staffHeader:s5,staffRow:a5,staffName:r5,staffAllocation:i5};function pd(n,s,r){const i=os(n),l=os(s),d=Ns(l,i)+1;let u=0,h=0;try{const p=Hv({start:i,end:l});for(const m of p){const v=kt(m,"yyyy-MM-dd"),y=r.has(v),b=Sp(m);y?h++:b||u++}}catch{u=d}return{totalDays:d,workDays:u,holidays:h}}function rr(n){if(!n)return{completion:null,isCalculated:!1};const s=n.children??[];let r=!1;for(const i of s){const l=rr(i);if(l&&l.completion!==null){r=!0;break}}if(r){let i=0,l=0;for(const d of s){const u=rr(d),h=os(d.start_date),p=os(d.end_date),m=Math.max(1,Ns(p,h)+1),v=u.completion??0;i+=v*m,l+=m}if(l>0)return{completion:Math.round(i/l),isCalculated:!0}}return{completion:n.completion??null,isCalculated:!1}}function o5(n,s){const r=os(n),i=os(s),l=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric"});return`${l.format(r)} - ${l.format(i)}`}function l5(n,s){return n.find(r=>(r.phases??[]).some(i=>i.id===s))??null}function c5(n,s){for(const r of n){const i=(r.phases??[]).find(l=>l.id===s);if(i)return i}return null}function d5(n,s){for(const r of n)for(const i of r.phases??[]){const l=lg(i.children??[],s);if(l)return{subphase:l,project:r,parentPhase:i}}return null}function lg(n,s){for(const r of n){if(r.id===s)return r;if(r.children?.length){const i=lg(r.children,s);if(i)return i}}return null}function u5(n){let s=n;for(;s;){if(s.classList.contains("linkZone")||s.className?.includes?.("linkZone")||s.getAttribute("title")?.includes("linking"))return!0;if(s.dataset.phaseId||s.dataset.subphaseId)break;s=s.parentElement}return!1}function h5(){const[n,s]=f.useState(null),[r,i]=f.useState(!1),l=G(b=>b.projects),d=G(b=>b.bankHolidayDates),u=f.useRef(null);f.useEffect(()=>{const b=x=>{x.key==="Shift"&&i(!0)},w=x=>{x.key==="Shift"&&(i(!1),s(null),u.current=null)};return window.addEventListener("keydown",b),window.addEventListener("keyup",w),()=>{window.removeEventListener("keydown",b),window.removeEventListener("keyup",w)}},[]);const h=f.useCallback((b,w,x)=>{const _=c5(l,b),S=l5(l,b);if(_&&S){const{totalDays:C,workDays:B,holidays:D}=pd(_.start_date,_.end_date,d),O=rr(_),z=(_.staffAssignments??[]).map(R=>({name:R.staff_name||`Staff #${R.staff_id}`,allocation:R.allocation}));s({type:"phase",title:_.name,projectName:S.name,startDate:_.start_date,endDate:_.end_date,completion:O.completion,isCalculatedCompletion:O.isCalculated,workDays:B,totalDays:C,holidays:D,staff:z,x:w,y:x})}},[l,d]),p=f.useCallback((b,w,x)=>{const _=d5(l,b);if(_){const{subphase:S,project:C,parentPhase:B}=_,{totalDays:D,workDays:O,holidays:z}=pd(S.start_date,S.end_date,d),R=rr(S),Q=(S.staffAssignments??[]).map(H=>({name:H.staff_name||`Staff #${H.staff_id}`,allocation:H.allocation}));s({type:"subphase",title:S.name,projectName:C.name,parentName:B.name,startDate:S.start_date,endDate:S.end_date,completion:R.completion,isCalculatedCompletion:R.isCalculated,workDays:O,totalDays:D,holidays:z,staff:Q,x:w,y:x})}},[l,d]),m=f.useCallback((b,w,x)=>{const _=l.find(S=>S.id===b);if(_){const S=_.start_date||(_.phases?.[0]?.start_date??""),C=_.end_date||(_.phases?.reduce((J,q)=>q.end_date>J?q.end_date:J,"")??"");if(!S||!C)return;const{totalDays:B,workDays:D,holidays:O}=pd(S,C,d),z=(_.staffAssignments??[]).map(J=>({name:J.staff_name||`Staff #${J.staff_id}`,allocation:J.allocation}));let R=null,Q=!1;if((_.phases??[]).filter(J=>rr(J).completion!==null).length>0){let J=0,q=0;for(const E of _.phases??[]){const L=rr(E),$=os(E.start_date),M=os(E.end_date),k=Math.max(1,Ns(M,$)+1),P=L.completion??0;J+=P*k,q+=k}q>0&&(R=Math.round(J/q),Q=!0)}s({type:"project",title:_.name,startDate:S,endDate:C,completion:R,isCalculatedCompletion:Q,workDays:D,totalDays:B,holidays:O,staff:z,customer:_.customer,pmName:_.pm_name,confirmed:_.confirmed,x:w,y:x})}},[l,d]);if(f.useEffect(()=>{const b=w=>{if(!r){n&&(s(null),u.current=null);return}const x=w.target;if(u5(x)){s(null),u.current=null;return}const _=x.closest("[data-phase-id], [data-subphase-id], [data-project-id]");if(!_){s(null),u.current=null;return}if(!(window.getComputedStyle(_).position==="absolute"||_.classList.toString().includes("bar")||_.classList.toString().includes("Bar"))){s(null),u.current=null;return}const B=_.getBoundingClientRect();if(w.clientX<B.left||w.clientX>B.right||w.clientY<B.top||w.clientY>B.bottom){s(null),u.current=null;return}if(_===u.current&&n){s(R=>R?{...R,x:w.clientX,y:w.clientY}:null);return}u.current=_;const D=_.dataset.phaseId,O=_.dataset.subphaseId,z=_.dataset.projectId;D?h(parseInt(D),w.clientX,w.clientY):O?p(parseInt(O),w.clientX,w.clientY):z&&m(parseInt(z),w.clientX,w.clientY)};return document.addEventListener("mousemove",b),()=>{document.removeEventListener("mousemove",b)}},[r,n,h,p,m]),!n||!r)return null;const v=n.completion!==null?`${n.completion}%${n.isCalculatedCompletion?" (calc)":""}`:"",y={left:Math.min(n.x+15,window.innerWidth-320),top:Math.min(n.y+15,window.innerHeight-280)};return e.jsxs("div",{className:pt.tooltip,style:y,children:[e.jsx("div",{className:pt.title,children:n.title}),n.type==="project"&&e.jsxs(e.Fragment,{children:[n.customer&&e.jsxs("div",{className:pt.row,children:[e.jsx("span",{className:pt.label,children:"Customer:"}),e.jsx("span",{children:n.customer})]}),n.pmName&&e.jsxs("div",{className:pt.row,children:[e.jsx("span",{className:pt.label,children:"PM:"}),e.jsx("span",{children:n.pmName})]}),e.jsxs("div",{className:pt.row,children:[e.jsx("span",{className:pt.label,children:"Status:"}),e.jsx("span",{className:n.confirmed?pt.confirmed:pt.unconfirmed,children:n.confirmed?"Confirmed":"Unconfirmed"})]})]}),n.type!=="project"&&n.projectName&&e.jsxs("div",{className:pt.row,children:[e.jsx("span",{className:pt.label,children:"Project:"}),e.jsx("span",{children:n.projectName})]}),n.parentName&&e.jsxs("div",{className:pt.row,children:[e.jsx("span",{className:pt.label,children:"Parent:"}),e.jsx("span",{children:n.parentName})]}),e.jsxs("div",{className:pt.row,children:[e.jsx("span",{className:pt.label,children:"Period:"}),e.jsx("span",{children:o5(n.startDate,n.endDate)})]}),e.jsxs("div",{className:pt.row,children:[e.jsx("span",{className:pt.label,children:"Completion:"}),e.jsx("span",{children:v})]}),e.jsxs("div",{className:pt.row,children:[e.jsx("span",{className:pt.label,children:"Work days:"}),e.jsxs("span",{children:[n.workDays," days",n.holidays>0&&` (excl. ${n.holidays} hol.)`]})]}),e.jsxs("div",{className:pt.row,children:[e.jsx("span",{className:pt.label,children:"Total:"}),e.jsxs("span",{children:[n.totalDays," days"]})]}),n.staff.length>0&&e.jsxs("div",{className:pt.staffSection,children:[e.jsx("div",{className:pt.staffHeader,children:"Assigned Staff:"}),n.staff.map((b,w)=>e.jsxs("div",{className:pt.staffRow,children:[e.jsx("span",{className:pt.staffName,children:b.name}),e.jsxs("span",{className:pt.staffAllocation,children:[b.allocation,"%"]})]},w))]})]})}const f5="_body_khwjn_3",m5="_content_khwjn_23",p5="_grid_khwjn_29",g5="_gridCell_khwjn_56",_5="_weekend_khwjn_64",y5="_holiday_khwjn_68",v5="_companyEvent_khwjn_72",x5="_holidayTooltipOverlay_khwjn_77",j5="_holidayTooltipZone_khwjn_88",w5="_eventTooltipZone_khwjn_89",S5="_today_khwjn_125",C5="_rows_khwjn_131",b5="_siteRow_khwjn_137",k5="_currentSite_khwjn_143",N5="_projectRow_khwjn_148",D5="_bar_khwjn_155",E5="_confirmed_khwjn_181",$5="_unconfirmed_khwjn_186",T5="_masked_khwjn_199",M5="_barLabel_khwjn_203",Pt={body:f5,content:m5,grid:p5,gridCell:g5,weekend:_5,holiday:y5,companyEvent:v5,holidayTooltipOverlay:x5,holidayTooltipZone:j5,eventTooltipZone:w5,today:S5,rows:C5,siteRow:b5,currentSite:k5,projectRow:N5,bar:D5,confirmed:E5,unconfirmed:$5,masked:T5,barLabel:M5},P5=f.forwardRef(function({rows:s,cells:r,cellWidth:i,totalWidth:l,viewMode:d},u){const h=d==="week"||d==="month",p=f.useMemo(()=>fl(r,i),[r,i]);return e.jsx("div",{ref:u,className:Pt.body,children:e.jsxs("div",{className:Pt.content,style:{width:l,"--cell-width":`${i}px`},children:[e.jsxs("div",{className:Pt.grid,children:[h&&r.map((m,v)=>m.isWeekend?e.jsx("div",{className:`${Pt.gridCell} ${Pt.weekend}`,style:{left:v*i,width:i}},`weekend-${v}`):null),h&&r.map((m,v)=>m.isBankHoliday?e.jsx("div",{className:`${Pt.gridCell} ${Pt.holiday}`,style:{left:v*i,width:i}},`holiday-${v}`):null),h&&r.map((m,v)=>m.isCompanyEvent?e.jsx("div",{className:`${Pt.gridCell} ${Pt.companyEvent}`,style:{left:v*i,width:i}},`event-${v}`):null),r.map((m,v)=>m.isToday?e.jsx("div",{className:`${Pt.gridCell} ${Pt.today}`,style:{left:v*i,width:i}},`today-${v}`):null)]}),p!==null&&e.jsx(gl,{position:p}),e.jsx("div",{className:Pt.rows,children:s.map(m=>m.type==="site"?e.jsx("div",{className:`${Pt.siteRow} ${m.isCurrentSite?Pt.currentSite:""}`},`site-row-${m.site.id}`):e.jsx(I5,{row:m,cells:r,cellWidth:i,viewMode:d},`project-row-${m.project.id}`))}),h&&e.jsx("div",{className:Pt.holidayTooltipOverlay,children:r.map((m,v)=>m.isCompanyEvent?e.jsx("div",{className:Pt.eventTooltipZone,style:{left:v*i,width:i},"data-tooltip":m.companyEventName||"Company Event"},`event-tooltip-${v}`):m.isBankHoliday?e.jsx("div",{className:Pt.holidayTooltipZone,style:{left:v*i,width:i},"data-tooltip":m.bankHolidayName||"Holiday"},`holiday-tooltip-${v}`):null)})]})})});function I5({row:n,cells:s,cellWidth:r,viewMode:i}){const{project:l,isCurrentSite:d,displayName:u}=n,h=f.useMemo(()=>!l.start_date||!l.end_date?null:xn(l.start_date,l.end_date,s,r,i),[l.start_date,l.end_date,s,r,i]);return e.jsx("div",{className:Pt.projectRow,children:h&&e.jsx("div",{className:`${Pt.bar} ${l.confirmed?Pt.confirmed:Pt.unconfirmed} ${d?"":Pt.masked}`,style:{left:h.left,width:h.width},title:d?l.name:"Confidential",children:e.jsx("span",{className:Pt.barLabel,children:d?u:"Project"})})})}const L5="_container_144fl_3",A5="_panel_144fl_11",R5="_panelHeader_144fl_20",B5="_headerTitle_144fl_31",O5="_panelBody_144fl_37",F5="_siteRow_144fl_58",z5="_currentSite_144fl_68",H5="_siteIndicator_144fl_72",W5="_current_144fl_68",q5="_siteInfo_144fl_84",U5="_siteName_144fl_89",V5="_siteMeta_144fl_95",G5="_projectRow_144fl_101",Y5="_masked_144fl_110",Q5="_status_144fl_114",X5="_confirmed_144fl_121",K5="_unconfirmed_144fl_125",Z5="_projectInfo_144fl_129",J5="_projectName_144fl_135",eB="_projectMeta_144fl_143",tB="_timeline_144fl_149",nB="_timelineScroll_144fl_157",sB="_timelineContent_144fl_179",Mt={container:L5,panel:A5,panelHeader:R5,headerTitle:B5,panelBody:O5,siteRow:F5,currentSite:z5,siteIndicator:H5,current:W5,siteInfo:q5,siteName:U5,siteMeta:V5,projectRow:G5,masked:Y5,status:Q5,confirmed:X5,unconfirmed:K5,projectInfo:Z5,projectName:J5,projectMeta:eB,timeline:tB,timelineScroll:nB,timelineContent:sB};function aB(){const n=f.useRef(null),s=f.useRef(null),r=f.useRef(null),i=G(D=>D.sites),l=G(D=>D.projects),d=G(D=>D.currentSite),u=G(D=>D.viewMode),h=G(D=>D.currentDate),p=G(D=>D.cellWidth),m=G(D=>D.bankHolidayDates),v=G(D=>D.bankHolidays),y=G(D=>D.companyEventDates),b=G(D=>D.companyEvents),w=xe(D=>D.scrollToTodayTrigger);pl({containerRef:r,cellWidth:p}),ml(n,s);const x=f.useMemo(()=>pi(h,u,m,v,y,b),[h,u,m,v,y,b]),_=f.useMemo(()=>gi(x,u),[x,u]),S=x.length*p;f.useEffect(()=>{if(!w||!r.current)return;const D=x.findIndex(H=>H.isToday);if(D===-1)return;const O=r.current,z=O.clientWidth,R=D*p,Q=Math.max(0,R-z/2+p/2);O.scrollTo({left:Q,behavior:"smooth"})},[w,x,p]);const C=f.useMemo(()=>{const D=new Map;return i.forEach(O=>{D.set(O.id,[])}),l.forEach(O=>{if(O.archived)return;const z=D.get(O.site_id)||[];z.push(O),D.set(O.site_id,z)}),D.forEach((O,z)=>{D.set(z,O.sort((R,Q)=>R.name.localeCompare(Q.name)))}),D},[i,l]),B=f.useMemo(()=>{const D=[];return i.forEach(O=>{const z=O.id===d?.id,R=C.get(O.id)||[];D.push({type:"site",site:O,isCurrentSite:z,projectCount:R.length}),R.forEach(Q=>{D.push({type:"project",project:Q,site:O,isCurrentSite:z,displayName:z?Q.name:"Confidential Project",displayCustomer:z?Q.customer||"":"***"})})}),D},[i,C,d]);return e.jsxs("div",{className:Mt.container,children:[e.jsxs("div",{className:Mt.panel,children:[e.jsx("div",{className:Mt.panelHeader,children:e.jsx("span",{className:Mt.headerTitle,children:"Cross-Site Overview"})}),e.jsx("div",{className:Mt.panelBody,ref:n,children:B.map(D=>D.type==="site"?e.jsxs("div",{className:`${Mt.siteRow} ${D.isCurrentSite?Mt.currentSite:""}`,children:[e.jsx("div",{className:`${Mt.siteIndicator} ${D.isCurrentSite?Mt.current:""}`}),e.jsxs("div",{className:Mt.siteInfo,children:[e.jsx("div",{className:Mt.siteName,children:D.site.name}),e.jsxs("div",{className:Mt.siteMeta,children:[D.projectCount," projects"]})]})]},`site-${D.site.id}`):e.jsxs("div",{className:`${Mt.projectRow} ${D.isCurrentSite?"":Mt.masked}`,children:[e.jsx("div",{className:`${Mt.status} ${D.project.confirmed?Mt.confirmed:Mt.unconfirmed}`}),e.jsxs("div",{className:Mt.projectInfo,children:[e.jsx("div",{className:Mt.projectName,children:D.displayName}),D.displayCustomer&&e.jsx("div",{className:Mt.projectMeta,children:D.displayCustomer})]})]},`project-${D.project.id}`))})]}),e.jsx("div",{className:Mt.timeline,children:e.jsx("div",{className:Mt.timelineScroll,ref:r,children:e.jsxs("div",{className:Mt.timelineContent,style:{width:S},children:[e.jsx(vi,{headers:_,cells:x,cellWidth:p,totalWidth:S,viewMode:u}),e.jsx(P5,{ref:s,rows:B,cells:x,cellWidth:p,totalWidth:S,viewMode:u})]})})})]})}const rB="_row_6xle6_3",iB="_specialCell_6xle6_29",oB="_weekend_6xle6_37",lB="_bankHoliday_6xle6_41",cB="_companyEvent_6xle6_48",dB="_today_6xle6_83",uB="_bar_6xle6_90",hB="_confirmed_6xle6_115",fB="_unconfirmed_6xle6_120",Un={row:rB,specialCell:iB,weekend:oB,bankHoliday:lB,companyEvent:cB,today:dB,bar:uB,confirmed:hB,unconfirmed:fB};function mB({project:n,cells:s,cellWidth:r,totalWidth:i,showHighlighting:l}){const d=f.useMemo(()=>{if(!n.start_date||!n.end_date||s.length===0)return null;const u=new Date(n.start_date),h=new Date(n.end_date);u.setHours(0,0,0,0),h.setHours(0,0,0,0);const p=s[0].date,m=s[s.length-1].date;if(h<p||u>m)return null;let v=0;for(let x=0;x<s.length;x++){if(s[x].date>=u){v=x;break}x===s.length-1&&(v=x)}u<p&&(v=0);let y=s.length-1;for(let x=s.length-1;x>=0;x--)if(s[x].date<=h){y=x;break}const b=v*r,w=Math.max((y-v+1)*r,r);return{left:b,width:w}},[n.start_date,n.end_date,s,r]);return e.jsxs("div",{className:Un.row,style:{width:i,"--cell-width":`${r}px`},children:[l&&s.map((u,h)=>u.isWeekend?e.jsx("div",{className:`${Un.specialCell} ${Un.weekend}`,style:{left:h*r,width:r}},`weekend-${h}`):null),l&&s.map((u,h)=>u.isBankHoliday?e.jsx("div",{className:`${Un.specialCell} ${Un.bankHoliday}`,style:{left:h*r,width:r},"data-tooltip":u.bankHolidayName||"Holiday"},`holiday-${h}`):null),l&&s.map((u,h)=>u.isCompanyEvent?e.jsx("div",{className:`${Un.specialCell} ${Un.companyEvent}`,style:{left:h*r,width:r},"data-tooltip":u.companyEventName||"Company Event"},`event-${h}`):null),s.map((u,h)=>u.isToday?e.jsx("div",{className:`${Un.specialCell} ${Un.today}`,style:{left:h*r,width:r}},`today-${h}`):null),d&&e.jsx("div",{className:`${Un.bar} ${n.confirmed?Un.confirmed:Un.unconfirmed}`,style:{left:d.left,width:d.width},children:n.name})]})}const pB="_container_1h039_3",gB="_projectPanel_1h039_11",_B="_panelHeader_1h039_21",yB="_panelContent_1h039_34",vB="_emptyState_1h039_58",xB="_projectRow_1h039_70",jB="_projectMain_1h039_75",wB="_expandPlaceholder_1h039_83",SB="_status_1h039_92",CB="_confirmed_1h039_99",bB="_unconfirmed_1h039_103",kB="_projectInfo_1h039_107",NB="_projectName_1h039_113",DB="_projectMeta_1h039_122",EB="_pmName_1h039_130",$B="_editBtn_1h039_134",TB="_timelineWrapper_1h039_155",MB="_timelineScroll_1h039_163",PB="_timelineContent_1h039_185",IB="_timelineBody_1h039_192",LB="_timelineBodyContent_1h039_212",AB="_emptyTimeline_1h039_217",At={container:pB,projectPanel:gB,panelHeader:_B,panelContent:yB,emptyState:vB,projectRow:xB,projectMain:jB,expandPlaceholder:wB,status:SB,confirmed:CB,unconfirmed:bB,projectInfo:kB,projectName:NB,projectMeta:DB,pmName:EB,editBtn:$B,timelineWrapper:TB,timelineScroll:MB,timelineContent:PB,timelineBody:IB,timelineBodyContent:LB,emptyTimeline:AB};function RB(){const n=f.useRef(null),s=f.useRef(null),r=G(C=>C.projects),i=G(C=>C.currentSite),l=G(C=>C.viewMode),d=G(C=>C.currentDate),u=G(C=>C.cellWidth),h=G(C=>C.bankHolidayDates),p=G(C=>C.bankHolidays),m=G(C=>C.companyEventDates),v=G(C=>C.companyEvents),y=xe(C=>C.openProjectModal);ml(n,s);const b=f.useMemo(()=>r.filter(C=>C.archived&&C.site_id===i?.id).sort((C,B)=>C.name.localeCompare(B.name)),[r,i]),w=f.useMemo(()=>pi(d,l,h,p,m,v),[d,l,h,p,m,v]),x=f.useMemo(()=>gi(w,l),[w,l]),_=w.length*u,S=l==="week"||l==="month";return e.jsxs("div",{className:At.container,children:[e.jsxs("div",{className:At.projectPanel,children:[e.jsx("div",{className:At.panelHeader,children:"Archived Projects"}),e.jsx("div",{className:At.panelContent,ref:n,children:b.length===0?e.jsx("div",{className:At.emptyState,children:e.jsx("p",{children:"No archived projects"})}):b.map(C=>e.jsx("div",{className:At.projectRow,"data-project-id":C.id,children:e.jsxs("div",{className:At.projectMain,children:[e.jsx("div",{className:At.expandPlaceholder,children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24"})}),e.jsx("div",{className:`${At.status} ${C.confirmed?At.confirmed:At.unconfirmed}`}),e.jsxs("div",{className:At.projectInfo,children:[e.jsx("div",{className:At.projectName,children:C.name}),e.jsxs("div",{className:At.projectMeta,children:[e.jsx("span",{className:At.pmName,children:C.pm_name||"No PM"}),e.jsx("span",{children:"  "}),e.jsx("span",{children:C.customer||"No customer"})]})]}),e.jsx("button",{className:At.editBtn,onClick:B=>{B.stopPropagation(),y(C)},title:"Edit project",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})]})},C.id))})]}),e.jsx("div",{className:At.timelineWrapper,children:e.jsx("div",{className:At.timelineScroll,children:e.jsxs("div",{className:At.timelineContent,style:{width:_},children:[e.jsx(vi,{headers:x,cells:w,cellWidth:u,totalWidth:_,viewMode:l}),e.jsx("div",{className:At.timelineBody,ref:s,children:e.jsx("div",{className:At.timelineBodyContent,style:{width:_,"--cell-width":`${u}px`},children:b.length===0?e.jsx("div",{className:At.emptyTimeline}):b.map(C=>e.jsx(mB,{project:C,cells:w,cellWidth:u,totalWidth:_,showHighlighting:S},C.id))})})]})})})]})}const BB="_container_16j28_1",OB="_body_16j28_11",FB="_main_16j28_18",gd={container:BB,body:OB,main:FB};function zB(){const n=G(r=>r.currentView);T0();const s=()=>{switch(n){case"gantt":return e.jsx(Um,{});case"staff":return e.jsx(ig,{});case"equipment":return e.jsx(og,{});case"crosssite":return e.jsx(aB,{});case"archived":return e.jsx(RB,{});default:return e.jsx(Um,{})}};return e.jsxs("div",{className:gd.container,children:[e.jsx(hw,{}),e.jsxs("div",{className:gd.body,children:[e.jsx(Fw,{}),e.jsx("main",{className:gd.main,children:s()})]}),e.jsx(h5,{})]})}const HB="_wrapper_1mmpa_1",WB="_label_1mmpa_7",qB="_input_1mmpa_14",UB="_checkbox_1mmpa_21",VB="_checkIcon_1mmpa_34",GB="_indeterminateIcon_1mmpa_35",YB="_labelText_1mmpa_75",QB="_error_1mmpa_85",na={wrapper:HB,label:WB,input:qB,checkbox:UB,checkIcon:VB,indeterminateIcon:GB,labelText:YB,error:QB},XB=f.forwardRef(({label:n,error:s,indeterminate:r,className:i,id:l,...d},u)=>{const h=l||`checkbox-${Math.random().toString(36).substr(2,9)}`,p=[na.wrapper,i].filter(Boolean).join(" ");return e.jsxs("div",{className:p,children:[e.jsxs("label",{htmlFor:h,className:na.label,children:[e.jsx("input",{ref:m=>{m&&(m.indeterminate=r||!1),typeof u=="function"?u(m):u&&(u.current=m)},type:"checkbox",id:h,className:na.input,...d}),e.jsxs("span",{className:na.checkbox,children:[e.jsx("svg",{className:na.checkIcon,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),e.jsx("svg",{className:na.indeterminateIcon,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})})]}),n&&e.jsx("span",{className:na.labelText,children:n})]}),s&&e.jsx("span",{className:na.error,children:s})]})});XB.displayName="Checkbox";const KB="_menu_1rdk0_1",ZB="_item_1rdk0_25",JB="_disabled_1rdk0_41",e8="_danger_1rdk0_45",t8="_icon_1rdk0_58",n8="_label_1rdk0_71",s8="_divider_1rdk0_75",ba={menu:KB,item:ZB,disabled:JB,danger:e8,icon:t8,label:n8,divider:s8};function a8({x:n,y:s,items:r,onClose:i}){const l=f.useRef(null);return f.useEffect(()=>{const d=h=>{l.current&&!l.current.contains(h.target)&&i()},u=h=>{h.key==="Escape"&&i()};return document.addEventListener("mousedown",d),document.addEventListener("keydown",u),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("keydown",u)}},[i]),f.useEffect(()=>{if(l.current){const d=l.current.getBoundingClientRect(),u=window.innerWidth,h=window.innerHeight;let p=n,m=s;n+d.width>u&&(p=u-d.width-8),s+d.height>h&&(m=h-d.height-8),l.current.style.left=`${p}px`,l.current.style.top=`${m}px`}},[n,s]),e.jsx("div",{ref:l,className:ba.menu,style:{left:n,top:s},children:r.map((d,u)=>d.divider?e.jsx("div",{className:ba.divider},u):e.jsxs("button",{className:`${ba.item} ${d.danger?ba.danger:""} ${d.disabled?ba.disabled:""}`,onClick:()=>{d.disabled||(d.onClick(),i())},disabled:d.disabled,children:[d.icon&&e.jsx("span",{className:ba.icon,children:d.icon}),e.jsx("span",{className:ba.label,children:d.label})]},u))})}function r8(){const n=xe(x=>x.contextMenu),s=xe(x=>x.hideContextMenu),r=xe(x=>x.openProjectModal),i=xe(x=>x.openPhaseModal),l=xe(x=>x.openSubphaseModal),d=xe(x=>x.openModal),u=xe(x=>x.setEditingStaffAssignment),h=xe(x=>x.setEditingEquipmentAssignment),p=G(x=>x.projects),m=G(x=>x.currentUser),{loadAllData:v}=ll(),y=m?.role==="admin"||m?.role==="superuser",b=f.useCallback(()=>!n.targetId||!n.type?null:n.type==="project"?p.find(x=>x.id===n.targetId):n.type==="phase"&&n.projectId?p.find(_=>_.id===n.projectId)?.phases?.find(_=>_.id===n.targetId):n.type==="subphase"&&n.projectId&&n.phaseId?p.find(S=>S.id===n.projectId)?.phases?.find(S=>S.id===n.phaseId)?.children?.find(S=>S.id===n.targetId):null,[n,p]),w=f.useCallback(()=>{const{type:x,targetId:_,projectId:S,phaseId:C}=n,B=b();if(!x||!_)return[];if(x==="project"){const D=B;return[{label:"Edit Project",icon:e.jsx(ri,{}),onClick:()=>{D&&r(D)},disabled:!y},{label:"Add Phase",icon:e.jsx(_d,{}),onClick:()=>{i(void 0,_)},disabled:!y},{label:"Assign Staff",icon:e.jsx(yd,{}),onClick:()=>{d("staffAssignment",{projectId:_})},disabled:!y},{label:"Assign Equipment",icon:e.jsx(vd,{}),onClick:()=>{d("equipmentAssignment",{projectId:_})},disabled:!y},{label:"",divider:!0,onClick:()=>{}},{label:"Delete Project",icon:e.jsx(ii,{}),danger:!0,onClick:async()=>{confirm(`Delete project "${D?.name}"? This cannot be undone.`)&&(await sy(_),v())},disabled:!y}]}if(x==="phase"){const D=B;return[{label:"Edit Phase",icon:e.jsx(ri,{}),onClick:()=>{D&&S&&i(D,S)},disabled:!y},{label:"Add Subphase",icon:e.jsx(_d,{}),onClick:()=>{l(void 0,_,S)},disabled:!y},{label:"Assign Staff",icon:e.jsx(yd,{}),onClick:()=>{d("staffAssignment",{phaseId:_,projectId:S})},disabled:!y},{label:"Assign Equipment",icon:e.jsx(vd,{}),onClick:()=>{d("equipmentAssignment",{phaseId:_,projectId:S})},disabled:!y},{label:"",divider:!0,onClick:()=>{}},{label:"Delete Phase",icon:e.jsx(ii,{}),danger:!0,onClick:async()=>{confirm(`Delete phase "${D?.name}"? This cannot be undone.`)&&(await lp(_),v())},disabled:!y}]}if(x==="subphase"){const D=B;return[{label:"Edit Subphase",icon:e.jsx(ri,{}),onClick:()=>{D&&C&&S&&l(D,C,S)},disabled:!y},{label:"Add Child Subphase",icon:e.jsx(_d,{}),onClick:()=>{l(void 0,C,S,_)},disabled:!y},{label:"Assign Staff",icon:e.jsx(yd,{}),onClick:()=>{d("staffAssignment",{subphaseId:_,phaseId:C,projectId:S})},disabled:!y},{label:"Assign Equipment",icon:e.jsx(vd,{}),onClick:()=>{d("equipmentAssignment",{subphaseId:_,phaseId:C,projectId:S})},disabled:!y},{label:"",divider:!0,onClick:()=>{}},{label:"Delete Subphase",icon:e.jsx(ii,{}),danger:!0,onClick:async()=>{confirm(`Delete subphase "${D?.name}"? This cannot be undone.`)&&(await cp(_),v())},disabled:!y}]}if(x==="staffAssignment"){const{assignmentData:D,subphaseId:O}=n,z=D?.name||"Staff Assignment",R=O?"subphase":C?"phase":"project";return[{label:"Edit Assignment",icon:e.jsx(ri,{}),onClick:()=>{u({id:_,project_id:S||0,phase_id:C||null,subphase_id:O||null,staff_id:D?.staffId||0,staff_name:D?.name||"",allocation:D?.allocation||100,start_date:D?.startDate||"",end_date:D?.endDate||""}),d("staffAssignment",{projectId:S,phaseId:C,subphaseId:O})},disabled:!y},{label:"",divider:!0,onClick:()=>{}},{label:"Delete Assignment",icon:e.jsx(ii,{}),danger:!0,onClick:async()=>{confirm(`Remove ${z} from this assignment?`)&&(await dp(_,R),v())},disabled:!y}]}if(x==="equipmentAssignment"){const{assignmentData:D,subphaseId:O}=n,z=D?.name||"Equipment Assignment";return[{label:"Edit Assignment",icon:e.jsx(ri,{}),onClick:()=>{h({id:_,project_id:S||0,phase_id:C||null,subphase_id:O||null,equipment_id:D?.equipmentId||0,equipment_name:D?.name||"",start_date:D?.startDate||"",end_date:D?.endDate||""}),d("equipmentAssignment",{projectId:S,phaseId:C,subphaseId:O})},disabled:!y},{label:"",divider:!0,onClick:()=>{}},{label:"Delete Assignment",icon:e.jsx(ii,{}),danger:!0,onClick:async()=>{confirm(`Remove ${z} from this assignment?`)&&(await up(_),v())},disabled:!y}]}return[]},[n,b,y,r,i,l,d,u,h,v]);return n.visible?e.jsx(a8,{x:n.x,y:n.y,items:w(),onClose:s}):null}const ri=()=>e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})]}),_d=()=>e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),ii=()=>e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})]}),yd=()=>e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),vd=()=>e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("path",{d:"M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16"})]}),Vm={adminUser:null,isAuthenticated:!1,isLoading:!0,mustChangePassword:!1,tenants:[],organizations:[],systemStats:null,adminUsers:[],activeTab:"tenants",selectedTenantId:null,selectedOrganizationId:null},xt=al(n=>({...Vm,setAdminUser:s=>n({adminUser:s}),setIsAuthenticated:s=>n({isAuthenticated:s}),setIsLoading:s=>n({isLoading:s}),setMustChangePassword:s=>n({mustChangePassword:s}),setTenants:s=>n({tenants:s}),setOrganizations:s=>n({organizations:s}),setSystemStats:s=>n({systemStats:s}),setAdminUsers:s=>n({adminUsers:s}),setActiveTab:s=>n({activeTab:s}),setSelectedTenantId:s=>n({selectedTenantId:s}),setSelectedOrganizationId:s=>n({selectedOrganizationId:s}),updateTenantInList:(s,r)=>n(i=>({tenants:i.tenants.map(l=>l.id===s?{...l,...r}:l)})),removeTenantFromList:s=>n(r=>({tenants:r.tenants.filter(i=>i.id!==s)})),addTenantToList:s=>n(r=>({tenants:[s,...r.tenants]})),updateOrganizationInList:(s,r)=>n(i=>({organizations:i.organizations.map(l=>l.id===s?{...l,...r}:l)})),removeOrganizationFromList:s=>n(r=>({organizations:r.organizations.filter(i=>i.id!==s)})),addOrganizationToList:s=>n(r=>({organizations:[s,...r.organizations]})),updateAdminUserInList:(s,r)=>n(i=>({adminUsers:i.adminUsers.map(l=>l.id===s?{...l,...r}:l)})),removeAdminUserFromList:s=>n(r=>({adminUsers:r.adminUsers.filter(i=>i.id!==s)})),addAdminUserToList:s=>n(r=>({adminUsers:[s,...r.adminUsers]})),reset:()=>n(Vm)})),i8="_container_jdpm3_3",o8="_card_jdpm3_12",l8="_header_jdpm3_22",c8="_logo_jdpm3_27",d8="_title_jdpm3_33",u8="_subtitle_jdpm3_40",h8="_form_jdpm3_46",f8="_formGroup_jdpm3_52",m8="_label_jdpm3_58",p8="_input_jdpm3_64",g8="_error_jdpm3_89",_8="_success_jdpm3_97",y8="_submitBtn_jdpm3_106",v8="_footer_jdpm3_127",x8="_backLink_jdpm3_134",nt={container:i8,card:o8,header:l8,logo:c8,title:d8,subtitle:u8,form:h8,formGroup:f8,label:m8,input:p8,error:g8,success:_8,submitBtn:y8,footer:v8,backLink:x8};function j8(){const[n,s]=f.useState(""),[r,i]=f.useState(""),[l,d]=f.useState(null),[u,h]=f.useState(!1),[p,m]=f.useState(()=>Ds()),[v,y]=f.useState(!1),[b,w]=f.useState(""),[x,_]=f.useState(""),[S,C]=f.useState(""),[B,D]=f.useState(!1),O=xt(E=>E.setAdminUser),z=xt(E=>E.setIsAuthenticated),R=xt(E=>E.setIsLoading),Q=xt(E=>E.setMustChangePassword);f.useEffect(()=>{const E=new MutationObserver(()=>{const L=document.documentElement.dataset.theme;L&&L!==p&&m(L)});return E.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>E.disconnect()},[p]);const H=async E=>{E.preventDefault(),d(null),h(!0);try{const L=await My(n,r);L.success&&L.user&&(L.must_change_password?(y(!0),w(r),O(L.user),Q(!0)):(O(L.user),z(!0)))}catch(L){d(L instanceof Error?L.message:"Invalid credentials")}finally{h(!1),R(!1)}},J=async E=>{if(E.preventDefault(),d(null),x.length<8){d("New password must be at least 8 characters");return}if(x!==S){d("Passwords do not match");return}h(!0);try{await Iy(b,x),D(!0),Q(!1),setTimeout(()=>{z(!0)},1500)}catch(L){d(L instanceof Error?L.message:"Failed to change password")}finally{h(!1)}},q=mi(p)?"/img/milestone_logo_dark_theme.svg":"/img/milestone_logo_light_theme.svg";return v?e.jsx("div",{className:nt.container,children:e.jsxs("div",{className:nt.card,children:[e.jsxs("div",{className:nt.header,children:[e.jsx("img",{src:q,alt:"Milestone",className:nt.logo}),e.jsx("h1",{className:nt.title,children:"Change Password"}),e.jsx("p",{className:nt.subtitle,children:"You must set a new password before continuing"})]}),B?e.jsx("div",{className:nt.success,children:"Password changed successfully. Redirecting..."}):e.jsxs("form",{onSubmit:J,className:nt.form,children:[e.jsxs("div",{className:nt.formGroup,children:[e.jsx("label",{htmlFor:"newPassword",className:nt.label,children:"New Password"}),e.jsx("input",{type:"password",id:"newPassword",className:nt.input,value:x,onChange:E=>_(E.target.value),placeholder:"Minimum 8 characters",required:!0,minLength:8,autoFocus:!0,disabled:u})]}),e.jsxs("div",{className:nt.formGroup,children:[e.jsx("label",{htmlFor:"confirmPassword",className:nt.label,children:"Confirm Password"}),e.jsx("input",{type:"password",id:"confirmPassword",className:nt.input,value:S,onChange:E=>C(E.target.value),placeholder:"Re-enter new password",required:!0,minLength:8,disabled:u})]}),l&&e.jsx("div",{className:nt.error,children:l}),e.jsx("button",{type:"submit",className:nt.submitBtn,disabled:u,children:u?"Changing...":"Set New Password"})]})]})}):e.jsx("div",{className:nt.container,children:e.jsxs("div",{className:nt.card,children:[e.jsxs("div",{className:nt.header,children:[e.jsx("img",{src:q,alt:"Milestone",className:nt.logo}),e.jsx("h1",{className:nt.title,children:"Admin Portal"}),e.jsx("p",{className:nt.subtitle,children:"Multi-tenant Management"})]}),e.jsxs("form",{onSubmit:H,className:nt.form,children:[e.jsxs("div",{className:nt.formGroup,children:[e.jsx("label",{htmlFor:"email",className:nt.label,children:"Email"}),e.jsx("input",{type:"email",id:"email",className:nt.input,value:n,onChange:E=>s(E.target.value),placeholder:"admin@example.com",required:!0,autoFocus:!0,disabled:u})]}),e.jsxs("div",{className:nt.formGroup,children:[e.jsx("label",{htmlFor:"password",className:nt.label,children:"Password"}),e.jsx("input",{type:"password",id:"password",className:nt.input,value:r,onChange:E=>i(E.target.value),placeholder:"",required:!0,disabled:u})]}),l&&e.jsx("div",{className:nt.error,children:l}),e.jsx("button",{type:"submit",className:nt.submitBtn,disabled:u,children:u?"Signing in...":"Sign In"})]}),e.jsx("div",{className:nt.footer,children:e.jsx("a",{href:"/",className:nt.backLink,children:" Back to Application"})})]})})}const w8="_container_1d2fr_3",S8="_statsGrid_1d2fr_10",C8="_statCard_1d2fr_16",b8="_statValue_1d2fr_31",k8="_success_1d2fr_37",N8="_warning_1d2fr_38",D8="_danger_1d2fr_39",E8="_panel_1d2fr_42",$8="_panelHeader_1d2fr_49",T8="_tableWrapper_1d2fr_65",M8="_table_1d2fr_65",P8="_emptyMessage_1d2fr_93",I8="_tenantName_1d2fr_99",L8="_companyName_1d2fr_113",A8="_slug_1d2fr_119",R8="_badge_1d2fr_127",B8="_badgeSuccess_1d2fr_136",O8="_badgeWarning_1d2fr_141",F8="_badgeDanger_1d2fr_146",z8="_badgeInfo_1d2fr_151",H8="_btnPrimary_1d2fr_157",W8="_actions_1d2fr_177",q8="_btnSmall_1d2fr_182",U8="_btnSuccess_1d2fr_202",V8="_btnWarning_1d2fr_210",G8="_btnDanger_1d2fr_218",Y8="_loading_1d2fr_226",je={container:w8,statsGrid:S8,statCard:C8,statValue:b8,success:k8,warning:N8,danger:D8,panel:E8,panelHeader:$8,tableWrapper:T8,table:M8,emptyMessage:P8,tenantName:I8,companyName:L8,slug:A8,badge:R8,badgeSuccess:B8,badgeWarning:O8,badgeDanger:F8,badgeInfo:z8,btnPrimary:H8,actions:W8,btnSmall:q8,btnSuccess:U8,btnWarning:V8,btnDanger:G8,loading:Y8};function Q8({onCreateNew:n,onViewDetails:s,onShowCredentials:r,onRefresh:i}){const l=xt(_=>_.tenants),d=xt(_=>_.systemStats),[u,h]=f.useState(null),p=async _=>{if(confirm("This will create the database for this tenant. Continue?")){h(_.id);try{const S=await zy(_.id);r("Database Provisioned!",S.adminEmail,S.adminPassword),i()}catch(S){alert("Error: "+(S instanceof Error?S.message:"Unknown error"))}finally{h(null)}}},m=async _=>{if(confirm("This will generate a new password for the tenant admin. Continue?")){h(_.id);try{const S=await Hy(_.id);r("Password Reset!",S.email,S.password)}catch(S){alert("Error: "+(S instanceof Error?S.message:"Unknown error"))}finally{h(null)}}},v=async(_,S)=>{if(confirm(`Change tenant status to ${S}?`)){h(_.id);try{await Oy(_.id,S),i()}catch(C){alert("Error: "+(C instanceof Error?C.message:"Unknown error"))}finally{h(null)}}},y=async _=>{if(_.status==="active"){alert("You must suspend the tenant before deleting it. This ensures no users are actively using the system.");return}const S=_.database_status?.accessible?`Delete tenant "${_.name}"?

 This will permanently delete:
 The tenant record
 The tenant database and all its data

This action cannot be undone.`:`Delete tenant "${_.name}"?

This will remove the tenant record.
This action cannot be undone.`;if(confirm(S)){h(_.id);try{await Fy(_.id,!0),i()}catch(C){alert("Error: "+(C instanceof Error?C.message:"Unknown error"))}finally{h(null)}}},b=_=>{const S={active:je.badgeSuccess,pending:je.badgeWarning,suspended:je.badgeDanger,archived:je.badgeInfo};return e.jsx("span",{className:`${je.badge} ${S[_]||""}`,children:_})},w=_=>_?_.accessible?e.jsx("span",{className:`${je.badge} ${je.badgeSuccess}`,children:"Connected"}):_.exists?e.jsx("span",{className:`${je.badge} ${je.badgeWarning}`,children:"Exists"}):e.jsx("span",{className:`${je.badge} ${je.badgeDanger}`,children:"Not provisioned"}):e.jsx("span",{className:je.badge,children:"Unknown"}),x=_=>new Date(_).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"});return e.jsxs("div",{className:je.container,children:[d&&e.jsxs("div",{className:je.statsGrid,children:[e.jsxs("div",{className:je.statCard,children:[e.jsx("h3",{children:"Total Tenants"}),e.jsx("div",{className:je.statValue,children:d.tenants.total})]}),e.jsxs("div",{className:`${je.statCard} ${je.success}`,children:[e.jsx("h3",{children:"Active"}),e.jsx("div",{className:je.statValue,children:d.tenants.active})]}),e.jsxs("div",{className:`${je.statCard} ${je.warning}`,children:[e.jsx("h3",{children:"Pending"}),e.jsx("div",{className:je.statValue,children:d.tenants.pending})]}),e.jsxs("div",{className:`${je.statCard} ${je.danger}`,children:[e.jsx("h3",{children:"Suspended"}),e.jsx("div",{className:je.statValue,children:d.tenants.suspended})]})]}),e.jsxs("div",{className:je.panel,children:[e.jsxs("div",{className:je.panelHeader,children:[e.jsx("h2",{children:"Tenants"}),e.jsxs("button",{className:je.btnPrimary,onClick:n,children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Create Tenant"]})]}),e.jsx("div",{className:je.tableWrapper,children:e.jsxs("table",{className:je.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Slug"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Database"}),e.jsx("th",{children:"Organization"}),e.jsx("th",{children:"Admin Email"}),e.jsx("th",{children:"Plan"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:je.emptyMessage,children:"No tenants found. Create your first tenant to get started."})}):l.map(_=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("button",{className:je.tenantName,onClick:()=>s(_.id),children:_.name}),_.company_name&&e.jsx("div",{className:je.companyName,children:_.company_name})]}),e.jsx("td",{children:e.jsx("code",{className:je.slug,children:_.slug})}),e.jsx("td",{children:b(_.status)}),e.jsx("td",{children:w(_.database_status)}),e.jsx("td",{children:_.organization_name?e.jsxs("span",{style:{fontSize:"0.8125rem"},children:[_.organization_name,_.required_group_ids&&_.required_group_ids.length>0&&e.jsxs("span",{style:{marginLeft:"0.25rem",color:"var(--text-muted)",fontSize:"0.75rem"},children:["(",_.required_group_ids.length," groups)"]})]}):e.jsx("span",{style:{color:"var(--text-muted)",fontSize:"0.8125rem"},children:""})}),e.jsx("td",{children:_.admin_email}),e.jsx("td",{children:_.plan}),e.jsx("td",{children:x(_.created_at)}),e.jsx("td",{children:e.jsx("div",{className:je.actions,children:u===_.id?e.jsx("span",{className:je.loading,children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:je.btnSmall,onClick:()=>s(_.id),title:"View Details",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})}),!_.database_status?.accessible&&e.jsx("button",{className:`${je.btnSmall} ${je.btnSuccess}`,onClick:()=>p(_),title:"Provision Database",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),e.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),e.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"})]})}),_.database_status?.accessible&&e.jsx("button",{className:je.btnSmall,onClick:()=>m(_),title:"Reset Admin Password",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),_.status==="active"&&e.jsx("button",{className:`${je.btnSmall} ${je.btnWarning}`,onClick:()=>v(_,"suspended"),title:"Suspend",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"6",y:"4",width:"4",height:"16"}),e.jsx("rect",{x:"14",y:"4",width:"4",height:"16"})]})}),_.status==="suspended"&&e.jsx("button",{className:`${je.btnSmall} ${je.btnSuccess}`,onClick:()=>v(_,"active"),title:"Activate",children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polygon",{points:"5 3 19 12 5 21 5 3"})})}),e.jsx("button",{className:`${je.btnSmall} ${je.btnDanger}`,onClick:()=>y(_),title:"Delete Tenant",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})})})]},_.id))})]})})]})]})}function X8({onCreateNew:n,onViewDetails:s,onRefresh:r}){const i=xt(p=>p.organizations),[l,d]=f.useState(null),u=async p=>{if(p.tenant_count>0){alert(`Cannot delete organization "${p.name}" - it has ${p.tenant_count} tenant(s) assigned.

Remove all tenants from this organization first.`);return}if(confirm(`Delete organization "${p.name}"?

This will also delete its SSO configuration.
This action cannot be undone.`)){d(p.id);try{await Jy(p.id),r()}catch(m){alert("Error: "+(m instanceof Error?m.message:"Unknown error"))}finally{d(null)}}},h=p=>new Date(p).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"});return e.jsxs("div",{className:je.container,children:[e.jsxs("div",{className:je.statsGrid,children:[e.jsxs("div",{className:je.statCard,children:[e.jsx("h3",{children:"Total Organizations"}),e.jsx("div",{className:je.statValue,children:i.length})]}),e.jsxs("div",{className:`${je.statCard} ${je.success}`,children:[e.jsx("h3",{children:"SSO Enabled"}),e.jsx("div",{className:je.statValue,children:i.filter(p=>p.sso_enabled).length})]}),e.jsxs("div",{className:je.statCard,children:[e.jsx("h3",{children:"Total Tenants"}),e.jsx("div",{className:je.statValue,children:i.reduce((p,m)=>p+m.tenant_count,0)})]})]}),e.jsxs("div",{className:je.panel,children:[e.jsxs("div",{className:je.panelHeader,children:[e.jsx("h2",{children:"Organizations"}),e.jsxs("button",{className:je.btnPrimary,onClick:n,children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Create Organization"]})]}),e.jsx("div",{className:je.tableWrapper,children:e.jsxs("table",{className:je.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Slug"}),e.jsx("th",{children:"Tenants"}),e.jsx("th",{children:"SSO"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:je.emptyMessage,children:"No organizations found. Create an organization to enable shared SSO configuration across multiple tenants."})}):i.map(p=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("button",{className:je.tenantName,onClick:()=>s(p.id),children:p.name})}),e.jsx("td",{children:e.jsx("code",{className:je.slug,children:p.slug})}),e.jsx("td",{children:p.tenant_count}),e.jsx("td",{children:p.sso_enabled?e.jsx("span",{className:`${je.badge} ${je.badgeSuccess}`,children:"Enabled"}):e.jsx("span",{className:`${je.badge} ${je.badgeWarning}`,children:"Not configured"})}),e.jsx("td",{style:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:p.description||""}),e.jsx("td",{children:h(p.created_at)}),e.jsx("td",{children:e.jsx("div",{className:je.actions,children:l===p.id?e.jsx("span",{className:je.loading,children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:je.btnSmall,onClick:()=>s(p.id),title:"View Details & Configure SSO",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})}),e.jsx("button",{className:`${je.btnSmall} ${je.btnDanger}`,onClick:()=>u(p),title:"Delete Organization",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})})})]},p.id))})]})})]}),e.jsxs("div",{className:je.panel,style:{padding:"1rem 1.25rem"},children:[e.jsx("h3",{style:{margin:"0 0 0.5rem",fontSize:"0.875rem",color:"var(--text-primary)"},children:"About Organizations"}),e.jsx("p",{style:{margin:0,fontSize:"0.8125rem",color:"var(--text-muted)",lineHeight:1.6},children:"Organizations allow multiple tenants to share a single SSO configuration. This is useful for enterprises with multiple departments or subsidiaries that use the same Microsoft Entra ID tenant. Each tenant within an organization can have its own group-based access requirements to control which Entra groups can access that specific tenant."})]})]})}function K8({onCreateNew:n,onRefresh:s}){const r=xt(m=>m.adminUsers),i=xt(m=>m.adminUser),[l,d]=f.useState(null),u=async(m,v)=>{d(m);try{await Gy(m,{active:!v}),s()}catch(y){alert("Error: "+(y instanceof Error?y.message:"Unknown error"))}finally{d(null)}},h=async(m,v)=>{if(m===i?.id){alert("You cannot delete yourself.");return}if(confirm(`Delete admin user "${v}"?`)){d(m);try{await Yy(m),s()}catch(y){alert("Error: "+(y instanceof Error?y.message:"Unknown error"))}finally{d(null)}}},p=m=>m?new Date(m).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):"-";return e.jsx("div",{className:je.container,children:e.jsxs("div",{className:je.panel,children:[e.jsxs("div",{className:je.panelHeader,children:[e.jsx("h2",{children:"Admin Users"}),e.jsxs("button",{className:je.btnPrimary,onClick:n,children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Admin"]})]}),e.jsx("div",{className:je.tableWrapper,children:e.jsxs("table",{className:je.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Last Login"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:je.emptyMessage,children:"No admin users found."})}):r.map(m=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("strong",{children:m.email}),m.id===i?.id&&e.jsx("span",{style:{marginLeft:8,fontSize:"0.75rem",color:"var(--text-muted)"},children:"(you)"})]}),e.jsx("td",{children:m.name}),e.jsx("td",{children:e.jsx("span",{className:`${je.badge} ${m.role==="superadmin"?je.badgeInfo:""}`,children:m.role})}),e.jsx("td",{children:e.jsx("span",{className:`${je.badge} ${m.active?je.badgeSuccess:je.badgeDanger}`,children:m.active?"Active":"Disabled"})}),e.jsx("td",{children:p(m.created_at)}),e.jsx("td",{children:p(m.last_login)}),e.jsx("td",{children:e.jsx("div",{className:je.actions,children:l===m.id?e.jsx("span",{className:je.loading,children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`${je.btnSmall} ${m.active?je.btnWarning:je.btnSuccess}`,onClick:()=>u(m.id,m.active),title:m.active?"Disable":"Enable",disabled:m.id===i?.id,children:m.active?e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})]}):e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("button",{className:`${je.btnSmall} ${je.btnDanger}`,onClick:()=>h(m.id,m.email),title:"Delete",disabled:m.id===i?.id,children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})})})]},m.id))})]})})]})})}const Z8="_container_1fjtr_3",J8="_loading_1fjtr_9",eO="_header_1fjtr_15",tO="_refreshBtn_1fjtr_28",nO="_grid_1fjtr_48",sO="_section_1fjtr_53",aO="_statsRow_1fjtr_68",rO="_stat_1fjtr_68",iO="_statLabel_1fjtr_80",oO="_statValue_1fjtr_85",lO="_success_1fjtr_91",cO="_warning_1fjtr_92",dO="_danger_1fjtr_93",uO="_info_1fjtr_95",hO="_infoLabel_1fjtr_104",fO="_infoValue_1fjtr_109",ze={container:Z8,loading:J8,header:eO,refreshBtn:tO,grid:nO,section:sO,statsRow:aO,stat:rO,statLabel:iO,statValue:oO,success:lO,warning:cO,danger:dO,info:uO,infoLabel:hO,infoValue:fO};function mO({onRefresh:n}){const s=xt(i=>i.systemStats),r=i=>{const l=Math.floor(i/86400),d=Math.floor(i%86400/3600),u=Math.floor(i%3600/60);return l>0?`${l}d ${d}h ${u}m`:d>0?`${d}h ${u}m`:`${u}m`};return s?e.jsxs("div",{className:ze.container,children:[e.jsxs("div",{className:ze.header,children:[e.jsx("h2",{children:"System Statistics"}),e.jsxs("button",{className:ze.refreshBtn,onClick:n,children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("polyline",{points:"1 20 1 14 7 14"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),"Refresh"]})]}),e.jsxs("div",{className:ze.grid,children:[e.jsxs("div",{className:ze.section,children:[e.jsx("h3",{children:"Tenants"}),e.jsxs("div",{className:ze.statsRow,children:[e.jsxs("div",{className:ze.stat,children:[e.jsx("span",{className:ze.statLabel,children:"Total"}),e.jsx("span",{className:ze.statValue,children:s.tenants.total})]}),e.jsxs("div",{className:ze.stat,children:[e.jsx("span",{className:ze.statLabel,children:"Active"}),e.jsx("span",{className:`${ze.statValue} ${ze.success}`,children:s.tenants.active})]}),e.jsxs("div",{className:ze.stat,children:[e.jsx("span",{className:ze.statLabel,children:"Pending"}),e.jsx("span",{className:`${ze.statValue} ${ze.warning}`,children:s.tenants.pending})]}),e.jsxs("div",{className:ze.stat,children:[e.jsx("span",{className:ze.statLabel,children:"Suspended"}),e.jsx("span",{className:`${ze.statValue} ${ze.danger}`,children:s.tenants.suspended})]}),e.jsxs("div",{className:ze.stat,children:[e.jsx("span",{className:ze.statLabel,children:"Archived"}),e.jsx("span",{className:ze.statValue,children:s.tenants.archived})]})]})]}),e.jsxs("div",{className:ze.section,children:[e.jsx("h3",{children:"Database Connections"}),e.jsxs("div",{className:ze.statsRow,children:[e.jsxs("div",{className:ze.stat,children:[e.jsx("span",{className:ze.statLabel,children:"Active Pools"}),e.jsx("span",{className:ze.statValue,children:s.connections.active_pools})]}),e.jsxs("div",{className:ze.stat,children:[e.jsx("span",{className:ze.statLabel,children:"Total Connections"}),e.jsx("span",{className:ze.statValue,children:s.connections.total_connections})]})]})]}),e.jsxs("div",{className:ze.section,children:[e.jsx("h3",{children:"Server"}),e.jsxs("div",{className:ze.statsRow,children:[e.jsxs("div",{className:ze.stat,children:[e.jsx("span",{className:ze.statLabel,children:"Uptime"}),e.jsx("span",{className:ze.statValue,children:r(s.system.uptime)})]}),e.jsxs("div",{className:ze.stat,children:[e.jsx("span",{className:ze.statLabel,children:"Memory"}),e.jsxs("span",{className:ze.statValue,children:[Math.round(s.system.memory_mb)," MB"]})]})]}),e.jsxs("div",{className:ze.info,children:[e.jsx("span",{className:ze.infoLabel,children:"Python Version:"}),e.jsx("code",{className:ze.infoValue,children:s.system.python_version.split(" ")[0]})]})]})]})]}):e.jsx("div",{className:ze.container,children:e.jsx("div",{className:ze.loading,children:"Loading statistics..."})})}const pO="_overlay_bj2j9_3",gO="_modal_bj2j9_14",_O="_wide_bj2j9_27",yO="_header_bj2j9_31",vO="_title_bj2j9_40",xO="_closeBtn_bj2j9_47",jO="_body_bj2j9_67",wO="_footer_bj2j9_74",SO="_form_bj2j9_86",CO="_formGroup_bj2j9_92",bO="_formRow_bj2j9_98",kO="_label_bj2j9_104",NO="_input_bj2j9_110",DO="_select_bj2j9_111",EO="_error_bj2j9_137",$O="_btn_bj2j9_146",TO="_btnPrimary_bj2j9_161",MO="_btnSecondary_bj2j9_170",PO="_infoGrid_bj2j9_182",IO="_infoRow_bj2j9_187",LO="_infoLabel_bj2j9_194",AO="_infoValue_bj2j9_200",RO="_codeBlock_bj2j9_206",BO="_credentialsField_bj2j9_216",OO="_credentialsInput_bj2j9_222",FO="_badge_bj2j9_254",zO="_badgeSuccess_bj2j9_263",HO="_badgeWarning_bj2j9_268",WO="_badgeDanger_bj2j9_273",qO="_badgeInfo_bj2j9_278",UO="_auditLog_bj2j9_284",VO="_auditEntry_bj2j9_290",GO="_auditAction_bj2j9_300",YO="_auditMeta_bj2j9_310",QO="_sectionTitle_bj2j9_316",V={overlay:pO,modal:gO,wide:_O,header:yO,title:vO,closeBtn:xO,body:jO,footer:wO,form:SO,formGroup:CO,formRow:bO,label:kO,input:NO,select:DO,error:EO,btn:$O,btnPrimary:TO,btnSecondary:MO,infoGrid:PO,infoRow:IO,infoLabel:LO,infoValue:AO,codeBlock:RO,credentialsField:BO,credentialsInput:OO,badge:FO,badgeSuccess:zO,badgeWarning:HO,badgeDanger:WO,badgeInfo:qO,auditLog:UO,auditEntry:VO,auditAction:GO,auditMeta:YO,sectionTitle:QO};function XO({onClose:n,onCreated:s}){const[r,i]=f.useState({name:"",slug:"",company_name:"",admin_email:"",plan:"standard",max_users:10,max_projects:50}),[l,d]=f.useState(!1),[u,h]=f.useState(null),p=b=>{const{name:w,value:x,type:_}=b.target;i(S=>({...S,[w]:_==="number"?parseInt(x,10):x}))},m=b=>{const w=b.target.value,x=w.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");i(_=>({..._,name:w,slug:x}))},v=async b=>{b.preventDefault(),h(null),d(!0);try{const w=await By(r);s(w)}catch(w){h(w instanceof Error?w.message:"Failed to create tenant")}finally{d(!1)}},y=b=>{b.target===b.currentTarget&&n()};return e.jsx("div",{className:V.overlay,onClick:y,children:e.jsxs("div",{className:V.modal,children:[e.jsxs("div",{className:V.header,children:[e.jsx("h2",{className:V.title,children:"Create Tenant"}),e.jsx("button",{className:V.closeBtn,onClick:n,children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("form",{id:"create-tenant-form",onSubmit:v,className:V.body,children:e.jsxs("div",{className:V.form,children:[e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Tenant Name *"}),e.jsx("input",{type:"text",name:"name",className:V.input,value:r.name,onChange:m,placeholder:"Acme Corporation",required:!0,disabled:l})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"URL Slug *"}),e.jsx("input",{type:"text",name:"slug",className:V.input,value:r.slug,onChange:p,placeholder:"acme-corp",pattern:"[a-z0-9-]+",required:!0,disabled:l}),e.jsxs("small",{style:{color:"var(--text-muted)",fontSize:"0.75rem"},children:["Access URL: /t/",r.slug||"slug","/"]})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Company Name"}),e.jsx("input",{type:"text",name:"company_name",className:V.input,value:r.company_name,onChange:p,placeholder:"Acme Corporation Inc.",disabled:l})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Admin Email *"}),e.jsx("input",{type:"email",name:"admin_email",className:V.input,value:r.admin_email,onChange:p,placeholder:"admin@acme.com",required:!0,disabled:l})]}),e.jsxs("div",{className:V.formRow,children:[e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Plan"}),e.jsxs("select",{name:"plan",className:V.select,value:r.plan,onChange:p,disabled:l,children:[e.jsx("option",{value:"trial",children:"Trial"}),e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"professional",children:"Professional"}),e.jsx("option",{value:"enterprise",children:"Enterprise"})]})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Max Users"}),e.jsx("input",{type:"number",name:"max_users",className:V.input,value:r.max_users,onChange:p,min:"1",disabled:l})]})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Max Projects"}),e.jsx("input",{type:"number",name:"max_projects",className:V.input,value:r.max_projects,onChange:p,min:"1",disabled:l})]}),u&&e.jsx("div",{className:V.error,children:u})]})}),e.jsxs("div",{className:V.footer,children:[e.jsx("button",{type:"button",className:`${V.btn} ${V.btnSecondary}`,onClick:n,disabled:l,children:"Cancel"}),e.jsx("button",{type:"submit",form:"create-tenant-form",className:`${V.btn} ${V.btnPrimary}`,disabled:l,children:l?"Creating...":"Create Tenant"})]})]})})}function KO({onClose:n,onCreated:s}){const[r,i]=f.useState({email:"",password:"",name:"",role:"admin"}),[l,d]=f.useState(!1),[u,h]=f.useState(null),p=y=>{const{name:b,value:w}=y.target;i(x=>({...x,[b]:w}))},m=async y=>{y.preventDefault(),h(null),d(!0);try{await Vy(r),s()}catch(b){h(b instanceof Error?b.message:"Failed to create admin user")}finally{d(!1)}},v=y=>{y.target===y.currentTarget&&n()};return e.jsx("div",{className:V.overlay,onClick:v,children:e.jsxs("div",{className:V.modal,children:[e.jsxs("div",{className:V.header,children:[e.jsx("h2",{className:V.title,children:"Create Admin User"}),e.jsx("button",{className:V.closeBtn,onClick:n,children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("form",{id:"create-admin-form",onSubmit:m,className:V.body,children:e.jsxs("div",{className:V.form,children:[e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Email *"}),e.jsx("input",{type:"email",name:"email",className:V.input,value:r.email,onChange:p,placeholder:"admin@example.com",required:!0,disabled:l})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Password *"}),e.jsx("input",{type:"password",name:"password",className:V.input,value:r.password,onChange:p,placeholder:"",minLength:8,required:!0,disabled:l})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Name *"}),e.jsx("input",{type:"text",name:"name",className:V.input,value:r.name,onChange:p,placeholder:"John Doe",required:!0,disabled:l})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Role"}),e.jsxs("select",{name:"role",className:V.select,value:r.role,onChange:p,disabled:l,children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"superadmin",children:"Superadmin"})]})]}),u&&e.jsx("div",{className:V.error,children:u})]})}),e.jsxs("div",{className:V.footer,children:[e.jsx("button",{type:"button",className:`${V.btn} ${V.btnSecondary}`,onClick:n,disabled:l,children:"Cancel"}),e.jsx("button",{type:"submit",form:"create-admin-form",className:`${V.btn} ${V.btnPrimary}`,disabled:l,children:l?"Creating...":"Create Admin"})]})]})})}function ZO({onClose:n,onCreated:s}){const[r,i]=f.useState(""),[l,d]=f.useState(""),[u,h]=f.useState(""),[p,m]=f.useState(!1),[v,y]=f.useState(null),b=S=>S.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"").substring(0,63),w=S=>{i(S),(!l||l===b(r))&&d(b(S))},x=async S=>{if(S.preventDefault(),y(null),!r.trim()||!l.trim()){y("Name and slug are required");return}if(!/^[a-z0-9][a-z0-9-]*[a-z0-9]$|^[a-z0-9]$/.test(l)){y("Slug must start and end with a letter/number and contain only lowercase letters, numbers, and hyphens");return}m(!0);try{await Ky({name:r.trim(),slug:l.trim(),description:u.trim()||void 0}),s()}catch(C){y(C instanceof Error?C.message:"Failed to create organization")}finally{m(!1)}},_=S=>{S.target===S.currentTarget&&n()};return e.jsx("div",{className:V.overlay,onClick:_,children:e.jsxs("div",{className:V.modal,children:[e.jsxs("div",{className:V.header,children:[e.jsx("h2",{className:V.title,children:"Create Organization"}),e.jsx("button",{className:V.closeBtn,onClick:n,children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("form",{className:V.body,onSubmit:x,children:[v&&e.jsx("div",{className:V.error,children:v}),e.jsxs("div",{className:V.form,children:[e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,htmlFor:"orgName",children:"Name *"}),e.jsx("input",{type:"text",id:"orgName",className:V.input,value:r,onChange:S=>w(S.target.value),placeholder:"Acme Corporation",required:!0})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,htmlFor:"orgSlug",children:"Slug *"}),e.jsx("input",{type:"text",id:"orgSlug",className:V.input,value:l,onChange:S=>d(S.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"")),placeholder:"acme-corp",required:!0}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)"},children:"Used in URLs. Only lowercase letters, numbers, and hyphens."})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,htmlFor:"orgDesc",children:"Description"}),e.jsx("input",{type:"text",id:"orgDesc",className:V.input,value:u,onChange:S=>h(S.target.value),placeholder:"Optional description of the organization"})]})]})]}),e.jsxs("div",{className:V.footer,children:[e.jsx("button",{type:"button",className:`${V.btn} ${V.btnSecondary}`,onClick:n,disabled:p,children:"Cancel"}),e.jsx("button",{type:"submit",className:`${V.btn} ${V.btnPrimary}`,onClick:x,disabled:p,children:p?"Creating...":"Create Organization"})]})]})})}function JO({tenantId:n,onClose:s}){const[r,i]=f.useState(null),[l,d]=f.useState([]),[u,h]=f.useState(!0),[p,m]=f.useState(null);f.useEffect(()=>{v()},[n]);const v=async()=>{h(!0),m(null);try{const[_,S]=await Promise.all([Ry(n),Wy(n,10)]);i(_),d(S)}catch(_){m(_ instanceof Error?_.message:"Failed to load tenant details")}finally{h(!1)}},y=_=>{_.target===_.currentTarget&&s()},b=_=>{const S={active:V.badgeSuccess,pending:V.badgeWarning,suspended:V.badgeDanger,archived:V.badgeInfo};return e.jsx("span",{className:`${V.badge} ${S[_]||""}`,children:_})},w=_=>_?_.accessible?e.jsx("span",{className:`${V.badge} ${V.badgeSuccess}`,children:"Connected"}):_.exists?e.jsx("span",{className:`${V.badge} ${V.badgeWarning}`,children:"Exists"}):e.jsx("span",{className:`${V.badge} ${V.badgeDanger}`,children:"Not provisioned"}):e.jsx("span",{className:V.badge,children:"Unknown"}),x=_=>new Date(_).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsx("div",{className:V.overlay,onClick:y,children:e.jsxs("div",{className:`${V.modal} ${V.wide}`,children:[e.jsxs("div",{className:V.header,children:[e.jsx("h2",{className:V.title,children:"Tenant Details"}),e.jsx("button",{className:V.closeBtn,onClick:s,children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("div",{className:V.body,children:u?e.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"var(--text-muted)"},children:"Loading..."}):p?e.jsx("div",{className:V.error,children:p}):r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{margin:0,color:"var(--text-primary)"},children:r.name}),r.company_name&&e.jsx("p",{style:{margin:"0.25rem 0 0",color:"var(--text-muted)"},children:r.company_name})]}),e.jsxs("div",{className:V.infoGrid,children:[e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Slug"}),e.jsx("code",{className:V.infoValue,children:r.slug})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Status"}),e.jsx("span",{className:V.infoValue,children:b(r.status)})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Database"}),e.jsx("span",{className:V.infoValue,children:w(r.database_status)})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"DB Name"}),e.jsx("code",{className:V.infoValue,children:r.database_name})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"DB User"}),e.jsx("code",{className:V.infoValue,children:r.database_user})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Admin Email"}),e.jsx("span",{className:V.infoValue,children:r.admin_email})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Plan"}),e.jsx("span",{className:V.infoValue,children:r.plan})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Max Users"}),e.jsx("span",{className:V.infoValue,children:r.max_users})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Max Projects"}),e.jsx("span",{className:V.infoValue,children:r.max_projects})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Created"}),e.jsx("span",{className:V.infoValue,children:x(r.created_at)})]})]}),e.jsx("h4",{className:V.sectionTitle,children:"Organization & SSO"}),e.jsxs("div",{className:V.infoGrid,children:[e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Organization"}),e.jsx("span",{className:V.infoValue,children:r.organization_name?e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[r.organization_name,e.jsx("span",{className:`${V.badge} ${V.badgeInfo}`,children:"SSO via Org"})]}):e.jsx("span",{style:{color:"var(--text-muted)"},children:"Not assigned"})})]}),r.organization_id&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Required Groups"}),e.jsx("span",{className:V.infoValue,children:r.required_group_ids&&r.required_group_ids.length>0?e.jsxs("span",{children:[r.required_group_ids.length," group(s) configured"]}):e.jsx("span",{style:{color:"var(--text-muted)"},children:"None (all org users allowed)"})})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Group Mode"}),e.jsx("span",{className:V.infoValue,children:r.group_membership_mode==="all"?"All groups required":"Any group allowed"})]})]})]}),e.jsx("h4",{className:V.sectionTitle,children:"Access URL"}),e.jsxs("div",{className:V.codeBlock,children:[window.location.origin,"/t/",r.slug,"/"]}),l.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:V.sectionTitle,children:"Recent Activity"}),e.jsx("div",{className:V.auditLog,children:l.map(_=>e.jsxs("div",{className:V.auditEntry,children:[e.jsx("span",{className:V.auditAction,children:_.action}),e.jsxs("span",{className:V.auditMeta,children:[x(_.created_at),_.actor&&` by ${_.actor}`]})]},_.id))})]})]}):null}),e.jsx("div",{className:V.footer,children:e.jsx("button",{className:`${V.btn} ${V.btnSecondary}`,onClick:s,children:"Close"})})]})})}function e9({organizationId:n,onClose:s,onRefresh:r}){const i=xt(ie=>ie.tenants),[l,d]=f.useState(null),[u,h]=f.useState(!0),[p,m]=f.useState(null),[v,y]=f.useState("details"),[b,w]=f.useState(!1),[x,_]=f.useState(""),[S,C]=f.useState(""),[B,D]=f.useState(!1),[O,z]=f.useState(""),[R,Q]=f.useState(""),[H,J]=f.useState(""),[q,E]=f.useState(""),[L,$]=f.useState(!1),[M,k]=f.useState("user"),[P,F]=f.useState(!1),[A,I]=f.useState(null),[U,N]=f.useState(""),[W,K]=f.useState(null),[te,Y]=f.useState(""),[me,ge]=f.useState("any"),pe=typeof window<"u"?`${window.location.origin}/api/auth/sso/callback`:"/api/auth/sso/callback";f.useEffect(()=>{oe()},[n]);const oe=async()=>{h(!0),m(null);try{const ie=await Xy(n);d(ie),_(ie.name),C(ie.description||""),ie.sso_config?(D(ie.sso_config.enabled),z(ie.sso_config.entraTenantId||""),Q(ie.sso_config.clientId||""),E(ie.sso_config.redirectUri||pe),$(ie.sso_config.autoCreateUsers),k(ie.sso_config.defaultUserRole)):E(pe)}catch(ie){m(ie instanceof Error?ie.message:"Failed to load organization")}finally{h(!1)}},le=async()=>{if(l)try{await Zy(l.id,{name:x.trim(),description:S.trim()||void 0}),await oe(),w(!1),r?.()}catch(ie){m(ie instanceof Error?ie.message:"Failed to update organization")}},se=async()=>{if(l){if(m(null),I(null),B&&(!O.trim()||!R.trim()||!q.trim())){m("Tenant ID, Client ID, and Redirect URI are required to enable SSO");return}F(!0);try{const ie={enabled:B,entraTenantId:O.trim(),clientId:R.trim(),redirectUri:q.trim(),autoCreateUsers:L,defaultUserRole:M};H&&(ie.clientSecret=H),await ev(l.id,ie),I("SSO configuration saved successfully"),J(""),await oe(),r?.()}catch(ie){m(ie instanceof Error?ie.message:"Failed to save SSO configuration")}finally{F(!1)}}},De=async()=>{if(!(!l||!U))try{await tv(l.id,U),N(""),await oe(),r?.()}catch(ie){m(ie instanceof Error?ie.message:"Failed to add tenant")}},We=async ie=>{if(l&&confirm(`Remove this tenant from the organization?

The tenant will no longer use the organization's SSO configuration.`))try{await nv(l.id,ie),await oe(),r?.()}catch(Ae){m(Ae instanceof Error?Ae.message:"Failed to remove tenant")}},ot=ie=>{K(ie.id),Y(ie.required_group_ids.join(", ")),ge(ie.group_membership_mode)},ce=async()=>{if(W)try{const ie=te.split(",").map(Ae=>Ae.trim()).filter(Ae=>Ae);await sv(W,{requiredGroupIds:ie,groupMembershipMode:me}),K(null),await oe()}catch(ie){m(ie instanceof Error?ie.message:"Failed to update tenant groups")}},ae=ie=>{ie.target===ie.currentTarget&&s()},ue=ie=>new Date(ie).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),we=i.filter(ie=>!l?.tenants.some(Ae=>Ae.id===ie.id));return e.jsx("div",{className:V.overlay,onClick:ae,children:e.jsxs("div",{className:`${V.modal} ${V.wide}`,style:{maxWidth:800},children:[e.jsxs("div",{className:V.header,children:[e.jsx("h2",{className:V.title,children:l?.name||"Organization Details"}),e.jsx("button",{className:V.closeBtn,onClick:s,children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("div",{style:{display:"flex",gap:"0.25rem",padding:"0.75rem 1.25rem",borderBottom:"1px solid var(--border-color)",background:"var(--bg-tertiary)",flexShrink:0},children:["details","sso","tenants"].map(ie=>e.jsx("button",{onClick:()=>y(ie),style:{padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:500,background:v===ie?"var(--bg-secondary)":"transparent",border:v===ie?"1px solid var(--border-color)":"1px solid transparent",borderBottom:v===ie?"1px solid var(--bg-secondary)":"1px solid transparent",borderRadius:"var(--radius-md) var(--radius-md) 0 0",color:v===ie?"var(--accent-blue)":"var(--text-secondary)",cursor:"pointer",marginBottom:"-1px",textTransform:"capitalize"},children:ie==="sso"?"SSO Configuration":ie},ie))}),e.jsx("div",{className:V.body,children:u?e.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"var(--text-muted)"},children:"Loading..."}):p&&!l?e.jsx("div",{className:V.error,children:p}):l?e.jsxs(e.Fragment,{children:[p&&e.jsx("div",{className:V.error,style:{marginBottom:"1rem"},children:p}),v==="details"&&e.jsx("div",{children:b?e.jsxs("div",{className:V.form,children:[e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Name"}),e.jsx("input",{type:"text",className:V.input,value:x,onChange:ie=>_(ie.target.value)})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Description"}),e.jsx("input",{type:"text",className:V.input,value:S,onChange:ie=>C(ie.target.value)})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"1rem"},children:[e.jsx("button",{className:`${V.btn} ${V.btnPrimary}`,onClick:le,children:"Save"}),e.jsx("button",{className:`${V.btn} ${V.btnSecondary}`,onClick:()=>w(!1),children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:V.infoGrid,children:[e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Name"}),e.jsx("span",{className:V.infoValue,children:l.name})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Slug"}),e.jsx("code",{className:V.infoValue,children:l.slug})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Description"}),e.jsx("span",{className:V.infoValue,children:l.description||""})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"SSO Status"}),e.jsx("span",{className:V.infoValue,children:l.sso_config?.enabled?e.jsx("span",{className:`${V.badge} ${V.badgeSuccess}`,children:"Enabled"}):l.sso_config?.configured?e.jsx("span",{className:`${V.badge} ${V.badgeWarning}`,children:"Configured (Disabled)"}):e.jsx("span",{className:`${V.badge} ${V.badgeInfo}`,children:"Not configured"})})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Tenants"}),e.jsx("span",{className:V.infoValue,children:l.tenants.length})]}),e.jsxs("div",{className:V.infoRow,children:[e.jsx("span",{className:V.infoLabel,children:"Created"}),e.jsx("span",{className:V.infoValue,children:ue(l.created_at)})]})]}),e.jsx("button",{className:`${V.btn} ${V.btnSecondary}`,onClick:()=>w(!0),style:{marginTop:"1rem"},children:"Edit Details"})]})}),v==="sso"&&e.jsxs("div",{className:V.form,children:[A&&e.jsx("div",{style:{padding:"0.75rem",background:"rgba(16, 185, 129, 0.15)",color:"var(--accent-green)",borderRadius:"var(--radius-md)",marginBottom:"1rem",fontSize:"0.875rem"},children:A}),e.jsxs("div",{className:V.formGroup,children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:B,onChange:ie=>D(ie.target.checked),style:{width:18,height:18}}),e.jsx("span",{style:{fontWeight:500},children:"Enable SSO for this organization"})]}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)",marginTop:"0.25rem"},children:"When enabled, all tenants in this organization can use SSO login."})]}),e.jsx("h4",{className:V.sectionTitle,style:{marginTop:"1rem"},children:"Microsoft Entra Settings"}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Entra Tenant ID *"}),e.jsx("input",{type:"text",className:V.input,value:O,onChange:ie=>z(ie.target.value),placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",disabled:!B})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Client ID (Application ID) *"}),e.jsx("input",{type:"text",className:V.input,value:R,onChange:ie=>Q(ie.target.value),placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",disabled:!B})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Client Secret"}),e.jsx("input",{type:"password",className:V.input,value:H,onChange:ie=>J(ie.target.value),placeholder:l.sso_config?.configured?"":"Enter client secret",disabled:!B}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)"},children:"Leave blank to keep existing secret."})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Redirect URI *"}),e.jsx("input",{type:"text",className:V.input,value:q,onChange:ie=>E(ie.target.value),placeholder:pe,disabled:!B})]}),e.jsx("h4",{className:V.sectionTitle,children:"User Management"}),e.jsx("div",{className:V.formGroup,children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.75rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:L,onChange:ie=>$(ie.target.checked),disabled:!B,style:{width:16,height:16}}),e.jsx("span",{children:"Auto-create users on first SSO login"})]})}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Default role for new users"}),e.jsxs("select",{className:V.select,value:M,onChange:ie=>k(ie.target.value),disabled:!B||!L,children:[e.jsx("option",{value:"viewer",children:"Viewer"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"superuser",children:"SuperUser"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsx("button",{className:`${V.btn} ${V.btnPrimary}`,onClick:se,disabled:P,style:{marginTop:"1rem"},children:P?"Saving...":"Save SSO Configuration"})]}),v==="tenants"&&e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",gap:"0.75rem",marginBottom:"1.5rem",padding:"1rem",background:"var(--bg-tertiary)",borderRadius:"var(--radius-md)"},children:[e.jsxs("select",{className:V.select,value:U,onChange:ie=>N(ie.target.value),style:{flex:1},children:[e.jsx("option",{value:"",children:"Select a tenant to add..."}),we.map(ie=>e.jsxs("option",{value:ie.id,children:[ie.name," (",ie.slug,")"]},ie.id))]}),e.jsx("button",{className:`${V.btn} ${V.btnPrimary}`,onClick:De,disabled:!U,children:"Add Tenant"})]}),l.tenants.length===0?e.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"var(--text-muted)"},children:"No tenants assigned to this organization yet."}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:l.tenants.map(ie=>e.jsxs("div",{style:{padding:"1rem",background:"var(--bg-tertiary)",borderRadius:"var(--radius-md)",border:"1px solid var(--border-color)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500,color:"var(--text-primary)"},children:ie.name}),e.jsxs("div",{style:{fontSize:"0.8125rem",color:"var(--text-muted)"},children:[e.jsx("code",{children:ie.slug}),"  ",ie.status]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{className:`${V.btn} ${V.btnSecondary}`,onClick:()=>ot(ie),style:{padding:"0.375rem 0.75rem",fontSize:"0.8125rem"},children:"Configure Groups"}),e.jsx("button",{className:`${V.btn} ${V.btnSecondary}`,onClick:()=>We(ie.id),style:{padding:"0.375rem 0.75rem",fontSize:"0.8125rem",color:"var(--accent-red)"},children:"Remove"})]})]}),W===ie.id?e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"var(--bg-secondary)",borderRadius:"var(--radius-md)"},children:[e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Required Group IDs"}),e.jsx("input",{type:"text",className:V.input,value:te,onChange:Ae=>Y(Ae.target.value),placeholder:"group-id-1, group-id-2"}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)"},children:"Comma-separated Entra group IDs. Leave empty for no group restrictions."})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Membership Mode"}),e.jsxs("select",{className:V.select,value:me,onChange:Ae=>ge(Ae.target.value),children:[e.jsx("option",{value:"any",children:"Any (user must be in at least ONE group)"}),e.jsx("option",{value:"all",children:"All (user must be in ALL groups)"})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.75rem"},children:[e.jsx("button",{className:`${V.btn} ${V.btnPrimary}`,onClick:ce,style:{padding:"0.375rem 0.75rem",fontSize:"0.8125rem"},children:"Save"}),e.jsx("button",{className:`${V.btn} ${V.btnSecondary}`,onClick:()=>K(null),style:{padding:"0.375rem 0.75rem",fontSize:"0.8125rem"},children:"Cancel"})]})]}):ie.required_group_ids.length>0?e.jsxs("div",{style:{marginTop:"0.75rem",fontSize:"0.8125rem"},children:[e.jsx("span",{style:{color:"var(--text-muted)"},children:"Required groups: "}),e.jsxs("span",{style:{color:"var(--text-secondary)"},children:[ie.required_group_ids.length," group(s) (",ie.group_membership_mode," mode)"]})]}):null]},ie.id))})]})]}):null}),e.jsx("div",{className:V.footer,children:e.jsx("button",{className:`${V.btn} ${V.btnSecondary}`,onClick:s,children:"Close"})})]})})}function t9({title:n,email:s,password:r,onClose:i}){const[l,d]=f.useState(!1),u=async()=>{const p=`Email: ${s}
Password: ${r}`;try{await navigator.clipboard.writeText(p),d(!0),setTimeout(()=>d(!1),2e3)}catch(m){console.error("Failed to copy:",m)}},h=p=>{p.target===p.currentTarget&&i()};return e.jsx("div",{className:V.overlay,onClick:h,children:e.jsxs("div",{className:V.modal,children:[e.jsxs("div",{className:V.header,children:[e.jsx("h2",{className:V.title,children:n}),e.jsx("button",{className:V.closeBtn,onClick:i,children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("div",{className:V.body,children:[e.jsx("p",{style:{marginBottom:"1.5rem",color:"var(--text-secondary)"},children:"Please save these credentials securely. The password will not be shown again."}),e.jsxs("div",{className:V.form,children:[e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Email"}),e.jsx("div",{className:V.credentialsField,children:e.jsx("input",{type:"text",className:V.credentialsInput,value:s,readOnly:!0})})]}),e.jsxs("div",{className:V.formGroup,children:[e.jsx("label",{className:V.label,children:"Password"}),e.jsx("div",{className:V.credentialsField,children:e.jsx("input",{type:"text",className:V.credentialsInput,value:r,readOnly:!0})})]})]})]}),e.jsxs("div",{className:V.footer,children:[e.jsx("button",{className:`${V.btn} ${V.btnSecondary}`,onClick:i,children:"Close"}),e.jsx("button",{className:`${V.btn} ${V.btnPrimary}`,onClick:u,children:l?"Copied!":"Copy Credentials"})]})]})})}const n9="_container_1by4n_3",s9="_header_1by4n_12",a9="_headerLeft_1by4n_21",r9="_logo_1by4n_27",i9="_title_1by4n_32",o9="_headerRight_1by4n_39",l9="_userInfo_1by4n_45",c9="_roleBadge_1by4n_53",d9="_logoutBtn_1by4n_63",u9="_tabs_1by4n_81",h9="_tab_1by4n_81",f9="_active_1by4n_109",m9="_main_1by4n_119",Kt={container:n9,header:s9,headerLeft:a9,logo:r9,title:i9,headerRight:o9,userInfo:l9,roleBadge:c9,logoutBtn:d9,tabs:u9,tab:h9,active:f9,main:m9};function p9(){const n=xt(P=>P.adminUser),s=xt(P=>P.activeTab),r=xt(P=>P.setActiveTab),i=xt(P=>P.setTenants),l=xt(P=>P.setOrganizations),d=xt(P=>P.setSystemStats),u=xt(P=>P.setAdminUsers),h=xt(P=>P.setIsAuthenticated),p=xt(P=>P.setAdminUser),m=xt(P=>P.reset),[v,y]=f.useState(()=>Ds()),[b,w]=f.useState(!1),[x,_]=f.useState(!1),[S,C]=f.useState(!1),[B,D]=f.useState(null),[O,z]=f.useState(null),[R,Q]=f.useState(null);f.useEffect(()=>{const P=new MutationObserver(()=>{const F=document.documentElement.dataset.theme;F&&F!==v&&y(F)});return P.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>P.disconnect()},[v]),f.useEffect(()=>{H(),J(),q()},[]),f.useEffect(()=>{s==="admins"&&E()},[s]);const H=async()=>{try{const P=await Ay();i(P)}catch(P){console.error("Failed to load tenants:",P)}},J=async()=>{try{const P=await Qy();l(P)}catch(P){console.error("Failed to load organizations:",P)}},q=async()=>{try{const P=await qy();d(P)}catch(P){console.error("Failed to load stats:",P)}},E=async()=>{try{const P=await Uy();u(P)}catch(P){console.error("Failed to load admin users:",P)}},L=async()=>{try{await Py()}catch(P){console.error("Logout error:",P)}finally{m(),h(!1),p(null)}},$=(P,F,A)=>{Q({title:P,email:F,password:A})},M=mi(v)?"/img/milestone_logo_dark_theme.svg":"/img/milestone_logo_light_theme.svg",k=n?.role==="superadmin";return e.jsxs("div",{className:Kt.container,children:[e.jsxs("header",{className:Kt.header,children:[e.jsxs("div",{className:Kt.headerLeft,children:[e.jsx("img",{src:M,alt:"Milestone",className:Kt.logo}),e.jsx("h1",{className:Kt.title,children:"Admin Portal"})]}),e.jsxs("div",{className:Kt.headerRight,children:[e.jsxs("span",{className:Kt.userInfo,children:[n?.email,n?.role==="superadmin"&&e.jsx("span",{className:Kt.roleBadge,children:"Superadmin"})]}),e.jsx("button",{className:Kt.logoutBtn,onClick:L,children:"Logout"})]})]}),e.jsxs("nav",{className:Kt.tabs,children:[e.jsxs("button",{className:`${Kt.tab} ${s==="tenants"?Kt.active:""}`,onClick:()=>r("tenants"),children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),"Tenants"]}),e.jsxs("button",{className:`${Kt.tab} ${s==="organizations"?Kt.active:""}`,onClick:()=>r("organizations"),children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),e.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]}),"Organizations"]}),k&&e.jsxs("button",{className:`${Kt.tab} ${s==="admins"?Kt.active:""}`,onClick:()=>r("admins"),children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),"Admin Users"]}),e.jsxs("button",{className:`${Kt.tab} ${s==="stats"?Kt.active:""}`,onClick:()=>r("stats"),children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),e.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),e.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]}),"System Stats"]})]}),e.jsxs("main",{className:Kt.main,children:[s==="tenants"&&e.jsx(Q8,{onCreateNew:()=>w(!0),onViewDetails:P=>D(P),onShowCredentials:$,onRefresh:H}),s==="organizations"&&e.jsx(X8,{onCreateNew:()=>_(!0),onViewDetails:P=>z(P),onRefresh:J}),s==="admins"&&k&&e.jsx(K8,{onCreateNew:()=>C(!0),onRefresh:E}),s==="stats"&&e.jsx(mO,{onRefresh:q})]}),b&&e.jsx(XO,{onClose:()=>w(!1),onCreated:()=>{H(),w(!1)}}),x&&e.jsx(ZO,{onClose:()=>_(!1),onCreated:()=>{J(),_(!1)}}),S&&e.jsx(KO,{onClose:()=>C(!1),onCreated:()=>{E(),C(!1)}}),B&&e.jsx(JO,{tenantId:B,onClose:()=>D(null),onShowCredentials:$,onRefresh:H}),O&&e.jsx(e9,{organizationId:O,onClose:()=>z(null),onRefresh:()=>{J(),H()}}),R&&e.jsx(t9,{title:R.title,email:R.email,password:R.password,onClose:()=>Q(null)})]})}function g9(){const n=xt(d=>d.isAuthenticated),s=xt(d=>d.isLoading),r=xt(d=>d.setAdminUser),i=xt(d=>d.setIsAuthenticated),l=xt(d=>d.setIsLoading);return f.useEffect(()=>{(async()=>{try{const u=await Ly();u.user&&(r(u.user),i(!0))}catch{console.log("Admin not authenticated")}finally{l(!1)}})()},[r,i,l]),s?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",background:"var(--bg-primary)",color:"var(--text-muted)"},children:"Loading..."}):n?e.jsx(p9,{}):e.jsx(j8,{})}function _9(){const{isLoading:n,isAuthenticated:s}=yp(),{loadAllData:r,isLoading:i}=ll(),l=G(p=>p.whatIfMode),d=G(p=>p.instanceSettings),[u,h]=f.useState(!1);return f.useEffect(()=>{const p=window.location.pathname,m=p==="/admin"||p==="/admin/"||p.startsWith("/admin/");h(m)},[]),f.useEffect(()=>{s&&!u&&r()},[s,r,u]),f.useEffect(()=>{if(u)document.title="Milestone Admin";else{const p=d?.instance_title||"Milestone";document.title=p}},[d,u]),f.useEffect(()=>(l?document.body.classList.add("what-if-mode"):document.body.classList.remove("what-if-mode"),()=>{document.body.classList.remove("what-if-mode")}),[l]),u?e.jsx(g9,{}):n?e.jsx(cm,{}):s?i?e.jsx(cm,{message:"Loading data..."}):e.jsxs(xj,{children:[e.jsx(zB,{}),e.jsx(xP,{}),e.jsx(r8,{})]}):e.jsx(Mv,{})}yv();fv();sp({isWhatIfMode:()=>G.getState().whatIfMode,queueWhatIfOperation:n=>G.getState().queueWhatIfOperation(n)});const y9=new A1({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*30,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});d1.createRoot(document.getElementById("root")).render(e.jsx(f.StrictMode,{children:e.jsx(B1,{client:y9,children:e.jsx(_9,{})})}));
//# sourceMappingURL=index-p20gDzRX.js.map
