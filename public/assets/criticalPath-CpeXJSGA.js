function y(d,s){const i=new Date(d),t=new Date(s).getTime()-i.getTime(),e=Math.ceil(t/(1e3*60*60*24));return Math.max(1,e+1)}function g(d,s){const a=new Date(d).getTime()-s.getTime();return Math.floor(a/(1e3*60*60*24))}function b(d,s){var a;const i=[];for(const t of d.phases??[]){i.push({id:`phase-${t.id}`,type:"phase",entityId:t.id,name:t.name,startDate:new Date(t.start_date),endDate:new Date(t.end_date),duration:y(t.start_date,t.end_date),dependencies:t.dependencies??[],earlyStart:g(t.start_date,s),earlyFinish:0,lateStart:0,lateFinish:0,totalFloat:0});const e=c=>{var o;for(const n of c)i.push({id:`subphase-${n.id}`,type:"subphase",entityId:n.id,name:n.name,startDate:new Date(n.start_date),endDate:new Date(n.end_date),duration:y(n.start_date,n.end_date),dependencies:n.dependencies??[],earlyStart:g(n.start_date,s),earlyFinish:0,lateStart:0,lateFinish:0,totalFloat:0}),(o=n.children)!=null&&o.length&&e(n.children)};(a=t.children)!=null&&a.length&&e(t.children)}return i}function D(d,s){const i=[...d].sort((a,t)=>a.earlyStart-t.earlyStart);for(const a of i){a.earlyFinish=a.earlyStart+a.duration-1;for(const t of a.dependencies){const e=`phase-${t.id}`,c=`subphase-${t.id}`,o=s.get(e)||s.get(c);if(o){let n;const r=t.lag??0;switch(t.type){case"FS":n=o.earlyFinish+1+r;break;case"SS":n=o.earlyStart+r;break;case"FF":n=o.earlyFinish-a.duration+1+r;break;case"SF":n=o.earlyStart-a.duration+1+r;break;default:n=o.earlyFinish+1+r}n>a.earlyStart&&(a.earlyStart=n,a.earlyFinish=a.earlyStart+a.duration-1)}}}}function m(d,s,i){for(const e of d)e.lateFinish=i,e.lateStart=e.lateFinish-e.duration+1;const a=[...d].sort((e,c)=>c.earlyFinish-e.earlyFinish),t=new Map;for(const e of d)for(const c of e.dependencies){const o=`phase-${c.id}`,n=`subphase-${c.id}`,r=s.get(o)||s.get(n);r&&(t.has(r.id)||t.set(r.id,[]),t.get(r.id).push({node:e,dep:c}))}for(const e of a){const c=t.get(e.id)||[];for(const{node:o,dep:n}of c){let r;const f=n.lag??0;switch(n.type){case"FS":r=o.lateStart-1-f;break;case"SS":r=o.lateStart+e.duration-1-f;break;case"FF":r=o.lateFinish-f;break;case"SF":r=o.lateFinish+e.duration-1-f;break;default:r=o.lateStart-1-f}r<e.lateFinish&&(e.lateFinish=r,e.lateStart=e.lateFinish-e.duration+1)}}}function w(d){for(const s of d)s.totalFloat=s.lateStart-s.earlyStart}function k(d){const s=new Set;for(const i of d)i.totalFloat<=0&&s.add(i.id);return s}function I(d){var r,f;const s=d.phases??[];if(s.length===0)return{criticalItems:new Set,hasDependencies:!1};let i=!1;for(const l of s){if(((r=l.dependencies)==null?void 0:r.length)>0){i=!0;break}const h=u=>{var S,F;for(const p of u)if(((S=p.dependencies)==null?void 0:S.length)>0||(F=p.children)!=null&&F.length&&h(p.children))return!0;return!1};if((f=l.children)!=null&&f.length&&h(l.children)){i=!0;break}}let a=null,t=null;for(const l of s){const h=new Date(l.start_date),u=new Date(l.end_date);(!a||h<a)&&(a=h),(!t||u>t)&&(t=u)}if(!a||!t)return{criticalItems:new Set,hasDependencies:i};const e=b(d,a);if(e.length===0)return{criticalItems:new Set,hasDependencies:i};const c=new Map;for(const l of e)c.set(l.id,l);const o=Math.ceil((t.getTime()-a.getTime())/(1e3*60*60*24));return D(e,c),m(e,c,o),w(e),{criticalItems:k(e),hasDependencies:i}}export{I as calculateCriticalPath};
//# sourceMappingURL=criticalPath-CpeXJSGA.js.map
