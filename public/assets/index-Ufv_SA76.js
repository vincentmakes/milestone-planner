var Ou=e=>{throw TypeError(e)};var El=(e,t,n)=>t.has(e)||Ou("Cannot "+n);var G=(e,t,n)=>(El(e,t,"read from private field"),n?n.call(e):t.get(e)),Ce=(e,t,n)=>t.has(e)?Ou("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),me=(e,t,n,r)=>(El(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),It=(e,t,n)=>(El(e,t,"access private method"),n);var Mi=(e,t,n,r)=>({set _(a){me(e,t,a,n)},get _(){return G(e,t,r)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();function C_(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var sm={exports:{}},tl={},rm={exports:{}},Se={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wi=Symbol.for("react.element"),k_=Symbol.for("react.portal"),b_=Symbol.for("react.fragment"),N_=Symbol.for("react.strict_mode"),D_=Symbol.for("react.profiler"),$_=Symbol.for("react.provider"),E_=Symbol.for("react.context"),T_=Symbol.for("react.forward_ref"),M_=Symbol.for("react.suspense"),I_=Symbol.for("react.memo"),P_=Symbol.for("react.lazy"),Fu=Symbol.iterator;function L_(e){return e===null||typeof e!="object"?null:(e=Fu&&e[Fu]||e["@@iterator"],typeof e=="function"?e:null)}var am={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},im=Object.assign,om={};function _a(e,t,n){this.props=e,this.context=t,this.refs=om,this.updater=n||am}_a.prototype.isReactComponent={};_a.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};_a.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function lm(){}lm.prototype=_a.prototype;function bd(e,t,n){this.props=e,this.context=t,this.refs=om,this.updater=n||am}var Nd=bd.prototype=new lm;Nd.constructor=bd;im(Nd,_a.prototype);Nd.isPureReactComponent=!0;var zu=Array.isArray,cm=Object.prototype.hasOwnProperty,Dd={current:null},dm={key:!0,ref:!0,__self:!0,__source:!0};function um(e,t,n){var r,a={},i=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(i=""+t.key),t)cm.call(t,r)&&!dm.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(l===1)a.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps,l)a[r]===void 0&&(a[r]=l[r]);return{$$typeof:wi,type:e,key:i,ref:o,props:a,_owner:Dd.current}}function A_(e,t){return{$$typeof:wi,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function $d(e){return typeof e=="object"&&e!==null&&e.$$typeof===wi}function B_(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Hu=/\/+/g;function Tl(e,t){return typeof e=="object"&&e!==null&&e.key!=null?B_(""+e.key):t.toString(36)}function io(e,t,n,r,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case wi:case k_:o=!0}}if(o)return o=e,a=a(o),e=r===""?"."+Tl(o,0):r,zu(a)?(n="",e!=null&&(n=e.replace(Hu,"$&/")+"/"),io(a,t,n,"",function(d){return d})):a!=null&&($d(a)&&(a=A_(a,n+(!a.key||o&&o.key===a.key?"":(""+a.key).replace(Hu,"$&/")+"/")+e)),t.push(a)),1;if(o=0,r=r===""?".":r+":",zu(e))for(var l=0;l<e.length;l++){i=e[l];var c=r+Tl(i,l);o+=io(i,t,n,c,a)}else if(c=L_(e),typeof c=="function")for(e=c.call(e),l=0;!(i=e.next()).done;)i=i.value,c=r+Tl(i,l++),o+=io(i,t,n,c,a);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Ii(e,t,n){if(e==null)return e;var r=[],a=0;return io(e,r,"","",function(i){return t.call(n,i,a++)}),r}function R_(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Qt={current:null},oo={transition:null},O_={ReactCurrentDispatcher:Qt,ReactCurrentBatchConfig:oo,ReactCurrentOwner:Dd};function fm(){throw Error("act(...) is not supported in production builds of React.")}Se.Children={map:Ii,forEach:function(e,t,n){Ii(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Ii(e,function(){t++}),t},toArray:function(e){return Ii(e,function(t){return t})||[]},only:function(e){if(!$d(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Se.Component=_a;Se.Fragment=b_;Se.Profiler=D_;Se.PureComponent=bd;Se.StrictMode=N_;Se.Suspense=M_;Se.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O_;Se.act=fm;Se.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=im({},e.props),a=e.key,i=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,o=Dd.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)cm.call(t,c)&&!dm.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:wi,type:e.type,key:a,ref:i,props:r,_owner:o}};Se.createContext=function(e){return e={$$typeof:E_,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:$_,_context:e},e.Consumer=e};Se.createElement=um;Se.createFactory=function(e){var t=um.bind(null,e);return t.type=e,t};Se.createRef=function(){return{current:null}};Se.forwardRef=function(e){return{$$typeof:T_,render:e}};Se.isValidElement=$d;Se.lazy=function(e){return{$$typeof:P_,_payload:{_status:-1,_result:e},_init:R_}};Se.memo=function(e,t){return{$$typeof:I_,type:e,compare:t===void 0?null:t}};Se.startTransition=function(e){var t=oo.transition;oo.transition={};try{e()}finally{oo.transition=t}};Se.unstable_act=fm;Se.useCallback=function(e,t){return Qt.current.useCallback(e,t)};Se.useContext=function(e){return Qt.current.useContext(e)};Se.useDebugValue=function(){};Se.useDeferredValue=function(e){return Qt.current.useDeferredValue(e)};Se.useEffect=function(e,t){return Qt.current.useEffect(e,t)};Se.useId=function(){return Qt.current.useId()};Se.useImperativeHandle=function(e,t,n){return Qt.current.useImperativeHandle(e,t,n)};Se.useInsertionEffect=function(e,t){return Qt.current.useInsertionEffect(e,t)};Se.useLayoutEffect=function(e,t){return Qt.current.useLayoutEffect(e,t)};Se.useMemo=function(e,t){return Qt.current.useMemo(e,t)};Se.useReducer=function(e,t,n){return Qt.current.useReducer(e,t,n)};Se.useRef=function(e){return Qt.current.useRef(e)};Se.useState=function(e){return Qt.current.useState(e)};Se.useSyncExternalStore=function(e,t,n){return Qt.current.useSyncExternalStore(e,t,n)};Se.useTransition=function(){return Qt.current.useTransition()};Se.version="18.3.1";rm.exports=Se;var f=rm.exports;const Pi=C_(f);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F_=f,z_=Symbol.for("react.element"),H_=Symbol.for("react.fragment"),q_=Object.prototype.hasOwnProperty,W_=F_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,V_={key:!0,ref:!0,__self:!0,__source:!0};function hm(e,t,n){var r,a={},i=null,o=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(r in t)q_.call(t,r)&&!V_.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:z_,type:e,key:i,ref:o,props:a,_owner:W_.current}}tl.Fragment=H_;tl.jsx=hm;tl.jsxs=hm;sm.exports=tl;var s=sm.exports,mm={exports:{}},hn={},pm={exports:{}},gm={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t($,A){var R=$.length;$.push(A);e:for(;0<R;){var H=R-1>>>1,F=$[H];if(0<a(F,A))$[H]=A,$[R]=F,R=H;else break e}}function n($){return $.length===0?null:$[0]}function r($){if($.length===0)return null;var A=$[0],R=$.pop();if(R!==A){$[0]=R;e:for(var H=0,F=$.length,V=F>>>1;H<V;){var Q=2*(H+1)-1,X=$[Q],Z=Q+1,ce=$[Z];if(0>a(X,R))Z<F&&0>a(ce,X)?($[H]=ce,$[Z]=R,H=Z):($[H]=X,$[Q]=R,H=Q);else if(Z<F&&0>a(ce,R))$[H]=ce,$[Z]=R,H=Z;else break e}}return A}function a($,A){var R=$.sortIndex-A.sortIndex;return R!==0?R:$.id-A.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();e.unstable_now=function(){return o.now()-l}}var c=[],d=[],h=1,m=null,g=3,_=!1,y=!1,u=!1,w=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v($){for(var A=n(d);A!==null;){if(A.callback===null)r(d);else if(A.startTime<=$)r(d),A.sortIndex=A.expirationTime,t(c,A);else break;A=n(d)}}function C($){if(u=!1,v($),!y)if(n(c)!==null)y=!0,T(N);else{var A=n(d);A!==null&&E(C,A.startTime-$)}}function N($,A){y=!1,u&&(u=!1,p(M),M=-1),_=!0;var R=g;try{for(v(A),m=n(c);m!==null&&(!(m.expirationTime>A)||$&&!P());){var H=m.callback;if(typeof H=="function"){m.callback=null,g=m.priorityLevel;var F=H(m.expirationTime<=A);A=e.unstable_now(),typeof F=="function"?m.callback=F:m===n(c)&&r(c),v(A)}else r(c);m=n(c)}if(m!==null)var V=!0;else{var Q=n(d);Q!==null&&E(C,Q.startTime-A),V=!1}return V}finally{m=null,g=R,_=!1}}var b=!1,B=null,M=-1,L=5,S=-1;function P(){return!(e.unstable_now()-S<L)}function I(){if(B!==null){var $=e.unstable_now();S=$;var A=!0;try{A=B(!0,$)}finally{A?D():(b=!1,B=null)}}else b=!1}var D;if(typeof x=="function")D=function(){x(I)};else if(typeof MessageChannel<"u"){var k=new MessageChannel,j=k.port2;k.port1.onmessage=I,D=function(){j.postMessage(null)}}else D=function(){w(I,0)};function T($){B=$,b||(b=!0,D())}function E($,A){M=w(function(){$(e.unstable_now())},A)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function($){$.callback=null},e.unstable_continueExecution=function(){y||_||(y=!0,T(N))},e.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<$?Math.floor(1e3/$):5},e.unstable_getCurrentPriorityLevel=function(){return g},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function($){switch(g){case 1:case 2:case 3:var A=3;break;default:A=g}var R=g;g=A;try{return $()}finally{g=R}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function($,A){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var R=g;g=$;try{return A()}finally{g=R}},e.unstable_scheduleCallback=function($,A,R){var H=e.unstable_now();switch(typeof R=="object"&&R!==null?(R=R.delay,R=typeof R=="number"&&0<R?H+R:H):R=H,$){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=R+F,$={id:h++,callback:A,priorityLevel:$,startTime:R,expirationTime:F,sortIndex:-1},R>H?($.sortIndex=R,t(d,$),n(c)===null&&$===n(d)&&(u?(p(M),M=-1):u=!0,E(C,R-H))):($.sortIndex=F,t(c,$),y||_||(y=!0,T(N))),$},e.unstable_shouldYield=P,e.unstable_wrapCallback=function($){var A=g;return function(){var R=g;g=A;try{return $.apply(this,arguments)}finally{g=R}}}})(gm);pm.exports=gm;var U_=pm.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G_=f,un=U_;function J(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var _m=new Set,Ja={};function kr(e,t){oa(e,t),oa(e+"Capture",t)}function oa(e,t){for(Ja[e]=t,e=0;e<t.length;e++)_m.add(t[e])}var us=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),_c=Object.prototype.hasOwnProperty,Y_=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qu={},Wu={};function Q_(e){return _c.call(Wu,e)?!0:_c.call(qu,e)?!1:Y_.test(e)?Wu[e]=!0:(qu[e]=!0,!1)}function X_(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function K_(e,t,n,r){if(t===null||typeof t>"u"||X_(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Xt(e,t,n,r,a,i,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var Mt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Mt[e]=new Xt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Mt[t]=new Xt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Mt[e]=new Xt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Mt[e]=new Xt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Mt[e]=new Xt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Mt[e]=new Xt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Mt[e]=new Xt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Mt[e]=new Xt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Mt[e]=new Xt(e,5,!1,e.toLowerCase(),null,!1,!1)});var Ed=/[\-:]([a-z])/g;function Td(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Ed,Td);Mt[t]=new Xt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Ed,Td);Mt[t]=new Xt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Ed,Td);Mt[t]=new Xt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Mt[e]=new Xt(e,1,!1,e.toLowerCase(),null,!1,!1)});Mt.xlinkHref=new Xt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Mt[e]=new Xt(e,1,!1,e.toLowerCase(),null,!0,!0)});function Md(e,t,n,r){var a=Mt.hasOwnProperty(t)?Mt[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(K_(t,n,a,r)&&(n=null),r||a===null?Q_(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=n===null?a.type===3?!1:"":n:(t=a.attributeName,r=a.attributeNamespace,n===null?e.removeAttribute(t):(a=a.type,n=a===3||a===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var gs=G_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Li=Symbol.for("react.element"),Pr=Symbol.for("react.portal"),Lr=Symbol.for("react.fragment"),Id=Symbol.for("react.strict_mode"),yc=Symbol.for("react.profiler"),ym=Symbol.for("react.provider"),vm=Symbol.for("react.context"),Pd=Symbol.for("react.forward_ref"),vc=Symbol.for("react.suspense"),xc=Symbol.for("react.suspense_list"),Ld=Symbol.for("react.memo"),Ss=Symbol.for("react.lazy"),xm=Symbol.for("react.offscreen"),Vu=Symbol.iterator;function ja(e){return e===null||typeof e!="object"?null:(e=Vu&&e[Vu]||e["@@iterator"],typeof e=="function"?e:null)}var st=Object.assign,Ml;function Fa(e){if(Ml===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Ml=t&&t[1]||""}return`
`+Ml+e}var Il=!1;function Pl(e,t){if(!e||Il)return"";Il=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var r=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){r=d}e.call(t.prototype)}else{try{throw Error()}catch(d){r=d}e()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var a=d.stack.split(`
`),i=r.stack.split(`
`),o=a.length-1,l=i.length-1;1<=o&&0<=l&&a[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(a[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||a[o]!==i[l]){var c=`
`+a[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=o&&0<=l);break}}}finally{Il=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Fa(e):""}function Z_(e){switch(e.tag){case 5:return Fa(e.type);case 16:return Fa("Lazy");case 13:return Fa("Suspense");case 19:return Fa("SuspenseList");case 0:case 2:case 15:return e=Pl(e.type,!1),e;case 11:return e=Pl(e.type.render,!1),e;case 1:return e=Pl(e.type,!0),e;default:return""}}function wc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Lr:return"Fragment";case Pr:return"Portal";case yc:return"Profiler";case Id:return"StrictMode";case vc:return"Suspense";case xc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case vm:return(e.displayName||"Context")+".Consumer";case ym:return(e._context.displayName||"Context")+".Provider";case Pd:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ld:return t=e.displayName||null,t!==null?t:wc(e.type)||"Memo";case Ss:t=e._payload,e=e._init;try{return wc(e(t))}catch{}}return null}function J_(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return wc(t);case 8:return t===Id?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Gs(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function wm(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function e1(e){var t=wm(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ai(e){e._valueTracker||(e._valueTracker=e1(e))}function jm(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=wm(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function vo(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function jc(e,t){var n=t.checked;return st({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Uu(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=Gs(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Sm(e,t){t=t.checked,t!=null&&Md(e,"checked",t,!1)}function Sc(e,t){Sm(e,t);var n=Gs(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Cc(e,t.type,n):t.hasOwnProperty("defaultValue")&&Cc(e,t.type,Gs(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Gu(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Cc(e,t,n){(t!=="number"||vo(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var za=Array.isArray;function Gr(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Gs(n),t=null,a=0;a<e.length;a++){if(e[a].value===n){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function kc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(J(91));return st({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Yu(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(J(92));if(za(n)){if(1<n.length)throw Error(J(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Gs(n)}}function Cm(e,t){var n=Gs(t.value),r=Gs(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function Qu(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function km(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function bc(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?km(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Bi,bm=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Bi=Bi||document.createElement("div"),Bi.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Bi.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ei(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Wa={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},t1=["Webkit","ms","Moz","O"];Object.keys(Wa).forEach(function(e){t1.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Wa[t]=Wa[e]})});function Nm(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Wa.hasOwnProperty(e)&&Wa[e]?(""+t).trim():t+"px"}function Dm(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,a=Nm(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}var n1=st({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Nc(e,t){if(t){if(n1[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(J(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(J(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(J(61))}if(t.style!=null&&typeof t.style!="object")throw Error(J(62))}}function Dc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var $c=null;function Ad(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ec=null,Yr=null,Qr=null;function Xu(e){if(e=Ci(e)){if(typeof Ec!="function")throw Error(J(280));var t=e.stateNode;t&&(t=il(t),Ec(e.stateNode,e.type,t))}}function $m(e){Yr?Qr?Qr.push(e):Qr=[e]:Yr=e}function Em(){if(Yr){var e=Yr,t=Qr;if(Qr=Yr=null,Xu(e),t)for(e=0;e<t.length;e++)Xu(t[e])}}function Tm(e,t){return e(t)}function Mm(){}var Ll=!1;function Im(e,t,n){if(Ll)return e(t,n);Ll=!0;try{return Tm(e,t,n)}finally{Ll=!1,(Yr!==null||Qr!==null)&&(Mm(),Em())}}function ti(e,t){var n=e.stateNode;if(n===null)return null;var r=il(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(J(231,t,typeof n));return n}var Tc=!1;if(us)try{var Sa={};Object.defineProperty(Sa,"passive",{get:function(){Tc=!0}}),window.addEventListener("test",Sa,Sa),window.removeEventListener("test",Sa,Sa)}catch{Tc=!1}function s1(e,t,n,r,a,i,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(n,d)}catch(h){this.onError(h)}}var Va=!1,xo=null,wo=!1,Mc=null,r1={onError:function(e){Va=!0,xo=e}};function a1(e,t,n,r,a,i,o,l,c){Va=!1,xo=null,s1.apply(r1,arguments)}function i1(e,t,n,r,a,i,o,l,c){if(a1.apply(this,arguments),Va){if(Va){var d=xo;Va=!1,xo=null}else throw Error(J(198));wo||(wo=!0,Mc=d)}}function br(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Pm(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Ku(e){if(br(e)!==e)throw Error(J(188))}function o1(e){var t=e.alternate;if(!t){if(t=br(e),t===null)throw Error(J(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(a===null)break;var i=a.alternate;if(i===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return Ku(a),e;if(i===r)return Ku(a),t;i=i.sibling}throw Error(J(188))}if(n.return!==r.return)n=a,r=i;else{for(var o=!1,l=a.child;l;){if(l===n){o=!0,n=a,r=i;break}if(l===r){o=!0,r=a,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=a;break}if(l===r){o=!0,r=i,n=a;break}l=l.sibling}if(!o)throw Error(J(189))}}if(n.alternate!==r)throw Error(J(190))}if(n.tag!==3)throw Error(J(188));return n.stateNode.current===n?e:t}function Lm(e){return e=o1(e),e!==null?Am(e):null}function Am(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Am(e);if(t!==null)return t;e=e.sibling}return null}var Bm=un.unstable_scheduleCallback,Zu=un.unstable_cancelCallback,l1=un.unstable_shouldYield,c1=un.unstable_requestPaint,ut=un.unstable_now,d1=un.unstable_getCurrentPriorityLevel,Bd=un.unstable_ImmediatePriority,Rm=un.unstable_UserBlockingPriority,jo=un.unstable_NormalPriority,u1=un.unstable_LowPriority,Om=un.unstable_IdlePriority,nl=null,Jn=null;function f1(e){if(Jn&&typeof Jn.onCommitFiberRoot=="function")try{Jn.onCommitFiberRoot(nl,e,void 0,(e.current.flags&128)===128)}catch{}}var On=Math.clz32?Math.clz32:p1,h1=Math.log,m1=Math.LN2;function p1(e){return e>>>=0,e===0?32:31-(h1(e)/m1|0)|0}var Ri=64,Oi=4194304;function Ha(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function So(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,o=n&268435455;if(o!==0){var l=o&~a;l!==0?r=Ha(l):(i&=o,i!==0&&(r=Ha(i)))}else o=n&~a,o!==0?r=Ha(o):i!==0&&(r=Ha(i));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,i=t&-t,a>=i||a===16&&(i&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-On(t),a=1<<n,r|=e[n],t&=~a;return r}function g1(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _1(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-On(i),l=1<<o,c=a[o];c===-1?(!(l&n)||l&r)&&(a[o]=g1(l,t)):c<=t&&(e.expiredLanes|=l),i&=~l}}function Ic(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Fm(){var e=Ri;return Ri<<=1,!(Ri&4194240)&&(Ri=64),e}function Al(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ji(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-On(t),e[t]=n}function y1(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-On(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}function Rd(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-On(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var Re=0;function zm(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Hm,Od,qm,Wm,Vm,Pc=!1,Fi=[],Bs=null,Rs=null,Os=null,ni=new Map,si=new Map,bs=[],v1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ju(e,t){switch(e){case"focusin":case"focusout":Bs=null;break;case"dragenter":case"dragleave":Rs=null;break;case"mouseover":case"mouseout":Os=null;break;case"pointerover":case"pointerout":ni.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":si.delete(t.pointerId)}}function Ca(e,t,n,r,a,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},t!==null&&(t=Ci(t),t!==null&&Od(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function x1(e,t,n,r,a){switch(t){case"focusin":return Bs=Ca(Bs,e,t,n,r,a),!0;case"dragenter":return Rs=Ca(Rs,e,t,n,r,a),!0;case"mouseover":return Os=Ca(Os,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return ni.set(i,Ca(ni.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,si.set(i,Ca(si.get(i)||null,e,t,n,r,a)),!0}return!1}function Um(e){var t=cr(e.target);if(t!==null){var n=br(t);if(n!==null){if(t=n.tag,t===13){if(t=Pm(n),t!==null){e.blockedOn=t,Vm(e.priority,function(){qm(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function lo(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Lc(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);$c=r,n.target.dispatchEvent(r),$c=null}else return t=Ci(n),t!==null&&Od(t),e.blockedOn=n,!1;t.shift()}return!0}function ef(e,t,n){lo(e)&&n.delete(t)}function w1(){Pc=!1,Bs!==null&&lo(Bs)&&(Bs=null),Rs!==null&&lo(Rs)&&(Rs=null),Os!==null&&lo(Os)&&(Os=null),ni.forEach(ef),si.forEach(ef)}function ka(e,t){e.blockedOn===t&&(e.blockedOn=null,Pc||(Pc=!0,un.unstable_scheduleCallback(un.unstable_NormalPriority,w1)))}function ri(e){function t(a){return ka(a,e)}if(0<Fi.length){ka(Fi[0],e);for(var n=1;n<Fi.length;n++){var r=Fi[n];r.blockedOn===e&&(r.blockedOn=null)}}for(Bs!==null&&ka(Bs,e),Rs!==null&&ka(Rs,e),Os!==null&&ka(Os,e),ni.forEach(t),si.forEach(t),n=0;n<bs.length;n++)r=bs[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<bs.length&&(n=bs[0],n.blockedOn===null);)Um(n),n.blockedOn===null&&bs.shift()}var Xr=gs.ReactCurrentBatchConfig,Co=!0;function j1(e,t,n,r){var a=Re,i=Xr.transition;Xr.transition=null;try{Re=1,Fd(e,t,n,r)}finally{Re=a,Xr.transition=i}}function S1(e,t,n,r){var a=Re,i=Xr.transition;Xr.transition=null;try{Re=4,Fd(e,t,n,r)}finally{Re=a,Xr.transition=i}}function Fd(e,t,n,r){if(Co){var a=Lc(e,t,n,r);if(a===null)Ul(e,t,r,ko,n),Ju(e,r);else if(x1(a,e,t,n,r))r.stopPropagation();else if(Ju(e,r),t&4&&-1<v1.indexOf(e)){for(;a!==null;){var i=Ci(a);if(i!==null&&Hm(i),i=Lc(e,t,n,r),i===null&&Ul(e,t,r,ko,n),i===a)break;a=i}a!==null&&r.stopPropagation()}else Ul(e,t,r,null,n)}}var ko=null;function Lc(e,t,n,r){if(ko=null,e=Ad(r),e=cr(e),e!==null)if(t=br(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Pm(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return ko=e,null}function Gm(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(d1()){case Bd:return 1;case Rm:return 4;case jo:case u1:return 16;case Om:return 536870912;default:return 16}default:return 16}}var Ls=null,zd=null,co=null;function Ym(){if(co)return co;var e,t=zd,n=t.length,r,a="value"in Ls?Ls.value:Ls.textContent,i=a.length;for(e=0;e<n&&t[e]===a[e];e++);var o=n-e;for(r=1;r<=o&&t[n-r]===a[i-r];r++);return co=a.slice(e,1<r?1-r:void 0)}function uo(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function zi(){return!0}function tf(){return!1}function mn(e){function t(n,r,a,i,o){this._reactName=n,this._targetInst=a,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?zi:tf,this.isPropagationStopped=tf,this}return st(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=zi)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=zi)},persist:function(){},isPersistent:zi}),t}var ya={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hd=mn(ya),Si=st({},ya,{view:0,detail:0}),C1=mn(Si),Bl,Rl,ba,sl=st({},Si,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ba&&(ba&&e.type==="mousemove"?(Bl=e.screenX-ba.screenX,Rl=e.screenY-ba.screenY):Rl=Bl=0,ba=e),Bl)},movementY:function(e){return"movementY"in e?e.movementY:Rl}}),nf=mn(sl),k1=st({},sl,{dataTransfer:0}),b1=mn(k1),N1=st({},Si,{relatedTarget:0}),Ol=mn(N1),D1=st({},ya,{animationName:0,elapsedTime:0,pseudoElement:0}),$1=mn(D1),E1=st({},ya,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),T1=mn(E1),M1=st({},ya,{data:0}),sf=mn(M1),I1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},P1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},L1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function A1(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=L1[e])?!!t[e]:!1}function qd(){return A1}var B1=st({},Si,{key:function(e){if(e.key){var t=I1[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=uo(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?P1[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qd,charCode:function(e){return e.type==="keypress"?uo(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?uo(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),R1=mn(B1),O1=st({},sl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rf=mn(O1),F1=st({},Si,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qd}),z1=mn(F1),H1=st({},ya,{propertyName:0,elapsedTime:0,pseudoElement:0}),q1=mn(H1),W1=st({},sl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),V1=mn(W1),U1=[9,13,27,32],Wd=us&&"CompositionEvent"in window,Ua=null;us&&"documentMode"in document&&(Ua=document.documentMode);var G1=us&&"TextEvent"in window&&!Ua,Qm=us&&(!Wd||Ua&&8<Ua&&11>=Ua),af=" ",of=!1;function Xm(e,t){switch(e){case"keyup":return U1.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Km(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ar=!1;function Y1(e,t){switch(e){case"compositionend":return Km(t);case"keypress":return t.which!==32?null:(of=!0,af);case"textInput":return e=t.data,e===af&&of?null:e;default:return null}}function Q1(e,t){if(Ar)return e==="compositionend"||!Wd&&Xm(e,t)?(e=Ym(),co=zd=Ls=null,Ar=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Qm&&t.locale!=="ko"?null:t.data;default:return null}}var X1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function lf(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!X1[e.type]:t==="textarea"}function Zm(e,t,n,r){$m(r),t=bo(t,"onChange"),0<t.length&&(n=new Hd("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Ga=null,ai=null;function K1(e){cp(e,0)}function rl(e){var t=Or(e);if(jm(t))return e}function Z1(e,t){if(e==="change")return t}var Jm=!1;if(us){var Fl;if(us){var zl="oninput"in document;if(!zl){var cf=document.createElement("div");cf.setAttribute("oninput","return;"),zl=typeof cf.oninput=="function"}Fl=zl}else Fl=!1;Jm=Fl&&(!document.documentMode||9<document.documentMode)}function df(){Ga&&(Ga.detachEvent("onpropertychange",ep),ai=Ga=null)}function ep(e){if(e.propertyName==="value"&&rl(ai)){var t=[];Zm(t,ai,e,Ad(e)),Im(K1,t)}}function J1(e,t,n){e==="focusin"?(df(),Ga=t,ai=n,Ga.attachEvent("onpropertychange",ep)):e==="focusout"&&df()}function ey(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return rl(ai)}function ty(e,t){if(e==="click")return rl(t)}function ny(e,t){if(e==="input"||e==="change")return rl(t)}function sy(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var zn=typeof Object.is=="function"?Object.is:sy;function ii(e,t){if(zn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!_c.call(t,a)||!zn(e[a],t[a]))return!1}return!0}function uf(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ff(e,t){var n=uf(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=uf(n)}}function tp(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?tp(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function np(){for(var e=window,t=vo();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=vo(e.document)}return t}function Vd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function ry(e){var t=np(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&tp(n.ownerDocument.documentElement,n)){if(r!==null&&Vd(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=r.end===void 0?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=ff(n,i);var o=ff(n,r);a&&o&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var ay=us&&"documentMode"in document&&11>=document.documentMode,Br=null,Ac=null,Ya=null,Bc=!1;function hf(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Bc||Br==null||Br!==vo(r)||(r=Br,"selectionStart"in r&&Vd(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ya&&ii(Ya,r)||(Ya=r,r=bo(Ac,"onSelect"),0<r.length&&(t=new Hd("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=Br)))}function Hi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Rr={animationend:Hi("Animation","AnimationEnd"),animationiteration:Hi("Animation","AnimationIteration"),animationstart:Hi("Animation","AnimationStart"),transitionend:Hi("Transition","TransitionEnd")},Hl={},sp={};us&&(sp=document.createElement("div").style,"AnimationEvent"in window||(delete Rr.animationend.animation,delete Rr.animationiteration.animation,delete Rr.animationstart.animation),"TransitionEvent"in window||delete Rr.transitionend.transition);function al(e){if(Hl[e])return Hl[e];if(!Rr[e])return e;var t=Rr[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in sp)return Hl[e]=t[n];return e}var rp=al("animationend"),ap=al("animationiteration"),ip=al("animationstart"),op=al("transitionend"),lp=new Map,mf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xs(e,t){lp.set(e,t),kr(t,[e])}for(var ql=0;ql<mf.length;ql++){var Wl=mf[ql],iy=Wl.toLowerCase(),oy=Wl[0].toUpperCase()+Wl.slice(1);Xs(iy,"on"+oy)}Xs(rp,"onAnimationEnd");Xs(ap,"onAnimationIteration");Xs(ip,"onAnimationStart");Xs("dblclick","onDoubleClick");Xs("focusin","onFocus");Xs("focusout","onBlur");Xs(op,"onTransitionEnd");oa("onMouseEnter",["mouseout","mouseover"]);oa("onMouseLeave",["mouseout","mouseover"]);oa("onPointerEnter",["pointerout","pointerover"]);oa("onPointerLeave",["pointerout","pointerover"]);kr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));kr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));kr("onBeforeInput",["compositionend","keypress","textInput","paste"]);kr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));kr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));kr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var qa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ly=new Set("cancel close invalid load scroll toggle".split(" ").concat(qa));function pf(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,i1(r,t,void 0,e),e.currentTarget=null}function cp(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&a.isPropagationStopped())break e;pf(a,l,d),i=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&a.isPropagationStopped())break e;pf(a,l,d),i=c}}}if(wo)throw e=Mc,wo=!1,Mc=null,e}function Ue(e,t){var n=t[Hc];n===void 0&&(n=t[Hc]=new Set);var r=e+"__bubble";n.has(r)||(dp(t,e,2,!1),n.add(r))}function Vl(e,t,n){var r=0;t&&(r|=4),dp(n,e,r,t)}var qi="_reactListening"+Math.random().toString(36).slice(2);function oi(e){if(!e[qi]){e[qi]=!0,_m.forEach(function(n){n!=="selectionchange"&&(ly.has(n)||Vl(n,!1,e),Vl(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[qi]||(t[qi]=!0,Vl("selectionchange",!1,t))}}function dp(e,t,n,r){switch(Gm(t)){case 1:var a=j1;break;case 4:a=S1;break;default:a=Fd}n=a.bind(null,t,n,e),a=void 0,!Tc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):a!==void 0?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Ul(e,t,n,r,a){var i=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===a||l.nodeType===8&&l.parentNode===a)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;o=o.return}for(;l!==null;){if(o=cr(l),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}l=l.parentNode}}r=r.return}Im(function(){var d=i,h=Ad(n),m=[];e:{var g=lp.get(e);if(g!==void 0){var _=Hd,y=e;switch(e){case"keypress":if(uo(n)===0)break e;case"keydown":case"keyup":_=R1;break;case"focusin":y="focus",_=Ol;break;case"focusout":y="blur",_=Ol;break;case"beforeblur":case"afterblur":_=Ol;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_=nf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_=b1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_=z1;break;case rp:case ap:case ip:_=$1;break;case op:_=q1;break;case"scroll":_=C1;break;case"wheel":_=V1;break;case"copy":case"cut":case"paste":_=T1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_=rf}var u=(t&4)!==0,w=!u&&e==="scroll",p=u?g!==null?g+"Capture":null:g;u=[];for(var x=d,v;x!==null;){v=x;var C=v.stateNode;if(v.tag===5&&C!==null&&(v=C,p!==null&&(C=ti(x,p),C!=null&&u.push(li(x,C,v)))),w)break;x=x.return}0<u.length&&(g=new _(g,y,null,n,h),m.push({event:g,listeners:u}))}}if(!(t&7)){e:{if(g=e==="mouseover"||e==="pointerover",_=e==="mouseout"||e==="pointerout",g&&n!==$c&&(y=n.relatedTarget||n.fromElement)&&(cr(y)||y[fs]))break e;if((_||g)&&(g=h.window===h?h:(g=h.ownerDocument)?g.defaultView||g.parentWindow:window,_?(y=n.relatedTarget||n.toElement,_=d,y=y?cr(y):null,y!==null&&(w=br(y),y!==w||y.tag!==5&&y.tag!==6)&&(y=null)):(_=null,y=d),_!==y)){if(u=nf,C="onMouseLeave",p="onMouseEnter",x="mouse",(e==="pointerout"||e==="pointerover")&&(u=rf,C="onPointerLeave",p="onPointerEnter",x="pointer"),w=_==null?g:Or(_),v=y==null?g:Or(y),g=new u(C,x+"leave",_,n,h),g.target=w,g.relatedTarget=v,C=null,cr(h)===d&&(u=new u(p,x+"enter",y,n,h),u.target=v,u.relatedTarget=w,C=u),w=C,_&&y)t:{for(u=_,p=y,x=0,v=u;v;v=Dr(v))x++;for(v=0,C=p;C;C=Dr(C))v++;for(;0<x-v;)u=Dr(u),x--;for(;0<v-x;)p=Dr(p),v--;for(;x--;){if(u===p||p!==null&&u===p.alternate)break t;u=Dr(u),p=Dr(p)}u=null}else u=null;_!==null&&gf(m,g,_,u,!1),y!==null&&w!==null&&gf(m,w,y,u,!0)}}e:{if(g=d?Or(d):window,_=g.nodeName&&g.nodeName.toLowerCase(),_==="select"||_==="input"&&g.type==="file")var N=Z1;else if(lf(g))if(Jm)N=ny;else{N=ey;var b=J1}else(_=g.nodeName)&&_.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(N=ty);if(N&&(N=N(e,d))){Zm(m,N,n,h);break e}b&&b(e,g,d),e==="focusout"&&(b=g._wrapperState)&&b.controlled&&g.type==="number"&&Cc(g,"number",g.value)}switch(b=d?Or(d):window,e){case"focusin":(lf(b)||b.contentEditable==="true")&&(Br=b,Ac=d,Ya=null);break;case"focusout":Ya=Ac=Br=null;break;case"mousedown":Bc=!0;break;case"contextmenu":case"mouseup":case"dragend":Bc=!1,hf(m,n,h);break;case"selectionchange":if(ay)break;case"keydown":case"keyup":hf(m,n,h)}var B;if(Wd)e:{switch(e){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else Ar?Xm(e,n)&&(M="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(M="onCompositionStart");M&&(Qm&&n.locale!=="ko"&&(Ar||M!=="onCompositionStart"?M==="onCompositionEnd"&&Ar&&(B=Ym()):(Ls=h,zd="value"in Ls?Ls.value:Ls.textContent,Ar=!0)),b=bo(d,M),0<b.length&&(M=new sf(M,e,null,n,h),m.push({event:M,listeners:b}),B?M.data=B:(B=Km(n),B!==null&&(M.data=B)))),(B=G1?Y1(e,n):Q1(e,n))&&(d=bo(d,"onBeforeInput"),0<d.length&&(h=new sf("onBeforeInput","beforeinput",null,n,h),m.push({event:h,listeners:d}),h.data=B))}cp(m,t)})}function li(e,t,n){return{instance:e,listener:t,currentTarget:n}}function bo(e,t){for(var n=t+"Capture",r=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=ti(e,n),i!=null&&r.unshift(li(e,i,a)),i=ti(e,t),i!=null&&r.push(li(e,i,a))),e=e.return}return r}function Dr(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function gf(e,t,n,r,a){for(var i=t._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,a?(c=ti(n,i),c!=null&&o.unshift(li(n,c,l))):a||(c=ti(n,i),c!=null&&o.push(li(n,c,l)))),n=n.return}o.length!==0&&e.push({event:t,listeners:o})}var cy=/\r\n?/g,dy=/\u0000|\uFFFD/g;function _f(e){return(typeof e=="string"?e:""+e).replace(cy,`
`).replace(dy,"")}function Wi(e,t,n){if(t=_f(t),_f(e)!==t&&n)throw Error(J(425))}function No(){}var Rc=null,Oc=null;function Fc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var zc=typeof setTimeout=="function"?setTimeout:void 0,uy=typeof clearTimeout=="function"?clearTimeout:void 0,yf=typeof Promise=="function"?Promise:void 0,fy=typeof queueMicrotask=="function"?queueMicrotask:typeof yf<"u"?function(e){return yf.resolve(null).then(e).catch(hy)}:zc;function hy(e){setTimeout(function(){throw e})}function Gl(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"){if(r===0){e.removeChild(a),ri(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=a}while(n);ri(t)}function Fs(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function vf(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var va=Math.random().toString(36).slice(2),Xn="__reactFiber$"+va,ci="__reactProps$"+va,fs="__reactContainer$"+va,Hc="__reactEvents$"+va,my="__reactListeners$"+va,py="__reactHandles$"+va;function cr(e){var t=e[Xn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fs]||n[Xn]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=vf(e);e!==null;){if(n=e[Xn])return n;e=vf(e)}return t}e=n,n=e.parentNode}return null}function Ci(e){return e=e[Xn]||e[fs],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Or(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(J(33))}function il(e){return e[ci]||null}var qc=[],Fr=-1;function Ks(e){return{current:e}}function Ye(e){0>Fr||(e.current=qc[Fr],qc[Fr]=null,Fr--)}function Ve(e,t){Fr++,qc[Fr]=e.current,e.current=t}var Ys={},Ft=Ks(Ys),en=Ks(!1),xr=Ys;function la(e,t){var n=e.type.contextTypes;if(!n)return Ys;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in n)a[i]=t[i];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function tn(e){return e=e.childContextTypes,e!=null}function Do(){Ye(en),Ye(Ft)}function xf(e,t,n){if(Ft.current!==Ys)throw Error(J(168));Ve(Ft,t),Ve(en,n)}function up(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(J(108,J_(e)||"Unknown",a));return st({},n,r)}function $o(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ys,xr=Ft.current,Ve(Ft,e),Ve(en,en.current),!0}function wf(e,t,n){var r=e.stateNode;if(!r)throw Error(J(169));n?(e=up(e,t,xr),r.__reactInternalMemoizedMergedChildContext=e,Ye(en),Ye(Ft),Ve(Ft,e)):Ye(en),Ve(en,n)}var as=null,ol=!1,Yl=!1;function fp(e){as===null?as=[e]:as.push(e)}function gy(e){ol=!0,fp(e)}function Zs(){if(!Yl&&as!==null){Yl=!0;var e=0,t=Re;try{var n=as;for(Re=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}as=null,ol=!1}catch(a){throw as!==null&&(as=as.slice(e+1)),Bm(Bd,Zs),a}finally{Re=t,Yl=!1}}return null}var zr=[],Hr=0,Eo=null,To=0,jn=[],Sn=0,wr=null,os=1,ls="";function ir(e,t){zr[Hr++]=To,zr[Hr++]=Eo,Eo=e,To=t}function hp(e,t,n){jn[Sn++]=os,jn[Sn++]=ls,jn[Sn++]=wr,wr=e;var r=os;e=ls;var a=32-On(r)-1;r&=~(1<<a),n+=1;var i=32-On(t)+a;if(30<i){var o=a-a%5;i=(r&(1<<o)-1).toString(32),r>>=o,a-=o,os=1<<32-On(t)+a|n<<a|r,ls=i+e}else os=1<<i|n<<a|r,ls=e}function Ud(e){e.return!==null&&(ir(e,1),hp(e,1,0))}function Gd(e){for(;e===Eo;)Eo=zr[--Hr],zr[Hr]=null,To=zr[--Hr],zr[Hr]=null;for(;e===wr;)wr=jn[--Sn],jn[Sn]=null,ls=jn[--Sn],jn[Sn]=null,os=jn[--Sn],jn[Sn]=null}var dn=null,cn=null,Xe=!1,Rn=null;function mp(e,t){var n=Cn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function jf(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,dn=e,cn=Fs(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,dn=e,cn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=wr!==null?{id:os,overflow:ls}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Cn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,dn=e,cn=null,!0):!1;default:return!1}}function Wc(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Vc(e){if(Xe){var t=cn;if(t){var n=t;if(!jf(e,t)){if(Wc(e))throw Error(J(418));t=Fs(n.nextSibling);var r=dn;t&&jf(e,t)?mp(r,n):(e.flags=e.flags&-4097|2,Xe=!1,dn=e)}}else{if(Wc(e))throw Error(J(418));e.flags=e.flags&-4097|2,Xe=!1,dn=e}}}function Sf(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;dn=e}function Vi(e){if(e!==dn)return!1;if(!Xe)return Sf(e),Xe=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Fc(e.type,e.memoizedProps)),t&&(t=cn)){if(Wc(e))throw pp(),Error(J(418));for(;t;)mp(e,t),t=Fs(t.nextSibling)}if(Sf(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(J(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){cn=Fs(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}cn=null}}else cn=dn?Fs(e.stateNode.nextSibling):null;return!0}function pp(){for(var e=cn;e;)e=Fs(e.nextSibling)}function ca(){cn=dn=null,Xe=!1}function Yd(e){Rn===null?Rn=[e]:Rn.push(e)}var _y=gs.ReactCurrentBatchConfig;function Na(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(J(309));var r=n.stateNode}if(!r)throw Error(J(147,e));var a=r,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(o){var l=a.refs;o===null?delete l[i]:l[i]=o},t._stringRef=i,t)}if(typeof e!="string")throw Error(J(284));if(!n._owner)throw Error(J(290,e))}return e}function Ui(e,t){throw e=Object.prototype.toString.call(t),Error(J(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Cf(e){var t=e._init;return t(e._payload)}function gp(e){function t(p,x){if(e){var v=p.deletions;v===null?(p.deletions=[x],p.flags|=16):v.push(x)}}function n(p,x){if(!e)return null;for(;x!==null;)t(p,x),x=x.sibling;return null}function r(p,x){for(p=new Map;x!==null;)x.key!==null?p.set(x.key,x):p.set(x.index,x),x=x.sibling;return p}function a(p,x){return p=Ws(p,x),p.index=0,p.sibling=null,p}function i(p,x,v){return p.index=v,e?(v=p.alternate,v!==null?(v=v.index,v<x?(p.flags|=2,x):v):(p.flags|=2,x)):(p.flags|=1048576,x)}function o(p){return e&&p.alternate===null&&(p.flags|=2),p}function l(p,x,v,C){return x===null||x.tag!==6?(x=tc(v,p.mode,C),x.return=p,x):(x=a(x,v),x.return=p,x)}function c(p,x,v,C){var N=v.type;return N===Lr?h(p,x,v.props.children,C,v.key):x!==null&&(x.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===Ss&&Cf(N)===x.type)?(C=a(x,v.props),C.ref=Na(p,x,v),C.return=p,C):(C=yo(v.type,v.key,v.props,null,p.mode,C),C.ref=Na(p,x,v),C.return=p,C)}function d(p,x,v,C){return x===null||x.tag!==4||x.stateNode.containerInfo!==v.containerInfo||x.stateNode.implementation!==v.implementation?(x=nc(v,p.mode,C),x.return=p,x):(x=a(x,v.children||[]),x.return=p,x)}function h(p,x,v,C,N){return x===null||x.tag!==7?(x=vr(v,p.mode,C,N),x.return=p,x):(x=a(x,v),x.return=p,x)}function m(p,x,v){if(typeof x=="string"&&x!==""||typeof x=="number")return x=tc(""+x,p.mode,v),x.return=p,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Li:return v=yo(x.type,x.key,x.props,null,p.mode,v),v.ref=Na(p,null,x),v.return=p,v;case Pr:return x=nc(x,p.mode,v),x.return=p,x;case Ss:var C=x._init;return m(p,C(x._payload),v)}if(za(x)||ja(x))return x=vr(x,p.mode,v,null),x.return=p,x;Ui(p,x)}return null}function g(p,x,v,C){var N=x!==null?x.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return N!==null?null:l(p,x,""+v,C);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Li:return v.key===N?c(p,x,v,C):null;case Pr:return v.key===N?d(p,x,v,C):null;case Ss:return N=v._init,g(p,x,N(v._payload),C)}if(za(v)||ja(v))return N!==null?null:h(p,x,v,C,null);Ui(p,v)}return null}function _(p,x,v,C,N){if(typeof C=="string"&&C!==""||typeof C=="number")return p=p.get(v)||null,l(x,p,""+C,N);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Li:return p=p.get(C.key===null?v:C.key)||null,c(x,p,C,N);case Pr:return p=p.get(C.key===null?v:C.key)||null,d(x,p,C,N);case Ss:var b=C._init;return _(p,x,v,b(C._payload),N)}if(za(C)||ja(C))return p=p.get(v)||null,h(x,p,C,N,null);Ui(x,C)}return null}function y(p,x,v,C){for(var N=null,b=null,B=x,M=x=0,L=null;B!==null&&M<v.length;M++){B.index>M?(L=B,B=null):L=B.sibling;var S=g(p,B,v[M],C);if(S===null){B===null&&(B=L);break}e&&B&&S.alternate===null&&t(p,B),x=i(S,x,M),b===null?N=S:b.sibling=S,b=S,B=L}if(M===v.length)return n(p,B),Xe&&ir(p,M),N;if(B===null){for(;M<v.length;M++)B=m(p,v[M],C),B!==null&&(x=i(B,x,M),b===null?N=B:b.sibling=B,b=B);return Xe&&ir(p,M),N}for(B=r(p,B);M<v.length;M++)L=_(B,p,M,v[M],C),L!==null&&(e&&L.alternate!==null&&B.delete(L.key===null?M:L.key),x=i(L,x,M),b===null?N=L:b.sibling=L,b=L);return e&&B.forEach(function(P){return t(p,P)}),Xe&&ir(p,M),N}function u(p,x,v,C){var N=ja(v);if(typeof N!="function")throw Error(J(150));if(v=N.call(v),v==null)throw Error(J(151));for(var b=N=null,B=x,M=x=0,L=null,S=v.next();B!==null&&!S.done;M++,S=v.next()){B.index>M?(L=B,B=null):L=B.sibling;var P=g(p,B,S.value,C);if(P===null){B===null&&(B=L);break}e&&B&&P.alternate===null&&t(p,B),x=i(P,x,M),b===null?N=P:b.sibling=P,b=P,B=L}if(S.done)return n(p,B),Xe&&ir(p,M),N;if(B===null){for(;!S.done;M++,S=v.next())S=m(p,S.value,C),S!==null&&(x=i(S,x,M),b===null?N=S:b.sibling=S,b=S);return Xe&&ir(p,M),N}for(B=r(p,B);!S.done;M++,S=v.next())S=_(B,p,M,S.value,C),S!==null&&(e&&S.alternate!==null&&B.delete(S.key===null?M:S.key),x=i(S,x,M),b===null?N=S:b.sibling=S,b=S);return e&&B.forEach(function(I){return t(p,I)}),Xe&&ir(p,M),N}function w(p,x,v,C){if(typeof v=="object"&&v!==null&&v.type===Lr&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Li:e:{for(var N=v.key,b=x;b!==null;){if(b.key===N){if(N=v.type,N===Lr){if(b.tag===7){n(p,b.sibling),x=a(b,v.props.children),x.return=p,p=x;break e}}else if(b.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===Ss&&Cf(N)===b.type){n(p,b.sibling),x=a(b,v.props),x.ref=Na(p,b,v),x.return=p,p=x;break e}n(p,b);break}else t(p,b);b=b.sibling}v.type===Lr?(x=vr(v.props.children,p.mode,C,v.key),x.return=p,p=x):(C=yo(v.type,v.key,v.props,null,p.mode,C),C.ref=Na(p,x,v),C.return=p,p=C)}return o(p);case Pr:e:{for(b=v.key;x!==null;){if(x.key===b)if(x.tag===4&&x.stateNode.containerInfo===v.containerInfo&&x.stateNode.implementation===v.implementation){n(p,x.sibling),x=a(x,v.children||[]),x.return=p,p=x;break e}else{n(p,x);break}else t(p,x);x=x.sibling}x=nc(v,p.mode,C),x.return=p,p=x}return o(p);case Ss:return b=v._init,w(p,x,b(v._payload),C)}if(za(v))return y(p,x,v,C);if(ja(v))return u(p,x,v,C);Ui(p,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,x!==null&&x.tag===6?(n(p,x.sibling),x=a(x,v),x.return=p,p=x):(n(p,x),x=tc(v,p.mode,C),x.return=p,p=x),o(p)):n(p,x)}return w}var da=gp(!0),_p=gp(!1),Mo=Ks(null),Io=null,qr=null,Qd=null;function Xd(){Qd=qr=Io=null}function Kd(e){var t=Mo.current;Ye(Mo),e._currentValue=t}function Uc(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Kr(e,t){Io=e,Qd=qr=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Jt=!0),e.firstContext=null)}function Nn(e){var t=e._currentValue;if(Qd!==e)if(e={context:e,memoizedValue:t,next:null},qr===null){if(Io===null)throw Error(J(308));qr=e,Io.dependencies={lanes:0,firstContext:e}}else qr=qr.next=e;return t}var dr=null;function Zd(e){dr===null?dr=[e]:dr.push(e)}function yp(e,t,n,r){var a=t.interleaved;return a===null?(n.next=n,Zd(t)):(n.next=a.next,a.next=n),t.interleaved=n,hs(e,r)}function hs(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Cs=!1;function Jd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vp(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function cs(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function zs(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,De&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,hs(e,n)}return a=r.interleaved,a===null?(t.next=t,Zd(r)):(t.next=a.next,a.next=t),r.interleaved=t,hs(e,n)}function fo(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Rd(e,n)}}function kf(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var a=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?a=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?a=i=t:i=i.next=t}else a=i=t;n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Po(e,t,n,r){var a=e.updateQueue;Cs=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,l=a.shared.pending;if(l!==null){a.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?i=d:o.next=d,o=c;var h=e.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==o&&(l===null?h.firstBaseUpdate=d:l.next=d,h.lastBaseUpdate=c))}if(i!==null){var m=a.baseState;o=0,h=d=c=null,l=i;do{var g=l.lane,_=l.eventTime;if((r&g)===g){h!==null&&(h=h.next={eventTime:_,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var y=e,u=l;switch(g=t,_=n,u.tag){case 1:if(y=u.payload,typeof y=="function"){m=y.call(_,m,g);break e}m=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=u.payload,g=typeof y=="function"?y.call(_,m,g):y,g==null)break e;m=st({},m,g);break e;case 2:Cs=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,g=a.effects,g===null?a.effects=[l]:g.push(l))}else _={eventTime:_,lane:g,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(d=h=_,c=m):h=h.next=_,o|=g;if(l=l.next,l===null){if(l=a.shared.pending,l===null)break;g=l,l=g.next,g.next=null,a.lastBaseUpdate=g,a.shared.pending=null}}while(!0);if(h===null&&(c=m),a.baseState=c,a.firstBaseUpdate=d,a.lastBaseUpdate=h,t=a.shared.interleaved,t!==null){a=t;do o|=a.lane,a=a.next;while(a!==t)}else i===null&&(a.shared.lanes=0);Sr|=o,e.lanes=o,e.memoizedState=m}}function bf(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=n,typeof a!="function")throw Error(J(191,a));a.call(r)}}}var ki={},es=Ks(ki),di=Ks(ki),ui=Ks(ki);function ur(e){if(e===ki)throw Error(J(174));return e}function eu(e,t){switch(Ve(ui,t),Ve(di,e),Ve(es,ki),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:bc(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=bc(t,e)}Ye(es),Ve(es,t)}function ua(){Ye(es),Ye(di),Ye(ui)}function xp(e){ur(ui.current);var t=ur(es.current),n=bc(t,e.type);t!==n&&(Ve(di,e),Ve(es,n))}function tu(e){di.current===e&&(Ye(es),Ye(di))}var et=Ks(0);function Lo(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ql=[];function nu(){for(var e=0;e<Ql.length;e++)Ql[e]._workInProgressVersionPrimary=null;Ql.length=0}var ho=gs.ReactCurrentDispatcher,Xl=gs.ReactCurrentBatchConfig,jr=0,tt=null,vt=null,Ct=null,Ao=!1,Qa=!1,fi=0,yy=0;function Pt(){throw Error(J(321))}function su(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!zn(e[n],t[n]))return!1;return!0}function ru(e,t,n,r,a,i){if(jr=i,tt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ho.current=e===null||e.memoizedState===null?jy:Sy,e=n(r,a),Qa){i=0;do{if(Qa=!1,fi=0,25<=i)throw Error(J(301));i+=1,Ct=vt=null,t.updateQueue=null,ho.current=Cy,e=n(r,a)}while(Qa)}if(ho.current=Bo,t=vt!==null&&vt.next!==null,jr=0,Ct=vt=tt=null,Ao=!1,t)throw Error(J(300));return e}function au(){var e=fi!==0;return fi=0,e}function Vn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ct===null?tt.memoizedState=Ct=e:Ct=Ct.next=e,Ct}function Dn(){if(vt===null){var e=tt.alternate;e=e!==null?e.memoizedState:null}else e=vt.next;var t=Ct===null?tt.memoizedState:Ct.next;if(t!==null)Ct=t,vt=e;else{if(e===null)throw Error(J(310));vt=e,e={memoizedState:vt.memoizedState,baseState:vt.baseState,baseQueue:vt.baseQueue,queue:vt.queue,next:null},Ct===null?tt.memoizedState=Ct=e:Ct=Ct.next=e}return Ct}function hi(e,t){return typeof t=="function"?t(e):t}function Kl(e){var t=Dn(),n=t.queue;if(n===null)throw Error(J(311));n.lastRenderedReducer=e;var r=vt,a=r.baseQueue,i=n.pending;if(i!==null){if(a!==null){var o=a.next;a.next=i.next,i.next=o}r.baseQueue=a=i,n.pending=null}if(a!==null){i=a.next,r=r.baseState;var l=o=null,c=null,d=i;do{var h=d.lane;if((jr&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var m={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=m,o=r):c=c.next=m,tt.lanes|=h,Sr|=h}d=d.next}while(d!==null&&d!==i);c===null?o=r:c.next=l,zn(r,t.memoizedState)||(Jt=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(e=n.interleaved,e!==null){a=e;do i=a.lane,tt.lanes|=i,Sr|=i,a=a.next;while(a!==e)}else a===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Zl(e){var t=Dn(),n=t.queue;if(n===null)throw Error(J(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,i=t.memoizedState;if(a!==null){n.pending=null;var o=a=a.next;do i=e(i,o.action),o=o.next;while(o!==a);zn(i,t.memoizedState)||(Jt=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function wp(){}function jp(e,t){var n=tt,r=Dn(),a=t(),i=!zn(r.memoizedState,a);if(i&&(r.memoizedState=a,Jt=!0),r=r.queue,iu(kp.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||Ct!==null&&Ct.memoizedState.tag&1){if(n.flags|=2048,mi(9,Cp.bind(null,n,r,a,t),void 0,null),kt===null)throw Error(J(349));jr&30||Sp(n,t,a)}return a}function Sp(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=tt.updateQueue,t===null?(t={lastEffect:null,stores:null},tt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Cp(e,t,n,r){t.value=n,t.getSnapshot=r,bp(t)&&Np(e)}function kp(e,t,n){return n(function(){bp(t)&&Np(e)})}function bp(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!zn(e,n)}catch{return!0}}function Np(e){var t=hs(e,1);t!==null&&Fn(t,e,1,-1)}function Nf(e){var t=Vn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:hi,lastRenderedState:e},t.queue=e,e=e.dispatch=wy.bind(null,tt,e),[t.memoizedState,e]}function mi(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=tt.updateQueue,t===null?(t={lastEffect:null,stores:null},tt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function Dp(){return Dn().memoizedState}function mo(e,t,n,r){var a=Vn();tt.flags|=e,a.memoizedState=mi(1|t,n,void 0,r===void 0?null:r)}function ll(e,t,n,r){var a=Dn();r=r===void 0?null:r;var i=void 0;if(vt!==null){var o=vt.memoizedState;if(i=o.destroy,r!==null&&su(r,o.deps)){a.memoizedState=mi(t,n,i,r);return}}tt.flags|=e,a.memoizedState=mi(1|t,n,i,r)}function Df(e,t){return mo(8390656,8,e,t)}function iu(e,t){return ll(2048,8,e,t)}function $p(e,t){return ll(4,2,e,t)}function Ep(e,t){return ll(4,4,e,t)}function Tp(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Mp(e,t,n){return n=n!=null?n.concat([e]):null,ll(4,4,Tp.bind(null,t,e),n)}function ou(){}function Ip(e,t){var n=Dn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&su(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Pp(e,t){var n=Dn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&su(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Lp(e,t,n){return jr&21?(zn(n,t)||(n=Fm(),tt.lanes|=n,Sr|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Jt=!0),e.memoizedState=n)}function vy(e,t){var n=Re;Re=n!==0&&4>n?n:4,e(!0);var r=Xl.transition;Xl.transition={};try{e(!1),t()}finally{Re=n,Xl.transition=r}}function Ap(){return Dn().memoizedState}function xy(e,t,n){var r=qs(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Bp(e))Rp(t,n);else if(n=yp(e,t,n,r),n!==null){var a=Yt();Fn(n,e,r,a),Op(n,t,r)}}function wy(e,t,n){var r=qs(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Bp(e))Rp(t,a);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var o=t.lastRenderedState,l=i(o,n);if(a.hasEagerState=!0,a.eagerState=l,zn(l,o)){var c=t.interleaved;c===null?(a.next=a,Zd(t)):(a.next=c.next,c.next=a),t.interleaved=a;return}}catch{}finally{}n=yp(e,t,a,r),n!==null&&(a=Yt(),Fn(n,e,r,a),Op(n,t,r))}}function Bp(e){var t=e.alternate;return e===tt||t!==null&&t===tt}function Rp(e,t){Qa=Ao=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Op(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Rd(e,n)}}var Bo={readContext:Nn,useCallback:Pt,useContext:Pt,useEffect:Pt,useImperativeHandle:Pt,useInsertionEffect:Pt,useLayoutEffect:Pt,useMemo:Pt,useReducer:Pt,useRef:Pt,useState:Pt,useDebugValue:Pt,useDeferredValue:Pt,useTransition:Pt,useMutableSource:Pt,useSyncExternalStore:Pt,useId:Pt,unstable_isNewReconciler:!1},jy={readContext:Nn,useCallback:function(e,t){return Vn().memoizedState=[e,t===void 0?null:t],e},useContext:Nn,useEffect:Df,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,mo(4194308,4,Tp.bind(null,t,e),n)},useLayoutEffect:function(e,t){return mo(4194308,4,e,t)},useInsertionEffect:function(e,t){return mo(4,2,e,t)},useMemo:function(e,t){var n=Vn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Vn();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=xy.bind(null,tt,e),[r.memoizedState,e]},useRef:function(e){var t=Vn();return e={current:e},t.memoizedState=e},useState:Nf,useDebugValue:ou,useDeferredValue:function(e){return Vn().memoizedState=e},useTransition:function(){var e=Nf(!1),t=e[0];return e=vy.bind(null,e[1]),Vn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=tt,a=Vn();if(Xe){if(n===void 0)throw Error(J(407));n=n()}else{if(n=t(),kt===null)throw Error(J(349));jr&30||Sp(r,t,n)}a.memoizedState=n;var i={value:n,getSnapshot:t};return a.queue=i,Df(kp.bind(null,r,i,e),[e]),r.flags|=2048,mi(9,Cp.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=Vn(),t=kt.identifierPrefix;if(Xe){var n=ls,r=os;n=(r&~(1<<32-On(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=fi++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=yy++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Sy={readContext:Nn,useCallback:Ip,useContext:Nn,useEffect:iu,useImperativeHandle:Mp,useInsertionEffect:$p,useLayoutEffect:Ep,useMemo:Pp,useReducer:Kl,useRef:Dp,useState:function(){return Kl(hi)},useDebugValue:ou,useDeferredValue:function(e){var t=Dn();return Lp(t,vt.memoizedState,e)},useTransition:function(){var e=Kl(hi)[0],t=Dn().memoizedState;return[e,t]},useMutableSource:wp,useSyncExternalStore:jp,useId:Ap,unstable_isNewReconciler:!1},Cy={readContext:Nn,useCallback:Ip,useContext:Nn,useEffect:iu,useImperativeHandle:Mp,useInsertionEffect:$p,useLayoutEffect:Ep,useMemo:Pp,useReducer:Zl,useRef:Dp,useState:function(){return Zl(hi)},useDebugValue:ou,useDeferredValue:function(e){var t=Dn();return vt===null?t.memoizedState=e:Lp(t,vt.memoizedState,e)},useTransition:function(){var e=Zl(hi)[0],t=Dn().memoizedState;return[e,t]},useMutableSource:wp,useSyncExternalStore:jp,useId:Ap,unstable_isNewReconciler:!1};function In(e,t){if(e&&e.defaultProps){t=st({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Gc(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:st({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var cl={isMounted:function(e){return(e=e._reactInternals)?br(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Yt(),a=qs(e),i=cs(r,a);i.payload=t,n!=null&&(i.callback=n),t=zs(e,i,a),t!==null&&(Fn(t,e,a,r),fo(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Yt(),a=qs(e),i=cs(r,a);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=zs(e,i,a),t!==null&&(Fn(t,e,a,r),fo(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Yt(),r=qs(e),a=cs(n,r);a.tag=2,t!=null&&(a.callback=t),t=zs(e,a,r),t!==null&&(Fn(t,e,r,n),fo(t,e,r))}};function $f(e,t,n,r,a,i,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,i,o):t.prototype&&t.prototype.isPureReactComponent?!ii(n,r)||!ii(a,i):!0}function Fp(e,t,n){var r=!1,a=Ys,i=t.contextType;return typeof i=="object"&&i!==null?i=Nn(i):(a=tn(t)?xr:Ft.current,r=t.contextTypes,i=(r=r!=null)?la(e,a):Ys),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=cl,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function Ef(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&cl.enqueueReplaceState(t,t.state,null)}function Yc(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},Jd(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=Nn(i):(i=tn(t)?xr:Ft.current,a.context=la(e,i)),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Gc(e,t,i,n),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&cl.enqueueReplaceState(a,a.state,null),Po(e,n,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function fa(e,t){try{var n="",r=t;do n+=Z_(r),r=r.return;while(r);var a=n}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a,digest:null}}function Jl(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Qc(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ky=typeof WeakMap=="function"?WeakMap:Map;function zp(e,t,n){n=cs(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Oo||(Oo=!0,ad=r),Qc(e,t)},n}function Hp(e,t,n){n=cs(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){Qc(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Qc(e,t),typeof r!="function"&&(Hs===null?Hs=new Set([this]):Hs.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),n}function Tf(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new ky;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Oy.bind(null,e,t,n),t.then(e,e))}function Mf(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function If(e,t,n,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=cs(-1,1),t.tag=2,zs(n,t,1))),n.lanes|=1),e)}var by=gs.ReactCurrentOwner,Jt=!1;function Ut(e,t,n,r){t.child=e===null?_p(t,null,n,r):da(t,e.child,n,r)}function Pf(e,t,n,r,a){n=n.render;var i=t.ref;return Kr(t,a),r=ru(e,t,n,r,i,a),n=au(),e!==null&&!Jt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,ms(e,t,a)):(Xe&&n&&Ud(t),t.flags|=1,Ut(e,t,r,a),t.child)}function Lf(e,t,n,r,a){if(e===null){var i=n.type;return typeof i=="function"&&!pu(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,qp(e,t,i,r,a)):(e=yo(n.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&a)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:ii,n(o,r)&&e.ref===t.ref)return ms(e,t,a)}return t.flags|=1,e=Ws(i,r),e.ref=t.ref,e.return=t,t.child=e}function qp(e,t,n,r,a){if(e!==null){var i=e.memoizedProps;if(ii(i,r)&&e.ref===t.ref)if(Jt=!1,t.pendingProps=r=i,(e.lanes&a)!==0)e.flags&131072&&(Jt=!0);else return t.lanes=e.lanes,ms(e,t,a)}return Xc(e,t,n,r,a)}function Wp(e,t,n){var r=t.pendingProps,a=r.children,i=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ve(Vr,ln),ln|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ve(Vr,ln),ln|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Ve(Vr,ln),ln|=r}else i!==null?(r=i.baseLanes|n,t.memoizedState=null):r=n,Ve(Vr,ln),ln|=r;return Ut(e,t,a,n),t.child}function Vp(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Xc(e,t,n,r,a){var i=tn(n)?xr:Ft.current;return i=la(t,i),Kr(t,a),n=ru(e,t,n,r,i,a),r=au(),e!==null&&!Jt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,ms(e,t,a)):(Xe&&r&&Ud(t),t.flags|=1,Ut(e,t,n,a),t.child)}function Af(e,t,n,r,a){if(tn(n)){var i=!0;$o(t)}else i=!1;if(Kr(t,a),t.stateNode===null)po(e,t),Fp(t,n,r),Yc(t,n,r,a),r=!0;else if(e===null){var o=t.stateNode,l=t.memoizedProps;o.props=l;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=Nn(d):(d=tn(n)?xr:Ft.current,d=la(t,d));var h=n.getDerivedStateFromProps,m=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";m||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Ef(t,o,r,d),Cs=!1;var g=t.memoizedState;o.state=g,Po(t,r,o,a),c=t.memoizedState,l!==r||g!==c||en.current||Cs?(typeof h=="function"&&(Gc(t,n,h,r),c=t.memoizedState),(l=Cs||$f(t,n,l,r,g,c,d))?(m||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,vp(e,t),l=t.memoizedProps,d=t.type===t.elementType?l:In(t.type,l),o.props=d,m=t.pendingProps,g=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Nn(c):(c=tn(n)?xr:Ft.current,c=la(t,c));var _=n.getDerivedStateFromProps;(h=typeof _=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==m||g!==c)&&Ef(t,o,r,c),Cs=!1,g=t.memoizedState,o.state=g,Po(t,r,o,a);var y=t.memoizedState;l!==m||g!==y||en.current||Cs?(typeof _=="function"&&(Gc(t,n,_,r),y=t.memoizedState),(d=Cs||$f(t,n,d,r,g,y,c)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,y,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,y,c)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===e.memoizedProps&&g===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&g===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=y),o.props=r,o.state=y,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||l===e.memoizedProps&&g===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&g===e.memoizedState||(t.flags|=1024),r=!1)}return Kc(e,t,n,r,i,a)}function Kc(e,t,n,r,a,i){Vp(e,t);var o=(t.flags&128)!==0;if(!r&&!o)return a&&wf(t,n,!1),ms(e,t,i);r=t.stateNode,by.current=t;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&o?(t.child=da(t,e.child,null,i),t.child=da(t,null,l,i)):Ut(e,t,l,i),t.memoizedState=r.state,a&&wf(t,n,!0),t.child}function Up(e){var t=e.stateNode;t.pendingContext?xf(e,t.pendingContext,t.pendingContext!==t.context):t.context&&xf(e,t.context,!1),eu(e,t.containerInfo)}function Bf(e,t,n,r,a){return ca(),Yd(a),t.flags|=256,Ut(e,t,n,r),t.child}var Zc={dehydrated:null,treeContext:null,retryLane:0};function Jc(e){return{baseLanes:e,cachePool:null,transitions:null}}function Gp(e,t,n){var r=t.pendingProps,a=et.current,i=!1,o=(t.flags&128)!==0,l;if((l=o)||(l=e!==null&&e.memoizedState===null?!1:(a&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),Ve(et,a&1),e===null)return Vc(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=r.children,e=r.fallback,i?(r=t.mode,i=t.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=fl(o,r,0,null),e=vr(e,r,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=Jc(n),t.memoizedState=Zc,e):lu(t,o));if(a=e.memoizedState,a!==null&&(l=a.dehydrated,l!==null))return Ny(e,t,o,r,l,a,n);if(i){i=r.fallback,o=t.mode,a=e.child,l=a.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=c,t.deletions=null):(r=Ws(a,c),r.subtreeFlags=a.subtreeFlags&14680064),l!==null?i=Ws(l,i):(i=vr(i,o,n,null),i.flags|=2),i.return=t,r.return=t,r.sibling=i,t.child=r,r=i,i=t.child,o=e.child.memoizedState,o=o===null?Jc(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=e.childLanes&~n,t.memoizedState=Zc,r}return i=e.child,e=i.sibling,r=Ws(i,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function lu(e,t){return t=fl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Gi(e,t,n,r){return r!==null&&Yd(r),da(t,e.child,null,n),e=lu(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Ny(e,t,n,r,a,i,o){if(n)return t.flags&256?(t.flags&=-257,r=Jl(Error(J(422))),Gi(e,t,o,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=r.fallback,a=t.mode,r=fl({mode:"visible",children:r.children},a,0,null),i=vr(i,a,o,null),i.flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,t.mode&1&&da(t,e.child,null,o),t.child.memoizedState=Jc(o),t.memoizedState=Zc,i);if(!(t.mode&1))return Gi(e,t,o,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(J(419)),r=Jl(i,r,void 0),Gi(e,t,o,r)}if(l=(o&e.childLanes)!==0,Jt||l){if(r=kt,r!==null){switch(o&-o){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|o)?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,hs(e,a),Fn(r,e,a,-1))}return mu(),r=Jl(Error(J(421))),Gi(e,t,o,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=Fy.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,cn=Fs(a.nextSibling),dn=t,Xe=!0,Rn=null,e!==null&&(jn[Sn++]=os,jn[Sn++]=ls,jn[Sn++]=wr,os=e.id,ls=e.overflow,wr=t),t=lu(t,r.children),t.flags|=4096,t)}function Rf(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Uc(e.return,t,n)}function ec(e,t,n,r,a){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function Yp(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(Ut(e,t,r.children,n),r=et.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Rf(e,n,t);else if(e.tag===19)Rf(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ve(et,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;n!==null;)e=n.alternate,e!==null&&Lo(e)===null&&(a=n),n=n.sibling;n=a,n===null?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),ec(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&Lo(e)===null){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}ec(t,!0,n,null,i);break;case"together":ec(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function po(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function ms(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Sr|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(J(153));if(t.child!==null){for(e=t.child,n=Ws(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Ws(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Dy(e,t,n){switch(t.tag){case 3:Up(t),ca();break;case 5:xp(t);break;case 1:tn(t.type)&&$o(t);break;case 4:eu(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Ve(Mo,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(Ve(et,et.current&1),t.flags|=128,null):n&t.child.childLanes?Gp(e,t,n):(Ve(et,et.current&1),e=ms(e,t,n),e!==null?e.sibling:null);Ve(et,et.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return Yp(e,t,n);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ve(et,et.current),r)break;return null;case 22:case 23:return t.lanes=0,Wp(e,t,n)}return ms(e,t,n)}var Qp,ed,Xp,Kp;Qp=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ed=function(){};Xp=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,ur(es.current);var i=null;switch(n){case"input":a=jc(e,a),r=jc(e,r),i=[];break;case"select":a=st({},a,{value:void 0}),r=st({},r,{value:void 0}),i=[];break;case"textarea":a=kc(e,a),r=kc(e,r),i=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=No)}Nc(n,r);var o;n=null;for(d in a)if(!r.hasOwnProperty(d)&&a.hasOwnProperty(d)&&a[d]!=null)if(d==="style"){var l=a[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Ja.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=a!=null?a[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Ja.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Ue("scroll",e),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(t.updateQueue=d)&&(t.flags|=4)}};Kp=function(e,t,n,r){n!==r&&(t.flags|=4)};function Da(e,t){if(!Xe)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Lt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function $y(e,t,n){var r=t.pendingProps;switch(Gd(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Lt(t),null;case 1:return tn(t.type)&&Do(),Lt(t),null;case 3:return r=t.stateNode,ua(),Ye(en),Ye(Ft),nu(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Vi(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Rn!==null&&(ld(Rn),Rn=null))),ed(e,t),Lt(t),null;case 5:tu(t);var a=ur(ui.current);if(n=t.type,e!==null&&t.stateNode!=null)Xp(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(J(166));return Lt(t),null}if(e=ur(es.current),Vi(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[Xn]=t,r[ci]=i,e=(t.mode&1)!==0,n){case"dialog":Ue("cancel",r),Ue("close",r);break;case"iframe":case"object":case"embed":Ue("load",r);break;case"video":case"audio":for(a=0;a<qa.length;a++)Ue(qa[a],r);break;case"source":Ue("error",r);break;case"img":case"image":case"link":Ue("error",r),Ue("load",r);break;case"details":Ue("toggle",r);break;case"input":Uu(r,i),Ue("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Ue("invalid",r);break;case"textarea":Yu(r,i),Ue("invalid",r)}Nc(n,i),a=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&Wi(r.textContent,l,e),a=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&Wi(r.textContent,l,e),a=["children",""+l]):Ja.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&Ue("scroll",r)}switch(n){case"input":Ai(r),Gu(r,i,!0);break;case"textarea":Ai(r),Qu(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=No)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{o=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=km(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=o.createElement(n,{is:r.is}):(e=o.createElement(n),n==="select"&&(o=e,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):e=o.createElementNS(e,n),e[Xn]=t,e[ci]=r,Qp(e,t,!1,!1),t.stateNode=e;e:{switch(o=Dc(n,r),n){case"dialog":Ue("cancel",e),Ue("close",e),a=r;break;case"iframe":case"object":case"embed":Ue("load",e),a=r;break;case"video":case"audio":for(a=0;a<qa.length;a++)Ue(qa[a],e);a=r;break;case"source":Ue("error",e),a=r;break;case"img":case"image":case"link":Ue("error",e),Ue("load",e),a=r;break;case"details":Ue("toggle",e),a=r;break;case"input":Uu(e,r),a=jc(e,r),Ue("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=st({},r,{value:void 0}),Ue("invalid",e);break;case"textarea":Yu(e,r),a=kc(e,r),Ue("invalid",e);break;default:a=r}Nc(n,a),l=a;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?Dm(e,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&bm(e,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&ei(e,c):typeof c=="number"&&ei(e,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Ja.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Ue("scroll",e):c!=null&&Md(e,i,c,o))}switch(n){case"input":Ai(e),Gu(e,r,!1);break;case"textarea":Ai(e),Qu(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Gs(r.value));break;case"select":e.multiple=!!r.multiple,i=r.value,i!=null?Gr(e,!!r.multiple,i,!1):r.defaultValue!=null&&Gr(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=No)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Lt(t),null;case 6:if(e&&t.stateNode!=null)Kp(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(J(166));if(n=ur(ui.current),ur(es.current),Vi(t)){if(r=t.stateNode,n=t.memoizedProps,r[Xn]=t,(i=r.nodeValue!==n)&&(e=dn,e!==null))switch(e.tag){case 3:Wi(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Wi(r.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Xn]=t,t.stateNode=r}return Lt(t),null;case 13:if(Ye(et),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Xe&&cn!==null&&t.mode&1&&!(t.flags&128))pp(),ca(),t.flags|=98560,i=!1;else if(i=Vi(t),r!==null&&r.dehydrated!==null){if(e===null){if(!i)throw Error(J(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(J(317));i[Xn]=t}else ca(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Lt(t),i=!1}else Rn!==null&&(ld(Rn),Rn=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||et.current&1?xt===0&&(xt=3):mu())),t.updateQueue!==null&&(t.flags|=4),Lt(t),null);case 4:return ua(),ed(e,t),e===null&&oi(t.stateNode.containerInfo),Lt(t),null;case 10:return Kd(t.type._context),Lt(t),null;case 17:return tn(t.type)&&Do(),Lt(t),null;case 19:if(Ye(et),i=t.memoizedState,i===null)return Lt(t),null;if(r=(t.flags&128)!==0,o=i.rendering,o===null)if(r)Da(i,!1);else{if(xt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=Lo(e),o!==null){for(t.flags|=128,Da(i,!1),r=o.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)i=n,e=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,e=o.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ve(et,et.current&1|2),t.child}e=e.sibling}i.tail!==null&&ut()>ha&&(t.flags|=128,r=!0,Da(i,!1),t.lanes=4194304)}else{if(!r)if(e=Lo(o),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Da(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Xe)return Lt(t),null}else 2*ut()-i.renderingStartTime>ha&&n!==1073741824&&(t.flags|=128,r=!0,Da(i,!1),t.lanes=4194304);i.isBackwards?(o.sibling=t.child,t.child=o):(n=i.last,n!==null?n.sibling=o:t.child=o,i.last=o)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=ut(),t.sibling=null,n=et.current,Ve(et,r?n&1|2:n&1),t):(Lt(t),null);case 22:case 23:return hu(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?ln&1073741824&&(Lt(t),t.subtreeFlags&6&&(t.flags|=8192)):Lt(t),null;case 24:return null;case 25:return null}throw Error(J(156,t.tag))}function Ey(e,t){switch(Gd(t),t.tag){case 1:return tn(t.type)&&Do(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ua(),Ye(en),Ye(Ft),nu(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return tu(t),null;case 13:if(Ye(et),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(J(340));ca()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Ye(et),null;case 4:return ua(),null;case 10:return Kd(t.type._context),null;case 22:case 23:return hu(),null;case 24:return null;default:return null}}var Yi=!1,Ot=!1,Ty=typeof WeakSet=="function"?WeakSet:Set,re=null;function Wr(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ot(e,t,r)}else n.current=null}function td(e,t,n){try{n()}catch(r){ot(e,t,r)}}var Of=!1;function My(e,t){if(Rc=Co,e=np(),Vd(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,d=0,h=0,m=e,g=null;t:for(;;){for(var _;m!==n||a!==0&&m.nodeType!==3||(l=o+a),m!==i||r!==0&&m.nodeType!==3||(c=o+r),m.nodeType===3&&(o+=m.nodeValue.length),(_=m.firstChild)!==null;)g=m,m=_;for(;;){if(m===e)break t;if(g===n&&++d===a&&(l=o),g===i&&++h===r&&(c=o),(_=m.nextSibling)!==null)break;m=g,g=m.parentNode}m=_}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Oc={focusedElem:e,selectionRange:n},Co=!1,re=t;re!==null;)if(t=re,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,re=e;else for(;re!==null;){t=re;try{var y=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var u=y.memoizedProps,w=y.memoizedState,p=t.stateNode,x=p.getSnapshotBeforeUpdate(t.elementType===t.type?u:In(t.type,u),w);p.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var v=t.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(J(163))}}catch(C){ot(t,t.return,C)}if(e=t.sibling,e!==null){e.return=t.return,re=e;break}re=t.return}return y=Of,Of=!1,y}function Xa(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,i!==void 0&&td(t,n,i)}a=a.next}while(a!==r)}}function dl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function nd(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function Zp(e){var t=e.alternate;t!==null&&(e.alternate=null,Zp(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Xn],delete t[ci],delete t[Hc],delete t[my],delete t[py])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Jp(e){return e.tag===5||e.tag===3||e.tag===4}function Ff(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Jp(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function sd(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=No));else if(r!==4&&(e=e.child,e!==null))for(sd(e,t,n),e=e.sibling;e!==null;)sd(e,t,n),e=e.sibling}function rd(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(rd(e,t,n),e=e.sibling;e!==null;)rd(e,t,n),e=e.sibling}var Et=null,Bn=!1;function _s(e,t,n){for(n=n.child;n!==null;)eg(e,t,n),n=n.sibling}function eg(e,t,n){if(Jn&&typeof Jn.onCommitFiberUnmount=="function")try{Jn.onCommitFiberUnmount(nl,n)}catch{}switch(n.tag){case 5:Ot||Wr(n,t);case 6:var r=Et,a=Bn;Et=null,_s(e,t,n),Et=r,Bn=a,Et!==null&&(Bn?(e=Et,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Et.removeChild(n.stateNode));break;case 18:Et!==null&&(Bn?(e=Et,n=n.stateNode,e.nodeType===8?Gl(e.parentNode,n):e.nodeType===1&&Gl(e,n),ri(e)):Gl(Et,n.stateNode));break;case 4:r=Et,a=Bn,Et=n.stateNode.containerInfo,Bn=!0,_s(e,t,n),Et=r,Bn=a;break;case 0:case 11:case 14:case 15:if(!Ot&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var i=a,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&td(n,t,o),a=a.next}while(a!==r)}_s(e,t,n);break;case 1:if(!Ot&&(Wr(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){ot(n,t,l)}_s(e,t,n);break;case 21:_s(e,t,n);break;case 22:n.mode&1?(Ot=(r=Ot)||n.memoizedState!==null,_s(e,t,n),Ot=r):_s(e,t,n);break;default:_s(e,t,n)}}function zf(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new Ty),t.forEach(function(r){var a=zy.bind(null,e,r);n.has(r)||(n.add(r),r.then(a,a))})}}function En(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r];try{var i=e,o=t,l=o;e:for(;l!==null;){switch(l.tag){case 5:Et=l.stateNode,Bn=!1;break e;case 3:Et=l.stateNode.containerInfo,Bn=!0;break e;case 4:Et=l.stateNode.containerInfo,Bn=!0;break e}l=l.return}if(Et===null)throw Error(J(160));eg(i,o,a),Et=null,Bn=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(d){ot(a,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)tg(t,e),t=t.sibling}function tg(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(En(t,e),Hn(e),r&4){try{Xa(3,e,e.return),dl(3,e)}catch(u){ot(e,e.return,u)}try{Xa(5,e,e.return)}catch(u){ot(e,e.return,u)}}break;case 1:En(t,e),Hn(e),r&512&&n!==null&&Wr(n,n.return);break;case 5:if(En(t,e),Hn(e),r&512&&n!==null&&Wr(n,n.return),e.flags&32){var a=e.stateNode;try{ei(a,"")}catch(u){ot(e,e.return,u)}}if(r&4&&(a=e.stateNode,a!=null)){var i=e.memoizedProps,o=n!==null?n.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Sm(a,i),Dc(l,o);var d=Dc(l,i);for(o=0;o<c.length;o+=2){var h=c[o],m=c[o+1];h==="style"?Dm(a,m):h==="dangerouslySetInnerHTML"?bm(a,m):h==="children"?ei(a,m):Md(a,h,m,d)}switch(l){case"input":Sc(a,i);break;case"textarea":Cm(a,i);break;case"select":var g=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var _=i.value;_!=null?Gr(a,!!i.multiple,_,!1):g!==!!i.multiple&&(i.defaultValue!=null?Gr(a,!!i.multiple,i.defaultValue,!0):Gr(a,!!i.multiple,i.multiple?[]:"",!1))}a[ci]=i}catch(u){ot(e,e.return,u)}}break;case 6:if(En(t,e),Hn(e),r&4){if(e.stateNode===null)throw Error(J(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(u){ot(e,e.return,u)}}break;case 3:if(En(t,e),Hn(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ri(t.containerInfo)}catch(u){ot(e,e.return,u)}break;case 4:En(t,e),Hn(e);break;case 13:En(t,e),Hn(e),a=e.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||(uu=ut())),r&4&&zf(e);break;case 22:if(h=n!==null&&n.memoizedState!==null,e.mode&1?(Ot=(d=Ot)||h,En(t,e),Ot=d):En(t,e),Hn(e),r&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!h&&e.mode&1)for(re=e,h=e.child;h!==null;){for(m=re=h;re!==null;){switch(g=re,_=g.child,g.tag){case 0:case 11:case 14:case 15:Xa(4,g,g.return);break;case 1:Wr(g,g.return);var y=g.stateNode;if(typeof y.componentWillUnmount=="function"){r=g,n=g.return;try{t=r,y.props=t.memoizedProps,y.state=t.memoizedState,y.componentWillUnmount()}catch(u){ot(r,n,u)}}break;case 5:Wr(g,g.return);break;case 22:if(g.memoizedState!==null){qf(m);continue}}_!==null?(_.return=g,re=_):qf(m)}h=h.sibling}e:for(h=null,m=e;;){if(m.tag===5){if(h===null){h=m;try{a=m.stateNode,d?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=m.stateNode,c=m.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=Nm("display",o))}catch(u){ot(e,e.return,u)}}}else if(m.tag===6){if(h===null)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(u){ot(e,e.return,u)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===e)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===e)break e;for(;m.sibling===null;){if(m.return===null||m.return===e)break e;h===m&&(h=null),m=m.return}h===m&&(h=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:En(t,e),Hn(e),r&4&&zf(e);break;case 21:break;default:En(t,e),Hn(e)}}function Hn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(Jp(n)){var r=n;break e}n=n.return}throw Error(J(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(ei(a,""),r.flags&=-33);var i=Ff(e);rd(e,i,a);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Ff(e);sd(e,l,o);break;default:throw Error(J(161))}}catch(c){ot(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Iy(e,t,n){re=e,ng(e)}function ng(e,t,n){for(var r=(e.mode&1)!==0;re!==null;){var a=re,i=a.child;if(a.tag===22&&r){var o=a.memoizedState!==null||Yi;if(!o){var l=a.alternate,c=l!==null&&l.memoizedState!==null||Ot;l=Yi;var d=Ot;if(Yi=o,(Ot=c)&&!d)for(re=a;re!==null;)o=re,c=o.child,o.tag===22&&o.memoizedState!==null?Wf(a):c!==null?(c.return=o,re=c):Wf(a);for(;i!==null;)re=i,ng(i),i=i.sibling;re=a,Yi=l,Ot=d}Hf(e)}else a.subtreeFlags&8772&&i!==null?(i.return=a,re=i):Hf(e)}}function Hf(e){for(;re!==null;){var t=re;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ot||dl(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Ot)if(n===null)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:In(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&bf(t,i,r);break;case 3:var o=t.updateQueue;if(o!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}bf(t,o,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var m=h.dehydrated;m!==null&&ri(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(J(163))}Ot||t.flags&512&&nd(t)}catch(g){ot(t,t.return,g)}}if(t===e){re=null;break}if(n=t.sibling,n!==null){n.return=t.return,re=n;break}re=t.return}}function qf(e){for(;re!==null;){var t=re;if(t===e){re=null;break}var n=t.sibling;if(n!==null){n.return=t.return,re=n;break}re=t.return}}function Wf(e){for(;re!==null;){var t=re;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{dl(4,t)}catch(c){ot(t,n,c)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(c){ot(t,a,c)}}var i=t.return;try{nd(t)}catch(c){ot(t,i,c)}break;case 5:var o=t.return;try{nd(t)}catch(c){ot(t,o,c)}}}catch(c){ot(t,t.return,c)}if(t===e){re=null;break}var l=t.sibling;if(l!==null){l.return=t.return,re=l;break}re=t.return}}var Py=Math.ceil,Ro=gs.ReactCurrentDispatcher,cu=gs.ReactCurrentOwner,bn=gs.ReactCurrentBatchConfig,De=0,kt=null,pt=null,Tt=0,ln=0,Vr=Ks(0),xt=0,pi=null,Sr=0,ul=0,du=0,Ka=null,Zt=null,uu=0,ha=1/0,rs=null,Oo=!1,ad=null,Hs=null,Qi=!1,As=null,Fo=0,Za=0,id=null,go=-1,_o=0;function Yt(){return De&6?ut():go!==-1?go:go=ut()}function qs(e){return e.mode&1?De&2&&Tt!==0?Tt&-Tt:_y.transition!==null?(_o===0&&(_o=Fm()),_o):(e=Re,e!==0||(e=window.event,e=e===void 0?16:Gm(e.type)),e):1}function Fn(e,t,n,r){if(50<Za)throw Za=0,id=null,Error(J(185));ji(e,n,r),(!(De&2)||e!==kt)&&(e===kt&&(!(De&2)&&(ul|=n),xt===4&&Ns(e,Tt)),nn(e,r),n===1&&De===0&&!(t.mode&1)&&(ha=ut()+500,ol&&Zs()))}function nn(e,t){var n=e.callbackNode;_1(e,t);var r=So(e,e===kt?Tt:0);if(r===0)n!==null&&Zu(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&Zu(n),t===1)e.tag===0?gy(Vf.bind(null,e)):fp(Vf.bind(null,e)),fy(function(){!(De&6)&&Zs()}),n=null;else{switch(zm(r)){case 1:n=Bd;break;case 4:n=Rm;break;case 16:n=jo;break;case 536870912:n=Om;break;default:n=jo}n=dg(n,sg.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function sg(e,t){if(go=-1,_o=0,De&6)throw Error(J(327));var n=e.callbackNode;if(Zr()&&e.callbackNode!==n)return null;var r=So(e,e===kt?Tt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=zo(e,r);else{t=r;var a=De;De|=2;var i=ag();(kt!==e||Tt!==t)&&(rs=null,ha=ut()+500,yr(e,t));do try{By();break}catch(l){rg(e,l)}while(!0);Xd(),Ro.current=i,De=a,pt!==null?t=0:(kt=null,Tt=0,t=xt)}if(t!==0){if(t===2&&(a=Ic(e),a!==0&&(r=a,t=od(e,a))),t===1)throw n=pi,yr(e,0),Ns(e,r),nn(e,ut()),n;if(t===6)Ns(e,r);else{if(a=e.current.alternate,!(r&30)&&!Ly(a)&&(t=zo(e,r),t===2&&(i=Ic(e),i!==0&&(r=i,t=od(e,i))),t===1))throw n=pi,yr(e,0),Ns(e,r),nn(e,ut()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(J(345));case 2:or(e,Zt,rs);break;case 3:if(Ns(e,r),(r&130023424)===r&&(t=uu+500-ut(),10<t)){if(So(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){Yt(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=zc(or.bind(null,e,Zt,rs),t);break}or(e,Zt,rs);break;case 4:if(Ns(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var o=31-On(r);i=1<<o,o=t[o],o>a&&(a=o),r&=~i}if(r=a,r=ut()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Py(r/1960))-r,10<r){e.timeoutHandle=zc(or.bind(null,e,Zt,rs),r);break}or(e,Zt,rs);break;case 5:or(e,Zt,rs);break;default:throw Error(J(329))}}}return nn(e,ut()),e.callbackNode===n?sg.bind(null,e):null}function od(e,t){var n=Ka;return e.current.memoizedState.isDehydrated&&(yr(e,t).flags|=256),e=zo(e,t),e!==2&&(t=Zt,Zt=n,t!==null&&ld(t)),e}function ld(e){Zt===null?Zt=e:Zt.push.apply(Zt,e)}function Ly(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!zn(i(),a))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Ns(e,t){for(t&=~du,t&=~ul,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-On(t),r=1<<n;e[n]=-1,t&=~r}}function Vf(e){if(De&6)throw Error(J(327));Zr();var t=So(e,0);if(!(t&1))return nn(e,ut()),null;var n=zo(e,t);if(e.tag!==0&&n===2){var r=Ic(e);r!==0&&(t=r,n=od(e,r))}if(n===1)throw n=pi,yr(e,0),Ns(e,t),nn(e,ut()),n;if(n===6)throw Error(J(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,or(e,Zt,rs),nn(e,ut()),null}function fu(e,t){var n=De;De|=1;try{return e(t)}finally{De=n,De===0&&(ha=ut()+500,ol&&Zs())}}function Cr(e){As!==null&&As.tag===0&&!(De&6)&&Zr();var t=De;De|=1;var n=bn.transition,r=Re;try{if(bn.transition=null,Re=1,e)return e()}finally{Re=r,bn.transition=n,De=t,!(De&6)&&Zs()}}function hu(){ln=Vr.current,Ye(Vr)}function yr(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,uy(n)),pt!==null)for(n=pt.return;n!==null;){var r=n;switch(Gd(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Do();break;case 3:ua(),Ye(en),Ye(Ft),nu();break;case 5:tu(r);break;case 4:ua();break;case 13:Ye(et);break;case 19:Ye(et);break;case 10:Kd(r.type._context);break;case 22:case 23:hu()}n=n.return}if(kt=e,pt=e=Ws(e.current,null),Tt=ln=t,xt=0,pi=null,du=ul=Sr=0,Zt=Ka=null,dr!==null){for(t=0;t<dr.length;t++)if(n=dr[t],r=n.interleaved,r!==null){n.interleaved=null;var a=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=a,r.next=o}n.pending=r}dr=null}return e}function rg(e,t){do{var n=pt;try{if(Xd(),ho.current=Bo,Ao){for(var r=tt.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Ao=!1}if(jr=0,Ct=vt=tt=null,Qa=!1,fi=0,cu.current=null,n===null||n.return===null){xt=1,pi=t,pt=null;break}e:{var i=e,o=n.return,l=n,c=t;if(t=Tt,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=l,m=h.tag;if(!(h.mode&1)&&(m===0||m===11||m===15)){var g=h.alternate;g?(h.updateQueue=g.updateQueue,h.memoizedState=g.memoizedState,h.lanes=g.lanes):(h.updateQueue=null,h.memoizedState=null)}var _=Mf(o);if(_!==null){_.flags&=-257,If(_,o,l,i,t),_.mode&1&&Tf(i,d,t),t=_,c=d;var y=t.updateQueue;if(y===null){var u=new Set;u.add(c),t.updateQueue=u}else y.add(c);break e}else{if(!(t&1)){Tf(i,d,t),mu();break e}c=Error(J(426))}}else if(Xe&&l.mode&1){var w=Mf(o);if(w!==null){!(w.flags&65536)&&(w.flags|=256),If(w,o,l,i,t),Yd(fa(c,l));break e}}i=c=fa(c,l),xt!==4&&(xt=2),Ka===null?Ka=[i]:Ka.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var p=zp(i,c,t);kf(i,p);break e;case 1:l=c;var x=i.type,v=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Hs===null||!Hs.has(v)))){i.flags|=65536,t&=-t,i.lanes|=t;var C=Hp(i,l,t);kf(i,C);break e}}i=i.return}while(i!==null)}og(n)}catch(N){t=N,pt===n&&n!==null&&(pt=n=n.return);continue}break}while(!0)}function ag(){var e=Ro.current;return Ro.current=Bo,e===null?Bo:e}function mu(){(xt===0||xt===3||xt===2)&&(xt=4),kt===null||!(Sr&268435455)&&!(ul&268435455)||Ns(kt,Tt)}function zo(e,t){var n=De;De|=2;var r=ag();(kt!==e||Tt!==t)&&(rs=null,yr(e,t));do try{Ay();break}catch(a){rg(e,a)}while(!0);if(Xd(),De=n,Ro.current=r,pt!==null)throw Error(J(261));return kt=null,Tt=0,xt}function Ay(){for(;pt!==null;)ig(pt)}function By(){for(;pt!==null&&!l1();)ig(pt)}function ig(e){var t=cg(e.alternate,e,ln);e.memoizedProps=e.pendingProps,t===null?og(e):pt=t,cu.current=null}function og(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=Ey(n,t),n!==null){n.flags&=32767,pt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{xt=6,pt=null;return}}else if(n=$y(n,t,ln),n!==null){pt=n;return}if(t=t.sibling,t!==null){pt=t;return}pt=t=e}while(t!==null);xt===0&&(xt=5)}function or(e,t,n){var r=Re,a=bn.transition;try{bn.transition=null,Re=1,Ry(e,t,n,r)}finally{bn.transition=a,Re=r}return null}function Ry(e,t,n,r){do Zr();while(As!==null);if(De&6)throw Error(J(327));n=e.finishedWork;var a=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(J(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(y1(e,i),e===kt&&(pt=kt=null,Tt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Qi||(Qi=!0,dg(jo,function(){return Zr(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=bn.transition,bn.transition=null;var o=Re;Re=1;var l=De;De|=4,cu.current=null,My(e,n),tg(n,e),ry(Oc),Co=!!Rc,Oc=Rc=null,e.current=n,Iy(n),c1(),De=l,Re=o,bn.transition=i}else e.current=n;if(Qi&&(Qi=!1,As=e,Fo=a),i=e.pendingLanes,i===0&&(Hs=null),f1(n.stateNode),nn(e,ut()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Oo)throw Oo=!1,e=ad,ad=null,e;return Fo&1&&e.tag!==0&&Zr(),i=e.pendingLanes,i&1?e===id?Za++:(Za=0,id=e):Za=0,Zs(),null}function Zr(){if(As!==null){var e=zm(Fo),t=bn.transition,n=Re;try{if(bn.transition=null,Re=16>e?16:e,As===null)var r=!1;else{if(e=As,As=null,Fo=0,De&6)throw Error(J(331));var a=De;for(De|=4,re=e.current;re!==null;){var i=re,o=i.child;if(re.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(re=d;re!==null;){var h=re;switch(h.tag){case 0:case 11:case 15:Xa(8,h,i)}var m=h.child;if(m!==null)m.return=h,re=m;else for(;re!==null;){h=re;var g=h.sibling,_=h.return;if(Zp(h),h===d){re=null;break}if(g!==null){g.return=_,re=g;break}re=_}}}var y=i.alternate;if(y!==null){var u=y.child;if(u!==null){y.child=null;do{var w=u.sibling;u.sibling=null,u=w}while(u!==null)}}re=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,re=o;else e:for(;re!==null;){if(i=re,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Xa(9,i,i.return)}var p=i.sibling;if(p!==null){p.return=i.return,re=p;break e}re=i.return}}var x=e.current;for(re=x;re!==null;){o=re;var v=o.child;if(o.subtreeFlags&2064&&v!==null)v.return=o,re=v;else e:for(o=x;re!==null;){if(l=re,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:dl(9,l)}}catch(N){ot(l,l.return,N)}if(l===o){re=null;break e}var C=l.sibling;if(C!==null){C.return=l.return,re=C;break e}re=l.return}}if(De=a,Zs(),Jn&&typeof Jn.onPostCommitFiberRoot=="function")try{Jn.onPostCommitFiberRoot(nl,e)}catch{}r=!0}return r}finally{Re=n,bn.transition=t}}return!1}function Uf(e,t,n){t=fa(n,t),t=zp(e,t,1),e=zs(e,t,1),t=Yt(),e!==null&&(ji(e,1,t),nn(e,t))}function ot(e,t,n){if(e.tag===3)Uf(e,e,n);else for(;t!==null;){if(t.tag===3){Uf(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Hs===null||!Hs.has(r))){e=fa(n,e),e=Hp(t,e,1),t=zs(t,e,1),e=Yt(),t!==null&&(ji(t,1,e),nn(t,e));break}}t=t.return}}function Oy(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Yt(),e.pingedLanes|=e.suspendedLanes&n,kt===e&&(Tt&n)===n&&(xt===4||xt===3&&(Tt&130023424)===Tt&&500>ut()-uu?yr(e,0):du|=n),nn(e,t)}function lg(e,t){t===0&&(e.mode&1?(t=Oi,Oi<<=1,!(Oi&130023424)&&(Oi=4194304)):t=1);var n=Yt();e=hs(e,t),e!==null&&(ji(e,t,n),nn(e,n))}function Fy(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),lg(e,n)}function zy(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(J(314))}r!==null&&r.delete(t),lg(e,n)}var cg;cg=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||en.current)Jt=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Jt=!1,Dy(e,t,n);Jt=!!(e.flags&131072)}else Jt=!1,Xe&&t.flags&1048576&&hp(t,To,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;po(e,t),e=t.pendingProps;var a=la(t,Ft.current);Kr(t,n),a=ru(null,t,r,e,a,n);var i=au();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,tn(r)?(i=!0,$o(t)):i=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,Jd(t),a.updater=cl,t.stateNode=a,a._reactInternals=t,Yc(t,r,e,n),t=Kc(null,t,r,!0,i,n)):(t.tag=0,Xe&&i&&Ud(t),Ut(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(po(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=qy(r),e=In(r,e),a){case 0:t=Xc(null,t,r,e,n);break e;case 1:t=Af(null,t,r,e,n);break e;case 11:t=Pf(null,t,r,e,n);break e;case 14:t=Lf(null,t,r,In(r.type,e),n);break e}throw Error(J(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:In(r,a),Xc(e,t,r,a,n);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:In(r,a),Af(e,t,r,a,n);case 3:e:{if(Up(t),e===null)throw Error(J(387));r=t.pendingProps,i=t.memoizedState,a=i.element,vp(e,t),Po(t,r,null,n);var o=t.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){a=fa(Error(J(423)),t),t=Bf(e,t,r,n,a);break e}else if(r!==a){a=fa(Error(J(424)),t),t=Bf(e,t,r,n,a);break e}else for(cn=Fs(t.stateNode.containerInfo.firstChild),dn=t,Xe=!0,Rn=null,n=_p(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ca(),r===a){t=ms(e,t,n);break e}Ut(e,t,r,n)}t=t.child}return t;case 5:return xp(t),e===null&&Vc(t),r=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,o=a.children,Fc(r,a)?o=null:i!==null&&Fc(r,i)&&(t.flags|=32),Vp(e,t),Ut(e,t,o,n),t.child;case 6:return e===null&&Vc(t),null;case 13:return Gp(e,t,n);case 4:return eu(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=da(t,null,r,n):Ut(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:In(r,a),Pf(e,t,r,a,n);case 7:return Ut(e,t,t.pendingProps,n),t.child;case 8:return Ut(e,t,t.pendingProps.children,n),t.child;case 12:return Ut(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,i=t.memoizedProps,o=a.value,Ve(Mo,r._currentValue),r._currentValue=o,i!==null)if(zn(i.value,o)){if(i.children===a.children&&!en.current){t=ms(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=cs(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Uc(i.return,n,t),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===t.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(J(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),Uc(o,n,t),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===t){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Ut(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Kr(t,n),a=Nn(a),r=r(a),t.flags|=1,Ut(e,t,r,n),t.child;case 14:return r=t.type,a=In(r,t.pendingProps),a=In(r.type,a),Lf(e,t,r,a,n);case 15:return qp(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:In(r,a),po(e,t),t.tag=1,tn(r)?(e=!0,$o(t)):e=!1,Kr(t,n),Fp(t,r,a),Yc(t,r,a,n),Kc(null,t,r,!0,e,n);case 19:return Yp(e,t,n);case 22:return Wp(e,t,n)}throw Error(J(156,t.tag))};function dg(e,t){return Bm(e,t)}function Hy(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cn(e,t,n,r){return new Hy(e,t,n,r)}function pu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function qy(e){if(typeof e=="function")return pu(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Pd)return 11;if(e===Ld)return 14}return 2}function Ws(e,t){var n=e.alternate;return n===null?(n=Cn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function yo(e,t,n,r,a,i){var o=2;if(r=e,typeof e=="function")pu(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case Lr:return vr(n.children,a,i,t);case Id:o=8,a|=8;break;case yc:return e=Cn(12,n,t,a|2),e.elementType=yc,e.lanes=i,e;case vc:return e=Cn(13,n,t,a),e.elementType=vc,e.lanes=i,e;case xc:return e=Cn(19,n,t,a),e.elementType=xc,e.lanes=i,e;case xm:return fl(n,a,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case ym:o=10;break e;case vm:o=9;break e;case Pd:o=11;break e;case Ld:o=14;break e;case Ss:o=16,r=null;break e}throw Error(J(130,e==null?e:typeof e,""))}return t=Cn(o,n,t,a),t.elementType=e,t.type=r,t.lanes=i,t}function vr(e,t,n,r){return e=Cn(7,e,r,t),e.lanes=n,e}function fl(e,t,n,r){return e=Cn(22,e,r,t),e.elementType=xm,e.lanes=n,e.stateNode={isHidden:!1},e}function tc(e,t,n){return e=Cn(6,e,null,t),e.lanes=n,e}function nc(e,t,n){return t=Cn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Wy(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Al(0),this.expirationTimes=Al(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Al(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function gu(e,t,n,r,a,i,o,l,c){return e=new Wy(e,t,n,l,c),t===1?(t=1,i===!0&&(t|=8)):t=0,i=Cn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Jd(i),e}function Vy(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Pr,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function ug(e){if(!e)return Ys;e=e._reactInternals;e:{if(br(e)!==e||e.tag!==1)throw Error(J(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(tn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(J(171))}if(e.tag===1){var n=e.type;if(tn(n))return up(e,n,t)}return t}function fg(e,t,n,r,a,i,o,l,c){return e=gu(n,r,!0,e,a,i,o,l,c),e.context=ug(null),n=e.current,r=Yt(),a=qs(n),i=cs(r,a),i.callback=t??null,zs(n,i,a),e.current.lanes=a,ji(e,a,r),nn(e,r),e}function hl(e,t,n,r){var a=t.current,i=Yt(),o=qs(a);return n=ug(n),t.context===null?t.context=n:t.pendingContext=n,t=cs(i,o),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=zs(a,t,o),e!==null&&(Fn(e,a,o,i),fo(e,a,o)),o}function Ho(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Gf(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function _u(e,t){Gf(e,t),(e=e.alternate)&&Gf(e,t)}function Uy(){return null}var hg=typeof reportError=="function"?reportError:function(e){console.error(e)};function yu(e){this._internalRoot=e}ml.prototype.render=yu.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(J(409));hl(e,t,null,null)};ml.prototype.unmount=yu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Cr(function(){hl(null,e,null,null)}),t[fs]=null}};function ml(e){this._internalRoot=e}ml.prototype.unstable_scheduleHydration=function(e){if(e){var t=Wm();e={blockedOn:null,target:e,priority:t};for(var n=0;n<bs.length&&t!==0&&t<bs[n].priority;n++);bs.splice(n,0,e),n===0&&Um(e)}};function vu(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function pl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Yf(){}function Gy(e,t,n,r,a){if(a){if(typeof r=="function"){var i=r;r=function(){var d=Ho(o);i.call(d)}}var o=fg(t,r,e,0,null,!1,!1,"",Yf);return e._reactRootContainer=o,e[fs]=o.current,oi(e.nodeType===8?e.parentNode:e),Cr(),o}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var l=r;r=function(){var d=Ho(c);l.call(d)}}var c=gu(e,0,!1,null,null,!1,!1,"",Yf);return e._reactRootContainer=c,e[fs]=c.current,oi(e.nodeType===8?e.parentNode:e),Cr(function(){hl(t,c,n,r)}),c}function gl(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i;if(typeof a=="function"){var l=a;a=function(){var c=Ho(o);l.call(c)}}hl(t,o,e,a)}else o=Gy(n,t,e,a,r);return Ho(o)}Hm=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Ha(t.pendingLanes);n!==0&&(Rd(t,n|1),nn(t,ut()),!(De&6)&&(ha=ut()+500,Zs()))}break;case 13:Cr(function(){var r=hs(e,1);if(r!==null){var a=Yt();Fn(r,e,1,a)}}),_u(e,1)}};Od=function(e){if(e.tag===13){var t=hs(e,134217728);if(t!==null){var n=Yt();Fn(t,e,134217728,n)}_u(e,134217728)}};qm=function(e){if(e.tag===13){var t=qs(e),n=hs(e,t);if(n!==null){var r=Yt();Fn(n,e,t,r)}_u(e,t)}};Wm=function(){return Re};Vm=function(e,t){var n=Re;try{return Re=e,t()}finally{Re=n}};Ec=function(e,t,n){switch(t){case"input":if(Sc(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=il(r);if(!a)throw Error(J(90));jm(r),Sc(r,a)}}}break;case"textarea":Cm(e,n);break;case"select":t=n.value,t!=null&&Gr(e,!!n.multiple,t,!1)}};Tm=fu;Mm=Cr;var Yy={usingClientEntryPoint:!1,Events:[Ci,Or,il,$m,Em,fu]},$a={findFiberByHostInstance:cr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Qy={bundleType:$a.bundleType,version:$a.version,rendererPackageName:$a.rendererPackageName,rendererConfig:$a.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:gs.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Lm(e),e===null?null:e.stateNode},findFiberByHostInstance:$a.findFiberByHostInstance||Uy,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Xi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xi.isDisabled&&Xi.supportsFiber)try{nl=Xi.inject(Qy),Jn=Xi}catch{}}hn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Yy;hn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!vu(t))throw Error(J(200));return Vy(e,t,null,n)};hn.createRoot=function(e,t){if(!vu(e))throw Error(J(299));var n=!1,r="",a=hg;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=gu(e,1,!1,null,null,n,!1,r,a),e[fs]=t.current,oi(e.nodeType===8?e.parentNode:e),new yu(t)};hn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(J(188)):(e=Object.keys(e).join(","),Error(J(268,e)));return e=Lm(t),e=e===null?null:e.stateNode,e};hn.flushSync=function(e){return Cr(e)};hn.hydrate=function(e,t,n){if(!pl(t))throw Error(J(200));return gl(null,e,t,!0,n)};hn.hydrateRoot=function(e,t,n){if(!vu(e))throw Error(J(405));var r=n!=null&&n.hydratedSources||null,a=!1,i="",o=hg;if(n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),t=fg(t,null,e,1,n??null,a,!1,i,o),e[fs]=t.current,oi(e),r)for(e=0;e<r.length;e++)n=r[e],a=n._getVersion,a=a(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new ml(t)};hn.render=function(e,t,n){if(!pl(t))throw Error(J(200));return gl(null,e,t,!1,n)};hn.unmountComponentAtNode=function(e){if(!pl(e))throw Error(J(40));return e._reactRootContainer?(Cr(function(){gl(null,null,e,!1,function(){e._reactRootContainer=null,e[fs]=null})}),!0):!1};hn.unstable_batchedUpdates=fu;hn.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!pl(n))throw Error(J(200));if(e==null||e._reactInternals===void 0)throw Error(J(38));return gl(e,t,n,!1,r)};hn.version="18.3.1-next-f1338f8080-20240426";function mg(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(mg)}catch(e){console.error(e)}}mg(),mm.exports=hn;var xu=mm.exports,pg,Qf=xu;pg=Qf.createRoot,Qf.hydrateRoot;var _l=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Xy={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},$s,kd,Yh,Ky=(Yh=class{constructor(){Ce(this,$s,Xy);Ce(this,kd,!1)}setTimeoutProvider(e){me(this,$s,e)}setTimeout(e,t){return G(this,$s).setTimeout(e,t)}clearTimeout(e){G(this,$s).clearTimeout(e)}setInterval(e,t){return G(this,$s).setInterval(e,t)}clearInterval(e){G(this,$s).clearInterval(e)}},$s=new WeakMap,kd=new WeakMap,Yh),cd=new Ky;function Zy(e){setTimeout(e,0)}var yl=typeof window>"u"||"Deno"in globalThis;function Pn(){}function Jy(e,t){return typeof e=="function"?e(t):e}function ev(e){return typeof e=="number"&&e>=0&&e!==1/0}function tv(e,t){return Math.max(e+(t||0)-Date.now(),0)}function dd(e,t){return typeof e=="function"?e(t):e}function nv(e,t){return typeof e=="function"?e(t):e}function Xf(e,t){const{type:n="all",exact:r,fetchStatus:a,predicate:i,queryKey:o,stale:l}=e;if(o){if(r){if(t.queryHash!==wu(o,t.options))return!1}else if(!_i(t.queryKey,o))return!1}if(n!=="all"){const c=t.isActive();if(n==="active"&&!c||n==="inactive"&&c)return!1}return!(typeof l=="boolean"&&t.isStale()!==l||a&&a!==t.state.fetchStatus||i&&!i(t))}function Kf(e,t){const{exact:n,status:r,predicate:a,mutationKey:i}=e;if(i){if(!t.options.mutationKey)return!1;if(n){if(gi(t.options.mutationKey)!==gi(i))return!1}else if(!_i(t.options.mutationKey,i))return!1}return!(r&&t.state.status!==r||a&&!a(t))}function wu(e,t){return((t==null?void 0:t.queryKeyHashFn)||gi)(e)}function gi(e){return JSON.stringify(e,(t,n)=>ud(n)?Object.keys(n).sort().reduce((r,a)=>(r[a]=n[a],r),{}):n)}function _i(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(n=>_i(e[n],t[n])):!1}var sv=Object.prototype.hasOwnProperty;function gg(e,t){if(e===t)return e;const n=Zf(e)&&Zf(t);if(!n&&!(ud(e)&&ud(t)))return t;const a=(n?e:Object.keys(e)).length,i=n?t:Object.keys(t),o=i.length,l=n?new Array(o):{};let c=0;for(let d=0;d<o;d++){const h=n?d:i[d],m=e[h],g=t[h];if(m===g){l[h]=m,(n?d<a:sv.call(e,h))&&c++;continue}if(m===null||g===null||typeof m!="object"||typeof g!="object"){l[h]=g;continue}const _=gg(m,g);l[h]=_,_===m&&c++}return a===o&&c===a?e:l}function Zf(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function ud(e){if(!Jf(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!Jf(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function Jf(e){return Object.prototype.toString.call(e)==="[object Object]"}function rv(e){return new Promise(t=>{cd.setTimeout(t,e)})}function av(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?gg(e,t):t}function iv(e,t,n=0){const r=[...e,t];return n&&r.length>n?r.slice(1):r}function ov(e,t,n=0){const r=[t,...e];return n&&r.length>n?r.slice(0,-1):r}var ju=Symbol();function _g(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===ju?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var fr,Es,Jr,Qh,lv=(Qh=class extends _l{constructor(){super();Ce(this,fr);Ce(this,Es);Ce(this,Jr);me(this,Jr,t=>{if(!yl&&window.addEventListener){const n=()=>t();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){G(this,Es)||this.setEventListener(G(this,Jr))}onUnsubscribe(){var t;this.hasListeners()||((t=G(this,Es))==null||t.call(this),me(this,Es,void 0))}setEventListener(t){var n;me(this,Jr,t),(n=G(this,Es))==null||n.call(this),me(this,Es,t(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(t){G(this,fr)!==t&&(me(this,fr,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(n=>{n(t)})}isFocused(){var t;return typeof G(this,fr)=="boolean"?G(this,fr):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},fr=new WeakMap,Es=new WeakMap,Jr=new WeakMap,Qh),yg=new lv;function cv(){let e,t;const n=new Promise((a,i)=>{e=a,t=i});n.status="pending",n.catch(()=>{});function r(a){Object.assign(n,a),delete n.resolve,delete n.reject}return n.resolve=a=>{r({status:"fulfilled",value:a}),e(a)},n.reject=a=>{r({status:"rejected",reason:a}),t(a)},n}var dv=Zy;function uv(){let e=[],t=0,n=l=>{l()},r=l=>{l()},a=dv;const i=l=>{t?e.push(l):a(()=>{n(l)})},o=()=>{const l=e;e=[],l.length&&a(()=>{r(()=>{l.forEach(c=>{n(c)})})})};return{batch:l=>{let c;t++;try{c=l()}finally{t--,t||o()}return c},batchCalls:l=>(...c)=>{i(()=>{l(...c)})},schedule:i,setNotifyFunction:l=>{n=l},setBatchNotifyFunction:l=>{r=l},setScheduler:l=>{a=l}}}var Gt=uv(),ea,Ts,ta,Xh,fv=(Xh=class extends _l{constructor(){super();Ce(this,ea,!0);Ce(this,Ts);Ce(this,ta);me(this,ta,t=>{if(!yl&&window.addEventListener){const n=()=>t(!0),r=()=>t(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}}})}onSubscribe(){G(this,Ts)||this.setEventListener(G(this,ta))}onUnsubscribe(){var t;this.hasListeners()||((t=G(this,Ts))==null||t.call(this),me(this,Ts,void 0))}setEventListener(t){var n;me(this,ta,t),(n=G(this,Ts))==null||n.call(this),me(this,Ts,t(this.setOnline.bind(this)))}setOnline(t){G(this,ea)!==t&&(me(this,ea,t),this.listeners.forEach(r=>{r(t)}))}isOnline(){return G(this,ea)}},ea=new WeakMap,Ts=new WeakMap,ta=new WeakMap,Xh),qo=new fv;function hv(e){return Math.min(1e3*2**e,3e4)}function vg(e){return(e??"online")==="online"?qo.isOnline():!0}var fd=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function xg(e){let t=!1,n=0,r;const a=cv(),i=()=>a.status!=="pending",o=u=>{var w;if(!i()){const p=new fd(u);g(p),(w=e.onCancel)==null||w.call(e,p)}},l=()=>{t=!0},c=()=>{t=!1},d=()=>yg.isFocused()&&(e.networkMode==="always"||qo.isOnline())&&e.canRun(),h=()=>vg(e.networkMode)&&e.canRun(),m=u=>{i()||(r==null||r(),a.resolve(u))},g=u=>{i()||(r==null||r(),a.reject(u))},_=()=>new Promise(u=>{var w;r=p=>{(i()||d())&&u(p)},(w=e.onPause)==null||w.call(e)}).then(()=>{var u;r=void 0,i()||(u=e.onContinue)==null||u.call(e)}),y=()=>{if(i())return;let u;const w=n===0?e.initialPromise:void 0;try{u=w??e.fn()}catch(p){u=Promise.reject(p)}Promise.resolve(u).then(m).catch(p=>{var b;if(i())return;const x=e.retry??(yl?0:3),v=e.retryDelay??hv,C=typeof v=="function"?v(n,p):v,N=x===!0||typeof x=="number"&&n<x||typeof x=="function"&&x(n,p);if(t||!N){g(p);return}n++,(b=e.onFail)==null||b.call(e,n,p),rv(C).then(()=>d()?void 0:_()).then(()=>{t?g(p):y()})})};return{promise:a,status:()=>a.status,cancel:o,continue:()=>(r==null||r(),a),cancelRetry:l,continueRetry:c,canStart:h,start:()=>(h()?y():_().then(y),a)}}var hr,Kh,wg=(Kh=class{constructor(){Ce(this,hr)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ev(this.gcTime)&&me(this,hr,cd.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(yl?1/0:5*60*1e3))}clearGcTimeout(){G(this,hr)&&(cd.clearTimeout(G(this,hr)),me(this,hr,void 0))}},hr=new WeakMap,Kh),mr,na,wn,pr,jt,yi,gr,Ln,ss,Zh,mv=(Zh=class extends wg{constructor(t){super();Ce(this,Ln);Ce(this,mr);Ce(this,na);Ce(this,wn);Ce(this,pr);Ce(this,jt);Ce(this,yi);Ce(this,gr);me(this,gr,!1),me(this,yi,t.defaultOptions),this.setOptions(t.options),this.observers=[],me(this,pr,t.client),me(this,wn,G(this,pr).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,me(this,mr,th(this.options)),this.state=t.state??G(this,mr),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=G(this,jt))==null?void 0:t.promise}setOptions(t){if(this.options={...G(this,yi),...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=th(this.options);n.data!==void 0&&(this.setState(eh(n.data,n.dataUpdatedAt)),me(this,mr,n))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&G(this,wn).remove(this)}setData(t,n){const r=av(this.state.data,t,this.options);return It(this,Ln,ss).call(this,{data:r,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),r}setState(t,n){It(this,Ln,ss).call(this,{type:"setState",state:t,setStateOptions:n})}cancel(t){var r,a;const n=(r=G(this,jt))==null?void 0:r.promise;return(a=G(this,jt))==null||a.cancel(t),n?n.then(Pn).catch(Pn):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(G(this,mr))}isActive(){return this.observers.some(t=>nv(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===ju||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>dd(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!tv(this.state.dataUpdatedAt,t)}onFocus(){var n;const t=this.observers.find(r=>r.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(n=G(this,jt))==null||n.continue()}onOnline(){var n;const t=this.observers.find(r=>r.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(n=G(this,jt))==null||n.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),G(this,wn).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(n=>n!==t),this.observers.length||(G(this,jt)&&(G(this,gr)?G(this,jt).cancel({revert:!0}):G(this,jt).cancelRetry()),this.scheduleGc()),G(this,wn).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||It(this,Ln,ss).call(this,{type:"invalidate"})}async fetch(t,n){var c,d,h,m,g,_,y,u,w,p,x,v;if(this.state.fetchStatus!=="idle"&&((c=G(this,jt))==null?void 0:c.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(G(this,jt))return G(this,jt).continueRetry(),G(this,jt).promise}if(t&&this.setOptions(t),!this.options.queryFn){const C=this.observers.find(N=>N.options.queryFn);C&&this.setOptions(C.options)}const r=new AbortController,a=C=>{Object.defineProperty(C,"signal",{enumerable:!0,get:()=>(me(this,gr,!0),r.signal)})},i=()=>{const C=_g(this.options,n),b=(()=>{const B={client:G(this,pr),queryKey:this.queryKey,meta:this.meta};return a(B),B})();return me(this,gr,!1),this.options.persister?this.options.persister(C,b,this):C(b)},l=(()=>{const C={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:G(this,pr),state:this.state,fetchFn:i};return a(C),C})();(d=this.options.behavior)==null||d.onFetch(l,this),me(this,na,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((h=l.fetchOptions)==null?void 0:h.meta))&&It(this,Ln,ss).call(this,{type:"fetch",meta:(m=l.fetchOptions)==null?void 0:m.meta}),me(this,jt,xg({initialPromise:n==null?void 0:n.initialPromise,fn:l.fetchFn,onCancel:C=>{C instanceof fd&&C.revert&&this.setState({...G(this,na),fetchStatus:"idle"}),r.abort()},onFail:(C,N)=>{It(this,Ln,ss).call(this,{type:"failed",failureCount:C,error:N})},onPause:()=>{It(this,Ln,ss).call(this,{type:"pause"})},onContinue:()=>{It(this,Ln,ss).call(this,{type:"continue"})},retry:l.options.retry,retryDelay:l.options.retryDelay,networkMode:l.options.networkMode,canRun:()=>!0}));try{const C=await G(this,jt).start();if(C===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(C),(_=(g=G(this,wn).config).onSuccess)==null||_.call(g,C,this),(u=(y=G(this,wn).config).onSettled)==null||u.call(y,C,this.state.error,this),C}catch(C){if(C instanceof fd){if(C.silent)return G(this,jt).promise;if(C.revert){if(this.state.data===void 0)throw C;return this.state.data}}throw It(this,Ln,ss).call(this,{type:"error",error:C}),(p=(w=G(this,wn).config).onError)==null||p.call(w,C,this),(v=(x=G(this,wn).config).onSettled)==null||v.call(x,this.state.data,C,this),C}finally{this.scheduleGc()}}},mr=new WeakMap,na=new WeakMap,wn=new WeakMap,pr=new WeakMap,jt=new WeakMap,yi=new WeakMap,gr=new WeakMap,Ln=new WeakSet,ss=function(t){const n=r=>{switch(t.type){case"failed":return{...r,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...pv(r.data,this.options),fetchMeta:t.meta??null};case"success":const a={...r,...eh(t.data,t.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return me(this,na,t.manual?a:void 0),a;case"error":const i=t.error;return{...r,error:i,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...t.state}}};this.state=n(this.state),Gt.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),G(this,wn).notify({query:this,type:"updated",action:t})})},Zh);function pv(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:vg(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function eh(e,t){return{data:e,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:!1,status:"success"}}function th(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,r=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}function nh(e){return{onFetch:(t,n)=>{var h,m,g,_,y;const r=t.options,a=(g=(m=(h=t.fetchOptions)==null?void 0:h.meta)==null?void 0:m.fetchMore)==null?void 0:g.direction,i=((_=t.state.data)==null?void 0:_.pages)||[],o=((y=t.state.data)==null?void 0:y.pageParams)||[];let l={pages:[],pageParams:[]},c=0;const d=async()=>{let u=!1;const w=v=>{Object.defineProperty(v,"signal",{enumerable:!0,get:()=>(t.signal.aborted?u=!0:t.signal.addEventListener("abort",()=>{u=!0}),t.signal)})},p=_g(t.options,t.fetchOptions),x=async(v,C,N)=>{if(u)return Promise.reject();if(C==null&&v.pages.length)return Promise.resolve(v);const B=(()=>{const P={client:t.client,queryKey:t.queryKey,pageParam:C,direction:N?"backward":"forward",meta:t.options.meta};return w(P),P})(),M=await p(B),{maxPages:L}=t.options,S=N?ov:iv;return{pages:S(v.pages,M,L),pageParams:S(v.pageParams,C,L)}};if(a&&i.length){const v=a==="backward",C=v?gv:sh,N={pages:i,pageParams:o},b=C(r,N);l=await x(N,b,v)}else{const v=e??i.length;do{const C=c===0?o[0]??r.initialPageParam:sh(r,l);if(c>0&&C==null)break;l=await x(l,C),c++}while(c<v)}return l};t.options.persister?t.fetchFn=()=>{var u,w;return(w=(u=t.options).persister)==null?void 0:w.call(u,d,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n)}:t.fetchFn=d}}}function sh(e,{pages:t,pageParams:n}){const r=t.length-1;return t.length>0?e.getNextPageParam(t[r],t,n[r],n):void 0}function gv(e,{pages:t,pageParams:n}){var r;return t.length>0?(r=e.getPreviousPageParam)==null?void 0:r.call(e,t[0],t,n[0],n):void 0}var vi,Un,Vt,_r,Gn,js,Jh,_v=(Jh=class extends wg{constructor(t){super();Ce(this,Gn);Ce(this,vi);Ce(this,Un);Ce(this,Vt);Ce(this,_r);me(this,vi,t.client),this.mutationId=t.mutationId,me(this,Vt,t.mutationCache),me(this,Un,[]),this.state=t.state||yv(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){G(this,Un).includes(t)||(G(this,Un).push(t),this.clearGcTimeout(),G(this,Vt).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){me(this,Un,G(this,Un).filter(n=>n!==t)),this.scheduleGc(),G(this,Vt).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){G(this,Un).length||(this.state.status==="pending"?this.scheduleGc():G(this,Vt).remove(this))}continue(){var t;return((t=G(this,_r))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var o,l,c,d,h,m,g,_,y,u,w,p,x,v,C,N,b,B,M,L;const n=()=>{It(this,Gn,js).call(this,{type:"continue"})},r={client:G(this,vi),meta:this.options.meta,mutationKey:this.options.mutationKey};me(this,_r,xg({fn:()=>this.options.mutationFn?this.options.mutationFn(t,r):Promise.reject(new Error("No mutationFn found")),onFail:(S,P)=>{It(this,Gn,js).call(this,{type:"failed",failureCount:S,error:P})},onPause:()=>{It(this,Gn,js).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>G(this,Vt).canRun(this)}));const a=this.state.status==="pending",i=!G(this,_r).canStart();try{if(a)n();else{It(this,Gn,js).call(this,{type:"pending",variables:t,isPaused:i}),await((l=(o=G(this,Vt).config).onMutate)==null?void 0:l.call(o,t,this,r));const P=await((d=(c=this.options).onMutate)==null?void 0:d.call(c,t,r));P!==this.state.context&&It(this,Gn,js).call(this,{type:"pending",context:P,variables:t,isPaused:i})}const S=await G(this,_r).start();return await((m=(h=G(this,Vt).config).onSuccess)==null?void 0:m.call(h,S,t,this.state.context,this,r)),await((_=(g=this.options).onSuccess)==null?void 0:_.call(g,S,t,this.state.context,r)),await((u=(y=G(this,Vt).config).onSettled)==null?void 0:u.call(y,S,null,this.state.variables,this.state.context,this,r)),await((p=(w=this.options).onSettled)==null?void 0:p.call(w,S,null,t,this.state.context,r)),It(this,Gn,js).call(this,{type:"success",data:S}),S}catch(S){try{throw await((v=(x=G(this,Vt).config).onError)==null?void 0:v.call(x,S,t,this.state.context,this,r)),await((N=(C=this.options).onError)==null?void 0:N.call(C,S,t,this.state.context,r)),await((B=(b=G(this,Vt).config).onSettled)==null?void 0:B.call(b,void 0,S,this.state.variables,this.state.context,this,r)),await((L=(M=this.options).onSettled)==null?void 0:L.call(M,void 0,S,t,this.state.context,r)),S}finally{It(this,Gn,js).call(this,{type:"error",error:S})}}finally{G(this,Vt).runNext(this)}}},vi=new WeakMap,Un=new WeakMap,Vt=new WeakMap,_r=new WeakMap,Gn=new WeakSet,js=function(t){const n=r=>{switch(t.type){case"failed":return{...r,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...r,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:t.error,failureCount:r.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=n(this.state),Gt.batch(()=>{G(this,Un).forEach(r=>{r.onMutationUpdate(t)}),G(this,Vt).notify({mutation:this,type:"updated",action:t})})},Jh);function yv(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var is,An,xi,em,vv=(em=class extends _l{constructor(t={}){super();Ce(this,is);Ce(this,An);Ce(this,xi);this.config=t,me(this,is,new Set),me(this,An,new Map),me(this,xi,0)}build(t,n,r){const a=new _v({client:t,mutationCache:this,mutationId:++Mi(this,xi)._,options:t.defaultMutationOptions(n),state:r});return this.add(a),a}add(t){G(this,is).add(t);const n=Ki(t);if(typeof n=="string"){const r=G(this,An).get(n);r?r.push(t):G(this,An).set(n,[t])}this.notify({type:"added",mutation:t})}remove(t){if(G(this,is).delete(t)){const n=Ki(t);if(typeof n=="string"){const r=G(this,An).get(n);if(r)if(r.length>1){const a=r.indexOf(t);a!==-1&&r.splice(a,1)}else r[0]===t&&G(this,An).delete(n)}}this.notify({type:"removed",mutation:t})}canRun(t){const n=Ki(t);if(typeof n=="string"){const r=G(this,An).get(n),a=r==null?void 0:r.find(i=>i.state.status==="pending");return!a||a===t}else return!0}runNext(t){var r;const n=Ki(t);if(typeof n=="string"){const a=(r=G(this,An).get(n))==null?void 0:r.find(i=>i!==t&&i.state.isPaused);return(a==null?void 0:a.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Gt.batch(()=>{G(this,is).forEach(t=>{this.notify({type:"removed",mutation:t})}),G(this,is).clear(),G(this,An).clear()})}getAll(){return Array.from(G(this,is))}find(t){const n={exact:!0,...t};return this.getAll().find(r=>Kf(n,r))}findAll(t={}){return this.getAll().filter(n=>Kf(t,n))}notify(t){Gt.batch(()=>{this.listeners.forEach(n=>{n(t)})})}resumePausedMutations(){const t=this.getAll().filter(n=>n.state.isPaused);return Gt.batch(()=>Promise.all(t.map(n=>n.continue().catch(Pn))))}},is=new WeakMap,An=new WeakMap,xi=new WeakMap,em);function Ki(e){var t;return(t=e.options.scope)==null?void 0:t.id}var Yn,tm,xv=(tm=class extends _l{constructor(t={}){super();Ce(this,Yn);this.config=t,me(this,Yn,new Map)}build(t,n,r){const a=n.queryKey,i=n.queryHash??wu(a,n);let o=this.get(i);return o||(o=new mv({client:t,queryKey:a,queryHash:i,options:t.defaultQueryOptions(n),state:r,defaultOptions:t.getQueryDefaults(a)}),this.add(o)),o}add(t){G(this,Yn).has(t.queryHash)||(G(this,Yn).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const n=G(this,Yn).get(t.queryHash);n&&(t.destroy(),n===t&&G(this,Yn).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Gt.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return G(this,Yn).get(t)}getAll(){return[...G(this,Yn).values()]}find(t){const n={exact:!0,...t};return this.getAll().find(r=>Xf(n,r))}findAll(t={}){const n=this.getAll();return Object.keys(t).length>0?n.filter(r=>Xf(t,r)):n}notify(t){Gt.batch(()=>{this.listeners.forEach(n=>{n(t)})})}onFocus(){Gt.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Gt.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Yn=new WeakMap,tm),it,Ms,Is,sa,ra,Ps,aa,ia,nm,wv=(nm=class{constructor(e={}){Ce(this,it);Ce(this,Ms);Ce(this,Is);Ce(this,sa);Ce(this,ra);Ce(this,Ps);Ce(this,aa);Ce(this,ia);me(this,it,e.queryCache||new xv),me(this,Ms,e.mutationCache||new vv),me(this,Is,e.defaultOptions||{}),me(this,sa,new Map),me(this,ra,new Map),me(this,Ps,0)}mount(){Mi(this,Ps)._++,G(this,Ps)===1&&(me(this,aa,yg.subscribe(async e=>{e&&(await this.resumePausedMutations(),G(this,it).onFocus())})),me(this,ia,qo.subscribe(async e=>{e&&(await this.resumePausedMutations(),G(this,it).onOnline())})))}unmount(){var e,t;Mi(this,Ps)._--,G(this,Ps)===0&&((e=G(this,aa))==null||e.call(this),me(this,aa,void 0),(t=G(this,ia))==null||t.call(this),me(this,ia,void 0))}isFetching(e){return G(this,it).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return G(this,Ms).findAll({...e,status:"pending"}).length}getQueryData(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=G(this,it).get(t.queryHash))==null?void 0:n.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=G(this,it).build(this,t),r=n.state.data;return r===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(dd(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(r))}getQueriesData(e){return G(this,it).findAll(e).map(({queryKey:t,state:n})=>{const r=n.data;return[t,r]})}setQueryData(e,t,n){const r=this.defaultQueryOptions({queryKey:e}),a=G(this,it).get(r.queryHash),i=a==null?void 0:a.state.data,o=Jy(t,i);if(o!==void 0)return G(this,it).build(this,r).setData(o,{...n,manual:!0})}setQueriesData(e,t,n){return Gt.batch(()=>G(this,it).findAll(e).map(({queryKey:r})=>[r,this.setQueryData(r,t,n)]))}getQueryState(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=G(this,it).get(t.queryHash))==null?void 0:n.state}removeQueries(e){const t=G(this,it);Gt.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=G(this,it);return Gt.batch(()=>(n.findAll(e).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},r=Gt.batch(()=>G(this,it).findAll(e).map(a=>a.cancel(n)));return Promise.all(r).then(Pn).catch(Pn)}invalidateQueries(e,t={}){return Gt.batch(()=>(G(this,it).findAll(e).forEach(n=>{n.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},r=Gt.batch(()=>G(this,it).findAll(e).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let i=a.fetch(void 0,n);return n.throwOnError||(i=i.catch(Pn)),a.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(r).then(Pn)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=G(this,it).build(this,t);return n.isStaleByTime(dd(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Pn).catch(Pn)}fetchInfiniteQuery(e){return e.behavior=nh(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Pn).catch(Pn)}ensureInfiniteQueryData(e){return e.behavior=nh(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return qo.isOnline()?G(this,Ms).resumePausedMutations():Promise.resolve()}getQueryCache(){return G(this,it)}getMutationCache(){return G(this,Ms)}getDefaultOptions(){return G(this,Is)}setDefaultOptions(e){me(this,Is,e)}setQueryDefaults(e,t){G(this,sa).set(gi(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...G(this,sa).values()],n={};return t.forEach(r=>{_i(e,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(e,t){G(this,ra).set(gi(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...G(this,ra).values()],n={};return t.forEach(r=>{_i(e,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...G(this,Is).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=wu(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===ju&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...G(this,Is).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){G(this,it).clear(),G(this,Ms).clear()}},it=new WeakMap,Ms=new WeakMap,Is=new WeakMap,sa=new WeakMap,ra=new WeakMap,Ps=new WeakMap,aa=new WeakMap,ia=new WeakMap,nm),jv=f.createContext(void 0),Sv=({client:e,children:t})=>(f.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),s.jsx(jv.Provider,{value:e,children:t}));const Cv="modulepreload",kv=function(e){return"/"+e},rh={},jg=function(t,n,r){let a=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(n.map(c=>{if(c=kv(c),c in rh)return;rh[c]=!0;const d=c.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const m=document.createElement("link");if(m.rel=d?"stylesheet":Cv,d||(m.as="script"),m.crossOrigin="",m.href=c,l&&m.setAttribute("nonce",l),document.head.appendChild(m),d)return new Promise((g,_)=>{m.addEventListener("load",g),m.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return a.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},ah=e=>{let t;const n=new Set,r=(d,h)=>{const m=typeof d=="function"?d(t):d;if(!Object.is(m,t)){const g=t;t=h??(typeof m!="object"||m===null)?m:Object.assign({},t,m),n.forEach(_=>_(t,g))}},a=()=>t,l={setState:r,getState:a,getInitialState:()=>c,subscribe:d=>(n.add(d),()=>n.delete(d))},c=t=e(r,a,l);return l},bv=e=>e?ah(e):ah,Nv=e=>e;function Dv(e,t=Nv){const n=Pi.useSyncExternalStore(e.subscribe,Pi.useCallback(()=>t(e.getState()),[e,t]),Pi.useCallback(()=>t(e.getInitialState()),[e,t]));return Pi.useDebugValue(n),n}const ih=e=>{const t=bv(e),n=r=>Dv(t,r);return Object.assign(n,t),n},vl=e=>e?ih(e):ih;function Sg(e,t){let n;try{n=e()}catch{return}return{getItem:a=>{var i;const o=c=>c===null?null:JSON.parse(c,void 0),l=(i=n.getItem(a))!=null?i:null;return l instanceof Promise?l.then(o):o(l)},setItem:(a,i)=>n.setItem(a,JSON.stringify(i,void 0)),removeItem:a=>n.removeItem(a)}}const hd=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then(r){return hd(r)(n)},catch(r){return this}}}catch(n){return{then(r){return this},catch(r){return hd(r)(n)}}}},$v=(e,t)=>(n,r,a)=>{let i={storage:Sg(()=>localStorage),partialize:u=>u,version:0,merge:(u,w)=>({...w,...u}),...t},o=!1;const l=new Set,c=new Set;let d=i.storage;if(!d)return e((...u)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),n(...u)},r,a);const h=()=>{const u=i.partialize({...r()});return d.setItem(i.name,{state:u,version:i.version})},m=a.setState;a.setState=(u,w)=>(m(u,w),h());const g=e((...u)=>(n(...u),h()),r,a);a.getInitialState=()=>g;let _;const y=()=>{var u,w;if(!d)return;o=!1,l.forEach(x=>{var v;return x((v=r())!=null?v:g)});const p=((w=i.onRehydrateStorage)==null?void 0:w.call(i,(u=r())!=null?u:g))||void 0;return hd(d.getItem.bind(d))(i.name).then(x=>{if(x)if(typeof x.version=="number"&&x.version!==i.version){if(i.migrate){const v=i.migrate(x.state,x.version);return v instanceof Promise?v.then(C=>[!0,C]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,x.state];return[!1,void 0]}).then(x=>{var v;const[C,N]=x;if(_=i.merge(N,(v=r())!=null?v:g),n(_,!0),C)return h()}).then(()=>{p==null||p(_,void 0),_=r(),o=!0,c.forEach(x=>x(_))}).catch(x=>{p==null||p(void 0,x)})};return a.persist={setOptions:u=>{i={...i,...u},u.storage&&(d=u.storage)},clearStorage:()=>{d==null||d.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>y(),hasHydrated:()=>o,onHydrate:u=>(l.add(u),()=>{l.delete(u)}),onFinishHydration:u=>(c.add(u),()=>{c.delete(u)})},i.skipHydration||y(),_||g},Ev=$v,Tv={week:100,month:36,quarter:50,year:80};function md(e){const t={1:[]};for(const r of e.phases||[])if(!r.is_milestone){const a=r.children||[],i=a.length>0;t[1].push({type:"phase",id:r.id,hasChildren:i}),i&&Cg(a,2,t)}let n=0;for(const r in t)t[r]&&t[r].length>0&&(n=Math.max(n,parseInt(r)));return n=Math.max(n,1),{levels:t,maxLevel:n}}function Cg(e,t,n){if(!(!e||e.length===0)){n[t]||(n[t]=[]);for(const r of e){const a=r.children||[],i=a.length>0;n[t].push({type:"subphase",id:r.id,hasChildren:i}),i&&Cg(a,t+1,n)}}}function oh(e,t,n,r){if(!t.has(e.id))return 0;const{levels:a,maxLevel:i}=md(e);if(!a[1]||a[1].length===0||!a[1].some(l=>n.has(l.id)))return 1;for(let l=2;l<=i;l++){if(!a[l]||a[l].length===0)continue;if(!a[l].some(d=>r.has(d.id)))return l}return i}function lh(e,t,n,r,a,i,o){const l=new Set(a),c=new Set(i),d=new Set(o);if(t===0){l.delete(e.id);for(const h of n[1]||[])c.delete(h.id);for(let h=2;h<=r;h++)for(const m of n[h]||[])d.delete(m.id)}else if(l.add(e.id),t===1){for(const h of n[1]||[])c.delete(h.id);for(let h=2;h<=r;h++)for(const m of n[h]||[])d.delete(m.id)}else{for(const h of n[1]||[])c.add(h.id);for(let h=2;h<=r;h++)for(const m of n[h]||[])h<t?d.add(m.id):d.delete(m.id)}return{expandedProjects:l,expandedPhases:c,expandedSubphases:d}}const ch={isAuthChecking:!0,isAuthenticated:!1,sites:[],projects:[],staff:[],equipment:[],vacations:[],bankHolidays:[],bankHolidayDates:new Set,users:[],instanceSettings:null,customColumns:[],customColumnValues:{},customColumnFilters:{},showAllCustomColumns:!0,hiddenCustomColumns:new Set,skills:[],currentSite:null,currentUser:null,viewMode:"month",currentView:"gantt",currentDate:new Date,cellWidth:36,currentResourceTab:"staff",timelineScrollLeft:0,showAssignments:!0,showStaffOverview:!1,showEquipmentOverview:!1,expandedProjects:new Set,expandedPhases:new Set,expandedSubphases:new Set,expandedStaff:new Set,expandedEquipment:new Set,expandedBankHolidays:!1,whatIfMode:!1,whatIfSnapshot:null,whatIfPendingOperations:[],sidebarCollapsed:!1,resourcePanelCollapsed:!1},O=vl()(Ev((e,t)=>({...ch,setSites:n=>e({sites:n}),setProjects:n=>e({projects:n}),setStaff:n=>e({staff:n}),setEquipment:n=>e({equipment:n}),setVacations:n=>e({vacations:n}),setBankHolidays:(n,r)=>e({bankHolidays:n,bankHolidayDates:r}),setUsers:n=>e({users:n}),setInstanceSettings:n=>e({instanceSettings:n}),setCustomColumns:n=>e({customColumns:n}),setCustomColumnValues:n=>e({customColumnValues:n}),setSkills:n=>e({skills:n}),setCustomColumnValue:(n,r,a,i)=>e(o=>({customColumnValues:{...o.customColumnValues,[`${n}-${r}-${a}`]:i}})),setCustomColumnFilter:(n,r)=>e(a=>({customColumnFilters:{...a.customColumnFilters,[n]:r}})),clearCustomColumnFilter:n=>e(r=>{const a={...r.customColumnFilters};return delete a[n],{customColumnFilters:a}}),clearAllCustomColumnFilters:()=>e({customColumnFilters:{}}),entityPassesFilters:(n,r)=>{const a=t(),{customColumnFilters:i,customColumnValues:o}=a,l=Object.keys(i).filter(c=>{var d;return((d=i[Number(c)])==null?void 0:d.length)>0});if(l.length===0)return!0;for(const c of l){const d=Number(c),h=i[d],m=`${d}-${n}-${r}`,g=o[m]??null;if(g===null){if(!h.includes("__empty__"))return!1}else if(!h.includes(g))return!1}return!0},setShowAllCustomColumns:n=>e({showAllCustomColumns:n}),toggleCustomColumnVisibility:n=>e(r=>{const a=new Set(r.hiddenCustomColumns);return a.has(n)?a.delete(n):a.add(n),{hiddenCustomColumns:a}}),setCurrentSite:n=>e({currentSite:n}),setCurrentUser:n=>e({currentUser:n}),setAuthChecking:n=>e({isAuthChecking:n}),setAuthenticated:n=>e({isAuthenticated:n}),setViewMode:n=>e({viewMode:n,cellWidth:Tv[n]}),setCurrentView:n=>e({currentView:n}),setCurrentDate:n=>e({currentDate:n}),setCellWidth:n=>e({cellWidth:n}),setCurrentResourceTab:n=>e({currentResourceTab:n}),setTimelineScrollLeft:n=>e({timelineScrollLeft:n}),setShowAssignments:n=>e({showAssignments:n}),toggleShowAssignments:()=>e(n=>({showAssignments:!n.showAssignments})),setShowStaffOverview:n=>e({showStaffOverview:n,showEquipmentOverview:n?!1:t().showEquipmentOverview}),toggleShowStaffOverview:()=>e(n=>({showStaffOverview:!n.showStaffOverview,showEquipmentOverview:n.showStaffOverview?n.showEquipmentOverview:!1})),setShowEquipmentOverview:n=>e({showEquipmentOverview:n,showStaffOverview:n?!1:t().showStaffOverview}),toggleShowEquipmentOverview:()=>e(n=>({showEquipmentOverview:!n.showEquipmentOverview,showStaffOverview:n.showEquipmentOverview?n.showStaffOverview:!1})),navigatePeriod:n=>{const{viewMode:r,currentDate:a}=t(),i=new Date(a);switch(r){case"week":i.setDate(i.getDate()+n*7);break;case"month":i.setMonth(i.getMonth()+n);break;case"quarter":i.setMonth(i.getMonth()+n*3);break;case"year":i.setFullYear(i.getFullYear()+n);break}e({currentDate:i})},goToToday:()=>e({currentDate:new Date}),toggleProjectExpanded:n=>e(r=>{const a=new Set(r.expandedProjects);return a.has(n)?a.delete(n):a.add(n),{expandedProjects:a}}),togglePhaseExpanded:n=>e(r=>{const a=new Set(r.expandedPhases);return a.has(n)?a.delete(n):a.add(n),{expandedPhases:a}}),toggleSubphaseExpanded:n=>e(r=>{const a=new Set(r.expandedSubphases);return a.has(n)?a.delete(n):a.add(n),{expandedSubphases:a}}),toggleStaffExpanded:n=>e(r=>{const a=new Set(r.expandedStaff);return a.has(n)?a.delete(n):a.add(n),{expandedStaff:a}}),toggleEquipmentExpanded:n=>e(r=>{const a=new Set(r.expandedEquipment);return a.has(n)?a.delete(n):a.add(n),{expandedEquipment:a}}),toggleBankHolidaysExpanded:()=>e(n=>({expandedBankHolidays:!n.expandedBankHolidays})),ensureProjectExpanded:n=>e(r=>{if(r.expandedProjects.has(n))return r;const a=new Set(r.expandedProjects);return a.add(n),{expandedProjects:a}}),ensurePhaseExpanded:n=>e(r=>{if(r.expandedPhases.has(n))return r;const a=new Set(r.expandedPhases);return a.add(n),{expandedPhases:a}}),ensureSubphaseExpanded:n=>e(r=>{if(r.expandedSubphases.has(n))return r;const a=new Set(r.expandedSubphases);return a.add(n),{expandedSubphases:a}}),setExpandedProjects:n=>e({expandedProjects:n}),setExpandedPhases:n=>e({expandedPhases:n}),collapseAll:()=>e({expandedProjects:new Set,expandedPhases:new Set,expandedSubphases:new Set,expandedStaff:new Set,expandedEquipment:new Set}),expandAll:()=>{const{projects:n}=t(),r=new Set(n.map(o=>o.id)),a=new Set,i=new Set;n.forEach(o=>{var l;(l=o.phases)==null||l.forEach(c=>{a.add(c.id);const d=h=>{h==null||h.forEach(m=>{i.add(m.id),d(m.children)})};d(c.children)})}),e({expandedProjects:r,expandedPhases:a,expandedSubphases:i})},expandProjectLevel:n=>{const{projects:r,expandedProjects:a,expandedPhases:i,expandedSubphases:o}=t(),l=r.find(_=>_.id===n);if(!l)return;const{levels:c,maxLevel:d}=md(l),h=oh(l,a,i,o),m=Math.min(h+1,d),g=lh(l,m,c,d,a,i,o);e(g)},collapseProjectLevel:n=>{const{projects:r,expandedProjects:a,expandedPhases:i,expandedSubphases:o}=t(),l=r.find(_=>_.id===n);if(!l)return;const{levels:c,maxLevel:d}=md(l),h=oh(l,a,i,o),m=Math.max(h-1,0),g=lh(l,m,c,d,a,i,o);e(g)},enterWhatIfMode:()=>{const{projects:n}=t();e({whatIfMode:!0,whatIfSnapshot:{projects:structuredClone(n)},whatIfPendingOperations:[]})},exitWhatIfMode:async n=>{const{whatIfSnapshot:r,whatIfPendingOperations:a}=t();if(!n&&r)e({projects:r.projects,whatIfMode:!1,whatIfSnapshot:null,whatIfPendingOperations:[]});else if(n&&a.length>0){console.log(`[What If] Applying ${a.length} pending operations...`);const{apiRequest:i,clientConfig:o}=await jg(async()=>{const{apiRequest:c,clientConfig:d}=await Promise.resolve().then(()=>Iv);return{apiRequest:c,clientConfig:d}},void 0),l=o.isWhatIfMode;o.isWhatIfMode=()=>!1;try{for(const c of a)console.log(`[What If] Executing: ${c.method} ${c.url}`),await i(c.url,{method:c.method,body:c.body});console.log("[What If] All operations applied successfully")}catch(c){console.error("[What If] Failed to apply operations:",c)}finally{o.isWhatIfMode=l}e({whatIfMode:!1,whatIfSnapshot:null,whatIfPendingOperations:[]})}else e({whatIfMode:!1,whatIfSnapshot:null,whatIfPendingOperations:[]})},queueWhatIfOperation:n=>{e(r=>({whatIfPendingOperations:[...r.whatIfPendingOperations,{...n,id:`op_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now()}]}))},toggleSidebar:()=>e(n=>({sidebarCollapsed:!n.sidebarCollapsed})),toggleResourcePanel:()=>e(n=>({resourcePanelCollapsed:!n.resourcePanelCollapsed})),setSidebarCollapsed:n=>e({sidebarCollapsed:n}),setResourcePanelCollapsed:n=>e({resourcePanelCollapsed:n}),reset:()=>e(ch)}),{name:"milestone-app-storage",storage:Sg(()=>localStorage),partialize:e=>{var t;return{viewMode:e.viewMode,currentView:e.currentView,cellWidth:e.cellWidth,currentResourceTab:e.currentResourceTab,sidebarCollapsed:e.sidebarCollapsed,resourcePanelCollapsed:e.resourcePanelCollapsed,timelineScrollLeft:e.timelineScrollLeft,expandedProjects:Array.from(e.expandedProjects),expandedPhases:Array.from(e.expandedPhases),expandedSubphases:Array.from(e.expandedSubphases),currentSiteId:(t=e.currentSite)==null?void 0:t.id,currentDateISO:e.currentDate.toISOString()}},onRehydrateStorage:()=>(console.log("[AppStore] Starting hydration from localStorage..."),(e,t)=>{var n,r;t?console.error("[AppStore] Hydration error:",t):e&&console.log("[AppStore] Hydration complete:",{viewMode:e.viewMode,currentDate:(r=(n=e.currentDate)==null?void 0:n.toISOString)==null?void 0:r.call(n),cellWidth:e.cellWidth})}),merge:(e,t)=>{const n=(e==null?void 0:e.state)??e;return console.log("[AppStore] Merging persisted state:",{raw:e,unwrapped:n}),{...t,viewMode:(n==null?void 0:n.viewMode)??t.viewMode,currentView:(n==null?void 0:n.currentView)??t.currentView,cellWidth:(n==null?void 0:n.cellWidth)??t.cellWidth,currentResourceTab:(n==null?void 0:n.currentResourceTab)??t.currentResourceTab,sidebarCollapsed:(n==null?void 0:n.sidebarCollapsed)??t.sidebarCollapsed,resourcePanelCollapsed:(n==null?void 0:n.resourcePanelCollapsed)??t.resourcePanelCollapsed,timelineScrollLeft:(n==null?void 0:n.timelineScrollLeft)??t.timelineScrollLeft,expandedProjects:Array.isArray(n==null?void 0:n.expandedProjects)?new Set(n.expandedProjects):t.expandedProjects,expandedPhases:Array.isArray(n==null?void 0:n.expandedPhases)?new Set(n.expandedPhases):t.expandedPhases,expandedSubphases:Array.isArray(n==null?void 0:n.expandedSubphases)?new Set(n.expandedSubphases):t.expandedSubphases,currentDate:n!=null&&n.currentDateISO?new Date(n.currentDateISO):t.currentDate}}}));function Mv(){return window.location.port==="3333"?`${window.location.protocol}//${window.location.hostname}:8485`:""}function kg(){const e=window.location.pathname.match(/^(\/t\/[a-z0-9][a-z0-9-]*)/);return e?e[1]:""}let Ds={isWhatIfMode:()=>!1,queueWhatIfOperation:void 0};function bg(e){Ds={...Ds,...e}}async function xa(e,t={}){var h;const n=Mv(),r=kg();let a=e.startsWith("/")?e:`/${e}`;a.startsWith("/api/")&&r&&(a=r+a),a=n+a;const i=t.method||"GET";if((h=Ds.isWhatIfMode)!=null&&h.call(Ds)&&["PUT","POST","DELETE"].includes(i)&&!["/api/auth/","/api/settings/"].some(_=>a.includes(_))){if(console.log(`[What If Mode] Queued ${i} request to ${a}`),Ds.queueWhatIfOperation){const _=a.replace(n,"");Ds.queueWhatIfOperation({method:i,url:_,body:t.body})}return{success:!0,whatIfMode:!0,id:Date.now()}}const{body:o,headers:l,...c}=t,d={method:i,headers:{"Content-Type":"application/json",...l},credentials:"include",...c};o!==void 0&&(d.body=JSON.stringify(o));try{const m=await fetch(a,d);if(m.status===204)return{};const g=await m.text();if(!g||g.trim()===""){if(m.ok)return{};throw new Error(`HTTP ${m.status}: Empty response`)}let _;try{_=JSON.parse(g)}catch{throw console.error(`[API Error] Non-JSON response from ${e}:`,g.substring(0,200)),new Error(`HTTP ${m.status}: Invalid response`)}if(!m.ok){const y=_;if(Array.isArray(y.detail)){const w=y.detail.map(p=>{var v;return`${((v=p.loc)==null?void 0:v.slice(-1)[0])||"field"}: ${p.msg||"invalid"}`});throw new Error(w.join(", "))}const u=y.error||y.detail||`HTTP ${m.status}`;throw new Error(u)}return _}catch(m){throw m instanceof Error?(console.error(`[API Error] ${i} ${e}:`,m.message),m):new Error("An unexpected error occurred")}}function Pe(e){return xa(e,{method:"GET"})}function Oe(e,t){return xa(e,{method:"POST",body:t})}function nt(e,t){return xa(e,{method:"PUT",body:t})}function zt(e){return xa(e,{method:"DELETE"})}const Iv=Object.freeze(Object.defineProperty({__proto__:null,apiDelete:zt,apiGet:Pe,apiPost:Oe,apiPut:nt,apiRequest:xa,get clientConfig(){return Ds},configureApiClient:bg,getTenantPrefix:kg},Symbol.toStringTag,{value:"Module"}));async function Pv(){try{return await Pe("/api/auth/me")}catch{return{user:null}}}async function Lv(e,t){return Oe("/api/auth/login",{email:e,password:t})}async function Ng(){await Oe("/api/auth/logout")}async function Av(){try{return await Pe("/api/auth/sso/status")}catch{return{enabled:!1}}}async function Bv(){return Pe("/api/auth/sso/login")}async function Rv(e="false"){return Pe(`/api/projects?archived=${e}`)}async function Ov(e){return Pe(`/api/projects/${e}`)}async function Fv(e){return Oe("/api/projects",e)}async function bi(e,t){return nt(`/api/projects/${e}`,t)}async function zv(e){await zt(`/api/projects/${e}`)}async function Hv(e,t){const n={type:t.name,start_date:t.start_date,end_date:t.end_date,is_milestone:t.is_milestone??!1};return t.order_index!==void 0&&(n.order_index=t.order_index),t.dependencies!==void 0&&(n.dependencies=t.dependencies),Oe(`/api/projects/${e}/phases`,n)}async function Js(e,t){return nt(`/api/phases/${e}`,t)}async function Dg(e){await zt(`/api/phases/${e}`)}async function qv(e,t,n){const r={name:n.name,start_date:n.start_date,end_date:n.end_date,project_id:t,is_milestone:n.is_milestone??!1};return n.order_index!==void 0&&(r.order_index=n.order_index),n.dependencies!==void 0&&(r.dependencies=n.dependencies),Oe(`/api/phases/${e}/subphases`,r)}async function Wv(e,t,n){const r={name:n.name,start_date:n.start_date,end_date:n.end_date,project_id:t,is_milestone:n.is_milestone??!1};return n.order_index!==void 0&&(r.order_index=n.order_index),n.dependencies!==void 0&&(r.dependencies=n.dependencies),Oe(`/api/subphases/${e}/children`,r)}async function er(e,t){return nt(`/api/subphases/${e}`,t)}async function $g(e){await zt(`/api/subphases/${e}`)}async function Su(e){if(e.subphase_id)return Oe(`/api/subphases/${e.subphase_id}/staff`,e);if(e.phase_id)return Oe(`/api/phases/${e.phase_id}/staff`,e);if(e.project_id)return Oe(`/api/projects/${e.project_id}/staff`,e);throw new Error("Must specify project_id, phase_id, or subphase_id")}async function xl(e,t,n="project"){const r=n==="subphase"?`/api/subphase-staff/${e}`:n==="phase"?`/api/phase-staff/${e}`:`/api/assignments/${e}`;return nt(r,t)}async function Eg(e,t="project"){const n=t==="subphase"?`/api/subphase-staff/${e}`:t==="phase"?`/api/phase-staff/${e}`:`/api/assignments/${e}`;await zt(n)}async function Cu(e){if(e.subphase_id)return Oe(`/api/subphases/${e.subphase_id}/equipment`,e);if(e.phase_id)return Oe(`/api/phases/${e.phase_id}/equipment`,e);if(e.project_id)return Oe(`/api/projects/${e.project_id}/equipment`,e);throw new Error("Must specify project_id, phase_id, or subphase_id")}async function wl(e,t){return nt(`/api/equipment-assignments/${e}`,t)}async function Tg(e){await zt(`/api/equipment-assignments/${e}`)}function Vv(e){return{...e,phases:(e.phases??[]).map(Yv),staffAssignments:(e.staff_assignments??e.staffAssignments??[]).map(ku),equipmentAssignments:(e.equipment_assignments??e.equipmentAssignments??[]).map(bu)}}const Uv="#ec4899",dh={1:"#06b6d4",2:"#8b5cf6",3:"#3b82f6",4:"#f97316",5:"#10b981",6:"#ec4899",7:"#eab308",8:"#14b8a6",9:"#a855f7"};function Gv(e){return dh[e]||dh[1]}function Yv(e){return{id:e.id,project_id:e.project_id,name:e.type||e.name||"Phase",start_date:e.start_date,end_date:e.end_date,color:Uv,order_index:e.sort_order??0,completion:e.completion??null,is_milestone:!!e.is_milestone,dependencies:e.dependencies??[],children:(e.children??e.subphases??[]).map(t=>Mg(t,1)),staffAssignments:(e.staff_assignments??e.staffAssignments??[]).map(ku),equipmentAssignments:(e.equipment_assignments??e.equipmentAssignments??[]).map(bu)}}function Mg(e,t=1){const n=e.depth??t;return{id:e.id,project_id:e.project_id,parent_phase_id:e.parent_type==="phase"?e.parent_id:null,parent_subphase_id:e.parent_type==="subphase"?e.parent_id:null,name:e.name,start_date:e.start_date,end_date:e.end_date,color:Gv(n),order_index:e.sort_order??0,completion:e.completion??null,is_milestone:!!e.is_milestone,dependencies:e.dependencies??[],children:(e.children??[]).map(r=>Mg(r,n+1)),staffAssignments:(e.staff_assignments??e.staffAssignments??[]).map(ku),equipmentAssignments:(e.equipment_assignments??e.equipmentAssignments??[]).map(bu)}}function ku(e){return{id:e.id,staff_id:e.staff_id,staff_name:e.staff_name,project_id:e.project_id,phase_id:e.phase_id,subphase_id:e.subphase_id,allocation:e.allocation??e.allocation_percent??100,start_date:e.start_date,end_date:e.end_date}}function bu(e){return{id:e.id,equipment_id:e.equipment_id,equipment_name:e.equipment_name,project_id:e.project_id,phase_id:e.phase_id,subphase_id:e.subphase_id,start_date:e.start_date,end_date:e.end_date}}async function ft(){const e=await Rv("all");return!e||e.length===0?[]:(await Promise.all(e.map(n=>Ov(n.id)))).map(Vv)}async function Qv(){return Pe("/api/sites")}async function Xv(e){return Oe("/api/sites",e)}async function Kv(e,t){return nt(`/api/sites/${e}`,t)}async function Vs(e,t){const n=t?`/api/sites/${e}/holidays?year=${t}`:`/api/sites/${e}/holidays`;return Pe(n)}async function Ig(e,t){return Oe(`/api/sites/${e}/holidays`,t)}const Zv=Ig;async function Pg(e,t){await zt(`/api/sites/${e}/holidays/${t}`)}const Jv=Pg;async function Lg(e){return Oe(`/api/sites/${e}/holidays/refresh`)}function Kn(e){const t=new Set;return e.forEach(n=>{const r=new Date(n.date),a=n.end_date?new Date(n.end_date):r,i=new Date(r);for(;i<=a;){const o=ex(i);t.add(o),i.setDate(i.getDate()+1)}}),t}function ex(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}async function uh(e=!1){return Pe(e?"/api/staff?includeAllSites=true":"/api/staff")}async function tx(e=!1){return Pe(e?"/api/equipment?includeAllSites=true":"/api/equipment")}async function Nu(){return Pe("/api/vacations")}async function nx(e){return Oe("/api/vacations",e)}async function sx(e,t){return nt(`/api/vacations/${e}`,t)}async function rx(e){await zt(`/api/vacations/${e}`)}async function ax(e=!1){return Pe(e?"/api/users?includeDisabled=true":"/api/users")}async function ix(e){return Oe("/api/users",e)}async function ox(e,t){return nt(`/api/users/${e}`,t)}async function lx(e){await zt(`/api/users/${e}`)}async function pd(e){return Pe(`/api/settings/${e}`)}async function cx(e,t){return nt(`/api/settings/${e}`,{value:t})}async function dx(){const e=await Pe("/api/settings");return{instance_title:e.instance_title||void 0,instance_name:e.instance_name||void 0}}async function ux(){return Pe("/api/predefined-phases")}async function Wo(e){return Pe(`/api/custom-columns/with-values?site_id=${e}`)}async function fx(e){return Oe("/api/custom-columns",e)}async function Du(e,t){return xa(`/api/custom-columns/${e}`,{method:"PATCH",body:t})}async function Ag(e){return zt(`/api/custom-columns/${e}`)}async function fh(e){return nt("/api/custom-columns/values",e)}function hx(e,t,n){return`${e}-${t}-${n}`}const ma={getAll:()=>Pe("/api/skills"),get:e=>Pe(`/api/skills/${e}`),create:e=>Oe("/api/skills",e),update:(e,t)=>nt(`/api/skills/${e}`,t),delete:e=>zt(`/api/skills/${e}`),getUserSkills:e=>Pe(`/api/skills/user/${e}`),updateUserSkills:(e,t)=>nt(`/api/skills/user/${e}`,{skill_ids:t}),addUserSkill:(e,t)=>Oe(`/api/skills/user/${e}/${t}`),removeUserSkill:(e,t)=>zt(`/api/skills/user/${e}/${t}`)},mx=Object.freeze(Object.defineProperty({__proto__:null,skillsApi:ma},Symbol.toStringTag,{value:"Module"}));async function px(e,t){return Oe("/api/admin/auth/login",{email:e,password:t})}async function gx(){await Oe("/api/admin/auth/logout",{})}async function _x(){return Pe("/api/admin/auth/me")}async function yx(){return Pe("/api/admin/tenants")}async function vx(e){return Pe(`/api/admin/tenants/${e}`)}async function xx(e){return Oe("/api/admin/tenants",e)}async function wx(e,t){return nt(`/api/admin/tenants/${e}/status`,{status:t})}async function jx(e,t=!1){await zt(`/api/admin/tenants/${e}?delete_database=${t}`)}async function Sx(e){return Oe(`/api/admin/tenants/${e}/provision`,{})}async function Cx(e){return Oe(`/api/admin/tenants/${e}/reset-admin-password`,{})}async function kx(e,t=50){return Pe(`/api/admin/tenants/${e}/audit?limit=${t}`)}async function bx(){return Pe("/api/admin/stats")}async function Nx(){return Pe("/api/admin/users")}async function Dx(e){return Oe("/api/admin/users",e)}async function $x(e,t){return nt(`/api/admin/users/${e}`,t)}async function Ex(e){await zt(`/api/admin/users/${e}`)}function Bg(){const e=O(d=>d.currentUser),t=O(d=>d.isAuthChecking),n=O(d=>d.isAuthenticated),r=O(d=>d.setCurrentUser),a=O(d=>d.setAuthChecking),i=O(d=>d.setAuthenticated),o=O(d=>d.reset);f.useEffect(()=>{t&&(async()=>{try{const h=await Pv();h.user?(r(h.user),i(!0)):i(!1)}catch(h){console.error("Auth check failed:",h),i(!1)}finally{a(!1)}})()},[t,r,i,a]);const l=f.useCallback(async(d,h)=>{try{const m=await Lv(d,h);r(m.user),i(!0)}catch(m){const g=m instanceof Error?m.message:"Login failed";throw new Error(g)}},[r,i]),c=f.useCallback(async()=>{try{await Ng()}catch(d){console.error("Logout error:",d)}finally{r(null),i(!1),o()}},[r,i,o]);return{isLoading:t,isAuthenticated:n,user:e,login:l,logout:c}}function jl(){const[e,t]=f.useState(!1),[n,r]=f.useState(null),{setSites:a,setProjects:i,setStaff:o,setEquipment:l,setVacations:c,setBankHolidays:d,setCurrentSite:h,setInstanceSettings:m,setCustomColumns:g,setCustomColumnValues:_,setSkills:y}=O(),u=f.useCallback(async()=>{var C;t(!0),r(null);try{console.log("[DataLoader] Loading all data...");const[N,b,B,M,L,S]=await Promise.all([Qv(),uh(!0),tx(!0),Nu(),dx().catch(()=>null),ma.getAll().catch(()=>[])]);if(console.log("[DataLoader] Loaded:",{sites:N.length,staff:b.length,equipment:B.length,vacations:M.length,instanceSettings:L?"yes":"no",skills:S.length}),a(N),o(b),l(B),c(M),y(S),L&&m(L),N.length>0){const I=[...N].sort((T,E)=>T.id-E.id);let D=I[0];console.log("[DataLoader] Default site (first by ID):",D.name,"id:",D.id);try{const T=localStorage.getItem("milestone-app-storage");if(console.log("[DataLoader] Raw localStorage:",T),T){const E=JSON.parse(T),$=(C=E==null?void 0:E.state)==null?void 0:C.currentSiteId;if(console.log("[DataLoader] Looking for persisted site ID:",$,"type:",typeof $),console.log("[DataLoader] Available sites:",I.map(A=>({id:A.id,name:A.name,type:typeof A.id}))),$!=null){const A=Number($),R=I.find(H=>Number(H.id)===A);console.log("[DataLoader] Comparison: looking for",A,"type:",typeof A),R?(D=R,console.log("[DataLoader]  Restored persisted site:",D.name,"id:",D.id)):console.log("[DataLoader]  Site ID",A,"not found in available sites")}else console.log("[DataLoader] No persistedSiteId in stored state")}else console.log("[DataLoader] No stored state in localStorage")}catch(T){console.warn("[DataLoader] Failed to restore persisted site:",T)}console.log("[DataLoader] Final selected site:",D.name,"id:",D.id),h(D);const k=await Vs(D.id),j=Kn(k);d(k,j);try{const T=await Wo(D.id);g(T.columns),_(T.values),console.log("[DataLoader] Loaded custom columns:",T.columns.length)}catch(T){console.warn("[DataLoader] Failed to load custom columns:",T)}}const P=await ft();i(P),console.log("[DataLoader] Loaded projects:",P.length)}catch(N){const b=N instanceof Error?N.message:"Failed to load data";console.error("[DataLoader] Error:",b),r(b)}finally{t(!1)}},[a,i,o,l,c,d,h,m,g,_,y]),w=f.useCallback(async()=>{try{const C=await ft();i(C)}catch(C){console.error("[DataLoader] Failed to refresh projects:",C)}},[i]),p=f.useCallback(async C=>{try{const N=await Vs(C),b=Kn(N);d(N,b)}catch(N){console.error("[DataLoader] Failed to refresh site data:",N)}},[d]),x=f.useCallback(async C=>{try{const N=await Wo(C);g(N.columns),_(N.values)}catch(N){console.error("[DataLoader] Failed to refresh custom columns:",N)}},[g,_]),v=f.useCallback(async()=>{try{const C=await uh(!0);o(C)}catch(C){console.error("[DataLoader] Failed to refresh staff:",C)}},[o]);return{isLoading:e,error:n,loadAllData:u,refreshProjects:w,refreshSiteData:p,refreshCustomColumns:x,refreshStaff:v}}const Tx="_container_69zuh_1",Mx="_content_69zuh_9",Ix="_logo_69zuh_16",Px="_spinner_69zuh_21",Lx="_message_69zuh_30",Ea={container:Tx,content:Mx,logo:Ix,spinner:Px,message:Lx};function hh({message:e="Loading..."}){return s.jsx("div",{className:Ea.container,children:s.jsxs("div",{className:Ea.content,children:[s.jsx("img",{src:"/img/milestone_logo_no_text.svg",alt:"Milestone",className:Ea.logo}),s.jsx("div",{className:Ea.spinner}),s.jsx("p",{className:Ea.message,children:e})]})})}const ks={PREF_SITE_ID:"milestone_pref_site_id",PREF_VIEW:"milestone_pref_view",PREF_VIEW_MODE:"milestone_pref_view_mode",PREF_THEME:"milestone_theme",LEGACY_SITE_ID:"rd_pref_site_id",LEGACY_VIEW:"rd_pref_view",LEGACY_VIEW_MODE:"rd_pref_view_mode"};function Ax(){[[ks.LEGACY_SITE_ID,ks.PREF_SITE_ID],[ks.LEGACY_VIEW,ks.PREF_VIEW],[ks.LEGACY_VIEW_MODE,ks.PREF_VIEW_MODE]].forEach(([t,n])=>{const r=localStorage.getItem(t);r!==null&&localStorage.getItem(n)===null&&(localStorage.setItem(n,r),console.log(`Migrated storage: ${t} -> ${n}`))})}function Nr(){const e=localStorage.getItem(ks.PREF_THEME);return e==="light"||e==="dark"?e:"dark"}function Bx(e){localStorage.setItem(ks.PREF_THEME,e),document.documentElement.setAttribute("data-theme",e)}function Rx(){const t=Nr()==="dark"?"light":"dark";return Bx(t),t}function Ox(){const e=Nr();document.documentElement.setAttribute("data-theme",e)}const Fx="_container_1pc0d_1",zx="_card_1pc0d_10",Hx="_header_1pc0d_19",qx="_logo_1pc0d_24",Wx="_subtitle_1pc0d_30",Vx="_ssoButton_1pc0d_36",Ux="_divider_1pc0d_58",Gx="_form_1pc0d_78",Yx="_formGroup_1pc0d_84",Qx="_label_1pc0d_90",Xx="_input_1pc0d_96",Kx="_error_1pc0d_122",Zx="_submitButton_1pc0d_132",At={container:Fx,card:zx,header:Hx,logo:qx,subtitle:Wx,ssoButton:Vx,divider:Ux,form:Gx,formGroup:Yx,label:Qx,input:Xx,error:Kx,submitButton:Zx};function Jx(){const{login:e}=Bg(),[t,n]=f.useState(""),[r,a]=f.useState(""),[i,o]=f.useState(!1),[l,c]=f.useState(null),[d,h]=f.useState(!1),[m,g]=f.useState(()=>Nr());f.useEffect(()=>{(async()=>{try{const{enabled:p}=await Av();h(p)}catch{}})()},[]),f.useEffect(()=>{const w=new MutationObserver(()=>{const p=document.documentElement.dataset.theme;p&&p!==m&&g(p)});return w.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>w.disconnect()},[m]);const _=async w=>{w.preventDefault(),c(null),o(!0);try{await e(t,r)}catch(p){c(p instanceof Error?p.message:"Invalid email or password")}finally{o(!1)}},y=async()=>{try{const{url:w}=await Bv();window.location.href=w}catch{c("Failed to initiate SSO login")}},u=m==="dark"?"/img/milestone_logo_dark_theme.svg":"/img/milestone_logo_light_theme.svg";return s.jsx("div",{className:At.container,children:s.jsxs("div",{className:At.card,children:[s.jsxs("div",{className:At.header,children:[s.jsx("img",{src:u,alt:"Milestone",className:At.logo}),s.jsx("p",{className:At.subtitle,children:"Sign in to continue"})]}),d&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{type:"button",className:At.ssoButton,onClick:y,children:[s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 23 23",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{fill:"#f35325",d:"M1 1h10v10H1z"}),s.jsx("path",{fill:"#81bc06",d:"M12 1h10v10H12z"}),s.jsx("path",{fill:"#05a6f0",d:"M1 12h10v10H1z"}),s.jsx("path",{fill:"#ffba08",d:"M12 12h10v10H12z"})]}),"Sign in with Microsoft"]}),s.jsx("div",{className:At.divider,children:s.jsx("span",{children:"or sign in with email"})})]}),s.jsxs("form",{onSubmit:_,className:At.form,children:[s.jsxs("div",{className:At.formGroup,children:[s.jsx("label",{htmlFor:"email",className:At.label,children:"Email"}),s.jsx("input",{type:"email",id:"email",className:At.input,value:t,onChange:w=>n(w.target.value),placeholder:"your@email.com",required:!0,autoFocus:!0,disabled:i})]}),s.jsxs("div",{className:At.formGroup,children:[s.jsx("label",{htmlFor:"password",className:At.label,children:"Password"}),s.jsx("input",{type:"password",id:"password",className:At.input,value:r,onChange:w=>a(w.target.value),placeholder:"",required:!0,disabled:i})]}),l&&s.jsx("div",{className:At.error,children:l}),s.jsx("button",{type:"submit",className:At.submitButton,disabled:i,children:i?"Signing in...":"Sign In"})]})]})})}const e0={activeModal:null,editingProject:null,editingPhase:null,editingSubphase:null,editingStaffAssignment:null,editingEquipmentAssignment:null,editingVacation:null,editingStaff:null,editingEquipment:null,editingUser:null,editingSite:null,modalContext:{},tooltip:{visible:!1,content:"",x:0,y:0},contextMenu:{visible:!1,x:0,y:0,type:null,targetId:null,projectId:void 0,phaseId:void 0,subphaseId:void 0,assignmentData:void 0},isDragging:!1,dragType:null,dragItemId:null,isResizing:!1,resizeEdge:null,resizeItemId:null,resizeItemType:null,dragIndicator:{visible:!1,left:0,top:0,type:"drag"},isLinkingDependency:!1,linkingFrom:null,phantomSiblingMode:null,isLoading:!1,loadingMessage:"",scrollToTodayTrigger:0,scrollToDateTrigger:null,zoomTrigger:null,resourceDrag:{active:!1,type:null,resourceId:null,resourceName:null,targetProjectId:null,targetPhaseId:null,targetSubphaseId:null,previewStart:null,previewEnd:null}},ee=vl()(e=>({...e0,openModal:(t,n={})=>e({activeModal:t,modalContext:n}),closeModal:()=>e({activeModal:null,editingProject:null,editingPhase:null,editingSubphase:null,editingStaffAssignment:null,editingEquipmentAssignment:null,editingVacation:null,editingStaff:null,editingEquipment:null,editingUser:null,editingSite:null,modalContext:{}}),setEditingProject:t=>e({editingProject:t}),setEditingPhase:t=>e({editingPhase:t}),setEditingSubphase:t=>e({editingSubphase:t}),setEditingStaffAssignment:t=>e({editingStaffAssignment:t}),setEditingEquipmentAssignment:t=>e({editingEquipmentAssignment:t}),setEditingVacation:t=>e({editingVacation:t}),setEditingStaff:t=>e({editingStaff:t}),setEditingEquipment:t=>e({editingEquipment:t}),setEditingUser:t=>e({editingUser:t}),setEditingSite:t=>e({editingSite:t}),openProjectModal:t=>e({activeModal:"project",editingProject:t||null}),openPhaseModal:(t,n)=>e({activeModal:"phase",editingPhase:t||null,modalContext:n?{projectId:n}:{}}),openSubphaseModal:(t,n,r,a)=>e({activeModal:"subphase",editingSubphase:t||null,modalContext:{phaseId:n,projectId:r,subphaseId:a}}),openVacationModal:(t,n)=>e({activeModal:"vacation",editingVacation:t||null,modalContext:n?{staffId:n}:{}}),openBankHolidayModal:()=>e({activeModal:"bankHoliday"}),openSiteModal:()=>e({activeModal:"site"}),setActiveModal:t=>e({activeModal:t}),showTooltip:(t,n,r)=>e({tooltip:{visible:!0,content:t,x:n,y:r}}),hideTooltip:()=>e({tooltip:{visible:!1,content:"",x:0,y:0}}),startDrag:(t,n)=>e({isDragging:!0,dragType:t,dragItemId:n}),endDrag:()=>e({isDragging:!1,dragType:null,dragItemId:null}),startResize:(t,n,r)=>e({isResizing:!0,resizeItemType:t,resizeItemId:n,resizeEdge:r}),endResize:()=>e({isResizing:!1,resizeItemType:null,resizeItemId:null,resizeEdge:null}),showDragIndicator:(t,n,r)=>e({dragIndicator:{visible:!0,left:t,top:n,type:"drag",lagDays:r}}),showResizeIndicator:(t,n,r,a,i)=>e({dragIndicator:{visible:!0,left:t,top:n,type:"resize",date:r,duration:a,edge:i}}),hideIndicator:()=>e({dragIndicator:{visible:!1,left:0,top:0,type:"drag"}}),startLinking:(t,n,r,a)=>e({isLinkingDependency:!0,linkingFrom:{projectId:t,itemId:n,itemType:r,zone:a}}),completeLinking:()=>e({isLinkingDependency:!1,linkingFrom:null}),cancelLinking:()=>e({isLinkingDependency:!1,linkingFrom:null}),startPhantomSibling:t=>e({phantomSiblingMode:t}),updatePhantomPosition:(t,n)=>e(r=>({phantomSiblingMode:r.phantomSiblingMode?{...r.phantomSiblingMode,phantomStart:t,phantomEnd:n}:null})),endPhantomSibling:()=>e({phantomSiblingMode:null}),setLoading:(t,n="")=>e({isLoading:t,loadingMessage:n}),showContextMenu:(t,n,r,a,i,o,l,c)=>e({contextMenu:{visible:!0,x:r,y:a,type:t,targetId:n,projectId:i,phaseId:o,subphaseId:l,assignmentData:c}}),hideContextMenu:()=>e({contextMenu:{visible:!1,x:0,y:0,type:null,targetId:null,projectId:void 0,phaseId:void 0,subphaseId:void 0,assignmentData:void 0}}),triggerScrollToToday:()=>e(t=>({scrollToTodayTrigger:t.scrollToTodayTrigger+1})),triggerScrollToDate:t=>e({scrollToDateTrigger:{date:t,timestamp:Date.now()}}),clearScrollToDateTrigger:()=>e({scrollToDateTrigger:null}),triggerZoom:(t,n)=>e({zoomTrigger:{direction:t,newCellWidth:n,timestamp:Date.now()}}),clearZoomTrigger:()=>e({zoomTrigger:null}),startResourceDrag:(t,n,r)=>e({resourceDrag:{active:!0,type:t,resourceId:n,resourceName:r,targetProjectId:null,targetPhaseId:null,targetSubphaseId:null,previewStart:null,previewEnd:null}}),updateResourceDragTarget:(t,n,r,a,i)=>e(o=>({resourceDrag:{...o.resourceDrag,targetProjectId:t,targetPhaseId:n,targetSubphaseId:r,previewStart:a,previewEnd:i}})),endResourceDrag:()=>e({resourceDrag:{active:!1,type:null,resourceId:null,resourceName:null,targetProjectId:null,targetPhaseId:null,targetSubphaseId:null,previewStart:null,previewEnd:null}})})),Rg=vl()((e,t)=>({undoStack:[],redoStack:[],canUndo:!1,canRedo:!1,saveState:(n,r)=>{e(a=>{const i={projects:structuredClone(n),description:r,timestamp:Date.now()};return{undoStack:[...a.undoStack,i].slice(-50),redoStack:[],canUndo:!0,canRedo:!1}})},undo:()=>{const{undoStack:n,redoStack:r}=t();if(n.length===0)return null;const a=n[n.length-1],i=n.slice(0,-1);return e({undoStack:i,redoStack:[...r,a],canUndo:i.length>0,canRedo:!0}),i.length>0?i[i.length-1].projects:null},redo:()=>{const{undoStack:n,redoStack:r}=t();if(r.length===0)return null;const a=r[r.length-1],i=r.slice(0,-1);return e({undoStack:[...n,a],redoStack:i,canUndo:!0,canRedo:i.length>0}),a.projects},clear:()=>{e({undoStack:[],redoStack:[],canUndo:!1,canRedo:!1})}})),Og=6048e5,t0=864e5,Fg=6e4,zg=36e5,mh=Symbol.for("constructDateFrom");function fn(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&mh in e?e[mh](t):e instanceof Date?new e.constructor(t):new Date(t)}function wt(e,t){return fn(t||e,e)}function kn(e,t,n){const r=wt(e,n==null?void 0:n.in);return isNaN(t)?fn(e,NaN):(t&&r.setDate(r.getDate()+t),r)}function Zn(e,t,n){const r=wt(e,n==null?void 0:n.in);if(isNaN(t))return fn(e,NaN);if(!t)return r;const a=r.getDate(),i=fn(e,r.getTime());i.setMonth(r.getMonth()+t+1,0);const o=i.getDate();return a>=o?i:(r.setFullYear(i.getFullYear(),i.getMonth(),a),r)}function Hg(e,t){const n=wt(e,t==null?void 0:t.in).getDay();return n===0||n===6}let n0={};function Sl(){return n0}function Qs(e,t){var l,c,d,h;const n=Sl(),r=(t==null?void 0:t.weekStartsOn)??((c=(l=t==null?void 0:t.locale)==null?void 0:l.options)==null?void 0:c.weekStartsOn)??n.weekStartsOn??((h=(d=n.locale)==null?void 0:d.options)==null?void 0:h.weekStartsOn)??0,a=wt(e,t==null?void 0:t.in),i=a.getDay(),o=(i<r?7:0)+i-r;return a.setDate(a.getDate()-o),a.setHours(0,0,0,0),a}function Vo(e,t){return Qs(e,{...t,weekStartsOn:1})}function qg(e,t){const n=wt(e,t==null?void 0:t.in),r=n.getFullYear(),a=fn(n,0);a.setFullYear(r+1,0,4),a.setHours(0,0,0,0);const i=Vo(a),o=fn(n,0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);const l=Vo(o);return n.getTime()>=i.getTime()?r+1:n.getTime()>=l.getTime()?r:r-1}function ph(e){const t=wt(e),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+e-+n}function Cl(e,...t){const n=fn.bind(null,t.find(r=>typeof r=="object"));return t.map(n)}function Uo(e,t){const n=wt(e,t==null?void 0:t.in);return n.setHours(0,0,0,0),n}function Wg(e,t,n){const[r,a]=Cl(n==null?void 0:n.in,e,t),i=Uo(r),o=Uo(a),l=+i-ph(i),c=+o-ph(o);return Math.round((l-c)/t0)}function s0(e,t){const n=qg(e,t),r=fn(e,0);return r.setFullYear(n,0,4),r.setHours(0,0,0,0),Vo(r)}function $u(e,t,n){return kn(e,t*7,n)}function r0(e,t,n){const[r,a]=Cl(n==null?void 0:n.in,e,t);return+Uo(r)==+Uo(a)}function a0(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function i0(e){return!(!a0(e)&&typeof e!="number"||isNaN(+wt(e)))}function Us(e,t,n){const[r,a]=Cl(n==null?void 0:n.in,e,t),i=gh(r,a),o=Math.abs(Wg(r,a));r.setDate(r.getDate()-i*o);const l=+(gh(r,a)===-i),c=i*(o-l);return c===0?0:c}function gh(e,t){const n=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return n<0?-1:n>0?1:n}function o0(e,t){const n=wt(e,t==null?void 0:t.in),r=n.getMonth();return n.setFullYear(n.getFullYear(),r+1,0),n.setHours(23,59,59,999),n}function l0(e,t){const[n,r]=Cl(e,t.start,t.end);return{start:n,end:r}}function c0(e,t){const{start:n,end:r}=l0(t==null?void 0:t.in,e);let a=+n>+r;const i=a?+n:+r,o=a?r:n;o.setHours(0,0,0,0);let l=1;const c=[];for(;+o<=i;)c.push(fn(n,o)),o.setDate(o.getDate()+l),o.setHours(0,0,0,0);return a?c.reverse():c}function Vg(e,t){const n=wt(e,t==null?void 0:t.in),r=n.getMonth(),a=r-r%3;return n.setMonth(a,1),n.setHours(0,0,0,0),n}function d0(e,t){const n=wt(e,t==null?void 0:t.in);return n.setDate(1),n.setHours(0,0,0,0),n}function u0(e,t){const n=wt(e,t==null?void 0:t.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}const f0={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},h0=(e,t,n)=>{let r;const a=f0[e];return typeof a=="string"?r=a:t===1?r=a.one:r=a.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function sc(e){return(t={})=>{const n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}const m0={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},p0={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},g0={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},_0={date:sc({formats:m0,defaultWidth:"full"}),time:sc({formats:p0,defaultWidth:"full"}),dateTime:sc({formats:g0,defaultWidth:"full"})},y0={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},v0=(e,t,n,r)=>y0[e];function Ta(e){return(t,n)=>{const r=n!=null&&n.context?String(n.context):"standalone";let a;if(r==="formatting"&&e.formattingValues){const o=e.defaultFormattingWidth||e.defaultWidth,l=n!=null&&n.width?String(n.width):o;a=e.formattingValues[l]||e.formattingValues[o]}else{const o=e.defaultWidth,l=n!=null&&n.width?String(n.width):e.defaultWidth;a=e.values[l]||e.values[o]}const i=e.argumentCallback?e.argumentCallback(t):t;return a[i]}}const x0={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},w0={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},j0={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},S0={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},C0={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},k0={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},b0=(e,t)=>{const n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},N0={ordinalNumber:b0,era:Ta({values:x0,defaultWidth:"wide"}),quarter:Ta({values:w0,defaultWidth:"wide",argumentCallback:e=>e-1}),month:Ta({values:j0,defaultWidth:"wide"}),day:Ta({values:S0,defaultWidth:"wide"}),dayPeriod:Ta({values:C0,defaultWidth:"wide",formattingValues:k0,defaultFormattingWidth:"wide"})};function Ma(e){return(t,n={})=>{const r=n.width,a=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],i=t.match(a);if(!i)return null;const o=i[0],l=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?$0(l,m=>m.test(o)):D0(l,m=>m.test(o));let d;d=e.valueCallback?e.valueCallback(c):c,d=n.valueCallback?n.valueCallback(d):d;const h=t.slice(o.length);return{value:d,rest:h}}}function D0(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return n}function $0(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n}function E0(e){return(t,n={})=>{const r=t.match(e.matchPattern);if(!r)return null;const a=r[0],i=t.match(e.parsePattern);if(!i)return null;let o=e.valueCallback?e.valueCallback(i[0]):i[0];o=n.valueCallback?n.valueCallback(o):o;const l=t.slice(a.length);return{value:o,rest:l}}}const T0=/^(\d+)(th|st|nd|rd)?/i,M0=/\d+/i,I0={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},P0={any:[/^b/i,/^(a|c)/i]},L0={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},A0={any:[/1/i,/2/i,/3/i,/4/i]},B0={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},R0={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},O0={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},F0={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},z0={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},H0={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},q0={ordinalNumber:E0({matchPattern:T0,parsePattern:M0,valueCallback:e=>parseInt(e,10)}),era:Ma({matchPatterns:I0,defaultMatchWidth:"wide",parsePatterns:P0,defaultParseWidth:"any"}),quarter:Ma({matchPatterns:L0,defaultMatchWidth:"wide",parsePatterns:A0,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Ma({matchPatterns:B0,defaultMatchWidth:"wide",parsePatterns:R0,defaultParseWidth:"any"}),day:Ma({matchPatterns:O0,defaultMatchWidth:"wide",parsePatterns:F0,defaultParseWidth:"any"}),dayPeriod:Ma({matchPatterns:z0,defaultMatchWidth:"any",parsePatterns:H0,defaultParseWidth:"any"})},W0={code:"en-US",formatDistance:h0,formatLong:_0,formatRelative:v0,localize:N0,match:q0,options:{weekStartsOn:0,firstWeekContainsDate:1}};function V0(e,t){const n=wt(e,t==null?void 0:t.in);return Wg(n,u0(n))+1}function U0(e,t){const n=wt(e,t==null?void 0:t.in),r=+Vo(n)-+s0(n);return Math.round(r/Og)+1}function Ug(e,t){var h,m,g,_;const n=wt(e,t==null?void 0:t.in),r=n.getFullYear(),a=Sl(),i=(t==null?void 0:t.firstWeekContainsDate)??((m=(h=t==null?void 0:t.locale)==null?void 0:h.options)==null?void 0:m.firstWeekContainsDate)??a.firstWeekContainsDate??((_=(g=a.locale)==null?void 0:g.options)==null?void 0:_.firstWeekContainsDate)??1,o=fn((t==null?void 0:t.in)||e,0);o.setFullYear(r+1,0,i),o.setHours(0,0,0,0);const l=Qs(o,t),c=fn((t==null?void 0:t.in)||e,0);c.setFullYear(r,0,i),c.setHours(0,0,0,0);const d=Qs(c,t);return+n>=+l?r+1:+n>=+d?r:r-1}function G0(e,t){var l,c,d,h;const n=Sl(),r=(t==null?void 0:t.firstWeekContainsDate)??((c=(l=t==null?void 0:t.locale)==null?void 0:l.options)==null?void 0:c.firstWeekContainsDate)??n.firstWeekContainsDate??((h=(d=n.locale)==null?void 0:d.options)==null?void 0:h.firstWeekContainsDate)??1,a=Ug(e,t),i=fn((t==null?void 0:t.in)||e,0);return i.setFullYear(a,0,r),i.setHours(0,0,0,0),Qs(i,t)}function Eu(e,t){const n=wt(e,t==null?void 0:t.in),r=+Qs(n,t)-+G0(n,t);return Math.round(r/Og)+1}function Be(e,t){const n=e<0?"-":"",r=Math.abs(e).toString().padStart(t,"0");return n+r}const ys={y(e,t){const n=e.getFullYear(),r=n>0?n:1-n;return Be(t==="yy"?r%100:r,t.length)},M(e,t){const n=e.getMonth();return t==="M"?String(n+1):Be(n+1,2)},d(e,t){return Be(e.getDate(),t.length)},a(e,t){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(e,t){return Be(e.getHours()%12||12,t.length)},H(e,t){return Be(e.getHours(),t.length)},m(e,t){return Be(e.getMinutes(),t.length)},s(e,t){return Be(e.getSeconds(),t.length)},S(e,t){const n=t.length,r=e.getMilliseconds(),a=Math.trunc(r*Math.pow(10,n-3));return Be(a,t.length)}},$r={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},_h={G:function(e,t,n){const r=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if(t==="yo"){const r=e.getFullYear(),a=r>0?r:1-r;return n.ordinalNumber(a,{unit:"year"})}return ys.y(e,t)},Y:function(e,t,n,r){const a=Ug(e,r),i=a>0?a:1-a;if(t==="YY"){const o=i%100;return Be(o,2)}return t==="Yo"?n.ordinalNumber(i,{unit:"year"}):Be(i,t.length)},R:function(e,t){const n=qg(e);return Be(n,t.length)},u:function(e,t){const n=e.getFullYear();return Be(n,t.length)},Q:function(e,t,n){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return Be(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return Be(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){const r=e.getMonth();switch(t){case"M":case"MM":return ys.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){const r=e.getMonth();switch(t){case"L":return String(r+1);case"LL":return Be(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){const a=Eu(e,r);return t==="wo"?n.ordinalNumber(a,{unit:"week"}):Be(a,t.length)},I:function(e,t,n){const r=U0(e);return t==="Io"?n.ordinalNumber(r,{unit:"week"}):Be(r,t.length)},d:function(e,t,n){return t==="do"?n.ordinalNumber(e.getDate(),{unit:"date"}):ys.d(e,t)},D:function(e,t,n){const r=V0(e);return t==="Do"?n.ordinalNumber(r,{unit:"dayOfYear"}):Be(r,t.length)},E:function(e,t,n){const r=e.getDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){const a=e.getDay(),i=(a-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(i);case"ee":return Be(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(a,{width:"short",context:"formatting"});case"eeee":default:return n.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){const a=e.getDay(),i=(a-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(i);case"cc":return Be(i,t.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(a,{width:"narrow",context:"standalone"});case"cccccc":return n.day(a,{width:"short",context:"standalone"});case"cccc":default:return n.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,n){const r=e.getDay(),a=r===0?7:r;switch(t){case"i":return String(a);case"ii":return Be(a,t.length);case"io":return n.ordinalNumber(a,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){const a=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,t,n){const r=e.getHours();let a;switch(r===12?a=$r.noon:r===0?a=$r.midnight:a=r/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,n){const r=e.getHours();let a;switch(r>=17?a=$r.evening:r>=12?a=$r.afternoon:r>=4?a=$r.morning:a=$r.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,n){if(t==="ho"){let r=e.getHours()%12;return r===0&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return ys.h(e,t)},H:function(e,t,n){return t==="Ho"?n.ordinalNumber(e.getHours(),{unit:"hour"}):ys.H(e,t)},K:function(e,t,n){const r=e.getHours()%12;return t==="Ko"?n.ordinalNumber(r,{unit:"hour"}):Be(r,t.length)},k:function(e,t,n){let r=e.getHours();return r===0&&(r=24),t==="ko"?n.ordinalNumber(r,{unit:"hour"}):Be(r,t.length)},m:function(e,t,n){return t==="mo"?n.ordinalNumber(e.getMinutes(),{unit:"minute"}):ys.m(e,t)},s:function(e,t,n){return t==="so"?n.ordinalNumber(e.getSeconds(),{unit:"second"}):ys.s(e,t)},S:function(e,t){return ys.S(e,t)},X:function(e,t,n){const r=e.getTimezoneOffset();if(r===0)return"Z";switch(t){case"X":return vh(r);case"XXXX":case"XX":return lr(r);case"XXXXX":case"XXX":default:return lr(r,":")}},x:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"x":return vh(r);case"xxxx":case"xx":return lr(r);case"xxxxx":case"xxx":default:return lr(r,":")}},O:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+yh(r,":");case"OOOO":default:return"GMT"+lr(r,":")}},z:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+yh(r,":");case"zzzz":default:return"GMT"+lr(r,":")}},t:function(e,t,n){const r=Math.trunc(+e/1e3);return Be(r,t.length)},T:function(e,t,n){return Be(+e,t.length)}};function yh(e,t=""){const n=e>0?"-":"+",r=Math.abs(e),a=Math.trunc(r/60),i=r%60;return i===0?n+String(a):n+String(a)+t+Be(i,2)}function vh(e,t){return e%60===0?(e>0?"-":"+")+Be(Math.abs(e)/60,2):lr(e,t)}function lr(e,t=""){const n=e>0?"-":"+",r=Math.abs(e),a=Be(Math.trunc(r/60),2),i=Be(r%60,2);return n+a+t+i}const xh=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Gg=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Y0=(e,t)=>{const n=e.match(/(P+)(p+)?/)||[],r=n[1],a=n[2];if(!a)return xh(e,t);let i;switch(r){case"P":i=t.dateTime({width:"short"});break;case"PP":i=t.dateTime({width:"medium"});break;case"PPP":i=t.dateTime({width:"long"});break;case"PPPP":default:i=t.dateTime({width:"full"});break}return i.replace("{{date}}",xh(r,t)).replace("{{time}}",Gg(a,t))},Q0={p:Gg,P:Y0},X0=/^D+$/,K0=/^Y+$/,Z0=["D","DD","YY","YYYY"];function J0(e){return X0.test(e)}function e2(e){return K0.test(e)}function t2(e,t,n){const r=n2(e,t,n);if(console.warn(r),Z0.includes(e))throw new RangeError(r)}function n2(e,t,n){const r=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const s2=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,r2=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,a2=/^'([^]*?)'?$/,i2=/''/g,o2=/[a-zA-Z]/;function Ie(e,t,n){var h,m,g,_;const r=Sl(),a=r.locale??W0,i=r.firstWeekContainsDate??((m=(h=r.locale)==null?void 0:h.options)==null?void 0:m.firstWeekContainsDate)??1,o=r.weekStartsOn??((_=(g=r.locale)==null?void 0:g.options)==null?void 0:_.weekStartsOn)??0,l=wt(e,n==null?void 0:n.in);if(!i0(l))throw new RangeError("Invalid time value");let c=t.match(r2).map(y=>{const u=y[0];if(u==="p"||u==="P"){const w=Q0[u];return w(y,a.formatLong)}return y}).join("").match(s2).map(y=>{if(y==="''")return{isToken:!1,value:"'"};const u=y[0];if(u==="'")return{isToken:!1,value:l2(y)};if(_h[u])return{isToken:!0,value:y};if(u.match(o2))throw new RangeError("Format string contains an unescaped latin alphabet character `"+u+"`");return{isToken:!1,value:y}});a.localize.preprocessor&&(c=a.localize.preprocessor(l,c));const d={firstWeekContainsDate:i,weekStartsOn:o,locale:a};return c.map(y=>{if(!y.isToken)return y.value;const u=y.value;(e2(u)||J0(u))&&t2(u,t,String(e));const w=_h[u[0]];return w(l,u,a.localize,d)}).join("")}function l2(e){const t=e.match(a2);return t?t[1].replace(i2,"'"):e}function ps(e,t){const n=()=>fn(t==null?void 0:t.in,NaN),a=f2(e);let i;if(a.date){const d=h2(a.date,2);i=m2(d.restDateString,d.year)}if(!i||isNaN(+i))return n();const o=+i;let l=0,c;if(a.time&&(l=p2(a.time),isNaN(l)))return n();if(a.timezone){if(c=g2(a.timezone),isNaN(c))return n()}else{const d=new Date(o+l),h=wt(0,t==null?void 0:t.in);return h.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),h.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),h}return wt(o+l+c,t==null?void 0:t.in)}const Zi={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},c2=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,d2=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,u2=/^([+-])(\d{2})(?::?(\d{2}))?$/;function f2(e){const t={},n=e.split(Zi.dateTimeDelimiter);let r;if(n.length>2)return t;if(/:/.test(n[0])?r=n[0]:(t.date=n[0],r=n[1],Zi.timeZoneDelimiter.test(t.date)&&(t.date=e.split(Zi.timeZoneDelimiter)[0],r=e.substr(t.date.length,e.length))),r){const a=Zi.timezone.exec(r);a?(t.time=r.replace(a[1],""),t.timezone=a[1]):t.time=r}return t}function h2(e,t){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),r=e.match(n);if(!r)return{year:NaN,restDateString:""};const a=r[1]?parseInt(r[1]):null,i=r[2]?parseInt(r[2]):null;return{year:i===null?a:i*100,restDateString:e.slice((r[1]||r[2]).length)}}function m2(e,t){if(t===null)return new Date(NaN);const n=e.match(c2);if(!n)return new Date(NaN);const r=!!n[4],a=Ia(n[1]),i=Ia(n[2])-1,o=Ia(n[3]),l=Ia(n[4]),c=Ia(n[5])-1;if(r)return w2(t,l,c)?_2(t,l,c):new Date(NaN);{const d=new Date(0);return!v2(t,i,o)||!x2(t,a)?new Date(NaN):(d.setUTCFullYear(t,i,Math.max(a,o)),d)}}function Ia(e){return e?parseInt(e):1}function p2(e){const t=e.match(d2);if(!t)return NaN;const n=rc(t[1]),r=rc(t[2]),a=rc(t[3]);return j2(n,r,a)?n*zg+r*Fg+a*1e3:NaN}function rc(e){return e&&parseFloat(e.replace(",","."))||0}function g2(e){if(e==="Z")return 0;const t=e.match(u2);if(!t)return 0;const n=t[1]==="+"?-1:1,r=parseInt(t[2]),a=t[3]&&parseInt(t[3])||0;return S2(r,a)?n*(r*zg+a*Fg):NaN}function _2(e,t,n){const r=new Date(0);r.setUTCFullYear(e,0,4);const a=r.getUTCDay()||7,i=(t-1)*7+n+1-a;return r.setUTCDate(r.getUTCDate()+i),r}const y2=[31,null,31,30,31,30,31,31,30,31,30,31];function Yg(e){return e%400===0||e%4===0&&e%100!==0}function v2(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(y2[t]||(Yg(e)?29:28))}function x2(e,t){return t>=1&&t<=(Yg(e)?366:365)}function w2(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function j2(e,t,n){return e===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}function S2(e,t){return t>=0&&t<=59}const kl={week:{before:26,after:52},month:{after:36},quarter:{after:16},year:{before:3,after:7}};function Ni(e,t,n,r){const a=new Date;a.setHours(0,0,0,0);const i=o=>{const l=Ie(o,"yyyy-MM-dd"),c=r.find(d=>d.date===l);return c==null?void 0:c.name};switch(t){case"week":return C2(e,a,n,i);case"month":return k2(e,a,n,i);case"quarter":return b2(e,a,n,i);case"year":return N2(e);default:return[]}}function C2(e,t,n,r){const a=[],{before:i,after:o}=kl.week,l=Qs(e,{weekStartsOn:1}),c=$u(l,-i),h=(i+o+1)*7;for(let m=0;m<h;m++){const g=kn(c,m);a.push(Tu(g,t,n,r))}return a}function k2(e,t,n,r){const a=[],{after:i}=kl.month,o=d0(e),l=Zn(o,-12),c=o0(Zn(o,i));let d=l;for(;d<=c;)a.push(Tu(d,t,n,r)),d=kn(d,1);return a}function b2(e,t,n,r){const a=[],{after:i}=kl.quarter,o=Vg(e),l=Zn(o,-8*3),c=Zn(o,(i+1)*3);let d=Qs(l,{weekStartsOn:1});for(;d<c;){const h=kn(d,6),m=t>=d&&t<=h,g=Tu(d,t,n,r);g.dateEnd=h,g.isToday=m,a.push(g),d=$u(d,1)}return a}function N2(e,t,n,r){const a=[],{before:i,after:o}=kl.year,l=new Date(e.getFullYear(),0,1),c=Zn(l,-i*12),d=(i+o+1)*12;for(let h=0;h<d;h++){const m=Zn(c,h);a.push(D2(m))}return a}function D2(e){const t=Ie(e,"yyyy-MM-dd"),n=e.getDay(),r=new Date;r.setHours(0,0,0,0);const a=e.getFullYear()===r.getFullYear()&&e.getMonth()===r.getMonth();return{date:e,dateStr:t,label:Ie(e,"MMM"),isToday:a,isWeekend:!1,isBankHoliday:!1,bankHolidayName:void 0,dayOfWeek:n,isFirstOfWeek:e.getDate()<=7&&n===1,isFirstOfMonth:!0,weekNumber:Eu(e,{weekStartsOn:1}),monthLabel:Ie(e,"MMM"),yearLabel:Ie(e,"yyyy")}}function Tu(e,t,n,r){const a=Ie(e,"yyyy-MM-dd"),i=e.getDay();return{date:e,dateStr:a,label:Ie(e,"d"),isToday:r0(e,t),isWeekend:Hg(e),isBankHoliday:n.has(a),bankHolidayName:r(e),dayOfWeek:i,isFirstOfWeek:i===1,isFirstOfMonth:e.getDate()===1,weekNumber:Eu(e,{weekStartsOn:1}),monthLabel:Ie(e,"MMM"),yearLabel:Ie(e,"yyyy")}}function Di(e,t){switch(t){case"week":return{primary:wh(e),secondary:jh(e)};case"month":return{primary:wh(e),secondary:jh(e)};case"quarter":return{primary:$2(e),secondary:E2(e)};case"year":return{primary:T2(e),secondary:M2(e)};default:return{primary:[],secondary:[]}}}function wh(e){const t=[];let n="",r=0;const a=new Date;return e.forEach((i,o)=>{const l=`${i.yearLabel}-${i.monthLabel}`;l!==n?(r>0&&t.push({label:n.split("-")[1]+" "+n.split("-")[0],span:r,isCurrentPeriod:!1}),n=l,r=1):r++,o===e.length-1&&t.push({label:n.split("-")[1]+" "+n.split("-")[0],span:r,isCurrentPeriod:Ie(a,"yyyy-MMM")===n})}),t}function jh(e){return e.map(t=>({label:t.label,span:1,isCurrentPeriod:t.isToday}))}function $2(e){const t=[];let n="",r=0;return e.forEach((a,i)=>{const l=`Q${Math.floor(a.date.getMonth()/3)+1} ${a.yearLabel}`;l!==n?(r>0&&t.push({label:n,span:r,isCurrentPeriod:!1}),n=l,r=1):r++,i===e.length-1&&t.push({label:n,span:r,isCurrentPeriod:!1})}),t}function E2(e){return e.map(t=>({label:`W${t.weekNumber}`,span:1,isCurrentPeriod:t.isToday}))}function T2(e){const t=[];let n="",r=0;const a=new Date().getFullYear().toString();return e.forEach((i,o)=>{i.yearLabel!==n?(r>0&&t.push({label:n,span:r,isCurrentPeriod:n===a}),n=i.yearLabel,r=1):r++,o===e.length-1&&t.push({label:n,span:r,isCurrentPeriod:n===a})}),t}function M2(e){const n=Ie(new Date,"yyyy-MM");return e.map(r=>({label:r.monthLabel,span:1,isCurrentPeriod:Ie(r.date,"yyyy-MM")===n}))}function sn(e,t,n,r,a){if(!n.length||!e||!t)return null;const i=String(e).split("T")[0],o=String(t).split("T")[0],l=new Date(i+"T00:00:00"),c=new Date(o+"T23:59:59.999");if(isNaN(l.getTime())||isNaN(c.getTime()))return null;const d=new Date(n[0].date);d.setHours(0,0,0,0);let h;const m=n[n.length-1];if(a==="quarter"&&m.dateEnd?(h=new Date(m.dateEnd),h.setHours(23,59,59,999)):a==="year"?(h=new Date(m.date),h=new Date(h.getFullYear(),h.getMonth()+1,0,23,59,59,999)):(h=new Date(m.date),h.setHours(23,59,59,999)),c<d||l>h)return null;const g=h.getTime()-d.getTime(),_=n.length*r,u=(Math.max(d.getTime(),l.getTime())-d.getTime())/g*_,p=(Math.min(h.getTime(),c.getTime())-d.getTime())/g*_,x=Math.max(20,p-u);return{left:u,width:x}}function bl(e,t){const n=e.findIndex(r=>r.isToday);return n===-1?null:n*t+t/2}function I2(e){const t=[];return e.forEach(n=>{(n.phases??[]).forEach(r=>{(r.dependencies??[]).forEach(a=>{const{item:i,type:o}=Xg(n,a.id);i&&t.push({id:`dep-${o}-${a.id}-phase-${r.id}`,fromId:a.id,fromType:o,toId:r.id,toType:"phase",type:a.type||"FS",lag:a.lag??0,projectId:n.id})}),Qg(n,r.children??[],t)})}),t}function Qg(e,t,n){t.forEach(r=>{var a;(r.dependencies??[]).forEach(i=>{const{item:o,type:l}=Xg(e,i.id);o&&n.push({id:`dep-${l}-${i.id}-subphase-${r.id}`,fromId:i.id,fromType:l,toId:r.id,toType:"subphase",type:i.type||"FS",lag:i.lag??0,projectId:e.id})}),(a=r.children)!=null&&a.length&&Qg(e,r.children,n)})}function Xg(e,t){const n=(e.phases??[]).find(r=>r.id===t);if(n)return{item:n,type:"phase"};for(const r of e.phases??[]){const a=Kg(r.children??[],t);if(a)return{item:a,type:"subphase"}}return{item:null,type:"subphase"}}function Kg(e,t){var n;for(const r of e){if(r.id===t)return r;if((n=r.children)!=null&&n.length){const a=Kg(r.children,t);if(a)return a}}return null}const P2={FS:{dashArray:"",description:"Finish-to-Start (solid)"},SS:{dashArray:"6,3",description:"Start-to-Start (long dash)"},FF:{dashArray:"4,2",description:"Finish-to-Finish (short dash)"},SF:{dashArray:"2,2",description:"Start-to-Finish (dotted)"}},Zg=5;function gn(e,t,n,r,a=Zg){const i=a,o={"right-down":{dx1:-i,dy1:0,dx2:0,dy2:i,sweep:1},"right-up":{dx1:-i,dy1:0,dx2:0,dy2:-i,sweep:0},"left-down":{dx1:i,dy1:0,dx2:0,dy2:i,sweep:0},"left-up":{dx1:i,dy1:0,dx2:0,dy2:-i,sweep:1},"down-right":{dx1:0,dy1:-i,dx2:i,dy2:0,sweep:0},"down-left":{dx1:0,dy1:-i,dx2:-i,dy2:0,sweep:1},"up-right":{dx1:0,dy1:i,dx2:i,dy2:0,sweep:1},"up-left":{dx1:0,dy1:i,dx2:-i,dy2:0,sweep:0}},l=`${n}-${r}`,c=o[l];if(!c)return`L ${e} ${t}`;const d=e+c.dx1,h=t+c.dy1,m=e+c.dx2,g=t+c.dy2;return`L ${d} ${h} A ${i} ${i} 0 0 ${c.sweep} ${m} ${g}`}function L2(e,t,n,r,a){const o=Zg,l=r>t?"down":"up";if(a==="FS")if(n>e+15){const c=e+(n-e)/2;return Math.abs(r-t)<o*2?`M ${e} ${t} H ${c} V ${r} H ${n}`:`M ${e} ${t} H ${c-o} ${gn(c,t,"right",l,o)} V ${r-(r>t?o:-o)} ${gn(c,r,l,"right",o)} H ${n}`}else{const c=t+(r>t?20:-20),d=Math.min(e,n)-15,h=e+15;if(Math.abs(c-t)<o*2||Math.abs(r-c)<o*2)return`M ${e} ${t} H ${h} V ${c} H ${d} V ${r} H ${n}`;const m=c>t?"down":"up",g=r>c?"down":"up";return`M ${e} ${t} H ${h-o} ${gn(h,t,"right",m,o)} V ${c-(c>t?o:-o)} ${gn(h,c,m,"left",o)} H ${d+o} ${gn(d,c,"left",g,o)} V ${r-(r>c?o:-o)} ${gn(d,r,g,"right",o)} H ${n}`}if(a==="SS"){const c=Math.min(e,n)-15;return Math.abs(r-t)<o*2?`M ${e} ${t} H ${c} V ${r} H ${n}`:`M ${e} ${t} H ${c+o} ${gn(c,t,"left",l,o)} V ${r-(r>t?o:-o)} ${gn(c,r,l,"right",o)} H ${n}`}if(a==="FF"){const c=Math.max(e,n)+15;return Math.abs(r-t)<o*2?`M ${e} ${t} H ${c} V ${r} H ${n}`:`M ${e} ${t} H ${c-o} ${gn(c,t,"right",l,o)} V ${r-(r>t?o:-o)} ${gn(c,r,l,"left",o)} H ${n}`}if(a==="SF")if(n<e-15){const c=e-(e-n)/2;return Math.abs(r-t)<o*2?`M ${e} ${t} H ${c} V ${r} H ${n}`:`M ${e} ${t} H ${c+o} ${gn(c,t,"left",l,o)} V ${r-(r>t?o:-o)} ${gn(c,r,l,"left",o)} H ${n}`}else{const c=Math.min(e,n)-15,d=Math.max(e,n)+15,h=t+(r>t?20:-20);return`M ${e} ${t} H ${c} V ${h} H ${d} V ${r} H ${n}`}return`M ${e} ${t} L ${n} ${r}`}function A2(e){switch(e){case"FS":return{sourceEdge:"end",targetEdge:"start"};case"SS":return{sourceEdge:"start",targetEdge:"start"};case"FF":return{sourceEdge:"end",targetEdge:"end"};case"SF":return{sourceEdge:"start",targetEdge:"end"};default:return{sourceEdge:"end",targetEdge:"start"}}}const Go=32,Sh=45,Qn=33;function B2(e,t,n,r,a,i=!0,o,l){const c=new Map;let d=0,h;const m=(g,_,y)=>{if(!o)return!0;const u=o(g,_),w=l&&(y!=null&&y.length)?l(y):!1;return u||w};return e.forEach(g=>{var y,u;const _=d;if(c.set(`project-${g.id}`,{top:_,height:Sh}),d+=Sh,t.has(g.id)&&((g.phases??[]).forEach(w=>{var x,v;if(!m("phase",w.id,w.children))return;const p=d;if(c.set(`phase-${w.id}`,{top:p,height:Go}),d+=Qn,(a==null?void 0:a.type)==="phase"&&a.projectId===g.id&&a.sourceId===w.id&&(h=d,c.set("phantom",{top:d,height:Go}),d+=Qn),n.has(w.id)){const C=Jg(w.children??[],c,d,r,a,g.id,w.id,void 0,i,o,l);if(d=C.currentTop,C.phantomRowTop!==void 0&&(h=C.phantomRowTop),i){const N=((x=w.staffAssignments)==null?void 0:x.length)??0;d+=N*Qn;const b=((v=w.equipmentAssignments)==null?void 0:v.length)??0;d+=b*Qn}}}),i)){const w=((y=g.staffAssignments)==null?void 0:y.length)??0;d+=w*Qn;const p=((u=g.equipmentAssignments)==null?void 0:u.length)??0;d+=p*Qn}}),{positions:c,totalHeight:d,phantomRowTop:h}}function Jg(e,t,n,r,a,i,o,l,c=!0,d,h){let m;const g=(_,y)=>{if(!d)return!0;const u=d("subphase",_),w=h&&(y!=null&&y.length)?h(y):!1;return u||w};return e.forEach(_=>{var y,u,w;if(g(_.id,_.children)&&(t.set(`subphase-${_.id}`,{top:n,height:Go}),n+=Qn,(a==null?void 0:a.type)==="subphase"&&a.projectId===i&&a.sourceId===_.id&&(m=n,t.set("phantom",{top:n,height:Go}),n+=Qn),r.has(_.id))){if((y=_.children)!=null&&y.length){const p=Jg(_.children,t,n,r,a,i,o,_.id,c,d,h);n=p.currentTop,p.phantomRowTop!==void 0&&(m=p.phantomRowTop)}if(c){const p=((u=_.staffAssignments)==null?void 0:u.length)??0;n+=p*Qn;const x=((w=_.equipmentAssignments)==null?void 0:w.length)??0;n+=x*Qn}}}),{currentTop:n,phantomRowTop:m}}function $n(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}function gd(e,t,n){for(const r of e){const a=new Date(r.start_date),i=new Date(r.end_date),o=new Date(a);o.setDate(o.getDate()+t);const l=new Date(i);l.setDate(l.getDate()+t),r.start_date=$n(o),r.end_date=$n(l),n.push({type:"staffAssignment",id:r.id,start_date:r.start_date,end_date:r.end_date,allocation:r.allocation??100})}}function _d(e,t,n){for(const r of e){const a=new Date(r.start_date),i=new Date(r.end_date),o=new Date(a);o.setDate(o.getDate()+t);const l=new Date(i);l.setDate(l.getDate()+t),r.start_date=$n(o),r.end_date=$n(l),n.push({type:"equipmentAssignment",id:r.id,start_date:r.start_date,end_date:r.end_date})}}function Yo(e,t,n){var r,a,i;for(const o of e){const l=new Date(o.start_date),c=new Date(o.end_date),d=new Date(l);d.setDate(d.getDate()+t);const h=new Date(c);h.setDate(h.getDate()+t),o.start_date=$n(d),o.end_date=$n(h),n.push({type:"subphase",id:o.id,start_date:o.start_date,end_date:o.end_date}),(r=o.staffAssignments)!=null&&r.length&&gd(o.staffAssignments,t,n),(a=o.equipmentAssignments)!=null&&a.length&&_d(o.equipmentAssignments,t,n),(i=o.children)!=null&&i.length&&Yo(o.children,t,n)}}function R2(e,t,n){var r,a,i,o,l;for(const c of e.phases??[]){const d=new Date(c.start_date),h=new Date(c.end_date),m=new Date(d);m.setDate(m.getDate()+t);const g=new Date(h);g.setDate(g.getDate()+t),c.start_date=$n(m),c.end_date=$n(g),n.push({type:"phase",id:c.id,start_date:c.start_date,end_date:c.end_date}),(r=c.staffAssignments)!=null&&r.length&&gd(c.staffAssignments,t,n),(a=c.equipmentAssignments)!=null&&a.length&&_d(c.equipmentAssignments,t,n),(i=c.children)!=null&&i.length&&Yo(c.children,t,n)}(o=e.staffAssignments)!=null&&o.length&&gd(e.staffAssignments,t,n),(l=e.equipmentAssignments)!=null&&l.length&&_d(e.equipmentAssignments,t,n)}function Ch(e,t){for(const n of e.phases??[])for(const r of n.children??[]){if(r.id===t)return{parent:n,type:"phase"};const a=e_(r,t);if(a)return a}return null}function e_(e,t){for(const n of e.children??[]){if(n.id===t)return{parent:e,type:"subphase"};const r=e_(n,t);if(r)return r}return null}function t_(e,t,n){let r=t,a=Ch(e,r);for(;a;){const i=a.parent,o=i.children??[];if(o.length===0)break;let l=null,c=null;for(const g of o){const _=new Date(g.start_date),y=new Date(g.end_date);(!l||_<l)&&(l=_),(!c||y>c)&&(c=y)}if(!l||!c)break;const d=new Date(i.start_date),h=new Date(i.end_date);let m=!1;if(l.getTime()!==d.getTime()&&(i.start_date=$n(l),m=!0),c.getTime()!==h.getTime()&&(i.end_date=$n(c),m=!0),m&&n.push({type:a.type,id:i.id,start_date:i.start_date,end_date:i.end_date}),a.type==="phase"){Mu(e,n);break}else r=i.id,a=Ch(e,r)}}function Mu(e,t){const n=e.phases??[];if(n.length===0)return;let r=null,a=null;for(const l of n){const c=new Date(l.start_date),d=new Date(l.end_date);(!r||c<r)&&(r=c),(!a||d>a)&&(a=d)}if(!r||!a)return;const i=$n(r),o=$n(a);if(e.start_date!==i||e.end_date!==o){e.start_date=i,e.end_date=o;const l=t.findIndex(c=>c.type==="project"&&c.id===e.id);l>=0?(t[l].start_date=i,t[l].end_date=o):t.push({type:"project",id:e.id,start_date:i,end_date:o,name:e.name,pm_id:e.pm_id,customer:e.customer,sales_pm:e.sales_pm,volume:e.volume,confirmed:e.confirmed})}}async function Qo(e){const t=e.map(n=>n.type==="phase"?Js(n.id,{start_date:n.start_date,end_date:n.end_date}).catch(r=>console.error(`Failed to save phase ${n.id}:`,r)):n.type==="subphase"?er(n.id,{start_date:n.start_date,end_date:n.end_date}).catch(r=>console.error(`Failed to save subphase ${n.id}:`,r)):n.type==="project"?bi(n.id,{name:n.name,start_date:n.start_date,end_date:n.end_date,pm_id:n.pm_id,customer:n.customer,sales_pm:n.sales_pm,volume:n.volume,confirmed:n.confirmed}).catch(r=>console.error(`Failed to save project ${n.id}:`,r)):n.type==="staffAssignment"?xl(n.id,{start_date:n.start_date,end_date:n.end_date,allocation:n.allocation??100}).catch(r=>console.error(`Failed to save staff assignment ${n.id}:`,r)):n.type==="equipmentAssignment"?wl(n.id,{start_date:n.start_date,end_date:n.end_date}).catch(r=>console.error(`Failed to save equipment assignment ${n.id}:`,r)):Promise.resolve());await Promise.all(t)}function n_(e,t,n,r){const a=[];return Mu(e,a),a}function s_(e,t,n,r){const a=[];return t_(e,t,a),a}function Iu(e){return JSON.parse(JSON.stringify(e))}function O2(){const{isDragging:e,dragType:t,dragItemId:n,startDrag:r,endDrag:a,showDragIndicator:i,hideIndicator:o}=ee(),{projects:l,setProjects:c,cellWidth:d,currentView:h,viewMode:m}=O(),{saveState:g}=Rg(),_=f.useRef(null),y=f.useRef(0),u=f.useCallback(D=>{const k=D.getFullYear(),j=String(D.getMonth()+1).padStart(2,"0"),T=String(D.getDate()).padStart(2,"0");return`${k}-${j}-${T}`},[]),w=f.useCallback(()=>{const D=document.querySelectorAll("[data-date]");if(D.length===0)return null;const k=[];return D.forEach(j=>{const T=j.getAttribute("data-date"),E=j.getAttribute("data-date-end");T&&k.push({date:T,dateEnd:E||void 0})}),k.length>0?k:null},[]),p=f.useCallback((D,k,j,T)=>{if(k.length===0)return null;if(T==="week"||T==="month"){const Q=Math.round(D/j),X=Math.max(0,Math.min(k.length-1,Q));return k[X].date}const E=new Date(k[0].date);E.setHours(0,0,0,0);let $;const A=k[k.length-1];T==="quarter"&&A.dateEnd?($=new Date(A.dateEnd),$.setHours(23,59,59,999)):T==="year"?($=new Date(A.date),$=new Date($.getFullYear(),$.getMonth()+1,0,23,59,59,999)):($=new Date(A.date),$.setHours(23,59,59,999));const R=$.getTime()-E.getTime(),H=k.length*j,F=D/H*R,V=new Date(E.getTime()+F);return u(V)},[u]),x=f.useCallback((D,k,j)=>{const T=l.find(X=>X.id===k);if(!T)return null;const E=(T.phases??[]).find(X=>X.id===D);if(!E)return null;const $=E.dependencies??[];if($.length===0)return null;const A=new Date(E.start_date),H=new Date(E.end_date).getTime()-A.getTime(),F=new Date(j),V=new Date(F.getTime()+H);let Q=null;for(const X of $){const Z=(T.phases??[]).find(ae=>ae.id===X.id);if(!Z)continue;const ce=new Date(Z.start_date),K=new Date(Z.end_date);let fe;if(X.type==="SS")fe=Math.round((F.getTime()-ce.getTime())/864e5);else if(X.type==="FF")fe=Math.round((V.getTime()-K.getTime())/864e5);else if(X.type==="SF")fe=Math.round((V.getTime()-ce.getTime())/864e5);else{const ae=new Date(K);ae.setDate(ae.getDate()+1),fe=Math.round((F.getTime()-ae.getTime())/864e5)}(Q===null||fe<Q)&&(Q=fe)}return Q},[l]),v=f.useCallback((D,k)=>{var T;const j=E=>{var $;for(const A of E){if(A.id===k)return A;if(($=A.children)!=null&&$.length){const R=j(A.children);if(R)return R}}return null};for(const E of D.phases??[])if((T=E.children)!=null&&T.length){const $=j(E.children);if($)return $}return null},[]),C=f.useCallback((D,k,j)=>{const T=l.find(X=>X.id===k);if(!T)return null;const E=v(T,D);if(!E)return null;const $=E.dependencies??[];if($.length===0)return null;const A=new Date(E.start_date),H=new Date(E.end_date).getTime()-A.getTime(),F=new Date(j),V=new Date(F.getTime()+H);let Q=null;for(const X of $){const Z=v(T,X.id);if(!Z)continue;const ce=new Date(Z.start_date),K=new Date(Z.end_date);let fe;if(X.type==="SS")fe=Math.round((F.getTime()-ce.getTime())/864e5);else if(X.type==="FF")fe=Math.round((V.getTime()-K.getTime())/864e5);else if(X.type==="SF")fe=Math.round((V.getTime()-ce.getTime())/864e5);else{const ae=new Date(K);ae.setDate(ae.getDate()+1),fe=Math.round((F.getTime()-ae.getTime())/864e5)}(Q===null||fe<Q)&&(Q=fe)}return Q},[l,v]),N=f.useCallback(D=>{if(!_.current)return;y.current=D.clientX;const k=_.current,j=D.clientX-k.startX;let T=k.originalLeft+j;(m==="week"||m==="month")&&(T=Math.round(T/d)*d),k.element&&(k.element.style.left=`${T}px`,k.element.style.opacity="0.8",k.element.style.zIndex="1000");const E=w();if(E&&E.length>0&&k.element){const $=p(T,E,d,m);if($){const A=k.type==="phase"?x(k.id,k.projectId,$):C(k.id,k.projectId,$);if(A!==null){const R=k.element.closest('[class*="row"]');if(R){const H=R.offsetTop,F=k.element.offsetWidth,V=T+F/2,Q=H-22;i(V,Q,A)}}else o()}}},[d,m,w,p,x,C,i,o]),b=f.useCallback(async()=>{if(o(),!_.current){a();return}const D=_.current;D.element&&(D.element.style.opacity="1",D.element.style.zIndex="",D.element.classList.remove("dragging")),document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",b);const k=D.element?parseFloat(D.element.style.left)||0:D.originalLeft,j=k-D.originalLeft;if(Math.abs(j)<2){_.current=null,a();return}const T=w();if(!T||T.length===0){console.warn("Could not get timeline cells for date calculation");const X=Math.round(j/d),Z=(fe,ae)=>{const z=new Date(fe);return z.setDate(z.getDate()+ae),z.toISOString().split("T")[0]},ce=Z(D.originalStartDate,X),K=D.isMilestone?ce:Z(D.originalEndDate,X);await B(D,ce,K);return}const E=p(k,T,d,m);if(!E){console.warn("Could not calculate date from position"),_.current=null,a();return}const $=new Date(D.originalStartDate),A=new Date(D.originalEndDate);$.setHours(0,0,0,0),A.setHours(0,0,0,0);const R=Math.round((A.getTime()-$.getTime())/864e5),H=new Date(E);H.setHours(0,0,0,0);const F=new Date(H);F.setDate(F.getDate()+R);const V=u(H),Q=D.isMilestone?V:u(F);await B(D,V,Q)},[d,m,a,N,g,c,l,o]),B=f.useCallback(async(D,k,j)=>{var T,E,$,A,R,H;try{const F=l.findIndex(ae=>ae.id===D.projectId);if(F===-1){console.error("Project not found:",D.projectId),_.current=null,a();return}const V=new Date(D.originalStartDate).getTime(),Q=new Date(k).getTime(),X=Math.round((Q-V)/864e5);if(X===0){_.current=null,a();return}if(D.type==="project"){const z=((T=l[F].phases)==null?void 0:T.length)??0;if(!window.confirm(`Move project by ${X>0?"+":""}${X} days?

This will move all ${z} phase(s), their subphases, and all staff/equipment assignments.`)){D.element&&(D.element.style.left=`${D.originalLeft}px`,D.element.classList.remove("dragging")),_.current=null,a();return}}g(l,"drag");const Z=Iu(l[F]),ce=[];if(D.type==="project")Z.start_date=k,Z.end_date=j,X!==0&&R2(Z,X,ce);else if(D.type==="phase"){const ae=(Z.phases??[]).find(z=>z.id===D.id);ae&&(ae.start_date=k,ae.end_date=j,(E=ae.children)!=null&&E.length&&X!==0&&Yo(ae.children,X,ce))}else{const ae=z=>{var ue,Le;for(const q of z){if(q.id===D.id)return q.start_date=k,q.end_date=j,(ue=q.children)!=null&&ue.length&&X!==0&&Yo(q.children,X,ce),!0;if((Le=q.children)!=null&&Le.length&&ae(q.children))return!0}return!1};for(const z of Z.phases??[])if(($=z.children)!=null&&$.length&&ae(z.children))break}let K=[];if(D.type==="phase")K=n_(Z,D.id,D.originalEndDate,j);else if(D.type==="subphase")K=s_(Z,D.id,D.originalEndDate,j);else if(D.type==="staffAssignment"){const ae=(A=Z.staffAssignments)==null?void 0:A.find(z=>z.id===D.id);ae&&(ae.start_date=k,ae.end_date=j)}else if(D.type==="equipmentAssignment"){const ae=(R=Z.equipmentAssignments)==null?void 0:R.find(z=>z.id===D.id);ae&&(ae.start_date=k,ae.end_date=j)}K.push(...ce);const fe=l.map((ae,z)=>z===F?Z:ae);if(c(fe),D.type==="project")await bi(D.id,{start_date:k,end_date:j});else if(D.type==="phase")await Js(D.id,{start_date:k,end_date:j});else if(D.type==="subphase")await er(D.id,{start_date:k,end_date:j});else if(D.type==="staffAssignment"){const ae=(H=Z.staffAssignments)==null?void 0:H.find(z=>z.id===D.id);await xl(D.id,{start_date:k,end_date:j,allocation:(ae==null?void 0:ae.allocation)??100})}else D.type==="equipmentAssignment"&&await wl(D.id,{start_date:k,end_date:j});K.length>0&&(console.log(`Saving ${K.length} cascaded updates`),await Qo(K))}catch(F){console.error("Failed to update item:",F);const V=await ft();c(V)}_.current=null,a()},[g,c,l,a]),M=f.useCallback((D,k,j,T,E,$=!1,A)=>{var H,F;if(D.target.classList.contains("resize-handle")||h==="equipment"||h==="staff")return;D.preventDefault(),D.stopPropagation();let R=A||D.currentTarget;if((!R||!((H=R.classList)!=null&&H.contains("gantt-bar"))&&!((F=R.dataset)!=null&&F.phaseId))&&(R=D.target.closest("[data-phase-id]")),!R){console.warn("Could not find element for drag");return}_.current={id:k,type:"phase",projectId:j,startX:D.clientX,element:R,originalLeft:parseInt((R==null?void 0:R.style.left)||"0")||0,originalStartDate:T,originalEndDate:E,isMilestone:$},y.current=D.clientX,R&&R.classList.add("dragging"),r("phase",k),document.addEventListener("mousemove",N),document.addEventListener("mouseup",b)},[h,N,b,r]),L=f.useCallback((D,k,j,T,E,$,A=!1,R)=>{var F,V;if(D.target.classList.contains("resize-handle")||h==="equipment"||h==="staff")return;D.preventDefault(),D.stopPropagation();let H=R||D.currentTarget;if((!H||!((F=H.classList)!=null&&F.contains("gantt-bar"))&&!((V=H.dataset)!=null&&V.subphaseId))&&(H=D.target.closest("[data-subphase-id]")),!H){console.warn("Could not find element for subphase drag");return}_.current={id:k,type:"subphase",projectId:j,phaseId:T,startX:D.clientX,element:H,originalLeft:parseInt((H==null?void 0:H.style.left)||"0")||0,originalStartDate:E,originalEndDate:$,isMilestone:A},y.current=D.clientX,H&&H.classList.add("dragging"),r("subphase",k),document.addEventListener("mousemove",N),document.addEventListener("mouseup",b)},[h,N,b,r]),S=f.useCallback((D,k,j,T,E)=>{var A,R;if(D.target.classList.contains("resize-handle")||h==="equipment"||h==="staff")return;D.preventDefault(),D.stopPropagation();let $=E||D.currentTarget;if((!$||!((A=$.classList)!=null&&A.contains("gantt-bar"))&&!((R=$.dataset)!=null&&R.projectId))&&($=D.target.closest("[data-project-id]")),!$){console.warn("Could not find element for project drag");return}_.current={id:k,type:"project",projectId:k,startX:D.clientX,element:$,originalLeft:parseInt(($==null?void 0:$.style.left)||"0")||0,originalStartDate:j,originalEndDate:T,isMilestone:!1},y.current=D.clientX,$&&$.classList.add("dragging"),r("project",k),document.addEventListener("mousemove",N),document.addEventListener("mouseup",b)},[h,N,b,r]),P=f.useCallback((D,k,j,T,E,$)=>{var R;if(D.target.classList.contains("resize-handle")||h==="equipment"||h==="staff")return;D.preventDefault(),D.stopPropagation();let A=$||D.currentTarget;if((!A||!((R=A.dataset)!=null&&R.assignmentId))&&(A=D.target.closest("[data-assignment-id]")),!A){console.warn("Could not find element for staff assignment drag");return}_.current={id:k,type:"staffAssignment",projectId:j,startX:D.clientX,element:A,originalLeft:parseInt((A==null?void 0:A.style.left)||"0")||0,originalStartDate:T,originalEndDate:E,isMilestone:!1},y.current=D.clientX,A&&A.classList.add("dragging"),r("staffAssignment",k),document.addEventListener("mousemove",N),document.addEventListener("mouseup",b)},[h,N,b,r]),I=f.useCallback((D,k,j,T,E,$)=>{var R;if(D.target.classList.contains("resize-handle")||h==="equipment"||h==="staff")return;D.preventDefault(),D.stopPropagation();let A=$||D.currentTarget;if((!A||!((R=A.dataset)!=null&&R.assignmentId))&&(A=D.target.closest("[data-assignment-id]")),!A){console.warn("Could not find element for equipment assignment drag");return}_.current={id:k,type:"equipmentAssignment",projectId:j,startX:D.clientX,element:A,originalLeft:parseInt((A==null?void 0:A.style.left)||"0")||0,originalStartDate:T,originalEndDate:E,isMilestone:!1},y.current=D.clientX,A&&A.classList.add("dragging"),r("equipmentAssignment",k),document.addEventListener("mousemove",N),document.addEventListener("mouseup",b)},[h,N,b,r]);return f.useEffect(()=>()=>{document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",b)},[N,b]),{isDragging:e,dragType:t,dragItemId:n,startProjectDrag:S,startPhaseDrag:M,startSubphaseDrag:L,startStaffAssignmentDrag:P,startEquipmentAssignmentDrag:I}}function F2(){const{isResizing:e,resizeEdge:t,resizeItemId:n,resizeItemType:r,startResize:a,endResize:i,showResizeIndicator:o,hideIndicator:l}=ee(),{projects:c,setProjects:d,cellWidth:h,currentView:m,viewMode:g}=O(),{saveState:_}=Rg(),y=f.useRef(null),u=f.useRef(0),w=f.useCallback(L=>{const S=L.getFullYear(),P=String(L.getMonth()+1).padStart(2,"0"),I=String(L.getDate()).padStart(2,"0");return`${S}-${P}-${I}`},[]),p=f.useCallback(()=>{const L=document.querySelectorAll("[data-date]");if(L.length===0)return null;const S=[];return L.forEach(P=>{const I=P.getAttribute("data-date"),D=P.getAttribute("data-date-end");I&&S.push({date:I,dateEnd:D||void 0})}),S.length>0?S:null},[]),x=f.useCallback((L,S,P,I)=>{if(S.length===0)return null;if(I==="week"||I==="month"){const R=Math.round(L/P),H=Math.max(0,Math.min(S.length-1,R));return S[H].date}const D=new Date(S[0].date);D.setHours(0,0,0,0);let k;const j=S[S.length-1];I==="quarter"&&j.dateEnd?(k=new Date(j.dateEnd),k.setHours(23,59,59,999)):I==="year"?(k=new Date(j.date),k=new Date(k.getFullYear(),k.getMonth()+1,0,23,59,59,999)):(k=new Date(j.date),k.setHours(23,59,59,999));const T=k.getTime()-D.getTime(),E=S.length*P,$=L/E*T,A=new Date(D.getTime()+$);return w(A)},[w]),v=f.useCallback(L=>{if(!y.current)return;u.current=L.clientX;const S=y.current,P=L.clientX-S.startX;let I=S.originalLeft,D=S.originalWidth;S.element&&(S.edge==="left"?(I=S.originalLeft+P,D=S.originalWidth-P,D>=h&&(S.element.style.left=`${I}px`,S.element.style.width=`${D}px`)):(D=S.originalWidth+P,D>=h&&(S.element.style.width=`${D}px`)));const k=p();if(k&&k.length>0&&D>=h&&S.element){const j=S.edge==="left"?x(I,k,h,g):x(I+D,k,h,g);if(j){const T=S.edge==="left"?j:x(I,k,h,g)||S.originalStartDate,E=S.edge==="left"?x(I+D,k,h,g)||S.originalEndDate:j,$=new Date(T).getTime(),A=new Date(E).getTime(),R=Math.round((A-$)/864e5)+1,H=S.element.closest('[class*="row"]');if(H){const F=H.offsetTop,V=S.edge==="left"?I:I+D,Q=F-28;o(V,Q,j,R,S.edge)}}}},[h,g,o,p,x]),C=f.useCallback(async()=>{var E,$,A,R;if(l(),!y.current){i();return}const L=y.current;document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",C),document.body.style.cursor="",L.element&&L.element.classList.remove("resizing");const S=L.element?parseFloat(L.element.style.left)||0:L.originalLeft,P=L.element&&parseFloat(L.element.style.width)||L.originalWidth,I=Math.abs(S-L.originalLeft),D=Math.abs(P-L.originalWidth);if(I<2&&D<2){L.element&&(L.element.style.left=`${L.originalLeft}px`,L.element.style.width=`${L.originalWidth}px`),y.current=null,i();return}const k=p();let j=L.originalStartDate,T=L.originalEndDate;if(k&&k.length>0)if(L.edge==="left"){const H=x(S,k,h,g);if(H&&(j=H,new Date(j)>=new Date(T))){const F=new Date(T);F.setDate(F.getDate()-1),j=w(F)}}else{const H=S+P,F=x(H,k,h,g);if(F&&(T=F,new Date(T)<=new Date(j))){const V=new Date(j);V.setDate(V.getDate()+1),T=w(V)}}else{const H=u.current-L.startX;let F;switch(g){case"week":case"month":F=1;break;case"quarter":F=7;break;case"year":F=30;break;default:F=1}const V=Math.round(H/h*F),Q=(X,Z)=>{const ce=new Date(X);return ce.setDate(ce.getDate()+Z),ce.toISOString().split("T")[0]};L.edge==="left"?(j=Q(L.originalStartDate,V),new Date(j)>=new Date(T)&&(j=Q(T,-1))):(T=Q(L.originalEndDate,V),new Date(T)<=new Date(j)&&(T=Q(j,1)))}try{_(c,"resize");const H=c.findIndex(X=>X.id===L.projectId);if(H===-1){console.error("Project not found:",L.projectId),y.current=null,i();return}const F=Iu(c[H]);if(L.type==="phase"){const X=(F.phases??[]).find(Z=>Z.id===L.id);X&&(X.start_date=j,X.end_date=T)}else if(L.type==="subphase"){const X=Z=>{var ce;for(const K of Z){if(K.id===L.id)return K.start_date=j,K.end_date=T,!0;if((ce=K.children)!=null&&ce.length&&X(K.children))return!0}return!1};for(const Z of F.phases??[])if((E=Z.children)!=null&&E.length&&X(Z.children))break}else if(L.type==="staffAssignment"){const X=($=F.staffAssignments)==null?void 0:$.find(Z=>Z.id===L.id);X&&(X.start_date=j,X.end_date=T)}else if(L.type==="equipmentAssignment"){const X=(A=F.equipmentAssignments)==null?void 0:A.find(Z=>Z.id===L.id);X&&(X.start_date=j,X.end_date=T)}let V=[];L.type==="phase"?V=n_(F,L.id,L.originalEndDate,T):L.type==="subphase"&&(V=s_(F,L.id,L.originalEndDate,T));const Q=c.map((X,Z)=>Z===H?F:X);if(d(Q),L.type==="phase")await Js(L.id,{start_date:j,end_date:T});else if(L.type==="subphase")await er(L.id,{start_date:j,end_date:T});else if(L.type==="staffAssignment"){const X=(R=F.staffAssignments)==null?void 0:R.find(Z=>Z.id===L.id);await xl(L.id,{start_date:j,end_date:T,allocation:(X==null?void 0:X.allocation)??100})}else L.type==="equipmentAssignment"&&await wl(L.id,{start_date:j,end_date:T});V.length>0&&(console.log(`Cascading ${V.length} updates:`,V),await Qo(V))}catch(H){console.error("Failed to resize item:",H);const F=await ft();d(F)}y.current=null,i()},[h,g,i,v,_,d,c,l]),N=f.useCallback((L,S,P,I,D,k,j)=>{if(m==="equipment"||m==="staff")return;L.preventDefault(),L.stopPropagation();const T=j.getBoundingClientRect(),E=window.getComputedStyle(j);y.current={id:S,type:"phase",projectId:P,edge:I,startX:L.clientX,element:j,originalLeft:parseFloat(E.left)||0,originalWidth:T.width,originalStartDate:D,originalEndDate:k},u.current=L.clientX,j.classList.add("resizing"),document.body.style.cursor="ew-resize",a("phase",S,I),document.addEventListener("mousemove",v),document.addEventListener("mouseup",C)},[m,v,C,a]),b=f.useCallback((L,S,P,I,D,k,j)=>{if(m==="equipment"||m==="staff")return;L.preventDefault(),L.stopPropagation();const T=j.getBoundingClientRect(),E=window.getComputedStyle(j);y.current={id:S,type:"subphase",projectId:P,edge:I,startX:L.clientX,element:j,originalLeft:parseFloat(E.left)||0,originalWidth:T.width,originalStartDate:D,originalEndDate:k},u.current=L.clientX,j.classList.add("resizing"),document.body.style.cursor="ew-resize",a("subphase",S,I),document.addEventListener("mousemove",v),document.addEventListener("mouseup",C)},[m,v,C,a]),B=f.useCallback((L,S,P,I,D,k,j)=>{if(m==="equipment"||m==="staff")return;L.preventDefault(),L.stopPropagation();const T=j||L.currentTarget.closest("[data-assignment-id]");T&&(y.current={id:S,type:"staffAssignment",projectId:P,edge:I,startX:L.clientX,element:T,originalLeft:parseInt(T.style.left||"0")||0,originalWidth:parseInt(T.style.width||"0")||T.offsetWidth,originalStartDate:D,originalEndDate:k},u.current=L.clientX,T.classList.add("resizing"),document.body.style.cursor="ew-resize",a("staffAssignment",S,I),document.addEventListener("mousemove",v),document.addEventListener("mouseup",C))},[m,v,C,a]),M=f.useCallback((L,S,P,I,D,k,j)=>{if(m==="equipment"||m==="staff")return;L.preventDefault(),L.stopPropagation();const T=j||L.currentTarget.closest("[data-assignment-id]");T&&(y.current={id:S,type:"equipmentAssignment",projectId:P,edge:I,startX:L.clientX,element:T,originalLeft:parseInt(T.style.left||"0")||0,originalWidth:parseInt(T.style.width||"0")||T.offsetWidth,originalStartDate:D,originalEndDate:k},u.current=L.clientX,T.classList.add("resizing"),document.body.style.cursor="ew-resize",a("equipmentAssignment",S,I),document.addEventListener("mousemove",v),document.addEventListener("mouseup",C))},[m,v,C,a]);return f.useEffect(()=>()=>{document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",C),document.body.style.cursor=""},[v,C]),{isResizing:e,resizeEdge:t,resizeItemId:n,resizeItemType:r,startPhaseResize:N,startSubphaseResize:b,startStaffAssignmentResize:B,startEquipmentAssignmentResize:M}}function Nl(e,t){f.useEffect(()=>{const n=e.current,r=t.current;if(!n||!r)return;let a=!1;const i=()=>{a||(a=!0,r.scrollTop=n.scrollTop,requestAnimationFrame(()=>{a=!1}))},o=()=>{a||(a=!0,n.scrollTop=r.scrollTop,requestAnimationFrame(()=>{a=!1}))};return n.addEventListener("scroll",i,{passive:!0}),r.addEventListener("scroll",o,{passive:!0}),()=>{n.removeEventListener("scroll",i),r.removeEventListener("scroll",o)}},[e,t])}function z2(e,t,n){return f.useMemo(()=>n.map(r=>{const a=r.dateStr,i=t.find(m=>{const g=m.start_date.split("T")[0],_=m.end_date.split("T")[0];return a>=g&&a<=_}),o=!!i,l=e.filter(m=>{const g=m.start_date.split("T")[0],_=m.end_date.split("T")[0];return a>=g&&a<=_}),c=l.reduce((m,g)=>m+(g.allocation||0),0);let d,h;return o?(d=0,c>0?h="conflict":h="vacation"):c===0?(d=100,h="empty"):c>100?(d=100-c,h="overloaded"):c===100?(d=0,h="full"):(d=100-c,h="partial"),{total:c,assignments:l,isOnVacation:o,vacationDescription:i==null?void 0:i.description,available:d,state:h}}),[e,t,n])}function H2(e){if(e.isOnVacation){const n=e.vacationDescription||"Vacation";return e.total>0?`${n}
 Conflict: ${e.total}% assigned during vacation`:n}if(e.total===0)return"Available";let t=`${e.total}% allocated`;return e.assignments.length>1&&(t+=` (${e.assignments.length} assignments)`),e.total>100&&(t+=`
 Overloaded by ${e.total-100}%`),t}function q2(e){switch(e.state){case"vacation":return{background:"rgba(139, 92, 246, 0.25)"};case"conflict":return{background:"linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(239, 68, 68, 0.3))"};case"overloaded":return{background:`linear-gradient(to top, rgba(239, 68, 68, ${.3+Math.min(100,e.total-100)/200}) ${Math.min(100,e.total)}%, transparent ${Math.min(100,e.total)}%)`};case"full":return{background:"rgba(59, 130, 246, 0.25)"};case"partial":return{background:`linear-gradient(to top, rgba(59, 130, 246, 0.2) ${e.total}%, transparent ${e.total}%)`};default:return{}}}function W2(e,t){return e==="end"&&t==="start"?"FS":e==="start"&&t==="start"?"SS":e==="end"&&t==="end"?"FF":e==="start"&&t==="end"?"SF":"FS"}function Er(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}function V2(){const{isLinkingDependency:e,linkingFrom:t,startLinking:n,completeLinking:r,cancelLinking:a}=ee(),{projects:i,setProjects:o}=O(),l=f.useCallback(_=>{for(const y of i){const u=(y.phases??[]).find(w=>w.id===_);if(u)return{project:y,phase:u}}return null},[i]),c=f.useCallback(_=>{const y=u=>{var w;for(const p of u){if(p.id===_)return p;if((w=p.children)!=null&&w.length){const x=y(p.children);if(x)return x}}return null};for(const u of i)for(const w of u.phases??[]){const p=y(w.children??[]);if(p)return{project:u,subphase:p}}return null},[i]),d=f.useCallback((_,y,u,w)=>{const p=new Set,x=[y],v=i.find(C=>C.id===_);if(!v)return!1;for(;x.length>0;){const C=x.pop();if(C===u)return!0;if(p.has(C))continue;p.add(C);let N=[];if(w==="phase"){const b=(v.phases??[]).find(B=>B.id===C);b!=null&&b.dependencies&&(N=b.dependencies)}else{const b=B=>{var M;for(const L of B){if(L.id===C&&L.dependencies)return L.dependencies;if((M=L.children)!=null&&M.length){const S=b(L.children);if(S.length)return S}}return[]};for(const B of v.phases??[])if(N=b(B.children??[]),N.length)break}N.forEach(b=>x.push(b.id))}return!1},[i]),h=f.useCallback((_,y,u,w,p)=>{if(_.stopPropagation(),_.preventDefault(),e&&t){if(t.projectId!==y){alert("Dependencies can only be created between items in the same project"),a();return}if(t.itemId===u&&t.itemType===w){a();return}if(d(y,u,t.itemId,w)){alert("Cannot create circular dependency"),a();return}const x=W2(t.zone,p);m(y,t.itemId,t.itemType,u,w,x),r();return}n(y,u,w,p)},[e,t,n,r,a,d]),m=f.useCallback(async(_,y,u,w,p,x)=>{try{let v=null,C=null;if(u==="phase"){const E=l(y);E&&(v=E.phase)}else{const E=c(y);E&&(v=E.subphase)}if(p==="phase"){const E=l(w);E&&(C=E.phase)}else{const E=c(w);E&&(C=E.subphase)}if(!v||!C){console.error("Could not find source or target item");return}const N=C.dependencies??[];if(N.some(E=>E.id===y&&E.type===x)){console.log("Dependency already exists");return}const b=[...N,{id:y,type:x}],B=new Date(C.start_date),M=new Date(C.end_date);B.setHours(0,0,0,0),M.setHours(0,0,0,0);const L=Math.round((M.getTime()-B.getTime())/864e5);let S=C.start_date,P=C.end_date,I=0;if(x==="FS"){const E=new Date(v.end_date);E.setHours(0,0,0,0);const $=new Date(E);$.setDate($.getDate()+1);const A=new Date($);A.setDate(A.getDate()+L),S=Er($),P=Er(A),I=Math.round(($.getTime()-B.getTime())/864e5)}else if(x==="SS"){const E=new Date(v.start_date);E.setHours(0,0,0,0);const $=new Date(E),A=new Date($);A.setDate(A.getDate()+L),S=Er($),P=Er(A),I=Math.round(($.getTime()-B.getTime())/864e5)}const D=[],k=(E,$)=>{var A;for(const R of E){const H=new Date(R.start_date),F=new Date(R.end_date);H.setDate(H.getDate()+$),F.setDate(F.getDate()+$);const V=Er(H),Q=Er(F);R.start_date=V,R.end_date=Q,D.push({type:"subphase",id:R.id,start_date:V,end_date:Q}),(A=R.children)!=null&&A.length&&k(R.children,$)}},j=[],T=i.map(E=>{var A,R;if(E.id!==_)return E;const $=Iu(E);if(p==="phase"){const H=($.phases??[]).find(F=>F.id===w);H&&(H.dependencies=b,H.start_date=S,H.end_date=P,I!==0&&((A=H.children)!=null&&A.length)&&k(H.children,I)),Mu($,j)}else{const H=F=>{var V,Q;for(const X of F){if(X.id===w)return X.dependencies=b,X.start_date=S,X.end_date=P,I!==0&&((V=X.children)!=null&&V.length)&&k(X.children,I),!0;if((Q=X.children)!=null&&Q.length&&H(X.children))return!0}return!1};for(const F of $.phases??[])if((R=F.children)!=null&&R.length&&H(F.children))break;I!==0&&t_($,w,j)}return $});o(T),p==="phase"?await Js(w,{start_date:S,end_date:P,dependencies:b}):await er(w,{start_date:S,end_date:P,dependencies:b}),D.length>0&&(console.log(`Saving ${D.length} child updates from dependency creation`),await Qo(D)),j.length>0&&(console.log(`Saving ${j.length} parent updates from dependency creation`),await Qo(j))}catch(v){console.error("Failed to create dependency:",v);const C=await ft();o(C)}},[i,o,l,c]),g=f.useCallback(()=>{e&&a()},[e,a]);return{isLinkingDependency:e,linkingFrom:t,handleLinkZoneClick:h,handleCancelLinking:g}}const U2="#ec4899",ac=["#06b6d4","#8b5cf6","#f59e0b","#10b981","#ef4444"];function G2(e){return ac[Math.min(e-1,ac.length-1)]||ac[0]}function Y2(e,t){for(const n of e.phases||[]){const r=r_(n.children||[],t,1);if(r!==null)return r}return 1}function r_(e,t,n){for(const r of e){if(r.id===t)return n;if(r.children&&r.children.length>0){const a=r_(r.children,t,n+1);if(a!==null)return a}}return null}function Xo(e,t){for(const n of e){const r=Pu(n.children||[],t);if(r)return r}return null}function Pu(e,t){for(const n of e){if(n.id===t)return n;if(n.children&&n.children.length>0){const r=Pu(n.children,t);if(r)return r}}return null}function Q2(e,t){const n=Xo(e.phases||[],t);if(!n)return 0;const r=!!n.parent_subphase_id,a=r?n.parent_subphase_id:n.parent_phase_id;let i=[];if(r){const o=Xo(e.phases||[],a);i=(o==null?void 0:o.children)||[]}else{const o=(e.phases||[]).find(l=>l.id===a);i=(o==null?void 0:o.children)||[]}return i.findIndex(o=>o.id===t)}function Ji(e){return Ie(e,"yyyy-MM-dd")}function Pa(e){const t=e.split("T")[0];return new Date(t+"T12:00:00")}function $i(){const e=O(m=>m.projects),t=ee(m=>m.phantomSiblingMode),n=ee(m=>m.startPhantomSibling),r=ee(m=>m.updatePhantomPosition),a=ee(m=>m.endPhantomSibling),i=f.useRef(!1);i.current=!!t;const o=f.useCallback(m=>{const{projectId:g,sourceId:_,type:y,zone:u}=m,w=e.find(D=>D.id===g);if(!w)return;let p,x,v,C=null,N;const b=u==="start"?"SS":"FS";if(y==="phase"){if(p=(w.phases||[]).find(k=>k.id===_),!p)return;v=(w.phases||[]).findIndex(k=>k.id===_),x=U2;const{expandedPhases:D}=O.getState();D.has(_)&&O.getState().togglePhaseExpanded(_)}else{if(p=Xo(w.phases||[],_)||void 0,!p)return;const D=p;v=Q2(w,_),x=D.color||G2(Y2(w,_)),D.parent_subphase_id?(C=D.parent_subphase_id,N="subphase"):(C=D.parent_phase_id,N="phase");const{expandedSubphases:k}=O.getState();k.has(_)&&O.getState().toggleSubphaseExpanded(_)}const B=Pa(p.start_date),M=Pa(p.end_date);let L=Us(M,B)+1;("is_milestone"in p&&p.is_milestone||L<2)&&(L=5);let P;b==="FS"?P=kn(M,1):P=new Date(B);const I=kn(P,L-1);n({projectId:g,sourceId:_,type:y,dependencyType:b,phantomStart:Ji(P),phantomEnd:Ji(I),phantomColor:x,siblingDurationDays:L,sourceIndex:v,parentId:C,parentType:N}),document.body.classList.add("phantom-sibling-mode")},[e,n]),l=f.useCallback((m,g,_,y,u)=>{if(!t)return;const{siblingDurationDays:w}=t,p=m-g.left+_;if(y.length===0)return;const x=new Date(y[0].date);x.setHours(0,0,0,0);const v=y[y.length-1],C=new Date(v.date);C.setHours(23,59,59,999);const N=y.length*u,B=(C.getTime()-x.getTime())/N,M=(w-1)*24*60*60*1e3,L=M/B/2,S=p-L,P=Math.max(0,Math.min(S,N-M/B)),I=x.getTime()+P*B,D=new Date(I);D.setHours(0,0,0,0);const k=kn(D,w-1);r(Ji(D),Ji(k))},[t,r]),c=f.useCallback(()=>{document.body.classList.remove("phantom-sibling-mode"),a()},[a]),d=f.useCallback(()=>{if(!t)return;const{projectId:m,sourceId:g,type:_,phantomStart:y,phantomEnd:u,dependencyType:w,parentId:p,parentType:x}=t,v={startDate:y,endDate:u,predecessorId:g,dependencyType:w,parentId:p,parentType:x};c(),setTimeout(()=>{if(_==="phase")ee.setState({activeModal:"phase",editingPhase:null,modalContext:{projectId:m,phantomPreset:v}});else{const C=e.find(B=>B.id===m);let N,b;if(x==="phase")N=p??void 0,b=void 0;else if(x==="subphase"&&p&&C){b=p;for(const B of C.phases||[])if(Pu(B.children||[],p)){N=B.id;break}}ee.setState({activeModal:"subphase",editingSubphase:null,modalContext:{phaseId:N,projectId:m,subphaseId:b,phantomPreset:v}})}},50)},[t,c,e]);f.useEffect(()=>{const m=g=>{g.key==="Escape"&&i.current&&c()};return document.addEventListener("keydown",m),()=>document.removeEventListener("keydown",m)},[c]);const h=f.useCallback(()=>{if(!t)return{lagDays:0,dependencyType:"FS"};const{phantomStart:m,dependencyType:g,sourceId:_,type:y}=t,u=e.find(N=>N.id===t.projectId);if(!u)return{lagDays:0,dependencyType:g};let w;if(y==="phase"?w=(u.phases||[]).find(N=>N.id===_):w=Xo(u.phases||[],_)||void 0,!w)return{lagDays:0,dependencyType:g};const p=Pa(m),x=Pa(w.start_date),v=Pa(w.end_date);let C;if(g==="SS")C=Us(p,x);else{const N=kn(v,1);C=Us(p,N)}return{lagDays:C,dependencyType:g}},[t,e]);return{phantomSiblingMode:t,isPhantomMode:!!t,startPhantom:o,updatePhantom:l,completePhantom:d,cancelPhantom:c,calculateLag:h}}const kh=12,bh=120,ic=4;function Dl({containerRef:e,cellWidth:t,enabled:n=!0}){const r=O(o=>o.setCellWidth),a=f.useRef(!1),i=f.useCallback(o=>{if(!o.ctrlKey||!n)return;o.preventDefault();const l=e.current;if(!l||a.current)return;a.current=!0;const d=o.deltaY<0?Math.min(t+ic,bh):Math.max(t-ic,kh);if(d===t){a.current=!1;return}const h=l.getBoundingClientRect(),g=(o.clientX-h.left+l.scrollLeft)/t;r(d),requestAnimationFrame(()=>{const _=g*d-(o.clientX-h.left);l.scrollLeft=Math.max(0,_),a.current=!1})},[t,e,r,n]);return f.useEffect(()=>{const o=e.current;if(!(!o||!n))return o.addEventListener("wheel",i,{passive:!1}),()=>{o.removeEventListener("wheel",i)}},[i,e,n]),{minCellWidth:kh,maxCellWidth:bh,zoomStep:ic}}const X2=12,K2=120,Nh=4;function Z2(){const e=ee(m=>m.triggerScrollToToday),t=ee(m=>m.triggerZoom),n=ee(m=>m.endPhantomSibling),r=ee(m=>m.phantomSiblingMode),a=ee(m=>m.cancelLinking),i=ee(m=>m.isLinkingDependency),o=ee(m=>m.closeModal),l=ee(m=>m.activeModal),c=O(m=>m.cellWidth),d=O(m=>m.setCellWidth),h=f.useCallback(m=>{const g=m.target;if(!(g.tagName==="INPUT"||g.tagName==="TEXTAREA"||g.isContentEditable)){if(m.key==="Escape"){if(l){o(),m.preventDefault();return}if(i){a(),m.preventDefault();return}if(r){document.body.classList.remove("phantom-sibling-mode"),n(),m.preventDefault();return}}if(m.key==="Home"&&!m.ctrlKey&&!m.shiftKey&&!m.altKey){e(),m.preventDefault();return}if((m.key==="+"||m.key==="=")&&!m.ctrlKey){const _=Math.min(c+Nh,K2);_!==c&&(t(1,_),d(_)),m.preventDefault();return}if(m.key==="-"&&!m.ctrlKey){const _=Math.max(c-Nh,X2);_!==c&&(t(-1,_),d(_)),m.preventDefault();return}}},[l,o,i,a,r,n,e,t,c,d]);f.useEffect(()=>(document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)),[h])}const Dh=5,$h=100;function a_(){const e=ee(g=>g.resourceDrag),t=ee(g=>g.startResourceDrag),n=ee(g=>g.updateResourceDragTarget),r=ee(g=>g.endResourceDrag),a=O(g=>g.setProjects),i=O(g=>g.currentUser),o=f.useCallback((g,_,y,u)=>{if(!i||i.role!=="superuser"&&i.role!=="admin"){g.preventDefault();return}g.dataTransfer.setData("application/json",JSON.stringify({type:_,resourceId:y,resourceName:u})),g.dataTransfer.effectAllowed="copy",t(_,y,u),document.body.classList.add("resource-dragging")},[i,t]),l=f.useCallback((g,_,y,u,w)=>{if(!e.active)return;g.preventDefault(),g.dataTransfer.dropEffect="copy";let p=w||Ie(new Date,"yyyy-MM-dd"),x=Ie(kn(new Date(p),Dh-1),"yyyy-MM-dd");n(_,y,u,p,x)},[e.active,n]),c=f.useCallback(g=>{const _=g.relatedTarget;_&&g.currentTarget.contains(_)||n(null,null,null,null,null)},[n]),d=f.useCallback(async(g,_,y,u,w,p)=>{if(g.preventDefault(),!e.active||!e.resourceId){r();return}const{type:x,resourceId:v}=e;try{x==="staff"?await Su({staff_id:v,allocation:$h,start_date:w,end_date:p,project_id:u||y?void 0:_,phase_id:u?void 0:y||void 0,subphase_id:u||void 0}):x==="equipment"&&await Cu({equipment_id:v,start_date:w,end_date:p,project_id:u||y?void 0:_,phase_id:u?void 0:y||void 0,subphase_id:u||void 0});const C=await ft();a(C)}catch(C){console.error("Failed to create assignment:",C)}finally{r(),document.body.classList.remove("resource-dragging")}},[e,r,a]),h=f.useCallback(()=>{r(),document.body.classList.remove("resource-dragging")},[r]),m=f.useCallback((g,_,y,u,w)=>{var C;if(w.length===0)return null;const p=g-_.left+y,x=Math.floor(p/u),v=Math.max(0,Math.min(x,w.length-1));return((C=w[v])==null?void 0:C.dateStr)||null},[]);return{resourceDrag:e,isActive:e.active,handleDragStart:o,handleDragOver:l,handleDragLeave:c,handleDrop:d,handleDragEnd:h,calculateDateFromPosition:m,DEFAULT_DURATION_DAYS:Dh,DEFAULT_ALLOCATION:$h}}const J2="_container_ft4rj_1",ew="_wrapper_ft4rj_7",tw="_icon_ft4rj_13",nw="_select_ft4rj_20",sw="_chevron_ft4rj_48",rw="_singleSite_ft4rj_55",sr={container:J2,wrapper:ew,icon:tw,select:nw,chevron:sw,singleSite:rw};function aw(){const e=O(h=>h.sites),t=O(h=>h.currentSite),n=O(h=>h.setCurrentSite),r=O(h=>h.setBankHolidays),a=O(h=>h.setCustomColumns),i=O(h=>h.setCustomColumnValues),o=O(h=>h.clearAllCustomColumnFilters),l=O(h=>h.currentUser),c=(l==null?void 0:l.role)==="admin"?e:e.filter(h=>{var m;return(m=l==null?void 0:l.site_ids)==null?void 0:m.includes(h.id)}),d=async h=>{const m=parseInt(h.target.value,10),g=e.find(_=>_.id===m);if(g){n(g),o();try{const _=await Vs(g.id),y=Kn(_);r(_,y)}catch(_){console.error("[SiteSelector] Failed to load bank holidays:",_)}try{const _=await Wo(g.id);a(_.columns),i(_.values),console.log("[SiteSelector] Loaded custom columns for site:",g.name,_.columns.length)}catch(_){console.error("[SiteSelector] Failed to load custom columns:",_)}}};return c.length<=1?t?s.jsx("div",{className:sr.container,children:s.jsxs("div",{className:sr.singleSite,children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),s.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),s.jsx("span",{children:t.name})]})}):null:s.jsx("div",{className:sr.container,children:s.jsxs("div",{className:sr.wrapper,children:[s.jsxs("svg",{className:sr.icon,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),s.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),s.jsx("select",{className:sr.select,value:(t==null?void 0:t.id)||"",onChange:d,children:c.map(h=>s.jsx("option",{value:h.id,children:h.name},h.id))}),s.jsx("svg",{className:sr.chevron,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"6 9 12 15 18 9"})})]})})}const iw="_wrapper_8vp7s_1",ow="_navigation_8vp7s_7",lw="_navButton_8vp7s_17",cw="_periodLabel_8vp7s_40",dw="_todayButton_8vp7s_48",Tr={wrapper:iw,navigation:ow,navButton:lw,periodLabel:cw,todayButton:dw};function uw(){const e=O(l=>l.viewMode),t=O(l=>l.currentDate),n=O(l=>l.setCurrentDate),r=ee(l=>l.triggerScrollToToday),a=l=>{let c;switch(e){case"week":c=$u(t,l);break;case"month":c=Zn(t,l);break;case"quarter":c=Zn(t,l*3);break;case"year":c=Zn(t,l*12);break;default:c=Zn(t,l)}n(c)},i=()=>{n(new Date),r()},o=()=>{switch(e){case"week":{const l=Qs(t,{weekStartsOn:1});return Ie(l,"MMM d, yyyy")}case"month":return Ie(t,"MMMM yyyy");case"quarter":{const l=Vg(t);return`Q${Math.floor(l.getMonth()/3)+1} ${Ie(l,"yyyy")}`}case"year":return Ie(t,"yyyy");default:return Ie(t,"MMMM yyyy")}};return s.jsxs("div",{className:Tr.wrapper,children:[s.jsxs("div",{className:Tr.navigation,children:[s.jsx("button",{className:Tr.navButton,onClick:()=>a(-1),title:"Previous period",children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"15 18 9 12 15 6"})})}),s.jsx("span",{className:Tr.periodLabel,children:o()}),s.jsx("button",{className:Tr.navButton,onClick:()=>a(1),title:"Next period",children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"9 18 15 12 9 6"})})})]}),s.jsx("button",{className:Tr.todayButton,onClick:i,title:"Go to today",children:"Today"})]})}const fw="_wrapper_vcvut_1",hw="_trigger_vcvut_5",mw="_avatar_vcvut_26",pw="_chevron_vcvut_39",gw="_open_vcvut_44",_w="_menu_vcvut_48",yw="_userInfo_vcvut_61",vw="_name_vcvut_68",xw="_email_vcvut_74",ww="_role_vcvut_79",jw="_divider_vcvut_85",Sw="_menuItem_vcvut_90",_n={wrapper:fw,trigger:hw,avatar:mw,chevron:pw,open:gw,menu:_w,userInfo:yw,name:vw,email:xw,role:ww,divider:jw,menuItem:Sw};function Cw(){var l,c;const[e,t]=f.useState(!1),n=f.useRef(null),r=O(d=>d.currentUser),a=O(d=>d.setCurrentUser);f.useEffect(()=>{const d=h=>{n.current&&!n.current.contains(h.target)&&t(!1)};return e&&document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[e]);const i=async()=>{try{await Ng(),a(null),window.location.reload()}catch(d){console.error("Logout failed:",d)}};if(!r)return null;const o=`${((l=r.first_name)==null?void 0:l[0])||""}${((c=r.last_name)==null?void 0:c[0])||""}`.toUpperCase()||"?";return s.jsxs("div",{ref:n,className:_n.wrapper,children:[s.jsxs("button",{className:_n.trigger,onClick:()=>t(!e),"aria-expanded":e,"aria-haspopup":"true",children:[s.jsx("span",{className:_n.avatar,children:o}),s.jsx("svg",{className:`${_n.chevron} ${e?_n.open:""}`,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),e&&s.jsxs("div",{className:_n.menu,children:[s.jsxs("div",{className:_n.userInfo,children:[s.jsx("span",{className:_n.name,children:r.name}),s.jsx("span",{className:_n.email,children:r.email}),s.jsx("span",{className:_n.role,children:r.role})]}),s.jsx("div",{className:_n.divider}),s.jsxs("button",{className:_n.menuItem,onClick:i,children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),s.jsx("polyline",{points:"16 17 21 12 16 7"}),s.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),s.jsx("span",{children:"Log out"})]})]})]})}const kw="_button_1jsgw_1",bw={button:kw};function Nw(){const[e,t]=f.useState(()=>Nr());f.useEffect(()=>{const r=new MutationObserver(()=>{const a=document.documentElement.dataset.theme;a&&a!==e&&t(a)});return r.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>r.disconnect()},[e]);const n=()=>{const r=Rx();t(r)};return s.jsx("button",{className:bw.button,onClick:n,title:`Switch to ${e==="dark"?"light":"dark"} theme`,"aria-label":`Switch to ${e==="dark"?"light":"dark"} theme`,children:e==="dark"?s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"12",cy:"12",r:"5"}),s.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),s.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),s.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),s.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),s.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),s.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),s.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),s.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]}):s.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})}const Dw="_button_n3mic_1",$w="_label_n3mic_28",Ew="_activeContainer_n3mic_33",Tw="_indicator_n3mic_53",Mw="_pendingBadge_n3mic_63",Iw="_discardButton_n3mic_77",Pw="_applyButton_n3mic_78",rr={button:Dw,label:$w,activeContainer:Ew,indicator:Tw,pendingBadge:Mw,discardButton:Iw,applyButton:Pw};function Lw(){const e=O(h=>h.whatIfMode),t=O(h=>h.whatIfPendingOperations),n=O(h=>h.enterWhatIfMode),r=O(h=>h.exitWhatIfMode),[a,i]=f.useState(!1),o=t.length,l=()=>{n()},c=()=>{window.confirm(o>0?`Discard ${o} pending change${o!==1?"s":""}? This cannot be undone.`:"Exit What If mode?")&&r(!1)},d=async()=>{if(o===0){r(!1);return}if(window.confirm(`Apply ${o} change${o!==1?"s":""} to the database?`)){i(!0);try{await r(!0)}finally{i(!1)}}};return e?s.jsxs("div",{className:rr.activeContainer,children:[s.jsxs("div",{className:rr.indicator,children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),s.jsx("circle",{cx:"12",cy:"17",r:"0.5",fill:"currentColor"})]}),s.jsx("span",{children:"What If"}),o>0&&s.jsx("span",{className:rr.pendingBadge,children:o})]}),s.jsx("button",{className:rr.discardButton,onClick:c,disabled:a,title:"Discard all changes",children:"Discard"}),s.jsx("button",{className:rr.applyButton,onClick:d,disabled:a,title:o>0?`Apply ${o} change${o!==1?"s":""}`:"Exit What If mode",children:a?"Applying...":o>0?"Apply":"Exit"})]}):s.jsxs("button",{className:rr.button,onClick:l,title:"Enter What If mode to test changes without saving",children:[s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),s.jsx("circle",{cx:"12",cy:"17",r:"0.5",fill:"currentColor"})]}),s.jsx("span",{className:rr.label,children:"What If"})]})}const Aw="_container_155df_1",Bw="_separator_155df_7",Rw="_title_155df_14",oc={container:Aw,separator:Bw,title:Rw};function Ow(){const e=O(n=>n.instanceSettings),t=(e==null?void 0:e.instance_title)||(e==null?void 0:e.instance_name);return!t||t==="Milestone"?null:s.jsxs("div",{className:oc.container,children:[s.jsx("span",{className:oc.separator,children:"|"}),s.jsx("span",{className:oc.title,children:t})]})}const Fw="_header_1jmbw_1",zw="_whatIfActive_1jmbw_14",Hw="_left_1jmbw_23",qw="_logo_1jmbw_30",Ww="_logoImg_1jmbw_35",Vw="_center_1jmbw_44",Uw="_viewModes_1jmbw_54",Gw="_viewModeBtn_1jmbw_62",Yw="_active_1jmbw_80",Qw="_zoomControls_1jmbw_86",Xw="_zoomBtn_1jmbw_95",Kw="_zoomLevel_1jmbw_119",Zw="_right_1jmbw_143",Jw="_panelsWrapper_1jmbw_151",ej="_panelsBtn_1jmbw_155",tj="_hasActive_1jmbw_176",nj="_panelsBadge_1jmbw_182",sj="_panelsDropdown_1jmbw_196",rj="_panelsDropdownHeader_1jmbw_210",aj="_panelButtons_1jmbw_219",ij="_panelToggleBtn_1jmbw_224",oj="_equipment_1jmbw_257",lj="_panelsHint_1jmbw_276",cj="_divider_1jmbw_289",Me={header:Fw,whatIfActive:zw,left:Hw,logo:qw,logoImg:Ww,center:Vw,viewModes:Uw,viewModeBtn:Gw,active:Yw,zoomControls:Qw,zoomBtn:Xw,zoomLevel:Kw,right:Zw,panelsWrapper:Jw,panelsBtn:ej,hasActive:tj,panelsBadge:nj,panelsDropdown:sj,panelsDropdownHeader:rj,panelButtons:aj,panelToggleBtn:ij,equipment:oj,panelsHint:lj,divider:cj},dj=[{value:"week",label:"W",title:"Week view"},{value:"month",label:"M",title:"Month view"},{value:"quarter",label:"Q",title:"Quarter view"},{value:"year",label:"Y",title:"Year view"}],Eh=12,Th=120,Mh=4,lc=36;function uj(){const e=O(j=>j.currentUser),t=O(j=>j.whatIfMode),n=O(j=>j.currentView),r=O(j=>j.viewMode),a=O(j=>j.setViewMode),i=O(j=>j.cellWidth),o=O(j=>j.setCellWidth),l=O(j=>j.showStaffOverview),c=O(j=>j.showEquipmentOverview),d=O(j=>j.toggleShowStaffOverview),h=O(j=>j.toggleShowEquipmentOverview),[m,g]=f.useState(()=>Nr()),[_,y]=f.useState(""),[u,w]=f.useState(""),[p,x]=f.useState(!1),v=f.useRef(null);f.useEffect(()=>{(async()=>{try{const[T,E]=await Promise.all([pd("header_logo_dark").catch(()=>({value:null})),pd("header_logo_light").catch(()=>({value:null}))]);T.value&&y(T.value),E.value&&w(E.value)}catch{}})()},[]),f.useEffect(()=>{const j=new MutationObserver(()=>{const T=document.documentElement.dataset.theme;T&&T!==m&&g(T)});return j.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>j.disconnect()},[m]),f.useEffect(()=>{const j=T=>{v.current&&!v.current.contains(T.target)&&x(!1)};return p&&document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[p]);const C=(e==null?void 0:e.role)==="admin"||(e==null?void 0:e.role)==="superuser",N=(e==null?void 0:e.role)==="admin"||(e==null?void 0:e.role)==="superuser",b=n==="gantt",B=Math.round(i/lc*100),M=i<Th,L=i>Eh,S=()=>{const j=Math.min(i+Mh,Th);j!==i&&o(j)},P=()=>{const j=Math.max(i-Mh,Eh);j!==i&&o(j)},I=()=>{i!==lc&&o(lc)},D=f.useMemo(()=>m==="dark"?_||"/img/milestone_logo_dark_theme.svg":u||"/img/milestone_logo_light_theme.svg",[m,_,u]),k=(l?1:0)+(c?1:0);return s.jsxs("header",{className:`${Me.header} ${t?Me.whatIfActive:""}`,children:[s.jsxs("div",{className:Me.left,children:[s.jsx("div",{className:Me.logo,children:s.jsx("img",{src:D,alt:"Milestone",className:Me.logoImg})}),s.jsx(Ow,{}),s.jsx("div",{className:Me.divider}),s.jsx(aw,{})]}),s.jsxs("div",{className:Me.center,children:[s.jsx(uw,{}),s.jsx("div",{className:Me.divider}),s.jsx("div",{className:Me.viewModes,children:dj.map(j=>s.jsx("button",{className:`${Me.viewModeBtn} ${r===j.value?Me.active:""}`,onClick:()=>a(j.value),title:j.title,children:j.label},j.value))}),s.jsx("div",{className:Me.divider}),s.jsxs("div",{className:Me.zoomControls,children:[s.jsx("button",{className:Me.zoomBtn,onClick:P,disabled:!L,title:"Zoom out",children:s.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M19 13H5v-2h14v2z"})})}),s.jsxs("button",{className:Me.zoomLevel,onClick:I,title:"Reset zoom to 100%",children:[B,"%"]}),s.jsx("button",{className:Me.zoomBtn,onClick:S,disabled:!M,title:"Zoom in",children:s.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})})})]})]}),s.jsxs("div",{className:Me.right,children:[N&&b&&s.jsxs("div",{ref:v,className:Me.panelsWrapper,children:[s.jsxs("button",{className:`${Me.panelsBtn} ${k>0?Me.hasActive:""}`,onClick:()=>x(!p),title:"Toggle overview panels",children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),s.jsx("line",{x1:"3",y1:"15",x2:"21",y2:"15"})]}),s.jsx("span",{children:"Panels"}),k>0&&s.jsx("span",{className:Me.panelsBadge,children:k})]}),p&&s.jsxs("div",{className:Me.panelsDropdown,children:[s.jsx("div",{className:Me.panelsDropdownHeader,children:"Overview Panels"}),s.jsxs("div",{className:Me.panelButtons,children:[s.jsxs("button",{className:`${Me.panelToggleBtn} ${l?Me.active:""}`,onClick:()=>{d(),x(!1)},children:[s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"9",cy:"7",r:"4"}),s.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),s.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),s.jsx("span",{children:"Staff"})]}),s.jsxs("button",{className:`${Me.panelToggleBtn} ${Me.equipment} ${c?Me.active:""}`,onClick:()=>{h(),x(!1)},children:[s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),s.jsx("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]}),s.jsx("span",{children:"Equipment"})]})]}),s.jsx("div",{className:Me.panelsHint,children:"Click to toggle  Drag staff/equipment to assign"})]})]}),C&&s.jsx(Lw,{}),s.jsx("div",{className:Me.divider}),s.jsx(Nw,{}),s.jsx(Cw,{})]})]})}const fj="_nav_7yrvb_1",hj="_collapsed_7yrvb_7",mj="_navItem_7yrvb_7",pj="_active_7yrvb_34",gj="_icon_7yrvb_44",_j="_label_7yrvb_53",Mr={nav:fj,collapsed:hj,navItem:mj,active:pj,icon:gj,label:_j},yj=[{view:"gantt",label:"Gantt Chart",icon:s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"4",y1:"9",x2:"20",y2:"9"}),s.jsx("line",{x1:"4",y1:"15",x2:"12",y2:"15"}),s.jsx("line",{x1:"4",y1:"21",x2:"16",y2:"21"}),s.jsx("rect",{x:"4",y:"3",width:"16",height:"2",rx:"1"})]})},{view:"staff",label:"Staff Overview",icon:s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"9",cy:"7",r:"4"}),s.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),s.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})},{view:"equipment",label:"Equipment",icon:s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"12",cy:"12",r:"3"}),s.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})},{view:"crosssite",label:"Cross-Site",icon:s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),s.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]})},{view:"archived",label:"Archived",icon:s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("polyline",{points:"21 8 21 21 3 21 3 8"}),s.jsx("rect",{x:"1",y:"3",width:"22",height:"5"}),s.jsx("line",{x1:"10",y1:"12",x2:"14",y2:"12"})]})}];function vj({collapsed:e=!1}){const t=O(r=>r.currentView),n=O(r=>r.setCurrentView);return s.jsx("nav",{className:`${Mr.nav} ${e?Mr.collapsed:""}`,children:yj.map(r=>s.jsxs("button",{className:`${Mr.navItem} ${t===r.view?Mr.active:""}`,onClick:()=>n(r.view),title:e?r.label:void 0,children:[s.jsx("span",{className:Mr.icon,children:r.icon}),!e&&s.jsx("span",{className:Mr.label,children:r.label})]},r.view))})}const xj="_section_18spk_1",wj="_collapsed_18spk_7",jj="_item_18spk_7",Sj="_icon_18spk_39",Cj="_label_18spk_48",La={section:xj,collapsed:wj,item:jj,icon:Sj,label:Cj},kj=[{id:"users",label:"Manage Users",modal:"userManagement",icon:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"9",cy:"7",r:"4"}),s.jsx("line",{x1:"19",y1:"8",x2:"19",y2:"14"}),s.jsx("line",{x1:"22",y1:"11",x2:"16",y2:"11"})]})},{id:"equipment",label:"Manage Equipment",modal:"manageEquipment",icon:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),s.jsx("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]})},{id:"sites",label:"Manage Sites",modal:"manageSites",icon:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),s.jsx("circle",{cx:"12",cy:"10",r:"3"})]})},{id:"phases",label:"Predefined Phases",modal:"predefinedPhases",icon:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),s.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),s.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),s.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),s.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),s.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]})},{id:"sso",label:"SSO Configuration",modal:"ssoConfig",adminOnly:!0,icon:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),s.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})},{id:"settings",label:"Settings",modal:"settings",icon:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"12",cy:"12",r:"3"}),s.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]})}];function bj({collapsed:e=!1}){const t=ee(o=>o.setActiveModal),n=O(o=>o.currentUser),r=(n==null?void 0:n.role)==="admin",a=o=>{t(o)},i=kj.filter(o=>!o.adminOnly||r);return s.jsx("div",{className:`${La.section} ${e?La.collapsed:""}`,children:i.map(o=>s.jsxs("button",{className:La.item,onClick:()=>a(o.modal),title:e?o.label:void 0,children:[s.jsx("span",{className:La.icon,children:o.icon}),!e&&s.jsx("span",{className:La.label,children:o.label})]},o.id))})}const Nj="_stats_sfjfp_1",Dj="_stat_sfjfp_1",$j="_value_sfjfp_14",Ej="_label_sfjfp_21",Tj="_detail_sfjfp_26",Tn={stats:Nj,stat:Dj,value:$j,label:Ej,detail:Tj};function Mj(){const e=O(d=>d.projects),t=O(d=>d.staff),n=O(d=>d.equipment),r=O(d=>d.currentSite),a=r?e.filter(d=>d.site_id===r.id&&!d.archived):e.filter(d=>!d.archived),i=r?t.filter(d=>d.site_id===r.id&&d.active):t.filter(d=>d.active),o=r?n.filter(d=>d.site_id===r.id&&d.active):n.filter(d=>d.active),l=a.filter(d=>d.confirmed).length,c=a.filter(d=>!d.confirmed).length;return s.jsxs("div",{className:Tn.stats,children:[s.jsxs("div",{className:Tn.stat,children:[s.jsx("span",{className:Tn.value,children:a.length}),s.jsx("span",{className:Tn.label,children:"Projects"}),s.jsxs("span",{className:Tn.detail,children:[l," confirmed, ",c," pending"]})]}),s.jsxs("div",{className:Tn.stat,children:[s.jsx("span",{className:Tn.value,children:i.length}),s.jsx("span",{className:Tn.label,children:"Staff"})]}),s.jsxs("div",{className:Tn.stat,children:[s.jsx("span",{className:Tn.value,children:o.length}),s.jsx("span",{className:Tn.label,children:"Equipment"})]})]})}const Ij="_sidebar_vk433_1",Pj="_collapsed_vk433_14",Lj="_collapseBtn_vk433_18",Aj="_content_vk433_51",Bj="_section_vk433_64",Rj="_sectionTitle_vk433_70",qn={sidebar:Ij,collapsed:Pj,collapseBtn:Lj,content:Aj,section:Bj,sectionTitle:Rj};function Oj(){const e=O(i=>i.sidebarCollapsed),t=O(i=>i.setSidebarCollapsed),n=O(i=>i.currentUser),r=(n==null?void 0:n.role)==="admin"||(n==null?void 0:n.role)==="superuser",a=()=>{t(!e)};return s.jsxs("aside",{className:`${qn.sidebar} ${e?qn.collapsed:""}`,children:[s.jsx("button",{className:qn.collapseBtn,onClick:a,title:e?"Expand sidebar":"Collapse sidebar","aria-label":e?"Expand sidebar":"Collapse sidebar",children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"15 18 9 12 15 6"})})}),s.jsxs("div",{className:qn.content,children:[s.jsxs("div",{className:qn.section,children:[!e&&s.jsx("div",{className:qn.sectionTitle,children:"Views"}),s.jsx(vj,{collapsed:e})]}),r&&s.jsxs("div",{className:qn.section,children:[!e&&s.jsx("div",{className:qn.sectionTitle,children:"Admin"}),s.jsx(bj,{collapsed:e})]}),!e&&s.jsxs("div",{className:qn.section,children:[s.jsx("div",{className:qn.sectionTitle,children:"Quick Stats"}),s.jsx(Mj,{})]})]})]})}const i_=f.createContext(null);function Fj({children:e}){const[t,n]=f.useState(null),[r,a]=f.useState(null),i=f.useRef(null),o=O(u=>u.setProjects),l=f.useCallback(()=>{n(null),a(null),i.current&&i.current.parentNode&&(i.current.parentNode.removeChild(i.current),i.current=null)},[]),c=f.useCallback((u,w,p,x,v,C)=>{u.stopPropagation(),u.dataTransfer.effectAllowed="move",u.dataTransfer.setData("text/plain",JSON.stringify({type:w,id:p}));const N=u.currentTarget,b=N.getBoundingClientRect(),B=N.cloneNode(!0);B.style.cssText=`
      position: absolute;
      top: -1000px;
      left: -1000px;
      width: ${b.width}px;
      opacity: 0.9;
      background: var(--bg-tertiary);
      border-radius: 4px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      pointer-events: none;
    `,document.body.appendChild(B),i.current=B,u.dataTransfer.setDragImage(B,20,b.height/2),n({type:w,id:p,projectId:x,parentId:v,parentType:C}),requestAnimationFrame(()=>{N.style.opacity="0.4"})},[]),d=f.useCallback((u,w,p)=>{if(!t||t.type!==w||t.id===p)return;u.preventDefault(),u.stopPropagation(),u.dataTransfer.dropEffect="move";const v=u.currentTarget.getBoundingClientRect(),C=v.top+v.height/2,N=u.clientY<C?"before":"after";a({type:w,id:p,position:N})},[t]),h=f.useCallback(u=>{u.preventDefault();const w=u.relatedTarget;u.currentTarget.contains(w)||a(null)},[]),m=f.useCallback(async(u,w,p,x,v,C)=>{if(u.preventDefault(),u.stopPropagation(),!t||!r||t.id===p){l();return}const N=x.map(M=>M.id),b=N.indexOf(t.id);let B=N.indexOf(p);if(b===-1||B===-1){l();return}N.splice(b,1),B=N.indexOf(p),r.position==="after"&&(B+=1),N.splice(B,0,t.id);try{w==="phase"?await nt(`/api/projects/${t.projectId}/phases/reorder`,{phase_order:N}):await nt(`/api/subphases/${v}/reorder`,{parent_type:C,subphase_order:N});const M=await ft();o(M)}catch(M){console.error("Failed to reorder:",M)}l()},[t,r,l,o]),g=f.useCallback(u=>{u.preventDefault();const w=u.currentTarget;w.style.opacity="",l()},[l]),_=f.useCallback((u,w)=>(t==null?void 0:t.type)===u&&(t==null?void 0:t.id)===w,[t]),y=f.useCallback((u,w)=>(r==null?void 0:r.type)===u&&(r==null?void 0:r.id)===w?r.position:null,[r]);return s.jsx(i_.Provider,{value:{dragState:t,dropTarget:r,handleDragStart:c,handleDragOver:d,handleDragLeave:h,handleDrop:m,handleDragEnd:g,isDragging:_,getDropPosition:y},children:e})}function o_(){const e=f.useContext(i_);if(!e)throw new Error("useReorder must be used within ReorderProvider");return e}const zj="_row_276wc_1",Hj="_editable_276wc_12",qj="_typeBadge_276wc_20",Wj="_staff_276wc_33",Vj="_equipment_276wc_38",Uj="_icon_276wc_43",Gj="_name_276wc_51",Yj="_detail_276wc_60",Qj="_allocation_276wc_64",yn={row:zj,editable:Hj,typeBadge:qj,staff:Wj,equipment:Vj,icon:Uj,name:Gj,detail:Yj,allocation:Qj},pa=f.memo(function({type:t,assignmentId:n,projectId:r,phaseId:a,subphaseId:i,staffId:o,equipmentId:l,name:c,role:d,equipmentType:h,allocation:m,depth:g,phaseType:_,phaseColor:y,startDate:u,endDate:w}){const p=ee(b=>b.showContextMenu),x=O(b=>b.currentUser),v=(x==null?void 0:x.role)==="admin"||(x==null?void 0:x.role)==="superuser",C=g*16+28,N=f.useCallback(b=>{if(!v)return;b.preventDefault(),b.stopPropagation(),p(t==="equipment"?"equipmentAssignment":"staffAssignment",n,b.clientX,b.clientY,r,a,i,{staffId:o,equipmentId:l,name:c,allocation:m,startDate:u,endDate:w})},[v,p,t,n,r,a,i,o,l,c,m,u,w]);return t==="phase-staff"||t==="subphase-staff"?s.jsxs("div",{className:`${yn.row} ${v?yn.editable:""}`,style:{paddingLeft:C},onContextMenu:N,children:[s.jsxs("span",{className:yn.typeBadge,style:{backgroundColor:y?`${y}33`:"rgba(139, 92, 246, 0.2)",color:y||"var(--accent-purple)"},children:[" ",_||(t==="subphase-staff"?"Subphase":"Phase")]}),s.jsx("span",{className:yn.name,title:c,children:c}),m!==void 0&&s.jsxs("span",{className:yn.allocation,children:[m,"%"]})]}):s.jsxs("div",{className:`${yn.row} ${v?yn.editable:""}`,style:{paddingLeft:C},onContextMenu:N,children:[s.jsx("span",{className:`${yn.typeBadge} ${yn[t]}`,children:t==="staff"?"STAFF":"EQUIP"}),s.jsxs("span",{className:yn.name,title:`${c}${d?` - ${d}`:""}${h?` - ${h}`:""}`,children:[c,(d||h)&&s.jsxs("span",{className:yn.detail,children:["  ",d||h]})]}),t==="staff"&&m!==void 0&&s.jsxs("span",{className:yn.allocation,children:[m,"%"]})]})}),Xj="_phantomRow_uvscd_3",Kj="_typeBadge_uvscd_19",Zj="_instructions_uvscd_28",Jj="_cancelBtn_uvscd_37",Aa={phantomRow:Xj,typeBadge:Kj,instructions:Zj,cancelBtn:Jj};function Lu({onComplete:e,onCancel:t}){const n=ee(l=>l.phantomSiblingMode);if(!n)return null;const{type:r,phantomColor:a,dependencyType:i}=n,o=i==="SS"?"Start-to-Start":"Finish-to-Start";return s.jsxs("div",{className:Aa.phantomRow,onClick:l=>{l.target.closest(`.${Aa.cancelBtn}`)||(l.stopPropagation(),e())},children:[s.jsxs("span",{className:Aa.typeBadge,style:{backgroundColor:`${a}40`,color:a},children:["New ",r==="phase"?"Phase":"Subphase"]}),s.jsxs("span",{className:Aa.instructions,children:["Move & click to place... (",o,")"]}),s.jsx("button",{className:Aa.cancelBtn,onClick:l=>{l.stopPropagation(),t()},title:"Cancel (Esc)",children:s.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})}const eS="_popover_1m2ej_3",tS="_header_1m2ej_14",nS="_title_1m2ej_21",sS="_calculatedNote_1m2ej_27",rS="_sliderContainer_1m2ej_33",aS="_valueDisplay_1m2ej_40",iS="_sliderWrapper_1m2ej_50",oS="_sliderTrack_1m2ej_58",lS="_sliderInput_1m2ej_69",cS="_tickMarks_1m2ej_122",dS="_tick_1m2ej_122",uS="_quickSelect_1m2ej_134",fS="_quickBtn_1m2ej_140",hS="_active_1m2ej_159",mS="_actions_1m2ej_165",pS="_clearBtn_1m2ej_173",gS="_applyBtn_1m2ej_191",ct={popover:eS,header:tS,title:nS,calculatedNote:sS,sliderContainer:rS,valueDisplay:aS,sliderWrapper:iS,sliderTrack:oS,sliderInput:lS,tickMarks:cS,tick:dS,quickSelect:uS,quickBtn:fS,active:hS,actions:mS,clearBtn:pS,applyBtn:gS};function l_({value:e,onChange:t,onClose:n,anchorEl:r,isCalculated:a=!1}){const[i,o]=f.useState(e??0),l=f.useRef(null);f.useEffect(()=>{if(!r||!l.current)return;const g=r.getBoundingClientRect(),_=l.current;_.style.top=`${g.bottom+8}px`,_.style.left=`${g.left}px`;const y=_.getBoundingClientRect();y.right>window.innerWidth-16&&(_.style.left=`${window.innerWidth-y.width-16}px`),y.bottom>window.innerHeight-16&&(_.style.top=`${g.top-y.height-8}px`)},[r]),f.useEffect(()=>{const g=y=>{l.current&&!l.current.contains(y.target)&&n()},_=y=>{y.key==="Escape"&&n()};return document.addEventListener("mousedown",g),document.addEventListener("keydown",_),()=>{document.removeEventListener("mousedown",g),document.removeEventListener("keydown",_)}},[n]);const c=g=>{const _=parseInt(g.target.value,10),y=Math.round(_/5)*5;o(y)},d=()=>{t(i),n()},h=()=>{t(-1),n()},m=[0,25,50,75,100];return s.jsxs("div",{ref:l,className:ct.popover,children:[s.jsxs("div",{className:ct.header,children:[s.jsx("span",{className:ct.title,children:"Set Completion"}),a&&s.jsx("span",{className:ct.calculatedNote,children:"Currently calculated from children"})]}),s.jsxs("div",{className:ct.sliderContainer,children:[s.jsxs("div",{className:ct.valueDisplay,children:[i,"%"]}),s.jsxs("div",{className:ct.sliderWrapper,children:[s.jsx("div",{className:ct.sliderTrack,style:{width:`${i}%`}}),s.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:i,onChange:c,className:ct.sliderInput})]}),s.jsxs("div",{className:ct.tickMarks,children:[s.jsx("span",{className:ct.tick,children:"0"}),s.jsx("span",{className:ct.tick,children:"25"}),s.jsx("span",{className:ct.tick,children:"50"}),s.jsx("span",{className:ct.tick,children:"75"}),s.jsx("span",{className:ct.tick,children:"100"})]})]}),s.jsx("div",{className:ct.quickSelect,children:m.map(g=>s.jsxs("button",{type:"button",className:`${ct.quickBtn} ${i===g?ct.active:""}`,onClick:()=>o(g),children:[g,"%"]},g))}),s.jsxs("div",{className:ct.actions,children:[s.jsx("button",{type:"button",className:ct.clearBtn,onClick:h,children:"Clear"}),s.jsx("button",{type:"button",className:ct.applyBtn,onClick:d,children:"Apply"})]})]})}const _S="_cellWrapper_1uh67_4",yS="_textCell_1uh67_20",vS="_booleanCell_1uh67_21",xS="_listCell_1uh67_22",wS="_readOnly_1uh67_40",jS="_empty_1uh67_48",SS="_cellText_1uh67_58",CS="_textInput_1uh67_65",kS="_checkbox_1uh67_88",bS="_checked_1uh67_106",NS="_listValue_1uh67_116",DS="_chevron_1uh67_133",$S="_open_1uh67_139",ES="_dropdown_1uh67_143",TS="_option_1uh67_170",MS="_selected_1uh67_182",IS="_clearOption_1uh67_187",mt={cellWrapper:_S,textCell:yS,booleanCell:vS,listCell:xS,readOnly:wS,empty:jS,cellText:SS,textInput:CS,checkbox:kS,checked:bS,listValue:NS,chevron:DS,open:$S,dropdown:ES,option:TS,selected:MS,clearOption:IS};function c_({column:e,entityType:t,entityId:n,readOnly:r=!1,childEntities:a=[]}){const i=O(m=>m.customColumnValues),o=O(m=>m.setCustomColumnValue),l=hx(e.id,t,n),c=i[l]??null,d=f.useCallback(async m=>{o(e.id,t,n,m);for(const g of a)o(e.id,g.entityType,g.entityId,m);try{await fh({custom_column_id:e.id,entity_type:t,entity_id:n,value:m});for(const g of a)await fh({custom_column_id:e.id,entity_type:g.entityType,entity_id:g.entityId,value:m})}catch(g){console.error("[CustomColumnCell] Failed to save value:",g)}},[e.id,t,n,o,a]),h=()=>{switch(e.column_type){case"boolean":return s.jsx(LS,{value:c,onChange:d,readOnly:r});case"list":return s.jsx(AS,{value:c,options:e.list_options||[],onChange:d,readOnly:r});default:return s.jsx(PS,{value:c,onChange:d,readOnly:r})}};return s.jsx("div",{className:mt.cellWrapper,children:h()})}function PS({value:e,onChange:t,readOnly:n}){const[r,a]=f.useState(!1),[i,o]=f.useState(e||""),l=f.useRef(null);f.useEffect(()=>{r&&l.current&&(l.current.focus(),l.current.select())},[r]);const c=()=>{n||(o(e||""),a(!0))},d=()=>{a(!1);const m=i.trim();m!==(e||"")&&t(m||null)},h=m=>{m.key==="Enter"?d():m.key==="Escape"&&(a(!1),o(e||""))};return r?s.jsx("input",{ref:l,type:"text",className:mt.textInput,value:i,onChange:m=>o(m.target.value),onBlur:d,onKeyDown:h}):s.jsx("div",{className:`${mt.textCell} ${e?"":mt.empty} ${n?mt.readOnly:""}`,onClick:c,title:e||"Click to edit",children:s.jsx("span",{className:mt.cellText,children:e||""})})}function LS({value:e,onChange:t,readOnly:n}){const r=(e==null?void 0:e.toLowerCase())==="true",a=()=>{n||t(r?"false":"true")};return s.jsx("div",{className:`${mt.booleanCell} ${n?mt.readOnly:""}`,onClick:a,children:s.jsx("div",{className:`${mt.checkbox} ${r?mt.checked:""}`,children:r&&s.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})})})})}function AS({value:e,options:t,onChange:n,readOnly:r}){const[a,i]=f.useState(!1),o=f.useRef(null);f.useEffect(()=>{const d=h=>{o.current&&!o.current.contains(h.target)&&i(!1)};return a&&document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[a]);const l=d=>{n(d),i(!1)},c=d=>{d.stopPropagation(),n(null),i(!1)};return s.jsxs("div",{ref:o,className:`${mt.listCell} ${r?mt.readOnly:""}`,children:[s.jsxs("div",{className:`${mt.listValue} ${e?"":mt.empty}`,onClick:()=>!r&&i(!a),children:[s.jsx("span",{children:e||""}),!r&&s.jsx("svg",{className:`${mt.chevron} ${a?mt.open:""}`,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),a&&s.jsxs("div",{className:mt.dropdown,children:[e&&s.jsx("div",{className:mt.clearOption,onClick:c,children:"Clear selection"}),t.map(d=>s.jsx("div",{className:`${mt.option} ${d===e?mt.selected:""}`,onClick:()=>l(d),children:d},d))]})]})}const BS="_header_5z3zo_3",RS="_resizing_5z3zo_25",OS="_filtered_5z3zo_29",FS="_content_5z3zo_33",zS="_icon_5z3zo_42",HS="_name_5z3zo_50",qS="_filterBtn_5z3zo_57",WS="_active_5z3zo_83",VS="_filterDropdown_5z3zo_89",US="_filterHeader_5z3zo_114",GS="_clearFilterBtn_5z3zo_125",YS="_filterActions_5z3zo_141",QS="_filterOptions_5z3zo_165",XS="_filterOption_5z3zo_165",KS="_filterValue_5z3zo_193",ZS="_filterValueEmpty_5z3zo_200",JS="_filterEmpty_5z3zo_206",eC="_resizeHandle_5z3zo_227",_t={header:BS,resizing:RS,filtered:OS,content:FS,icon:zS,name:HS,filterBtn:qS,active:WS,filterDropdown:VS,filterHeader:US,clearFilterBtn:GS,filterActions:YS,filterOptions:QS,filterOption:XS,filterValue:KS,filterValueEmpty:ZS,filterEmpty:JS,resizeHandle:eC};function tC({column:e,onEdit:t,onWidthChange:n}){const r=f.useRef(null),[a,i]=f.useState(!1),[o,l]=f.useState(!1),c=O(b=>b.customColumnValues),d=O(b=>b.customColumnFilters),h=O(b=>b.setCustomColumnFilter),m=O(b=>b.clearCustomColumnFilter),g=d[e.id]||[],_=g.length>0,y=f.useMemo(()=>{const b=new Set;return Object.entries(c).forEach(([B,M])=>{B.startsWith(`${e.id}-`)&&M&&b.add(M)}),Array.from(b).sort()},[e.id,c]);f.useEffect(()=>{const b=B=>{r.current&&!r.current.contains(B.target)&&l(!1)};return o&&document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[o]);const u=f.useCallback(b=>{b.preventDefault(),b.stopPropagation();const B=b.clientX,M=e.width;i(!0);const L=P=>{const I=P.clientX-B,D=Math.max(60,Math.min(400,M+I));n(e.id,D)},S=async()=>{i(!1),document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",S);try{await Du(e.id,{width:e.width})}catch(P){console.error("[CustomColumnHeader] Failed to save width:",P)}};document.addEventListener("mousemove",L),document.addEventListener("mouseup",S)},[e.id,e.width,n]),w=()=>{t(e)},p=b=>{b.stopPropagation(),l(!o)},x=b=>{const B=g.includes(b)?g.filter(M=>M!==b):[...g,b];B.length===0?m(e.id):h(e.id,B)},v=()=>{m(e.id),l(!1)},C=()=>{h(e.id,y)},N=()=>{switch(e.column_type){case"boolean":return s.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),s.jsx("polyline",{points:"9 11 12 14 22 4"})]});case"list":return s.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"6 9 12 15 18 9"})});default:return s.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"17",y1:"10",x2:"3",y2:"10"}),s.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),s.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),s.jsx("line",{x1:"17",y1:"18",x2:"3",y2:"18"})]})}};return s.jsxs("div",{ref:r,className:`${_t.header} ${a?_t.resizing:""} ${_?_t.filtered:""}`,style:{width:e.width},onDoubleClick:w,title:`${e.name} (double-click to edit)`,children:[s.jsxs("div",{className:_t.content,children:[s.jsx("span",{className:_t.icon,children:N()}),s.jsx("span",{className:_t.name,children:e.name})]}),s.jsx("button",{className:`${_t.filterBtn} ${_?_t.active:""}`,onClick:p,title:"Filter column",children:s.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})})}),o&&s.jsxs("div",{className:_t.filterDropdown,children:[s.jsxs("div",{className:_t.filterHeader,children:[s.jsx("span",{children:"Filter by value"}),_&&s.jsx("button",{className:_t.clearFilterBtn,onClick:v,children:"Clear"})]}),y.length===0?s.jsx("div",{className:_t.filterEmpty,children:"No values"}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:_t.filterActions,children:[s.jsx("button",{onClick:C,children:"Select All"}),s.jsx("button",{onClick:v,children:"Clear All"})]}),s.jsxs("div",{className:_t.filterOptions,children:[s.jsxs("label",{className:_t.filterOption,children:[s.jsx("input",{type:"checkbox",checked:g.includes("__empty__"),onChange:()=>x("__empty__")}),s.jsx("span",{className:_t.filterValueEmpty,children:"(Empty)"})]}),y.map(b=>s.jsxs("label",{className:_t.filterOption,children:[s.jsx("input",{type:"checkbox",checked:g.includes(b),onChange:()=>x(b)}),s.jsx("span",{className:_t.filterValue,children:e.column_type==="boolean"?b==="true"?" Yes":" No":b})]},b))]})]})]}),s.jsx("div",{className:_t.resizeHandle,onMouseDown:u})]})}const nC="_row_134mi_1",sC="_nameColumn_134mi_18",rC="_customCells_134mi_30",aC="_customCell_134mi_30",iC="_dragging_134mi_47",oC="_dropBefore_134mi_51",lC="_dropAfter_134mi_63",cC="_dragHandle_134mi_76",dC="_expandBtn_134mi_103",uC="_expanded_134mi_133",fC="_wbsLevel_134mi_137",hC="_completionBadge_134mi_163",mC="_manual_134mi_176",pC="_calculated_134mi_187",gC="_empty_134mi_197",_C="_colorDot_134mi_209",yC="_name_134mi_18",vC="_dateDisplay_134mi_226",Bt={row:nC,nameColumn:sC,customCells:rC,customCell:aC,dragging:iC,dropBefore:oC,dropAfter:lC,dragHandle:cC,expandBtn:dC,expanded:uC,wbsLevel:fC,completionBadge:hC,manual:mC,calculated:pC,empty:gC,colorDot:_C,name:yC,dateDisplay:vC};function xC(e){const t=[];function n(r){for(const a of r)t.push({entityType:"subphase",entityId:a.id}),a.children&&a.children.length>0&&n(a.children)}return n(e),t}function wC(e,t){const n={month:"short",day:"numeric"},r=new Date(e).toLocaleDateString("en-US",n),a=new Date(t).toLocaleDateString("en-US",n);return`${r} - ${a}`}function Ko(e){if(!e)return{completion:null,isCalculated:!1};const t=e.children||[];let n=!1;for(const r of t){if(!r)continue;const a=Ko(r);if(a&&a.completion!==null){n=!0;break}}if(n){let r=0,a=0;for(const i of t){if(!i)continue;const o=Ko(i),l=Math.max(1,Math.ceil((new Date(i.end_date).getTime()-new Date(i.start_date).getTime())/(1e3*60*60*24))),c=o.completion??0;a+=c*l,r+=l}if(r>0)return{completion:Math.round(a/r),isCalculated:!0}}return{completion:e.completion??null,isCalculated:!1}}const d_=f.memo(function({subphase:t,phaseId:n,projectId:r,depth:a,wbsLevel:i=1,siblings:o,parentId:l,parentType:c,customColumns:d=[],nameColumnWidth:h}){var te,he,Ee;const m=O(ne=>ne.expandedSubphases),g=O(ne=>ne.toggleSubphaseExpanded),_=O(ne=>ne.staff),y=O(ne=>ne.equipment),u=O(ne=>ne.currentUser),w=O(ne=>ne.showAssignments),p=ee(ne=>ne.openSubphaseModal),x=ee(ne=>ne.triggerScrollToDate),v=O(ne=>ne.projects),C=O(ne=>ne.setProjects),N=(u==null?void 0:u.role)==="admin"||(u==null?void 0:u.role)==="superuser",[b,B]=f.useState(null),M=!!b,{handleDragStart:L,handleDragOver:S,handleDragLeave:P,handleDrop:I,handleDragEnd:D,isDragging:k,getDropPosition:j}=o_(),T=m.has(t.id),E=ne=>{ne.stopPropagation(),g(t.id)},$=()=>{p(t,n,r)},A=f.useCallback(ne=>{ne.stopPropagation(),x(t.start_date)},[t.start_date,x]),R=f.useCallback(ne=>{ne.stopPropagation(),!Ko(t).isCalculated&&B(ne.currentTarget)},[t]),H=f.useCallback((ne,ke,Ht)=>ne.map(bt=>bt.id===ke?{...bt,completion:Ht}:bt.children&&bt.children.length>0?{...bt,children:H(bt.children,ke,Ht)}:bt),[]),F=f.useCallback(async ne=>{try{const ke=ne===-1?null:ne;await er(t.id,{completion:ke});const Ht=v.map(bt=>{var Ti;return bt.id!==r?bt:{...bt,phases:(Ti=bt.phases)==null?void 0:Ti.map(tr=>tr.id!==n?tr:{...tr,children:H(tr.children||[],t.id,ke)})}});C(Ht)}catch(ke){console.error("Failed to update completion:",ke)}},[t.id,r,n,v,C,H]),V=(((te=t.children)==null?void 0:te.length)??0)>0||(((he=t.staffAssignments)==null?void 0:he.length)??0)>0||(((Ee=t.equipmentAssignments)==null?void 0:Ee.length)??0)>0,Q=a*16+8,X=f.useMemo(()=>wC(t.start_date,t.end_date),[t.start_date,t.end_date]),Z=f.useMemo(()=>Ko(t),[t]),ce=f.useMemo(()=>xC(t.children??[]),[t.children]),K=ee(ne=>ne.showContextMenu),fe=f.useCallback(ne=>{ne.preventDefault(),K("subphase",t.id,ne.clientX,ne.clientY,r,n)},[K,t.id,r,n]),ae=f.useCallback(ne=>{L(ne,"subphase",t.id,r,l,c)},[L,t.id,r,l,c]),z=f.useCallback(ne=>{S(ne,"subphase",t.id)},[S,t.id]),ue=f.useCallback(ne=>{I(ne,"subphase",t.id,o,l,c)},[I,t.id,o,l,c]),Le=k("subphase",t.id),q=j("subphase",t.id);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`${Bt.row} ${Le?Bt.dragging:""} ${q?Bt[`drop${q.charAt(0).toUpperCase()+q.slice(1)}`]:""}`,"data-subphase-id":t.id,onDragOver:z,onDragLeave:P,onDrop:ue,onDoubleClick:$,onContextMenu:fe,children:[s.jsxs("div",{className:Bt.nameColumn,style:{width:h,paddingLeft:Q},children:[s.jsx("div",{className:Bt.dragHandle,draggable:!0,onDragStart:ae,onDragEnd:D,title:"Drag to reorder",children:s.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:[s.jsx("circle",{cx:"9",cy:"6",r:"2"}),s.jsx("circle",{cx:"15",cy:"6",r:"2"}),s.jsx("circle",{cx:"9",cy:"12",r:"2"}),s.jsx("circle",{cx:"15",cy:"12",r:"2"}),s.jsx("circle",{cx:"9",cy:"18",r:"2"}),s.jsx("circle",{cx:"15",cy:"18",r:"2"})]})}),s.jsx("button",{className:`${Bt.expandBtn} ${T?Bt.expanded:""}`,onClick:E,disabled:!V,children:V&&s.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"9 18 15 12 9 6"})})}),s.jsx("button",{className:`${Bt.completionBadge} ${Z.completion!==null?Z.isCalculated?Bt.calculated:Bt.manual:Bt.empty}`,onClick:R,title:Z.completion!==null?Z.isCalculated?"Calculated from children":"Click to edit":"Click to set completion",children:Z.completion!==null?`${Z.completion}%`:""}),s.jsxs("button",{className:Bt.wbsLevel,style:{backgroundColor:t.color},onClick:A,title:`Level ${i} - Click to scroll to start date`,children:["L",i]}),s.jsx("span",{className:Bt.name,title:t.name,children:t.name}),s.jsx("span",{className:Bt.dateDisplay,children:X})]}),d.length>0&&s.jsx("div",{className:Bt.customCells,children:d.map(ne=>s.jsx("div",{className:Bt.customCell,style:{width:ne.width},children:s.jsx(c_,{column:ne,entityType:"subphase",entityId:t.id,readOnly:!N,childEntities:ce})},ne.id))})]}),M&&xu.createPortal(s.jsx(l_,{value:t.completion??null,onChange:F,onClose:()=>B(null),anchorEl:b,isCalculated:Z.isCalculated}),document.body),T&&s.jsxs(s.Fragment,{children:[s.jsx(jC,{subphases:t.children??[],phaseId:n,projectId:r,depth:a+1,wbsLevel:i+1,parentId:t.id,parentType:"subphase",customColumns:d,nameColumnWidth:h}),w&&(t.staffAssignments??[]).map(ne=>{const ke=_.find(Ht=>Ht.id===ne.staff_id);return s.jsx(pa,{type:"subphase-staff",assignmentId:ne.id,projectId:r,phaseId:n,subphaseId:t.id,staffId:ne.staff_id,name:(ke==null?void 0:ke.name)||ne.staff_name||"Unknown",role:ke==null?void 0:ke.role,allocation:ne.allocation,phaseType:t.name,phaseColor:t.color,depth:a+1},`staff-${ne.id}`)}),w&&(t.equipmentAssignments??[]).map(ne=>{const ke=y.find(Ht=>Ht.id===ne.equipment_id);return s.jsx(pa,{type:"equipment",assignmentId:ne.id,projectId:r,phaseId:n,subphaseId:t.id,equipmentId:ne.equipment_id,name:(ke==null?void 0:ke.name)||ne.equipment_name||"Unknown",equipmentType:ke==null?void 0:ke.type,depth:a+1},`equip-${ne.id}`)})]})]})});function jC({subphases:e,phaseId:t,projectId:n,depth:r,wbsLevel:a,parentId:i,parentType:o,customColumns:l,nameColumnWidth:c}){const d=ee(x=>x.phantomSiblingMode),h=O(x=>x.customColumnFilters),m=O(x=>x.customColumnValues),{completePhantom:g,cancelPhantom:_}=$i(),y=(d==null?void 0:d.type)==="subphase"&&d.projectId===n?d.sourceId:null,u=f.useCallback((x,v)=>{const C=Object.keys(h).filter(N=>{var b;return((b=h[Number(N)])==null?void 0:b.length)>0});if(C.length===0)return!0;for(const N of C){const b=Number(N),B=h[b],M=`${b}-${x}-${v}`,L=m[M]??null;if(L===null){if(!B.includes("__empty__"))return!1}else if(!B.includes(L))return!1}return!0},[h,m]),w=f.useCallback(x=>{for(const v of x)if(u("subphase",v.id)||v.children&&v.children.length>0&&w(v.children))return!0;return!1},[u]),p=f.useMemo(()=>e.filter(x=>u("subphase",x.id)||w(x.children??[])),[e,u,w]);return s.jsx(s.Fragment,{children:p.map(x=>s.jsxs(f.Fragment,{children:[s.jsx(d_,{subphase:x,phaseId:t,projectId:n,depth:r,wbsLevel:a,siblings:e,parentId:i,parentType:o,customColumns:l,nameColumnWidth:c}),y===x.id&&s.jsx(Lu,{onComplete:g,onCancel:_})]},x.id))})}const SC="_row_1i1ra_1",CC="_nameColumn_1i1ra_18",kC="_customCells_1i1ra_30",bC="_customCell_1i1ra_30",NC="_dragging_1i1ra_47",DC="_dropBefore_1i1ra_51",$C="_dropAfter_1i1ra_63",EC="_dragHandle_1i1ra_76",TC="_expandBtn_1i1ra_103",MC="_expanded_1i1ra_133",IC="_completionBadge_1i1ra_137",PC="_manual_1i1ra_150",LC="_calculated_1i1ra_161",AC="_empty_1i1ra_171",BC="_typeBadge_1i1ra_183",RC="_colorDot_1i1ra_196",OC="_name_1i1ra_18",FC="_dateDisplay_1i1ra_212",qt={row:SC,nameColumn:CC,customCells:kC,customCell:bC,dragging:NC,dropBefore:DC,dropAfter:$C,dragHandle:EC,expandBtn:TC,expanded:MC,completionBadge:IC,manual:PC,calculated:LC,empty:AC,typeBadge:BC,colorDot:RC,name:OC,dateDisplay:FC};function zC(e){const t=[];function n(r){for(const a of r)t.push({entityType:"subphase",entityId:a.id}),a.children&&a.children.length>0&&n(a.children)}return n(e),t}function HC(e,t){const n={month:"short",day:"numeric"},r=new Date(e).toLocaleDateString("en-US",n),a=new Date(t).toLocaleDateString("en-US",n);return`${r} - ${a}`}function Zo(e){if(!e)return{completion:null,isCalculated:!1};const t=e.children||[];let n=!1;for(const r of t){if(!r)continue;const a=Zo(r);if(a&&a.completion!==null){n=!0;break}}if(n){let r=0,a=0;for(const i of t){if(!i)continue;const o=Zo(i),l=Math.max(1,Math.ceil((new Date(i.end_date).getTime()-new Date(i.start_date).getTime())/(1e3*60*60*24))),c=o.completion??0;a+=c*l,r+=l}if(r>0)return{completion:Math.round(a/r),isCalculated:!0}}return{completion:e.completion??null,isCalculated:!1}}const qC=f.memo(function({phase:t,projectId:n,depth:r,phases:a,customColumns:i=[],nameColumnWidth:o}){var K,fe,ae;const l=O(z=>z.expandedPhases),c=O(z=>z.togglePhaseExpanded),d=O(z=>z.staff),h=O(z=>z.equipment),m=O(z=>z.currentUser),g=O(z=>z.showAssignments),_=O(z=>z.projects),y=O(z=>z.setProjects),u=ee(z=>z.openPhaseModal),w=(m==null?void 0:m.role)==="admin"||(m==null?void 0:m.role)==="superuser",[p,x]=f.useState(null),v=!!p,{handleDragStart:C,handleDragOver:N,handleDragLeave:b,handleDrop:B,handleDragEnd:M,isDragging:L,getDropPosition:S}=o_(),P=l.has(t.id),I=z=>{z.stopPropagation(),c(t.id)},D=()=>{u(t,n)},k=f.useCallback(z=>{z.stopPropagation(),!Zo(t).isCalculated&&x(z.currentTarget)},[t]),j=f.useCallback(async z=>{try{const ue=z===-1?null:z;await Js(t.id,{completion:ue});const Le=_.map(q=>q.id!==n?q:{...q,phases:(q.phases??[]).map(te=>te.id===t.id?{...te,completion:ue}:te)});y(Le)}catch(ue){console.error("Failed to update phase completion:",ue)}},[t.id,n,_,y]),T=(((K=t.children)==null?void 0:K.length)??0)>0||(((fe=t.staffAssignments)==null?void 0:fe.length)??0)>0||(((ae=t.equipmentAssignments)==null?void 0:ae.length)??0)>0,E=r*16+8,$=f.useMemo(()=>t.is_milestone?new Date(t.start_date).toLocaleDateString("en-US",{month:"short",day:"numeric"}):HC(t.start_date,t.end_date),[t.start_date,t.end_date,t.is_milestone]),A=f.useMemo(()=>Zo(t),[t]),R=f.useMemo(()=>zC(t.children??[]),[t.children]),H=ee(z=>z.showContextMenu),F=f.useCallback(z=>{z.preventDefault(),H("phase",t.id,z.clientX,z.clientY,n)},[H,t.id,n]),V=f.useCallback(z=>{C(z,"phase",t.id,n)},[C,t.id,n]),Q=f.useCallback(z=>{N(z,"phase",t.id)},[N,t.id]),X=f.useCallback(z=>{B(z,"phase",t.id,a)},[B,t.id,a]),Z=L("phase",t.id),ce=S("phase",t.id);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`${qt.row} ${Z?qt.dragging:""} ${ce?qt[`drop${ce.charAt(0).toUpperCase()+ce.slice(1)}`]:""}`,"data-phase-id":t.id,onDragOver:Q,onDragLeave:b,onDrop:X,onDoubleClick:D,onContextMenu:F,children:[s.jsxs("div",{className:qt.nameColumn,style:{width:o,paddingLeft:E},children:[s.jsx("div",{className:qt.dragHandle,draggable:!0,onDragStart:V,onDragEnd:M,title:"Drag to reorder",children:s.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:[s.jsx("circle",{cx:"9",cy:"6",r:"2"}),s.jsx("circle",{cx:"15",cy:"6",r:"2"}),s.jsx("circle",{cx:"9",cy:"12",r:"2"}),s.jsx("circle",{cx:"15",cy:"12",r:"2"}),s.jsx("circle",{cx:"9",cy:"18",r:"2"}),s.jsx("circle",{cx:"15",cy:"18",r:"2"})]})}),s.jsx("button",{className:`${qt.expandBtn} ${P?qt.expanded:""}`,onClick:I,disabled:!T,children:T&&s.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"9 18 15 12 9 6"})})}),s.jsx("span",{className:`${qt.completionBadge} ${A.completion!==null?A.isCalculated?qt.calculated:qt.manual:qt.empty}`,style:{cursor:A.isCalculated?"default":"pointer"},title:A.completion!==null?A.isCalculated?"Calculated from children":"Click to edit":"Click to set completion",onClick:k,children:A.completion!==null?`${A.completion}%`:""}),s.jsxs("span",{className:qt.typeBadge,style:{backgroundColor:`${t.color}33`,color:t.color},children:[t.is_milestone?"":"",t.name]}),s.jsx("span",{className:qt.dateDisplay,children:$})]}),i.length>0&&s.jsx("div",{className:qt.customCells,children:i.map(z=>s.jsx("div",{className:qt.customCell,style:{width:z.width},children:s.jsx(c_,{column:z,entityType:"phase",entityId:t.id,readOnly:!w,childEntities:R})},z.id))})]}),P&&s.jsxs(s.Fragment,{children:[s.jsx(WC,{subphases:t.children??[],phaseId:t.id,projectId:n,depth:r+1,customColumns:i,nameColumnWidth:o}),g&&(t.staffAssignments??[]).map(z=>{const ue=d.find(Le=>Le.id===z.staff_id);return s.jsx(pa,{type:"phase-staff",assignmentId:z.id,projectId:n,phaseId:t.id,staffId:z.staff_id,name:(ue==null?void 0:ue.name)||z.staff_name||"Unknown",role:ue==null?void 0:ue.role,allocation:z.allocation,phaseType:t.name,phaseColor:t.color,depth:r+1},`staff-${z.id}`)}),g&&(t.equipmentAssignments??[]).map(z=>{const ue=h.find(Le=>Le.id===z.equipment_id);return s.jsx(pa,{type:"equipment",assignmentId:z.id,projectId:n,phaseId:t.id,equipmentId:z.equipment_id,name:(ue==null?void 0:ue.name)||z.equipment_name||"Unknown",equipmentType:ue==null?void 0:ue.type,depth:r+1},`equip-${z.id}`)})]}),v&&s.jsx(l_,{value:t.completion??null,onClose:()=>x(null),anchorEl:p,onChange:j})]})});function WC({subphases:e,phaseId:t,projectId:n,depth:r,customColumns:a,nameColumnWidth:i}){const o=ee(u=>u.phantomSiblingMode),l=O(u=>u.customColumnFilters),c=O(u=>u.customColumnValues),{completePhantom:d,cancelPhantom:h}=$i(),m=(o==null?void 0:o.type)==="subphase"&&o.projectId===n&&o.parentType==="phase"&&o.parentId===t?o.sourceId:null,g=f.useCallback((u,w)=>{const p=Object.keys(l).filter(x=>{var v;return((v=l[Number(x)])==null?void 0:v.length)>0});if(p.length===0)return!0;for(const x of p){const v=Number(x),C=l[v],N=`${v}-${u}-${w}`,b=c[N]??null;if(b===null){if(!C.includes("__empty__"))return!1}else if(!C.includes(b))return!1}return!0},[l,c]),_=f.useCallback(u=>{for(const w of u)if(g("subphase",w.id)||w.children&&w.children.length>0&&_(w.children))return!0;return!1},[g]),y=f.useMemo(()=>e.filter(u=>g("subphase",u.id)||_(u.children??[])),[e,g,_]);return s.jsx(s.Fragment,{children:y.map(u=>s.jsxs(f.Fragment,{children:[s.jsx(d_,{subphase:u,phaseId:t,projectId:n,depth:r,wbsLevel:1,siblings:e,parentId:t,parentType:"phase",customColumns:a,nameColumnWidth:i}),m===u.id&&s.jsx(Lu,{onComplete:d,onCancel:h})]},u.id))})}const VC="_row_gmhu2_1",UC="_unconfirmed_gmhu2_16",GC="_name_gmhu2_20",YC="_nameColumn_gmhu2_25",QC="_levelControls_gmhu2_37",XC="_levelBtn_gmhu2_47",KC="_status_gmhu2_118",ZC="_confirmed_gmhu2_126",JC="_pending_gmhu2_130",ek="_completionBadge_gmhu2_135",tk="_info_gmhu2_150",nk="_meta_gmhu2_166",sk="_pm_gmhu2_175",rk="_customer_gmhu2_179",ak="_children_gmhu2_197",ik="_customCells_gmhu2_202",ok="_customCell_gmhu2_202",lk="_emptyCell_gmhu2_218",yt={row:VC,unconfirmed:UC,name:GC,nameColumn:YC,levelControls:QC,levelBtn:XC,status:KC,confirmed:ZC,pending:JC,completionBadge:ek,info:tk,meta:nk,pm:sk,customer:rk,children:ak,customCells:ik,customCell:ok,emptyCell:lk};function yd(e){if(!e)return{completion:null,isCalculated:!1};const t=e.children||[];let n=!1;for(const r of t){if(!r)continue;const a=yd(r);if(a&&a.completion!==null){n=!0;break}}if(n){let r=0,a=0;for(const i of t){if(!i)continue;const o=yd(i),l=Math.max(1,Math.ceil((new Date(i.end_date).getTime()-new Date(i.start_date).getTime())/(1e3*60*60*24))),c=o.completion??0;a+=c*l,r+=l}if(r>0)return{completion:Math.round(a/r),isCalculated:!0}}return{completion:e.completion??null,isCalculated:!1}}function ck(e){const t=e.phases??[];if(t.length===0)return null;let n=0,r=0;return t.forEach(a=>{const i=yd(a),o=new Date(a.start_date),l=new Date(a.end_date),c=Math.max(1,(l.getTime()-o.getTime())/(1e3*60*60*24)),d=i.completion??0;n+=d*c,r+=c}),r>0?Math.round(n/r):null}const dk=f.memo(function({project:t,customColumns:n=[],nameColumnWidth:r}){const a=O(M=>M.expandedProjects),i=O(M=>M.expandedPhases),o=O(M=>M.expandedSubphases),l=O(M=>M.toggleProjectExpanded),c=O(M=>M.expandProjectLevel),d=O(M=>M.collapseProjectLevel),h=O(M=>M.staff),m=O(M=>M.equipment),g=O(M=>M.showAssignments),_=ee(M=>M.openProjectModal),y=a.has(t.id),u=f.useMemo(()=>ck(t),[t]),w=f.useMemo(()=>{if(!a.has(t.id))return 0;const M=t.phases??[];if(!M.some(P=>i.has(P.id)))return 1;let S=!1;return M.forEach(P=>{const I=D=>{D==null||D.forEach(k=>{o.has(k.id)&&(S=!0),I(k.children)})};I(P.children)}),S?3:2},[t,a,i,o]),p=f.useMemo(()=>{const M=t.phases??[];let L=1;return M.forEach(S=>{var P;if(((P=S.children)==null?void 0:P.length)>0){L=Math.max(L,2);const I=(D,k)=>{D==null||D.forEach(j=>{var T;L=Math.max(L,k),((T=j.children)==null?void 0:T.length)>0&&I(j.children,k+1)})};I(S.children,3)}}),L},[t]),x=M=>{M.stopPropagation(),l(t.id)},v=M=>{M.stopPropagation(),c(t.id)},C=M=>{M.stopPropagation(),d(t.id)},N=()=>{_(t)},b=ee(M=>M.showContextMenu),B=f.useCallback(M=>{M.preventDefault(),b("project",t.id,M.clientX,M.clientY)},[b,t.id]);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`${yt.row} ${t.confirmed?"":yt.unconfirmed}`,"data-project-id":t.id,onDoubleClick:N,onContextMenu:B,children:[s.jsxs("div",{className:yt.nameColumn,style:{width:r},children:[s.jsxs("div",{className:yt.levelControls,onClick:M=>M.stopPropagation(),children:[s.jsx("button",{className:yt.levelBtn,onClick:C,disabled:w===0,title:"Collapse one level",children:s.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})})}),s.jsx("button",{className:yt.levelBtn,onClick:v,disabled:w>=p,title:"Expand one level",children:s.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})]}),s.jsx("span",{className:`${yt.status} ${t.confirmed?yt.confirmed:yt.pending}`,title:t.confirmed?"Confirmed":"Unconfirmed",onClick:x}),u!==null&&s.jsxs("span",{className:yt.completionBadge,title:"Project completion (calculated from phases)",children:[u,"%"]}),s.jsxs("div",{className:yt.info,onClick:x,children:[s.jsx("span",{className:yt.name,title:t.name,children:t.name}),s.jsxs("span",{className:yt.meta,children:[t.pm_name&&s.jsx("span",{className:yt.pm,children:t.pm_name}),t.customer&&s.jsxs("span",{className:yt.customer,children:["  ",t.customer]})]})]})]}),n.length>0&&s.jsx("div",{className:yt.customCells,children:n.map(M=>s.jsx("div",{className:`${yt.customCell} ${yt.emptyCell}`,style:{width:M.width}},M.id))})]}),y&&s.jsxs("div",{className:yt.children,children:[s.jsx(uk,{phases:t.phases??[],projectId:t.id,customColumns:n,nameColumnWidth:r}),g&&(t.staffAssignments??[]).map(M=>{const L=h.find(S=>S.id===M.staff_id);return s.jsx(pa,{type:"staff",assignmentId:M.id,projectId:t.id,staffId:M.staff_id,name:(L==null?void 0:L.name)||M.staff_name||"Unknown",role:L==null?void 0:L.role,allocation:M.allocation,startDate:M.start_date,endDate:M.end_date,depth:1},`staff-${M.id}`)}),g&&(t.equipmentAssignments??[]).map(M=>{const L=m.find(S=>S.id===M.equipment_id);return s.jsx(pa,{type:"equipment",assignmentId:M.id,projectId:t.id,equipmentId:M.equipment_id,name:(L==null?void 0:L.name)||M.equipment_name||"Unknown",equipmentType:L==null?void 0:L.type,startDate:M.start_date,endDate:M.end_date,depth:1},`equip-${M.id}`)})]})]})});function uk({phases:e,projectId:t,customColumns:n,nameColumnWidth:r}){const a=ee(_=>_.phantomSiblingMode),i=O(_=>_.customColumnFilters),o=O(_=>_.customColumnValues),{completePhantom:l,cancelPhantom:c}=$i(),d=(a==null?void 0:a.type)==="phase"&&a.projectId===t?a.sourceId:null,h=f.useCallback((_,y)=>{const u=Object.keys(i).filter(w=>{var p;return((p=i[Number(w)])==null?void 0:p.length)>0});if(u.length===0)return!0;for(const w of u){const p=Number(w),x=i[p],v=`${p}-${_}-${y}`,C=o[v]??null;if(C===null){if(!x.includes("__empty__"))return!1}else if(!x.includes(C))return!1}return!0},[i,o]),m=f.useCallback(_=>{for(const y of _)if(h("subphase",y.id)||y.children&&y.children.length>0&&m(y.children))return!0;return!1},[h]),g=f.useMemo(()=>e.filter(_=>h("phase",_.id)||m(_.children??[])),[e,h,m]);return s.jsx(s.Fragment,{children:g.map(_=>s.jsxs(f.Fragment,{children:[s.jsx(qC,{phase:_,projectId:t,depth:1,phases:e,customColumns:n,nameColumnWidth:r}),d===_.id&&s.jsx(Lu,{onComplete:l,onCancel:c})]},_.id))})}const fk="_overlay_e3ihd_1",hk="_fadeIn_e3ihd_1",mk="_modal_e3ihd_14",pk="_slideIn_e3ihd_1",gk="_sm_e3ihd_30",_k="_md_e3ihd_35",yk="_lg_e3ihd_40",vk="_xl_e3ihd_45",xk="_xxl_e3ihd_50",wk="_full_e3ihd_55",jk="_header_e3ihd_62",Sk="_title_e3ihd_71",Ck="_closeBtn_e3ihd_78",kk="_body_e3ihd_103",bk="_footer_e3ihd_109",vs={overlay:fk,fadeIn:hk,modal:mk,slideIn:pk,sm:gk,md:_k,lg:yk,xl:vk,xxl:xk,full:wk,header:jk,title:Sk,closeBtn:Ck,body:kk,footer:bk};function gt({isOpen:e,onClose:t,title:n,children:r,size:a="md",footer:i,closeOnOverlayClick:o=!0,closeOnEscape:l=!0}){const c=f.useRef(null),d=f.useRef(null),h=f.useRef(!1),m=f.useRef(t);m.current=t;const g=f.useCallback(y=>{o&&y.target===c.current&&m.current()},[o]);if(f.useEffect(()=>{if(!e||!l)return;const y=u=>{u.key==="Escape"&&m.current()};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[e,l]),f.useEffect(()=>{var y;return e&&!h.current?(document.body.style.overflow="hidden",(y=d.current)==null||y.focus(),h.current=!0):!e&&h.current&&(document.body.style.overflow="",h.current=!1),()=>{h.current&&(document.body.style.overflow="")}},[e]),!e)return null;const _=[vs.modal,vs[a]].join(" ");return xu.createPortal(s.jsx("div",{ref:c,className:vs.overlay,onClick:g,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:s.jsxs("div",{ref:d,className:_,tabIndex:-1,children:[s.jsxs("div",{className:vs.header,children:[s.jsx("h2",{id:"modal-title",className:vs.title,children:n}),s.jsx("button",{className:vs.closeBtn,onClick:t,"aria-label":"Close modal",children:s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),s.jsx("div",{className:vs.body,children:r}),i&&s.jsx("div",{className:vs.footer,children:i})]})}),document.body)}const Nk="_button_4ftbf_1",Dk="_sm_4ftbf_21",$k="_md_4ftbf_27",Ek="_lg_4ftbf_33",Tk="_primary_4ftbf_40",Mk="_secondary_4ftbf_53",Ik="_danger_4ftbf_64",Pk="_ghost_4ftbf_73",Lk="_icon_4ftbf_83",Ak="_disabled_4ftbf_107",Bk="_loading_4ftbf_113",Rk="_content_4ftbf_117",Ok="_spinner_4ftbf_123",Fk="_spin_4ftbf_123",ts={button:Nk,sm:Dk,md:$k,lg:Ek,primary:Tk,secondary:Mk,danger:Ik,ghost:Pk,icon:Lk,disabled:Ak,loading:Bk,content:Rk,spinner:Ok,spin:Fk},oe=f.forwardRef(({variant:e="primary",size:t="md",loading:n=!1,icon:r,iconPosition:a="left",children:i,className:o,disabled:l,...c},d)=>{const h=[ts.button,ts[e],ts[t],n&&ts.loading,l&&ts.disabled,o].filter(Boolean).join(" ");return s.jsxs("button",{ref:d,className:h,disabled:n||l,...c,children:[n&&s.jsx("span",{className:ts.spinner}),!n&&r&&a==="left"&&s.jsx("span",{className:ts.icon,children:r}),i&&s.jsx("span",{className:ts.content,children:i}),!n&&r&&a==="right"&&s.jsx("span",{className:ts.icon,children:r})]})});oe.displayName="Button";function We(e){return e?e.includes("T")?e.split("T")[0]:e:""}function Ur(e){if(!e)return"";try{const t=ps(e);return Ie(t,"MM/dd/yyyy")}catch{return e}}function vd(e,t){if(!e||!t)return 1;try{const n=ps(e),r=ps(t);return Us(r,n)+1}catch{return 1}}function u_(e,t){return e===t}function Ih(e,t){return!e||e.length===0?"":e.map(n=>{const r=`phase-${n.id}`,a=`subphase-${n.id}`;let i=t[r]||t[a];if(!i)return null;let o=`${i}${n.type}`;return n.lag&&n.lag!==0&&(o+=n.lag>0?`+${n.lag}d`:`${n.lag}d`),o}).filter(Boolean).join(",")}function f_(e,t,n,r,a){const i=e.filter(o=>o.parent_subphase_id===t);for(const o of i){const l=r.length+1,c=`subphase-${o.id}`;a[c]=l;const d=u_(o.start_date,o.end_date);r.push({id:l,name:d?` ${o.name}`:o.name,outlineLevel:n,start:Ur(o.start_date),finish:Ur(o.end_date),duration:d?"0d":`${vd(o.start_date,o.end_date)}d`,predecessors:"",percentComplete:o.completion||0,milestone:d?"Yes":"No",notes:"",internalId:c}),f_(e,o.id,n+1,r,a)}}function Ph(e){const t=[];function n(r){if(r)for(const a of r)t.push(a),a.children&&n(a.children)}return n(e.children),t}function zk(e){const t=[],n={};for(const i of e){const o=t.length+1,l=`project-${i.id}`;n[l]=o,t.push({id:o,name:i.name,outlineLevel:1,start:Ur(i.start_date),finish:Ur(i.end_date),duration:`${vd(i.start_date,i.end_date)}d`,predecessors:"",percentComplete:0,milestone:"No",notes:[i.customer?`Customer: ${i.customer}`:"",i.pm_name?`PM: ${i.pm_name}`:"",i.confirmed?"":"UNCONFIRMED"].filter(Boolean).join("; "),internalId:l});for(const c of i.phases||[]){const d=t.length+1,h=`phase-${c.id}`;n[h]=d;const m=u_(c.start_date,c.end_date);t.push({id:d,name:m?` ${c.name}`:c.name,outlineLevel:2,start:Ur(c.start_date),finish:Ur(c.end_date),duration:m?"0d":`${vd(c.start_date,c.end_date)}d`,predecessors:"",percentComplete:c.completion||0,milestone:m?"Yes":"No",notes:"",internalId:h});const g=Ph(c);g.length>0&&f_(g,null,3,t,n)}}for(const i of e)for(const o of i.phases||[]){const l=t.find(d=>d.internalId===`phase-${o.id}`);l&&o.dependencies&&(l.predecessors=Ih(o.dependencies,n));const c=Ph(o);for(const d of c){const h=t.find(m=>m.internalId===`subphase-${d.id}`);h&&d.dependencies&&(h.predecessors=Ih(d.dependencies,n))}}return[["ID","Name","Outline Level","Start","Finish","Duration","Predecessors","% Complete","Milestone","Notes"].join(","),...t.map(i=>[i.id,`"${i.name.replace(/"/g,'""')}"`,i.outlineLevel,i.start,i.finish,i.duration,i.predecessors,i.percentComplete,i.milestone,`"${i.notes.replace(/"/g,'""')}"`].join(","))].join(`
`)}function Hk(e,t){const n=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}function qk(e,t){const n=zk(e),r=Ie(new Date,"yyyy-MM-dd"),a=t?`${t.toLowerCase().replace(/\s+/g,"-")}-projects-${r}.csv`:`projects-export-${r}.csv`;Hk(n,a)}function Wk(e){const t=[];t.push('<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'),t.push('<Project xmlns="http://schemas.microsoft.com/project">'),t.push(`  <Name>${eo(e.name)}</Name>`),t.push(`  <Title>${eo(e.name)}</Title>`),t.push(`  <Company>${eo(e.customer||"")}</Company>`),e.start_date&&t.push(`  <StartDate>${e.start_date}T08:00:00</StartDate>`),e.end_date&&t.push(`  <FinishDate>${e.end_date}T17:00:00</FinishDate>`),t.push("  <ScheduleFromStart>1</ScheduleFromStart>"),t.push(`  <CurrentDate>${Ie(new Date,"yyyy-MM-dd'T'HH:mm:ss")}</CurrentDate>`),t.push("  <CalendarUID>1</CalendarUID>"),t.push("  <Calendars>"),t.push("    <Calendar>"),t.push("      <UID>1</UID>"),t.push("      <Name>Standard</Name>"),t.push("      <IsBaseCalendar>1</IsBaseCalendar>"),t.push("    </Calendar>"),t.push("  </Calendars>"),t.push("  <Tasks>");let n=0;const r=(a,i,o,l,c=!1,d=0)=>{n++,t.push("    <Task>"),t.push(`      <UID>${n}</UID>`),t.push(`      <ID>${n}</ID>`),t.push(`      <Name>${eo(a)}</Name>`),t.push(`      <OutlineLevel>${l}</OutlineLevel>`),i&&t.push(`      <Start>${i}T08:00:00</Start>`),o&&t.push(`      <Finish>${o}T17:00:00</Finish>`),t.push(`      <Milestone>${c?"1":"0"}</Milestone>`),t.push(`      <PercentComplete>${d||0}</PercentComplete>`),t.push("    </Task>")};r(e.name,e.start_date,e.end_date,0);for(const a of e.phases||[]){const i=a.start_date===a.end_date;r(a.name,a.start_date,a.end_date,1,i,a.completion||0);const o=(l,c)=>{for(const d of l||[]){const h=d.start_date===d.end_date;r(d.name,d.start_date,d.end_date,c,h,d.completion||0),d.children&&d.children.length>0&&o(d.children,c+1)}};o(a.children,2)}return t.push("  </Tasks>"),t.push("  <Resources/>"),t.push("  <Assignments/>"),t.push("</Project>"),t.join(`
`)}function eo(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Vk(e,t){const n=new Blob([e],{type:"application/xml;charset=utf-8;"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}function Uk(e){const t=Wk(e),n=`${e.name.replace(/\s+/g,"_")}.xml`;Vk(t,n)}const Gk="_form_b7hew_3",Yk="_formGroup_b7hew_9",Qk="_formRow_b7hew_15",Xk="_label_b7hew_21",Kk="_input_b7hew_27",Zk="_checkbox_b7hew_63",Jk="_phaseTags_b7hew_79",eb="_phaseTag_b7hew_79",tb="_selected_b7hew_102",nb="_error_b7hew_109",sb="_footer_b7hew_119",rb="_exportButtons_b7hew_126",ab="_actionButtons_b7hew_141",ve={form:Gk,formGroup:Yk,formRow:Qk,label:Xk,input:Kk,checkbox:Zk,phaseTags:Jk,phaseTag:eb,selected:tb,error:nb,footer:sb,exportButtons:rb,actionButtons:ab};function ib(){const{activeModal:e,editingProject:t,closeModal:n}=ee(),{currentSite:r,staff:a,setProjects:i}=O(),o=e==="project",l=!!t,[c,d]=f.useState(""),[h,m]=f.useState(""),[g,_]=f.useState(""),[y,u]=f.useState(""),[w,p]=f.useState(""),[x,v]=f.useState(!1),[C,N]=f.useState(!1),[b,B]=f.useState(""),[M,L]=f.useState(""),[S,P]=f.useState(new Set),[I,D]=f.useState([]),[k,j]=f.useState(!1),[T,E]=f.useState(null),$=f.useMemo(()=>r?a.filter(K=>K.site_id===r.id):[],[a,r]);f.useEffect(()=>{o&&ux().then(K=>{const ae=K.filter(z=>z.is_active!==!1);D(ae),l||P(new Set(ae.map(z=>z.name)))}).catch(K=>console.error("Failed to load predefined phases:",K))},[o,l]),f.useEffect(()=>{var K,fe;if(o){if(t)d(t.name),m(t.customer||""),_(((K=t.pm_id)==null?void 0:K.toString())||""),u(t.sales_pm||""),p(((fe=t.volume)==null?void 0:fe.toString())||""),v(t.confirmed),N(t.archived||!1),B(We(t.start_date)),L(We(t.end_date)),P(new Set);else{const ae=new Date,z=new Date(ae);z.setMonth(z.getMonth()+1),d(""),m(""),_(""),u(""),p(""),v(!1),N(!1),B(ae.toISOString().split("T")[0]),L(z.toISOString().split("T")[0])}E(null)}},[o,t]);const A=K=>{P(fe=>{const ae=new Set(fe);return ae.has(K)?ae.delete(K):ae.add(K),ae})},R=async K=>{if(K.preventDefault(),!c.trim()){E("Please enter a project name");return}if(!b||!M){E("Please select start and end dates");return}if(!r){E("No site selected");return}j(!0),E(null);try{const fe=[];if(S.size>0&&!l){const ue=new Date(b),Le=new Date(M),te=(Le.getTime()-ue.getTime())/S.size;let he=0;for(const Ee of I)if(S.has(Ee.name)){const ne=new Date(ue.getTime()+te*he),ke=new Date(ue.getTime()+te*(he+1)),Ht=ke>Le?Le:ke;fe.push({type:Ee.name,start_date:ne.toISOString().split("T")[0],end_date:Ht.toISOString().split("T")[0]}),he++}}const ae={name:c.trim(),site_id:r.id,customer:h.trim()||null,pm_id:g?parseInt(g):null,sales_pm:y.trim()||null,volume:w?parseInt(w):null,confirmed:x,archived:C,start_date:b,end_date:M,phases:l?void 0:fe};l&&t?await bi(t.id,ae):await Fv(ae);const z=await ft();i(z),n()}catch(fe){E(fe instanceof Error?fe.message:"Failed to save project")}finally{j(!1)}},[H,F]=f.useState(!1),V=O(K=>K.projects),Q=f.useMemo(()=>t?V.find(K=>K.id===t.id):null,[t,V]),X=()=>{Q&&qk([Q],Q.name)},Z=()=>{if(Q){F(!0);try{Uk(Q)}catch(K){console.error("Export failed:",K),alert("Failed to export to MS Project format")}finally{F(!1)}}},ce=s.jsxs("div",{className:ve.footer,children:[l&&s.jsxs("div",{className:ve.exportButtons,children:[s.jsxs(oe,{variant:"secondary",onClick:X,disabled:k||H,title:"Export to CSV (MS Project compatible)",children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),s.jsx("polyline",{points:"7,10 12,15 17,10"}),s.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"CSV"]}),s.jsxs(oe,{variant:"secondary",onClick:Z,disabled:k||H,title:"Export to MS Project XML format",children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),s.jsx("polyline",{points:"7,10 12,15 17,10"}),s.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),H?"Exporting...":"XML"]})]}),s.jsxs("div",{className:ve.actionButtons,children:[s.jsx(oe,{variant:"secondary",onClick:n,disabled:k,children:"Cancel"}),s.jsx(oe,{variant:"primary",onClick:R,disabled:k,children:k?"Saving...":l?"Save Changes":"Create Project"})]})]});return s.jsx(gt,{isOpen:o,onClose:n,title:l?"Edit Project":"New Project",size:"lg",footer:ce,children:s.jsxs("form",{onSubmit:R,className:ve.form,children:[T&&s.jsx("div",{className:ve.error,children:T}),s.jsxs("div",{className:ve.formGroup,children:[s.jsx("label",{className:ve.label,children:"Project Name *"}),s.jsx("input",{type:"text",className:ve.input,value:c,onChange:K=>d(K.target.value),placeholder:"Enter project name",autoFocus:!0})]}),s.jsxs("div",{className:ve.formRow,children:[s.jsxs("div",{className:ve.formGroup,children:[s.jsx("label",{className:ve.label,children:"Start Date *"}),s.jsx("input",{type:"date",className:ve.input,value:b,onChange:K=>B(K.target.value)})]}),s.jsxs("div",{className:ve.formGroup,children:[s.jsx("label",{className:ve.label,children:"End Date *"}),s.jsx("input",{type:"date",className:ve.input,value:M,onChange:K=>L(K.target.value)})]})]}),s.jsxs("div",{className:ve.formRow,children:[s.jsxs("div",{className:ve.formGroup,children:[s.jsx("label",{className:ve.label,children:"Project Manager"}),s.jsxs("select",{className:ve.input,value:g,onChange:K=>_(K.target.value),children:[s.jsx("option",{value:"",children:"Select PM"}),$.map(K=>s.jsx("option",{value:K.id,children:K.name},K.id))]})]}),s.jsxs("div",{className:ve.formGroup,children:[s.jsx("label",{className:ve.label,children:"Customer"}),s.jsx("input",{type:"text",className:ve.input,value:h,onChange:K=>m(K.target.value),placeholder:"Customer name"})]})]}),s.jsxs("div",{className:ve.formRow,children:[s.jsxs("div",{className:ve.formGroup,children:[s.jsx("label",{className:ve.label,children:"Sales PM"}),s.jsx("input",{type:"text",className:ve.input,value:y,onChange:K=>u(K.target.value),placeholder:"Sales contact"})]}),s.jsxs("div",{className:ve.formGroup,children:[s.jsx("label",{className:ve.label,children:"Project Volume (CHF)"}),s.jsx("input",{type:"number",className:ve.input,value:w,onChange:K=>p(K.target.value),placeholder:"0"})]})]}),!l&&s.jsxs("div",{className:ve.formGroup,children:[s.jsx("label",{className:ve.label,children:"Project Phases"}),s.jsx("div",{className:ve.phaseTags,children:I.map(K=>s.jsx("span",{className:`${ve.phaseTag} ${S.has(K.name)?ve.selected:""}`,onClick:()=>A(K.name),style:{"--phase-color":K.default_color||K.color||"var(--accent-blue)"},children:K.name},K.id))})]}),s.jsxs("div",{className:ve.formRow,children:[s.jsx("div",{className:ve.formGroup,children:s.jsxs("label",{className:ve.checkbox,children:[s.jsx("input",{type:"checkbox",checked:x,onChange:K=>v(K.target.checked)}),s.jsx("span",{children:"Project Confirmed"})]})}),l&&s.jsx("div",{className:ve.formGroup,children:s.jsxs("label",{className:ve.checkbox,children:[s.jsx("input",{type:"checkbox",checked:C,onChange:K=>N(K.target.checked)}),s.jsx("span",{children:"Archived"})]})})]})]})})}const ob="_form_1rm0y_3",lb="_formGroup_1rm0y_9",cb="_formRow_1rm0y_15",db="_label_1rm0y_21",ub="_input_1rm0y_27",fb="_checkbox_1rm0y_63",hb="_error_1rm0y_79",mb="_contextInfo_1rm0y_89",pb="_footer_1rm0y_102",gb="_footerRight_1rm0y_108",_b="_deleteBtn_1rm0y_113",yb="_assignmentsSection_1rm0y_118",vb="_assignmentsList_1rm0y_124",xb="_assignmentItem_1rm0y_131",wb="_assignmentName_1rm0y_140",jb="_assignmentAllocation_1rm0y_145",ye={form:ob,formGroup:lb,formRow:cb,label:db,input:ub,checkbox:fb,error:hb,contextInfo:mb,footer:pb,footerRight:gb,deleteBtn:_b,assignmentsSection:yb,assignmentsList:vb,assignmentItem:xb,assignmentName:wb,assignmentAllocation:jb};function Sb(e){const t=e.phases||[];if(t.length===0)return null;let n=null,r=null;for(const a of t){const i=new Date(a.start_date),o=new Date(a.end_date);(!n||i<n)&&(n=i),(!r||o>r)&&(r=o)}return n&&r?{start:n,end:r}:null}async function Lh(e,t,n,r){if(!e.start_date||!e.end_date)return!1;const a=new Date(e.start_date),i=new Date(e.end_date);let o=a,l=i;if(t==="expand"&&n&&r)n<a&&(o=n),r>i&&(l=r);else if(t==="shrink"){const c=Sb(e);c&&(o=c.start,l=c.end)}return o.getTime()!==a.getTime()||l.getTime()!==i.getTime()?(console.log("[PhaseModal] Cascading project dates:",{projectId:e.id,mode:t,oldStart:e.start_date,oldEnd:e.end_date,newStart:o.toISOString().split("T")[0],newEnd:l.toISOString().split("T")[0]}),await bi(e.id,{start_date:o.toISOString().split("T")[0],end_date:l.toISOString().split("T")[0]}),!0):!1}function Cb(){const{activeModal:e,editingPhase:t,modalContext:n,closeModal:r}=ee(),{projects:a,setProjects:i,ensureProjectExpanded:o}=O(),l=e==="phase",c=!!t,d=(t==null?void 0:t.project_id)||n.projectId,[h,m]=f.useState(""),[g,_]=f.useState(!1),[y,u]=f.useState(""),[w,p]=f.useState(""),[x,v]=f.useState(!1),[C,N]=f.useState(null),b=f.useMemo(()=>a.find(S=>S.id===d),[a,d]);f.useEffect(()=>{if(l){if(t)m(t.name),_(!!t.is_milestone),u(We(t.start_date)),p(We(t.end_date));else if(n.phantomPreset)m(""),_(!1),u(We(n.phantomPreset.startDate)),p(We(n.phantomPreset.endDate));else{const S=new Date().toISOString().split("T")[0],P=We(b==null?void 0:b.start_date)||S,I=We(b==null?void 0:b.end_date)||S;m(""),_(!1),u(P),p(I)}N(null)}},[l,t,b,n.phantomPreset]),f.useEffect(()=>{g&&y&&p(y)},[g,y]);const B=async S=>{var P;if(S.preventDefault(),!h.trim()){N("Please enter a phase name");return}if(!y){N("Please select a start date");return}if(!g&&!w){N("Please select an end date");return}if(!d){N("No project selected");return}v(!0),N(null);try{const I={name:h.trim(),start_date:y,end_date:g?y:w,is_milestone:g,color:(t==null?void 0:t.color)||"#ec4899"};if(n.phantomPreset){const{predecessorId:k,dependencyType:j}=n.phantomPreset,T=(P=b==null?void 0:b.phases)==null?void 0:P.find(E=>E.id===k);if(T){let E=0;const $=new Date(y),A=new Date(T.start_date.split("T")[0]),R=new Date(T.end_date.split("T")[0]);if(j==="SS")E=Math.round(($.getTime()-A.getTime())/(1e3*60*60*24));else{const F=new Date(R);F.setDate(F.getDate()+1),E=Math.round(($.getTime()-F.getTime())/(1e3*60*60*24))}I.dependencies=[{id:k,type:j,lag:E}];const H=T.order_index??0;I.order_index=H+1}else console.warn("[PhaseModal] sourcePhase not found for predecessorId:",k)}if(c&&t)await Js(t.id,I);else if(await Hv(d,I),o(d),b){const k=new Date(I.start_date),j=new Date(I.end_date);await Lh(b,"expand",k,j)}const D=await ft();i(D),r()}catch(I){N(I instanceof Error?I.message:"Failed to save phase")}finally{v(!1)}},M=async()=>{if(!(!c||!t||!d)&&confirm("Are you sure you want to delete this phase? This will also delete all subphases and assignments.")){v(!0),N(null);try{await Dg(t.id);const S=await ft();if(b){const P=S.find(I=>I.id===b.id);if(P)if(await Lh(P,"shrink")){const D=await ft();i(D)}else i(S);else i(S)}else i(S);r()}catch(S){N(S instanceof Error?S.message:"Failed to delete phase")}finally{v(!1)}}},L=s.jsxs("div",{className:ye.footer,children:[c&&s.jsx(oe,{variant:"danger",onClick:M,disabled:x,className:ye.deleteBtn,children:"Delete Phase"}),s.jsxs("div",{className:ye.footerRight,children:[s.jsx(oe,{variant:"secondary",onClick:r,disabled:x,children:"Cancel"}),s.jsx(oe,{variant:"primary",onClick:B,disabled:x,children:x?"Saving...":c?"Save Changes":"Add Phase"})]})]});return s.jsx(gt,{isOpen:l,onClose:r,title:c?"Edit Phase":"Add Phase",size:"md",footer:L,children:s.jsxs("form",{onSubmit:B,className:ye.form,children:[C&&s.jsx("div",{className:ye.error,children:C}),s.jsxs("div",{className:ye.formGroup,children:[s.jsx("label",{className:ye.label,children:"Phase Name *"}),s.jsx("input",{type:"text",className:ye.input,value:h,onChange:S=>m(S.target.value),placeholder:"e.g., Preparation, Analytics, Trial, etc.",autoFocus:!0})]}),s.jsx("div",{className:ye.formGroup,children:s.jsxs("label",{className:ye.checkbox,children:[s.jsx("input",{type:"checkbox",checked:g,onChange:S=>_(S.target.checked)}),s.jsx("span",{children:"Milestone (single date, shown as diamond)"})]})}),s.jsxs("div",{className:ye.formRow,children:[s.jsxs("div",{className:ye.formGroup,children:[s.jsx("label",{className:ye.label,children:g?"Date *":"Start Date *"}),s.jsx("input",{type:"date",className:ye.input,value:y,onChange:S=>u(S.target.value)})]}),!g&&s.jsxs("div",{className:ye.formGroup,children:[s.jsx("label",{className:ye.label,children:"End Date *"}),s.jsx("input",{type:"date",className:ye.input,value:w,onChange:S=>p(S.target.value)})]})]}),c&&(t==null?void 0:t.staffAssignments)&&t.staffAssignments.length>0&&s.jsxs("div",{className:ye.assignmentsSection,children:[s.jsx("label",{className:ye.label,children:"Assigned Staff"}),s.jsx("div",{className:ye.assignmentsList,children:t.staffAssignments.map(S=>s.jsxs("div",{className:ye.assignmentItem,children:[s.jsx("span",{className:ye.assignmentName,children:S.staff_name||`Staff #${S.staff_id}`}),s.jsxs("span",{className:ye.assignmentAllocation,children:[S.allocation,"%"]})]},S.id))})]})]})})}function Jo(e,t){for(const n of e){const r=Au(n.children||[],t);if(r)return r}return null}function Au(e,t){for(const n of e){if(n.id===t)return n;if(n.children&&n.children.length>0){const r=Au(n.children,t);if(r)return r}}return null}function kb(e,t){for(const n of e)if(Au(n.children||[],t))return n;return null}function bb(e){const t=e.children||[];if(t.length===0)return null;let n=null,r=null;const a=i=>{for(const o of i){const l=new Date(o.start_date),c=new Date(o.end_date);(!n||l<n)&&(n=l),(!r||c>r)&&(r=c),o.children&&o.children.length>0&&a(o.children)}};return a(t),n&&r?{start:n,end:r}:null}function Nb(e){const t=e.phases||[];if(t.length===0)return null;let n=null,r=null;for(const a of t){const i=new Date(a.start_date),o=new Date(a.end_date);(!n||i<n)&&(n=i),(!r||o>r)&&(r=o)}return n&&r?{start:n,end:r}:null}function Db(e){const t=e.children||[];if(t.length===0)return null;let n=null,r=null;const a=i=>{for(const o of i){const l=new Date(o.start_date),c=new Date(o.end_date);(!n||l<n)&&(n=l),(!r||c>r)&&(r=c),o.children&&o.children.length>0&&a(o.children)}};return a(t),n&&r?{start:n,end:r}:null}function $b(e,t){const n=[],r=Jo(e,t);if(!r)return n;let a=r;for(;a&&a.parent_subphase_id;){const i=Jo(e,a.parent_subphase_id);if(i)n.push(i),a=i;else break}return n}async function Ah(e,t,n,r,a,i){var x;const o={subphasesUpdated:0,phaseUpdated:!1,projectUpdated:!1},l=(x=e.phases)==null?void 0:x.find(v=>v.id===t);if(!l||!e.start_date||!e.end_date)return o;let c=r,d=a;if(i){const v=$b(e.phases||[],i),C=Jo(e.phases||[],i);C&&v.unshift(C);for(const N of v){const b=new Date(N.start_date),B=new Date(N.end_date);let M=b,L=B;if(n==="expand"&&c&&d)c<b&&(M=c),d>B&&(L=d);else if(n==="shrink"){const S=Db(N);S&&(M=S.start,L=S.end)}(M.getTime()!==b.getTime()||L.getTime()!==B.getTime())&&(console.log("[Cascade] Updating parent subphase dates:",{subphaseId:N.id,name:N.name,oldStart:N.start_date,oldEnd:N.end_date,newStart:M.toISOString().split("T")[0],newEnd:L.toISOString().split("T")[0]}),await er(N.id,{start_date:M.toISOString().split("T")[0],end_date:L.toISOString().split("T")[0]}),o.subphasesUpdated++,N.start_date=M.toISOString().split("T")[0],N.end_date=L.toISOString().split("T")[0]),c=M,d=L}}const h=new Date(l.start_date),m=new Date(l.end_date);let g=h,_=m;if(n==="expand"&&c&&d)c<h&&(g=c),d>m&&(_=d);else if(n==="shrink"){const v=bb(l);v&&(g=v.start,_=v.end)}(g.getTime()!==h.getTime()||_.getTime()!==m.getTime())&&(console.log("[Cascade] Updating phase dates:",{phaseId:t,oldStart:l.start_date,oldEnd:l.end_date,newStart:g.toISOString().split("T")[0],newEnd:_.toISOString().split("T")[0]}),await Js(t,{start_date:g.toISOString().split("T")[0],end_date:_.toISOString().split("T")[0]}),o.phaseUpdated=!0,l.start_date=g.toISOString().split("T")[0],l.end_date=_.toISOString().split("T")[0]);const y=new Date(e.start_date),u=new Date(e.end_date);let w=y,p=u;if(n==="expand")g<y&&(w=g),_>u&&(p=_);else if(n==="shrink"){const v=Nb(e);v&&(w=v.start,p=v.end)}return(w.getTime()!==y.getTime()||p.getTime()!==u.getTime())&&(console.log("[Cascade] Updating project dates:",{projectId:e.id,oldStart:e.start_date,oldEnd:e.end_date,newStart:w.toISOString().split("T")[0],newEnd:p.toISOString().split("T")[0]}),await bi(e.id,{start_date:w.toISOString().split("T")[0],end_date:p.toISOString().split("T")[0]}),o.projectUpdated=!0),o}function Eb(){const{activeModal:e,editingSubphase:t,modalContext:n,closeModal:r}=ee(),{projects:a,setProjects:i,ensurePhaseExpanded:o,ensureSubphaseExpanded:l}=O(),c=e==="subphase",d=!!t,h=n.projectId,m=(t==null?void 0:t.parent_phase_id)||n.phaseId,g=n.subphaseId,[_,y]=f.useState(""),[u,w]=f.useState(!1),[p,x]=f.useState(""),[v,C]=f.useState(""),[N,b]=f.useState(!1),[B,M]=f.useState(null),L=f.useMemo(()=>h&&a.find(k=>k.id===h)||null,[a,h]),S=f.useMemo(()=>{var k;return!L||!m?null:((k=L.phases)==null?void 0:k.find(j=>j.id===m))||null},[L,m]);f.useEffect(()=>{if(c){if(t)y(t.name),w(!!t.is_milestone),x(We(t.start_date)),C(We(t.end_date));else if(n.phantomPreset)y(""),w(!1),x(We(n.phantomPreset.startDate)),C(We(n.phantomPreset.endDate));else{const k=new Date().toISOString().split("T")[0],j=We(S==null?void 0:S.start_date)||k,T=We(S==null?void 0:S.end_date)||k;y(""),w(!1),x(j),C(T)}M(null)}},[c,t,S,n.phantomPreset]),f.useEffect(()=>{u&&p&&C(p)},[u,p]);const P=async k=>{if(k.preventDefault(),!_.trim()){M("Please enter a subphase name");return}if(!p){M("Please select a start date");return}if(!u&&!v){M("Please select an end date");return}if(!m){M("No parent phase selected");return}b(!0),M(null);try{const j={name:_.trim(),start_date:p,end_date:u?p:v,is_milestone:u,color:(t==null?void 0:t.color)||(S==null?void 0:S.color)||"#ec4899"};if(n.phantomPreset){const{predecessorId:A,dependencyType:R}=n.phantomPreset,H=a.find(V=>V.id===h),F=Jo((H==null?void 0:H.phases)||[],A);if(F){let V=0;const Q=new Date(p),X=new Date(F.start_date.split("T")[0]),Z=new Date(F.end_date.split("T")[0]);if(R==="SS")V=Math.round((Q.getTime()-X.getTime())/(1e3*60*60*24));else{const K=new Date(Z);K.setDate(K.getDate()+1),V=Math.round((Q.getTime()-K.getTime())/(1e3*60*60*24))}j.dependencies=[{id:A,type:R,lag:V}];const ce=F.order_index??0;j.order_index=ce+1}}let T=null,E;if(d&&t)await er(t.id,j);else if(g&&h)await Wv(g,h,j),l(g),T=m||null,E=g;else if(m&&h)await qv(m,h,j),o(m),T=m;else throw new Error("Missing phaseId or projectId");if(T&&!d&&L){const A=new Date(j.start_date),R=new Date(j.end_date);await Ah(L,T,"expand",A,R,E)}const $=await ft();i($),r()}catch(j){M(j instanceof Error?j.message:"Failed to save subphase")}finally{b(!1)}},I=async()=>{if(!(!d||!t)&&confirm("Are you sure you want to delete this subphase? This will also delete all nested subphases and assignments.")){b(!0),M(null);try{const k=L?kb(L.phases||[],t.id):null,j=t.parent_subphase_id||void 0;await $g(t.id);const T=await ft();if(k&&L){const E=T.find($=>$.id===L.id);if(E){await Ah(E,k.id,"shrink",void 0,void 0,j);const $=await ft();i($)}else i(T)}else i(T);r()}catch(k){M(k instanceof Error?k.message:"Failed to delete subphase")}finally{b(!1)}}},D=s.jsxs("div",{className:ye.footer,children:[d&&s.jsx(oe,{variant:"danger",onClick:I,disabled:N,className:ye.deleteBtn,children:"Delete Subphase"}),s.jsxs("div",{className:ye.footerRight,children:[s.jsx(oe,{variant:"secondary",onClick:r,disabled:N,children:"Cancel"}),s.jsx(oe,{variant:"primary",onClick:P,disabled:N,children:N?"Saving...":d?"Save Changes":"Add Subphase"})]})]});return s.jsx(gt,{isOpen:c,onClose:r,title:d?"Edit Subphase":"Add Subphase",size:"md",footer:D,children:s.jsxs("form",{onSubmit:P,className:ye.form,children:[B&&s.jsx("div",{className:ye.error,children:B}),S&&s.jsxs("div",{className:ye.contextInfo,children:["Parent: ",s.jsx("strong",{children:S.name})]}),s.jsxs("div",{className:ye.formGroup,children:[s.jsx("label",{className:ye.label,children:"Subphase Name *"}),s.jsx("input",{type:"text",className:ye.input,value:_,onChange:k=>y(k.target.value),placeholder:"e.g., Task 1, Setup, Review, etc.",autoFocus:!0})]}),s.jsx("div",{className:ye.formGroup,children:s.jsxs("label",{className:ye.checkbox,children:[s.jsx("input",{type:"checkbox",checked:u,onChange:k=>w(k.target.checked)}),s.jsx("span",{children:"Milestone (single date, shown as diamond)"})]})}),s.jsxs("div",{className:ye.formRow,children:[s.jsxs("div",{className:ye.formGroup,children:[s.jsx("label",{className:ye.label,children:u?"Date *":"Start Date *"}),s.jsx("input",{type:"date",className:ye.input,value:p,onChange:k=>x(k.target.value)})]}),!u&&s.jsxs("div",{className:ye.formGroup,children:[s.jsx("label",{className:ye.label,children:"End Date *"}),s.jsx("input",{type:"date",className:ye.input,value:v,onChange:k=>C(k.target.value)})]})]})]})})}const Tb="_form_b9ldw_3",Mb="_formGroup_b9ldw_9",Ib="_formRow_b9ldw_15",Pb="_label_b9ldw_21",Lb="_input_b9ldw_27",Ab="_contextInfo_b9ldw_48",Bb="_error_b9ldw_60",Rb="_sliderContainer_b9ldw_70",Ob="_slider_b9ldw_70",Fb="_sliderLabels_b9ldw_112",zb="_footer_b9ldw_120",Hb="_footerRight_b9ldw_127",qb="_deleteBtn_b9ldw_133",Wb="_infoBox_b9ldw_155",we={form:Tb,formGroup:Mb,formRow:Ib,label:Pb,input:Lb,contextInfo:Ab,error:Bb,sliderContainer:Rb,slider:Ob,sliderLabels:Fb,footer:zb,footerRight:Hb,deleteBtn:qb,infoBox:Wb};function Vb(){const{activeModal:e,editingStaffAssignment:t,modalContext:n,closeModal:r}=ee(),{projects:a,staff:i,currentSite:o,setProjects:l}=O(),c=e==="staffAssignment",d=!!t,[h,m]=f.useState(""),[g,_]=f.useState(100),[y,u]=f.useState(""),[w,p]=f.useState(""),[x,v]=f.useState(!1),[C,N]=f.useState(null),b=(t==null?void 0:t.project_id)||n.projectId,B=(t==null?void 0:t.phase_id)||n.phaseId,M=(t==null?void 0:t.subphase_id)||n.subphaseId,L=f.useMemo(()=>o?i.filter($=>$.site_id===o.id):[],[i,o]),S=f.useMemo(()=>{var A;if(!b)return null;const $=a.find(R=>R.id===b);return $?M?(H=>{for(const F of H||[]){const V=X=>{for(const Z of X||[]){if(Z.id===M)return Z;const ce=V(Z.children||[]);if(ce)return ce}return null},Q=V(F.children||[]);if(Q)return Q}return null})($.phases||[]):B?((A=$.phases)==null?void 0:A.find(R=>R.id===B))||null:$:null},[a,b,B,M]);f.useEffect(()=>{if(c){if(t)m(t.staff_id.toString()),_(t.allocation),u(We(t.start_date)),p(We(t.end_date));else{const $=new Date().toISOString().split("T")[0];m(""),_(100),u(We(S==null?void 0:S.start_date)||$),p(We(S==null?void 0:S.end_date)||$)}N(null)}},[c,t,S]);const P=M?"subphase":B?"phase":"project",I=P!=="project",D=async $=>{if($.preventDefault(),!h){N("Please select a staff member");return}if(!I&&(!y||!w)){N("Please select start and end dates");return}if(g<1||g>100){N("Allocation must be between 1 and 100");return}v(!0),N(null);try{if(d&&t){const R=I?{allocation:g}:{allocation:g,start_date:y,end_date:w};await xl(t.id,R,P)}else{const R={staff_id:parseInt(h),allocation:g,start_date:y,end_date:w,project_id:b||void 0,phase_id:B||void 0,subphase_id:M||void 0};await Su(R)}const A=await ft();l(A),r()}catch(A){N(A instanceof Error?A.message:"Failed to save assignment")}finally{v(!1)}},k=async()=>{if(!(!d||!t)&&confirm("Are you sure you want to remove this staff assignment?")){v(!0),N(null);try{await Eg(t.id,P);const $=await ft();l($),r()}catch($){N($ instanceof Error?$.message:"Failed to delete assignment")}finally{v(!1)}}},j=M?"Subphase":B?"Phase":"Project",T=(S==null?void 0:S.name)||"Unknown",E=s.jsxs("div",{className:we.footer,children:[d&&s.jsx(oe,{variant:"danger",onClick:k,disabled:x,className:we.deleteBtn,children:"Remove Assignment"}),s.jsxs("div",{className:we.footerRight,children:[s.jsx(oe,{variant:"secondary",onClick:r,disabled:x,children:"Cancel"}),s.jsx(oe,{variant:"primary",onClick:D,disabled:x,children:x?"Saving...":d?"Save Changes":"Assign Staff"})]})]});return s.jsx(gt,{isOpen:c,onClose:r,title:d?"Edit Staff Assignment":"Assign Staff",size:"md",footer:E,children:s.jsxs("form",{onSubmit:D,className:we.form,children:[C&&s.jsx("div",{className:we.error,children:C}),s.jsxs("div",{className:we.contextInfo,children:[j,": ",s.jsx("strong",{children:T})]}),s.jsxs("div",{className:we.formGroup,children:[s.jsx("label",{className:we.label,children:"Staff Member *"}),s.jsxs("select",{className:we.input,value:h,onChange:$=>m($.target.value),disabled:d,children:[s.jsx("option",{value:"",children:"Select staff member"}),L.map($=>s.jsxs("option",{value:$.id,children:[$.name," (",$.role||"No role",")"]},$.id))]})]}),s.jsxs("div",{className:we.formGroup,children:[s.jsxs("label",{className:we.label,children:["Allocation: ",g,"%"]}),s.jsxs("div",{className:we.sliderContainer,children:[s.jsx("input",{type:"range",className:we.slider,min:"1",max:"100",value:g,onChange:$=>_(parseInt($.target.value))}),s.jsxs("div",{className:we.sliderLabels,children:[s.jsx("span",{children:"1%"}),s.jsx("span",{children:"50%"}),s.jsx("span",{children:"100%"})]})]})]}),!I&&s.jsxs("div",{className:we.formRow,children:[s.jsxs("div",{className:we.formGroup,children:[s.jsx("label",{className:we.label,children:"Start Date *"}),s.jsx("input",{type:"date",className:we.input,value:y,onChange:$=>u($.target.value)})]}),s.jsxs("div",{className:we.formGroup,children:[s.jsx("label",{className:we.label,children:"End Date *"}),s.jsx("input",{type:"date",className:we.input,value:w,onChange:$=>p($.target.value)})]})]}),I&&s.jsx("div",{className:we.infoBox,children:s.jsxs("p",{children:[" This assignment uses the ",j.toLowerCase(),"'s dates automatically."]})})]})})}function Ub(){const{activeModal:e,editingEquipmentAssignment:t,modalContext:n,closeModal:r}=ee(),{projects:a,equipment:i,currentSite:o,setProjects:l}=O(),c=e==="equipmentAssignment",d=!!t,[h,m]=f.useState(""),[g,_]=f.useState(""),[y,u]=f.useState(""),[w,p]=f.useState(!1),[x,v]=f.useState(null),C=(t==null?void 0:t.project_id)||n.projectId,N=(t==null?void 0:t.phase_id)||n.phaseId,b=(t==null?void 0:t.subphase_id)||n.subphaseId,B=f.useMemo(()=>o?i.filter(k=>k.site_id===o.id):[],[i,o]),M=f.useMemo(()=>{var j;if(!C)return null;const k=a.find(T=>T.id===C);return k?b?(E=>{for(const $ of E||[]){const A=H=>{for(const F of H||[]){if(F.id===b)return F;const V=A(F.children||[]);if(V)return V}return null},R=A($.children||[]);if(R)return R}return null})(k.phases||[]):N?((j=k.phases)==null?void 0:j.find(T=>T.id===N))||null:k:null},[a,C,N,b]);f.useEffect(()=>{if(c){if(t)m(t.equipment_id.toString()),_(We(t.start_date)),u(We(t.end_date));else{const k=new Date().toISOString().split("T")[0];m(""),_(We(M==null?void 0:M.start_date)||k),u(We(M==null?void 0:M.end_date)||k)}v(null)}},[c,t,M]);const L=async k=>{if(k.preventDefault(),!h){v("Please select equipment");return}if(!g||!y){v("Please select start and end dates");return}p(!0),v(null);try{const j={equipment_id:parseInt(h),start_date:g,end_date:y,project_id:C||void 0,phase_id:N||void 0,subphase_id:b||void 0};d&&t?await wl(t.id,j):await Cu(j);const T=await ft();l(T),r()}catch(j){v(j instanceof Error?j.message:"Failed to save assignment")}finally{p(!1)}},S=async()=>{if(!(!d||!t)&&confirm("Are you sure you want to remove this equipment assignment?")){p(!0),v(null);try{await Tg(t.id);const k=await ft();l(k),r()}catch(k){v(k instanceof Error?k.message:"Failed to delete assignment")}finally{p(!1)}}},P=b?"Subphase":N?"Phase":"Project",I=(M==null?void 0:M.name)||"Unknown",D=s.jsxs("div",{className:we.footer,children:[d&&s.jsx(oe,{variant:"danger",onClick:S,disabled:w,className:we.deleteBtn,children:"Remove Assignment"}),s.jsxs("div",{className:we.footerRight,children:[s.jsx(oe,{variant:"secondary",onClick:r,disabled:w,children:"Cancel"}),s.jsx(oe,{variant:"primary",onClick:L,disabled:w,children:w?"Saving...":d?"Save Changes":"Assign Equipment"})]})]});return s.jsx(gt,{isOpen:c,onClose:r,title:d?"Edit Equipment Assignment":"Assign Equipment",size:"md",footer:D,children:s.jsxs("form",{onSubmit:L,className:we.form,children:[x&&s.jsx("div",{className:we.error,children:x}),s.jsxs("div",{className:we.contextInfo,children:[P,": ",s.jsx("strong",{children:I})]}),s.jsxs("div",{className:we.formGroup,children:[s.jsx("label",{className:we.label,children:"Equipment *"}),s.jsxs("select",{className:we.input,value:h,onChange:k=>m(k.target.value),disabled:d,children:[s.jsx("option",{value:"",children:"Select equipment"}),B.map(k=>s.jsxs("option",{value:k.id,children:[k.name," (",k.type||"No type",")"]},k.id))]})]}),s.jsxs("div",{className:we.formRow,children:[s.jsxs("div",{className:we.formGroup,children:[s.jsx("label",{className:we.label,children:"Start Date *"}),s.jsx("input",{type:"date",className:we.input,value:g,onChange:k=>_(k.target.value)})]}),s.jsxs("div",{className:we.formGroup,children:[s.jsx("label",{className:we.label,children:"End Date *"}),s.jsx("input",{type:"date",className:we.input,value:y,onChange:k=>u(k.target.value)})]})]})]})})}const Gb="_content_ltqk2_3",Yb="_error_ltqk2_9",Qb="_staffDisplay_ltqk2_19",Xb="_staffAvatar_ltqk2_29",Kb="_staffInfo_ltqk2_43",Zb="_staffName_ltqk2_50",Jb="_staffRole_ltqk2_56",eN="_noStaff_ltqk2_62",tN="_section_ltqk2_76",nN="_sectionLabel_ltqk2_82",sN="_optional_ltqk2_90",rN="_dateRow_ltqk2_98",aN="_dateField_ltqk2_104",iN="_label_ltqk2_111",oN="_dateSeparator_ltqk2_117",lN="_input_ltqk2_127",cN="_duration_ltqk2_154",dN="_footer_ltqk2_170",uN="_exportBtn_ltqk2_181",Ge={content:Gb,error:Yb,staffDisplay:Qb,staffAvatar:Xb,staffInfo:Kb,staffName:Zb,staffRole:Jb,noStaff:eN,section:tN,sectionLabel:nN,optional:sN,dateRow:rN,dateField:aN,label:iN,dateSeparator:oN,input:lN,duration:cN,footer:dN,exportBtn:uN},fN=f.memo(function({onCancel:t,onSaveAndExport:n,onSave:r,isSubmitting:a,canSubmit:i}){return s.jsxs("div",{className:Ge.footer,children:[s.jsx(oe,{type:"button",variant:"secondary",onClick:t,disabled:a,children:"Cancel"}),s.jsxs(oe,{type:"button",variant:"secondary",onClick:n,disabled:a||!i,title:"Save vacation and export to Outlook calendar",className:Ge.exportBtn,children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),s.jsx("polyline",{points:"7 10 12 15 17 10"}),s.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Save & Export to Outlook"]}),s.jsx(oe,{type:"button",variant:"primary",onClick:r,disabled:a||!i,children:a?"Saving...":"Save"})]})});function hN(){var D;const{activeModal:e,editingVacation:t,modalContext:n,closeModal:r}=ee(),{staff:a,setVacations:i}=O(),o=e==="vacation",l=!!t,[c,d]=f.useState(null),[h,m]=f.useState(""),[g,_]=f.useState(""),[y,u]=f.useState(!1),[w,p]=f.useState(null),x=f.useRef(null),v=f.useRef(!1),C=f.useMemo(()=>c?a.find(k=>k.id===c):null,[a,c]);f.useEffect(()=>{if(o&&!v.current){if(v.current=!0,t)d(t.staff_id),m(We(t.start_date)),_(We(t.end_date)),x.current&&(x.current.value=t.description||"");else{d(n.staffId||null);const k=new Date,j=new Date(k);j.setDate(k.getDate()+((8-k.getDay())%7||7));const T=new Date(j);T.setDate(j.getDate()+4),m(We(j.toISOString())),_(We(T.toISOString())),x.current&&(x.current.value="")}p(null)}o||(v.current=!1)},[o,t,n.staffId]);const N=f.useMemo(()=>{if(!h||!g)return 0;const k=new Date(h),T=new Date(g).getTime()-k.getTime();return Math.ceil(T/(1e3*60*60*24))+1},[h,g]),b=f.useCallback(()=>{r(),p(null)},[r]),B=f.useCallback(async()=>{var j;const k=((j=x.current)==null?void 0:j.value)||"";if(!c)return p("No staff member selected"),!1;if(!h||!g)return p("Please select start and end dates"),!1;if(new Date(h)>new Date(g))return p("Start date must be before end date"),!1;u(!0),p(null);try{const T={staff_id:c,start_date:h,end_date:g,description:k||"Vacation"};l&&t?await sx(t.id,T):await nx(T);const E=await Nu();return i(E),!0}catch(T){return console.error("Failed to save vacation:",T),p(T instanceof Error?T.message:"Failed to save vacation"),!1}finally{u(!1)}},[c,h,g,l,t,i]),M=f.useCallback(async()=>{await B()&&b()},[B,b]),L=f.useCallback(()=>{var R;const k=(C==null?void 0:C.name)||"Staff",j=((R=x.current)==null?void 0:R.value)||"Vacation",T=mN({summary:j,description:`${k} - Time Off`,startDate:new Date(h),endDate:new Date(g)}),E=new Blob([T],{type:"text/calendar;charset=utf-8"}),$=URL.createObjectURL(E),A=document.createElement("a");A.href=$,A.download=`vacation-${k.replace(/\s+/g,"-").toLowerCase()}-${h}.ics`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL($)},[C==null?void 0:C.name,h,g]),S=f.useCallback(async()=>{await B()&&(L(),b())},[B,L,b]),P=!!c&&!!h&&!!g,I=f.useMemo(()=>s.jsx(fN,{onCancel:b,onSaveAndExport:S,onSave:M,isSubmitting:y,canSubmit:P}),[b,S,M,y,P]);return o?s.jsx(gt,{isOpen:o,onClose:b,title:l?"Edit Vacation":"Add Vacation",size:"md",footer:I,children:s.jsxs("div",{className:Ge.content,children:[w&&s.jsx("div",{className:Ge.error,children:w}),C?s.jsxs("div",{className:Ge.staffDisplay,children:[s.jsx("div",{className:Ge.staffAvatar,children:((D=C.name)==null?void 0:D.charAt(0).toUpperCase())||"?"}),s.jsxs("div",{className:Ge.staffInfo,children:[s.jsx("div",{className:Ge.staffName,children:C.name}),C.role&&s.jsx("div",{className:Ge.staffRole,children:C.role})]})]}):s.jsxs("div",{className:Ge.noStaff,children:[s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"12",cy:"8",r:"4"}),s.jsx("path",{d:"M20 21a8 8 0 1 0-16 0"})]}),s.jsx("span",{children:"No staff member selected"})]}),s.jsxs("div",{className:Ge.section,children:[s.jsx("label",{className:Ge.sectionLabel,children:"Duration"}),s.jsxs("div",{className:Ge.dateRow,children:[s.jsxs("div",{className:Ge.dateField,children:[s.jsx("label",{className:Ge.label,children:"From"}),s.jsx("input",{type:"date",className:Ge.input,value:h,onChange:k=>m(k.target.value)})]}),s.jsx("div",{className:Ge.dateSeparator,children:s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),s.jsx("polyline",{points:"12 5 19 12 12 19"})]})}),s.jsxs("div",{className:Ge.dateField,children:[s.jsx("label",{className:Ge.label,children:"To"}),s.jsx("input",{type:"date",className:Ge.input,value:g,onChange:k=>_(k.target.value)})]})]}),N>0&&s.jsxs("div",{className:Ge.duration,children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),s.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),s.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),s.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),N," day",N!==1?"s":""]})]}),s.jsxs("div",{className:Ge.section,children:[s.jsxs("label",{className:Ge.sectionLabel,htmlFor:"vacation-description",children:["Description ",s.jsx("span",{className:Ge.optional,children:"(optional)"})]}),s.jsx("input",{ref:x,id:"vacation-description",type:"text",className:Ge.input,defaultValue:(t==null?void 0:t.description)||"",placeholder:"e.g., Annual Leave, Personal Day...",autoComplete:"off"})]})]})}):null}function mN(e){const{summary:t,description:n,startDate:r,endDate:a}=e,i=(h,m)=>{const g=h.getFullYear(),_=String(h.getMonth()+1).padStart(2,"0"),y=String(h.getDate()).padStart(2,"0");if(m)return`${g}${_}${y}`;const u=String(h.getUTCHours()).padStart(2,"0"),w=String(h.getUTCMinutes()).padStart(2,"0"),p=String(h.getUTCSeconds()).padStart(2,"0");return`${g}${_}${y}T${u}${w}${p}Z`},o=new Date(a);o.setDate(o.getDate()+1);const l=`vacation-${Date.now()}-${Math.random().toString(36).substr(2,9)}@milestone`,c=i(new Date,!1);return["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Milestone//Vacation Export//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${l}`,`DTSTAMP:${c}`,`DTSTART;VALUE=DATE:${i(r,!0)}`,`DTEND;VALUE=DATE:${i(o,!0)}`,`SUMMARY:${Bh(t)}`,`DESCRIPTION:${Bh(n)}`,"STATUS:CONFIRMED","TRANSP:OPAQUE","X-MICROSOFT-CDO-BUSYSTATUS:OOF","X-MICROSOFT-CDO-ALLDAYEVENT:TRUE","END:VEVENT","END:VCALENDAR"].join(`\r
`)}function Bh(e){return e.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n")}const pN="_container_18znu_3",gN="_error_18znu_10",_N="_toolbar_18znu_19",yN="_yearSelector_18znu_28",vN="_label_18znu_34",xN="_select_18znu_40",wN="_toolbarActions_18znu_55",jN="_addForm_18znu_61",SN="_addFormRow_18znu_70",CN="_input_18znu_76",kN="_addFormActions_18znu_94",bN="_holidaysList_18znu_101",NN="_loading_18znu_107",DN="_empty_18znu_108",$N="_section_18znu_118",EN="_sectionTitle_18znu_122",TN="_holidayItems_18znu_131",MN="_holidayItem_18znu_131",IN="_custom_18znu_148",PN="_holidayDate_18znu_153",LN="_holidayName_18znu_159",AN="_deleteBtn_18znu_163",BN="_footer_18znu_184",RN="_footerInfo_18znu_192",$e={container:pN,error:gN,toolbar:_N,yearSelector:yN,label:vN,select:xN,toolbarActions:wN,addForm:jN,addFormRow:SN,input:CN,addFormActions:kN,holidaysList:bN,loading:NN,empty:DN,section:$N,sectionTitle:EN,holidayItems:TN,holidayItem:MN,custom:IN,holidayDate:PN,holidayName:LN,deleteBtn:AN,footer:BN,footerInfo:RN};function ON(){const{activeModal:e,closeModal:t}=ee(),{currentSite:n,bankHolidays:r,setBankHolidays:a}=O(),i=e==="bankHoliday",[o,l]=f.useState(new Date().getFullYear()),[c,d]=f.useState(!1),[h,m]=f.useState(!1),[g,_]=f.useState(null),[y,u]=f.useState(""),[w,p]=f.useState(""),[x,v]=f.useState(""),C=f.useMemo(()=>{const j=new Date().getFullYear();return[j-1,j,j+1,j+2]},[]),N=f.useMemo(()=>r.filter(j=>new Date(j.date).getFullYear()===o).sort((j,T)=>new Date(j.date).getTime()-new Date(T.date).getTime()),[r,o]),b=N.filter(j=>j.is_custom),B=N.filter(j=>!j.is_custom);f.useEffect(()=>{i&&n&&M()},[i,n,o]);const M=async()=>{if(n){d(!0),_(null);try{const j=await Vs(n.id,o);a(j,Kn(j))}catch(j){console.error("Failed to load holidays:",j),_("Failed to load holidays")}finally{d(!1)}}},L=async()=>{if(n){d(!0),_(null);try{const j=await Lg(n.id);a(j,Kn(j))}catch(j){console.error("Failed to refresh holidays:",j),_("Failed to refresh holidays from API")}finally{d(!1)}}},S=async j=>{if(j.preventDefault(),!(!n||!y||!x)){d(!0),_(null);try{await Zv(n.id,{date:y,end_date:w||void 0,name:x});const T=await Vs(n.id);a(T,Kn(T)),u(""),p(""),v(""),m(!1)}catch(T){console.error("Failed to add holiday:",T),_("Failed to add custom holiday")}finally{d(!1)}}},P=async j=>{if(n&&window.confirm(`Delete "${j.name}"?`)){d(!0),_(null);try{await Jv(n.id,j.id);const T=await Vs(n.id);a(T,Kn(T))}catch(T){console.error("Failed to delete holiday:",T),_("Failed to delete holiday")}finally{d(!1)}}},I=()=>{var A;if(N.length===0)return;const j=FN(N,(n==null?void 0:n.name)||"Site"),T=new Blob([j],{type:"text/calendar;charset=utf-8"}),E=URL.createObjectURL(T),$=document.createElement("a");$.href=E,$.download=`bank-holidays-${((A=n==null?void 0:n.name)==null?void 0:A.toLowerCase().replace(/\s+/g,"-"))||"site"}-${o}.ics`,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(E)},D=()=>{t(),m(!1),_(null)},k=j=>new Date(j).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"});return i?s.jsx(gt,{isOpen:i,onClose:D,title:`Bank Holidays - ${(n==null?void 0:n.name)||""}`,size:"md",children:s.jsxs("div",{className:$e.container,children:[g&&s.jsx("div",{className:$e.error,children:g}),s.jsxs("div",{className:$e.toolbar,children:[s.jsxs("div",{className:$e.yearSelector,children:[s.jsx("label",{className:$e.label,children:"Year:"}),s.jsx("select",{className:$e.select,value:o,onChange:j=>l(parseInt(j.target.value,10)),children:C.map(j=>s.jsx("option",{value:j,children:j},j))})]}),s.jsxs("div",{className:$e.toolbarActions,children:[s.jsx(oe,{variant:"secondary",size:"sm",onClick:L,disabled:c,title:"Refresh from Nager.Date API",children:c?"Refreshing...":"Refresh"}),s.jsx(oe,{variant:"secondary",size:"sm",onClick:I,disabled:N.length===0,title:"Export all holidays to ICS",children:"Export ICS"}),s.jsx(oe,{variant:"primary",size:"sm",onClick:()=>m(!0),disabled:h,children:"Add Custom"})]})]}),h&&s.jsxs("form",{onSubmit:S,className:$e.addForm,children:[s.jsxs("div",{className:$e.addFormRow,children:[s.jsx("input",{type:"text",className:$e.input,placeholder:"Holiday name...",value:x,onChange:j=>v(j.target.value),required:!0}),s.jsx("input",{type:"date",className:$e.input,value:y,onChange:j=>u(j.target.value),required:!0}),s.jsx("input",{type:"date",className:$e.input,value:w,onChange:j=>p(j.target.value),placeholder:"End date (optional)"})]}),s.jsxs("div",{className:$e.addFormActions,children:[s.jsx(oe,{type:"button",variant:"secondary",size:"sm",onClick:()=>m(!1),children:"Cancel"}),s.jsx(oe,{type:"submit",variant:"primary",size:"sm",disabled:c||!x||!y,children:"Add"})]})]}),s.jsx("div",{className:$e.holidaysList,children:c&&N.length===0?s.jsx("div",{className:$e.loading,children:"Loading holidays..."}):N.length===0?s.jsxs("div",{className:$e.empty,children:["No holidays for ",o]}):s.jsxs(s.Fragment,{children:[B.length>0&&s.jsxs("div",{className:$e.section,children:[s.jsxs("h3",{className:$e.sectionTitle,children:["Public Holidays (",B.length,")"]}),s.jsx("div",{className:$e.holidayItems,children:B.map(j=>s.jsxs("div",{className:$e.holidayItem,children:[s.jsxs("div",{className:$e.holidayDate,children:[k(j.date),j.end_date&&j.end_date!==j.date&&s.jsxs("span",{children:[" - ",k(j.end_date)]})]}),s.jsx("div",{className:$e.holidayName,children:j.name})]},j.id))})]}),b.length>0&&s.jsxs("div",{className:$e.section,children:[s.jsxs("h3",{className:$e.sectionTitle,children:["Custom Holidays (",b.length,")"]}),s.jsx("div",{className:$e.holidayItems,children:b.map(j=>s.jsxs("div",{className:`${$e.holidayItem} ${$e.custom}`,children:[s.jsxs("div",{className:$e.holidayDate,children:[k(j.date),j.end_date&&j.end_date!==j.date&&s.jsxs("span",{children:[" - ",k(j.end_date)]})]}),s.jsx("div",{className:$e.holidayName,children:j.name}),s.jsx("button",{className:$e.deleteBtn,onClick:()=>P(j),title:"Delete custom holiday",children:""})]},j.id))})]})]})}),s.jsxs("div",{className:$e.footer,children:[s.jsx("span",{className:$e.footerInfo,children:n!=null&&n.country_code?`Country: ${n.country_code}`:"No country configured"}),s.jsx(oe,{variant:"secondary",onClick:D,children:"Close"})]})]})}):null}function FN(e,t){const n=["BEGIN:VCALENDAR","VERSION:2.0",`PRODID:-//Milestone//${t} Holidays//EN`,"CALSCALE:GREGORIAN","METHOD:PUBLISH"];return e.forEach(r=>{const a=new Date(r.date),i=r.end_date?new Date(r.end_date):a,o=new Date(i);o.setDate(o.getDate()+1);const l=h=>{const m=h.getFullYear(),g=String(h.getMonth()+1).padStart(2,"0"),_=String(h.getDate()).padStart(2,"0");return`${m}${g}${_}`},c=`holiday-${r.id}-${Date.now()}@milestone`,d=new Date().toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"");n.push("BEGIN:VEVENT",`UID:${c}`,`DTSTAMP:${d}`,`DTSTART;VALUE=DATE:${l(a)}`,`DTEND;VALUE=DATE:${l(o)}`,`SUMMARY:${Rh(r.name)}`,`DESCRIPTION:${Rh(`${t} - Bank Holiday`)}`,"STATUS:CONFIRMED","TRANSP:TRANSPARENT","END:VEVENT")}),n.push("END:VCALENDAR"),n.join(`\r
`)}function Rh(e){return e.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n")}const zN="_error_17myg_3",HN="_formGroup_17myg_13",qN="_formRow_17myg_17",WN="_label_17myg_26",VN="_input_17myg_34",UN="_help_17myg_60",GN="_footer_17myg_66",rn={error:zN,formGroup:HN,formRow:qN,label:WN,input:VN,help:UN,footer:GN};function YN(){const{activeModal:e,closeModal:t}=ee(),n=O(p=>p.currentSite),r=O(p=>p.setBankHolidays),a=e==="customHoliday",[i,o]=f.useState(""),[l,c]=f.useState(""),[d,h]=f.useState(""),[m,g]=f.useState(!1),[_,y]=f.useState(null);f.useEffect(()=>{a&&(o(""),c(""),h(""),y(null))},[a]);const u=async()=>{if(!n){y("No site selected");return}if(!i.trim()){y("Please enter a holiday name");return}if(!l){y("Please select a start date");return}if(d&&d<l){y("End date must be on or after start date");return}g(!0),y(null);try{await Ig(n.id,{name:i.trim(),date:l,end_date:d||void 0});const p=await Vs(n.id),x=Kn(p);r(p,x),t()}catch(p){y(p instanceof Error?p.message:"Failed to add custom holiday")}finally{g(!1)}},w=s.jsxs("div",{className:rn.footer,children:[s.jsx(oe,{variant:"secondary",onClick:t,children:"Cancel"}),s.jsx(oe,{variant:"primary",onClick:u,disabled:m,children:m?"Adding...":"Add Holiday"})]});return s.jsxs(gt,{isOpen:a,onClose:t,title:"Add Custom Holiday",size:"sm",footer:w,children:[_&&s.jsx("div",{className:rn.error,children:_}),s.jsxs("div",{className:rn.formGroup,children:[s.jsx("label",{className:rn.label,children:"Holiday Name"}),s.jsx("input",{type:"text",className:rn.input,value:i,onChange:p=>o(p.target.value),placeholder:"e.g., Company Anniversary",autoFocus:!0})]}),s.jsxs("div",{className:rn.formRow,children:[s.jsxs("div",{className:rn.formGroup,children:[s.jsx("label",{className:rn.label,children:"Start Date"}),s.jsx("input",{type:"date",className:rn.input,value:l,onChange:p=>c(p.target.value)})]}),s.jsxs("div",{className:rn.formGroup,children:[s.jsx("label",{className:rn.label,children:"End Date"}),s.jsx("input",{type:"date",className:rn.input,value:d,onChange:p=>h(p.target.value)})]})]}),s.jsxs("p",{className:rn.help,children:["Leave end date empty for a single-day holiday. Custom holidays will be applied to ",(n==null?void 0:n.name)||"the current site"," only."]})]})}const QN="_error_6ynm4_3",XN="_section_6ynm4_13",KN="_sectionTitle_6ynm4_28",ZN="_formGroup_6ynm4_44",JN="_formRow_6ynm4_48",eD="_label_6ynm4_57",tD="_input_6ynm4_65",nD="_select_6ynm4_87",sD="_help_6ynm4_120",rD="_checkbox_6ynm4_126",aD="_footer_6ynm4_146",iD="_warning_6ynm4_153",oD="_holidayStatusBox_6ynm4_177",lD="_holidayInfo_6ynm4_188",cD="_holidayCount_6ynm4_194",dD="_lastFetch_6ynm4_203",He={error:QN,section:XN,sectionTitle:KN,formGroup:ZN,formRow:JN,label:eD,input:tD,select:nD,help:sD,checkbox:rD,footer:aD,warning:iD,holidayStatusBox:oD,holidayInfo:lD,holidayCount:cD,lastFetch:dD},to={europe:[{code:"AT",name:"Austria"},{code:"BE",name:"Belgium"},{code:"CH",name:"Switzerland"},{code:"CZ",name:"Czech Republic"},{code:"DE",name:"Germany"},{code:"DK",name:"Denmark"},{code:"ES",name:"Spain"},{code:"FI",name:"Finland"},{code:"FR",name:"France"},{code:"GB",name:"United Kingdom"},{code:"GR",name:"Greece"},{code:"HR",name:"Croatia"},{code:"HU",name:"Hungary"},{code:"IE",name:"Ireland"},{code:"IT",name:"Italy"},{code:"NL",name:"Netherlands"},{code:"NO",name:"Norway"},{code:"PL",name:"Poland"},{code:"PT",name:"Portugal"},{code:"RO",name:"Romania"},{code:"SE",name:"Sweden"}],americas:[{code:"AR",name:"Argentina"},{code:"BR",name:"Brazil"},{code:"CA",name:"Canada"},{code:"CL",name:"Chile"},{code:"CO",name:"Colombia"},{code:"MX",name:"Mexico"},{code:"US",name:"United States"}],asiaPacific:[{code:"AU",name:"Australia"},{code:"CN",name:"China"},{code:"IN",name:"India"},{code:"JP",name:"Japan"},{code:"KR",name:"South Korea"},{code:"NZ",name:"New Zealand"},{code:"SG",name:"Singapore"}],africaMiddleEast:[{code:"AE",name:"United Arab Emirates"},{code:"IL",name:"Israel"},{code:"SA",name:"Saudi Arabia"},{code:"ZA",name:"South Africa"}]};function uD(){const{activeModal:e,editingSite:t,openModal:n}=ee(),r=O(E=>E.currentSite),a=O(E=>E.bankHolidays),i=O(E=>E.setBankHolidays),o=O(E=>E.setCurrentSite),l=O(E=>E.sites),c=O(E=>E.setSites),d=e==="site",h=t||r,[m,g]=f.useState(""),[_,y]=f.useState(""),[u,w]=f.useState(""),[p,x]=f.useState(""),[v,C]=f.useState(!0),[N,b]=f.useState(!1),[B,M]=f.useState(!1),[L,S]=f.useState(null);f.useEffect(()=>{d&&h&&(g(h.name||""),y(h.city||""),w(h.country_code||""),x(h.region_code||""),C(h.active!==!1&&h.active!==0),S(null))},[d,h]);const P=a.filter(E=>h&&E.site_id===h.id).length,I=async()=>{if(h){if(!m.trim()){S("Site name is required");return}b(!0),S(null);try{const E=await Kv(h.id,{name:m.trim(),city:_.trim()||void 0,country_code:u||void 0,region_code:p.trim()||void 0,active:v}),$=l.map(A=>A.id===h.id?{...A,...E}:A);c($),(r==null?void 0:r.id)===h.id&&o({...r,...E}),n("manageSites")}catch(E){S(E instanceof Error?E.message:"Failed to save site")}finally{b(!1)}}},D=async()=>{if(h&&confirm("This will refresh bank holidays from the Nager.Date API. Continue?")){M(!0),S(null);try{const E=await Lg(h.id),$=Kn(E);i(E,$);const A=l.map(R=>R.id===h.id?{...R,last_holiday_fetch:new Date().toISOString()}:R);c(A),(r==null?void 0:r.id)===h.id&&o({...r,last_holiday_fetch:new Date().toISOString()})}catch(E){S(E instanceof Error?E.message:"Failed to refresh holidays")}finally{M(!1)}}},k=()=>{n("manageSites")},j=s.jsxs("div",{className:He.footer,children:[s.jsx(oe,{variant:"secondary",onClick:k,children:"Back"}),s.jsx(oe,{variant:"primary",onClick:I,disabled:N,children:N?"Saving...":"Save Changes"})]});if(!h)return null;const T=h.last_holiday_fetch?new Date(h.last_holiday_fetch).toLocaleDateString():"Never";return s.jsxs(gt,{isOpen:d,onClose:k,title:`Edit Site: ${h.name}`,size:"lg",footer:j,children:[L&&s.jsx("div",{className:He.error,children:L}),s.jsxs("div",{className:He.section,children:[s.jsx("h3",{className:He.sectionTitle,children:"Site Details"}),s.jsxs("div",{className:He.formGroup,children:[s.jsx("label",{className:He.label,children:"Site Name"}),s.jsx("input",{type:"text",className:He.input,value:m,onChange:E=>g(E.target.value),placeholder:"e.g., Winterthur HQ"})]}),s.jsxs("div",{className:He.formGroup,children:[s.jsx("label",{className:He.label,children:"City"}),s.jsx("input",{type:"text",className:He.input,value:_,onChange:E=>y(E.target.value),placeholder:"e.g., Winterthur"})]}),s.jsxs("div",{className:He.formRow,children:[s.jsxs("div",{className:He.formGroup,children:[s.jsx("label",{className:He.label,children:"Country"}),s.jsxs("select",{className:He.select,value:u,onChange:E=>w(E.target.value),children:[s.jsx("option",{value:"",children:"Select country..."}),s.jsx("optgroup",{label:"Europe",children:to.europe.map(E=>s.jsxs("option",{value:E.code,children:[E.name," (",E.code,")"]},E.code))}),s.jsx("optgroup",{label:"Americas",children:to.americas.map(E=>s.jsxs("option",{value:E.code,children:[E.name," (",E.code,")"]},E.code))}),s.jsx("optgroup",{label:"Asia & Pacific",children:to.asiaPacific.map(E=>s.jsxs("option",{value:E.code,children:[E.name," (",E.code,")"]},E.code))}),s.jsx("optgroup",{label:"Africa & Middle East",children:to.africaMiddleEast.map(E=>s.jsxs("option",{value:E.code,children:[E.name," (",E.code,")"]},E.code))})]})]}),s.jsxs("div",{className:He.formGroup,children:[s.jsx("label",{className:He.label,children:"Region/State Code"}),s.jsx("input",{type:"text",className:He.input,value:p,onChange:E=>x(E.target.value),placeholder:"e.g., ZH, HE, ARA"})]})]}),s.jsx("p",{className:He.help,children:"Region codes vary by country. For Switzerland: ZH, BE, GE, etc. For Germany: BY, HE, NW, etc."}),s.jsx("div",{className:He.checkbox,children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:v,onChange:E=>C(E.target.checked)}),s.jsx("span",{children:"Active"})]})})]}),s.jsxs("div",{className:He.section,children:[s.jsx("h3",{className:He.sectionTitle,children:"Bank Holidays"}),u?s.jsxs("div",{className:He.holidayStatusBox,children:[s.jsxs("div",{className:He.holidayInfo,children:[s.jsxs("span",{className:He.holidayCount,children:[s.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})}),P," bank holidays"]}),s.jsxs("span",{className:He.lastFetch,children:["Last updated: ",T]})]}),s.jsxs(oe,{variant:"secondary",size:"sm",onClick:D,disabled:B,children:[s.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:4},children:[s.jsx("polyline",{points:"23 4 23 10 17 10"}),s.jsx("polyline",{points:"1 20 1 14 7 14"}),s.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),B?"Refreshing...":"Refresh"]})]}):s.jsxs("div",{className:He.warning,children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),s.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),s.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),"Set a country code above to enable automatic bank holiday fetching"]}),s.jsx("p",{className:He.help,children:"Bank holidays are fetched from the Nager.Date public API. Custom holidays can be added in the Staff View under the Bank Holidays section."})]})]})}const fD="_footer_nlv1i_3",hD="_error_nlv1i_8",mD="_siteList_nlv1i_18",pD="_empty_nlv1i_24",gD="_siteRow_nlv1i_31",_D="_inactive_nlv1i_43",yD="_siteInfo_nlv1i_47",vD="_siteName_nlv1i_52",xD="_siteCountry_nlv1i_58",wD="_siteActions_nlv1i_64",jD="_inactiveBadge_nlv1i_70",SD="_editBtn_nlv1i_78",CD="_addSection_nlv1i_97",kD="_addForm_nlv1i_102",bD="_input_nlv1i_107",ND="_help_nlv1i_127",Rt={footer:fD,error:hD,siteList:mD,empty:pD,siteRow:gD,inactive:_D,siteInfo:yD,siteName:vD,siteCountry:xD,siteActions:wD,inactiveBadge:jD,editBtn:SD,addSection:CD,addForm:kD,input:bD,help:ND},DD={AT:"Austria",BE:"Belgium",CH:"Switzerland",CZ:"Czech Republic",DE:"Germany",DK:"Denmark",ES:"Spain",FI:"Finland",FR:"France",GB:"United Kingdom",GR:"Greece",HR:"Croatia",HU:"Hungary",IE:"Ireland",IT:"Italy",NL:"Netherlands",NO:"Norway",PL:"Poland",PT:"Portugal",RO:"Romania",SE:"Sweden",AR:"Argentina",BR:"Brazil",CA:"Canada",CL:"Chile",CO:"Colombia",MX:"Mexico",US:"United States",AU:"Australia",CN:"China",IN:"India",JP:"Japan",KR:"South Korea",NZ:"New Zealand",SG:"Singapore",AE:"UAE",IL:"Israel",SA:"Saudi Arabia",ZA:"South Africa"};function $D(e){return e?DD[e]||e:""}function ED(){const{activeModal:e,closeModal:t,setEditingSite:n,openModal:r}=ee(),a=O(p=>p.sites),i=O(p=>p.setSites),o=e==="manageSites"||e==="siteManagement",[l,c]=f.useState(""),[d,h]=f.useState(!1),[m,g]=f.useState(null),_=async()=>{if(!l.trim()){g("Please enter a site name");return}h(!0),g(null);try{const p=await Xv({name:l.trim()});i([...a,p]),c("")}catch(p){g(p instanceof Error?p.message:"Failed to add site")}finally{h(!1)}},y=p=>{n(p),r("site")},u=()=>{c(""),g(null),t()},w=s.jsx("div",{className:Rt.footer,children:s.jsx(oe,{variant:"secondary",onClick:u,children:"Close"})});return s.jsxs(gt,{isOpen:o,onClose:u,title:"Site Management",footer:w,size:"md",children:[m&&s.jsx("div",{className:Rt.error,children:m}),s.jsx("div",{className:Rt.siteList,children:a.length===0?s.jsx("div",{className:Rt.empty,children:"No sites configured. Add one below."}):a.map(p=>s.jsxs("div",{className:`${Rt.siteRow} ${!p.active&&p.active!==void 0?Rt.inactive:""}`,children:[s.jsxs("div",{className:Rt.siteInfo,children:[s.jsx("div",{className:Rt.siteName,children:p.name}),s.jsx("div",{className:Rt.siteCountry,children:$D(p.country_code)||p.country_code||""})]}),s.jsxs("div",{className:Rt.siteActions,children:[!p.active&&p.active!==void 0&&s.jsx("span",{className:Rt.inactiveBadge,children:"Inactive"}),s.jsx("button",{className:Rt.editBtn,onClick:()=>y(p),title:"Edit site",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),s.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})]})]},p.id))}),s.jsxs("div",{className:Rt.addSection,children:[s.jsxs("div",{className:Rt.addForm,children:[s.jsx("input",{type:"text",className:Rt.input,placeholder:"New site name",value:l,onChange:p=>c(p.target.value),onKeyDown:p=>p.key==="Enter"&&_()}),s.jsx(oe,{variant:"primary",onClick:_,disabled:d,children:"Add"})]}),s.jsx("p",{className:Rt.help,children:"After adding, click the edit button to set country and region codes for automatic bank holidays."})]})]})}const TD="_container_1yt18_5",MD="_toolbar_1yt18_10",ID="_count_1yt18_19",PD="_error_1yt18_25",LD="_listWrapper_1yt18_36",AD="_loading_1yt18_41",BD="_empty_1yt18_42",RD="_emptyHint_1yt18_48",OD="_list_1yt18_36",FD="_skillItem_1yt18_59",zD="_skillInfo_1yt18_74",HD="_colorDot_1yt18_82",qD="_skillText_1yt18_89",WD="_skillName_1yt18_96",VD="_skillDesc_1yt18_101",UD="_skillActions_1yt18_109",GD="_actionBtn_1yt18_116",YD="_deleteBtn_1yt18_136",QD="_form_1yt18_145",XD="_formHeader_1yt18_151",KD="_backBtn_1yt18_166",ZD="_field_1yt18_182",JD="_colorPicker_1yt18_215",e$="_colorOption_1yt18_222",t$="_selected_1yt18_235",n$="_customColor_1yt18_240",s$="_colorPreview_1yt18_259",r$="_previewDot_1yt18_269",a$="_previewText_1yt18_275",i$="_formActions_1yt18_281",be={container:TD,toolbar:MD,count:ID,error:PD,listWrapper:LD,loading:AD,empty:BD,emptyHint:RD,list:OD,skillItem:FD,skillInfo:zD,colorDot:HD,skillText:qD,skillName:WD,skillDesc:VD,skillActions:UD,actionBtn:GD,deleteBtn:YD,form:QD,formHeader:XD,backBtn:KD,field:ZD,colorPicker:JD,colorOption:e$,selected:t$,customColor:n$,colorPreview:s$,previewDot:r$,previewText:a$,formActions:i$},Oh=["#3b82f6","#8b5cf6","#10b981","#f59e0b","#ef4444","#06b6d4","#ec4899","#84cc16","#f97316","#6366f1"];function o$({isOpen:e,onClose:t}){const n=O(v=>v.setSkills),[r,a]=f.useState([]),[i,o]=f.useState(!1),[l,c]=f.useState(null),[d,h]=f.useState(!1),[m,g]=f.useState(null),_=f.useCallback(async()=>{o(!0),g(null);try{const v=await ma.getAll();a(v),n(v)}catch(v){console.error("Failed to load skills:",v),g("Failed to load skills")}finally{o(!1)}},[n]);f.useEffect(()=>{e&&_()},[e,_]);const y=v=>{c(v),h(!1)},u=()=>{c(null),h(!0)},w=()=>{c(null),h(!1)},p=async()=>{await _(),w()},x=async v=>{const C=r.find(b=>b.id===v);if(!(!C||!window.confirm(`Are you sure you want to delete "${C.name}"?

This will remove the skill from all users who have it assigned.`)))try{await ma.delete(v),await _()}catch(b){console.error("Failed to delete skill:",b),g("Failed to delete skill")}};return s.jsx(gt,{isOpen:e,onClose:t,title:"Manage Skills",size:"md",children:s.jsx("div",{className:be.container,children:l||d?s.jsx(l$,{skill:l,onSave:p,onCancel:w}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:be.toolbar,children:[s.jsxs("span",{className:be.count,children:[r.length," skills"]}),s.jsxs(oe,{onClick:u,children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Skill"]})]}),m&&s.jsx("div",{className:be.error,children:m}),s.jsx("div",{className:be.listWrapper,children:i?s.jsx("div",{className:be.loading,children:"Loading skills..."}):r.length===0?s.jsxs("div",{className:be.empty,children:[s.jsx("p",{children:"No skills defined yet"}),s.jsx("p",{className:be.emptyHint,children:'Click "Add Skill" to create your first skill'})]}):s.jsx("div",{className:be.list,children:r.map(v=>s.jsxs("div",{className:be.skillItem,children:[s.jsxs("div",{className:be.skillInfo,children:[s.jsx("span",{className:be.colorDot,style:{backgroundColor:v.color}}),s.jsxs("div",{className:be.skillText,children:[s.jsx("span",{className:be.skillName,children:v.name}),v.description&&s.jsx("span",{className:be.skillDesc,children:v.description})]})]}),s.jsxs("div",{className:be.skillActions,children:[s.jsx("button",{className:be.actionBtn,onClick:()=>y(v),title:"Edit skill",children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),s.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),s.jsx("button",{className:`${be.actionBtn} ${be.deleteBtn}`,onClick:()=>x(v.id),title:"Delete skill",children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("polyline",{points:"3 6 5 6 21 6"}),s.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})]},v.id))})})]})})})}function l$({skill:e,onSave:t,onCancel:n}){const r=!!e,[a,i]=f.useState((e==null?void 0:e.name)||""),[o,l]=f.useState((e==null?void 0:e.description)||""),[c,d]=f.useState((e==null?void 0:e.color)||Oh[0]),[h,m]=f.useState(!1),[g,_]=f.useState(null),y=async u=>{if(u.preventDefault(),_(null),!a.trim()){_("Skill name is required");return}m(!0);try{r&&e?await ma.update(e.id,{name:a.trim(),description:o.trim()||void 0,color:c}):await ma.create({name:a.trim(),description:o.trim()||void 0,color:c}),t()}catch(w){console.error("Failed to save skill:",w);let p="Failed to save skill";w instanceof Error&&(p=w.message),_(p)}finally{m(!1)}};return s.jsxs("form",{onSubmit:y,className:be.form,children:[s.jsxs("div",{className:be.formHeader,children:[s.jsx("h3",{children:r?"Edit Skill":"Add Skill"}),s.jsx("button",{type:"button",className:be.backBtn,onClick:n,children:" Back to list"})]}),g&&s.jsx("div",{className:be.error,children:g}),s.jsxs("div",{className:be.field,children:[s.jsx("label",{htmlFor:"skillName",children:"Name *"}),s.jsx("input",{type:"text",id:"skillName",value:a,onChange:u=>i(u.target.value),placeholder:"e.g., Project Management",required:!0,maxLength:100})]}),s.jsxs("div",{className:be.field,children:[s.jsx("label",{htmlFor:"skillDesc",children:"Description"}),s.jsx("input",{type:"text",id:"skillDesc",value:o,onChange:u=>l(u.target.value),placeholder:"Optional description"})]}),s.jsxs("div",{className:be.field,children:[s.jsx("label",{children:"Color"}),s.jsxs("div",{className:be.colorPicker,children:[Oh.map(u=>s.jsx("button",{type:"button",className:`${be.colorOption} ${c===u?be.selected:""}`,style:{backgroundColor:u},onClick:()=>d(u),title:u},u)),s.jsx("input",{type:"color",value:c,onChange:u=>d(u.target.value),className:be.customColor,title:"Custom color"})]}),s.jsxs("div",{className:be.colorPreview,children:[s.jsx("span",{className:be.previewDot,style:{backgroundColor:c}}),s.jsx("span",{className:be.previewText,children:a||"Skill Name"})]})]}),s.jsxs("div",{className:be.formActions,children:[s.jsx(oe,{type:"button",variant:"secondary",onClick:n,disabled:h,children:"Cancel"}),s.jsx(oe,{type:"submit",disabled:h,children:h?"Saving...":r?"Save Changes":"Create Skill"})]})]})}const c$="_container_5vw7o_6",d$="_toolbar_5vw7o_13",u$="_toolbarLeft_5vw7o_24",f$="_toolbarRight_5vw7o_30",h$="_resultCount_5vw7o_36",m$="_filterWrapper_5vw7o_42",p$="_filterTrigger_5vw7o_46",g$="_hasFilters_5vw7o_67",_$="_chevron_5vw7o_73",y$="_open_5vw7o_77",v$="_filterDropdown_5vw7o_81",x$="_filterActions_5vw7o_94",w$="_clearFilters_5vw7o_100",j$="_filterGrid_5vw7o_113",S$="_filterField_5vw7o_119",C$="_tableWrapper_5vw7o_147",k$="_table_5vw7o_147",b$="_disabled_5vw7o_186",N$="_nameCell_5vw7o_191",D$="_nameInfo_5vw7o_197",$$="_userName_5vw7o_203",E$="_userEmail_5vw7o_208",T$="_disabledBadge_5vw7o_213",M$="_jobTitleCell_5vw7o_224",I$="_noValue_5vw7o_229",P$="_roleBadge_5vw7o_234",L$="_skillsCell_5vw7o_243",A$="_skillBadge_5vw7o_250",B$="_moreSkills_5vw7o_262",R$="_sitesCell_5vw7o_269",O$="_editBtn_5vw7o_279",F$="_loading_5vw7o_300",z$="_empty_5vw7o_301",H$="_form_5vw7o_311",q$="_formHeader_5vw7o_317",W$="_backBtn_5vw7o_332",V$="_error_5vw7o_348",U$="_formGrid_5vw7o_358",G$="_field_5vw7o_371",Y$="_toggleLabel_5vw7o_414",Q$="_hint_5vw7o_433",X$="_optionButtons_5vw7o_488",K$="_optionButton_5vw7o_488",Z$="_selected_5vw7o_513",J$="_addNew_5vw7o_520",e4="_skillOption_5vw7o_529",t4="_skillColorDot_5vw7o_535",n4="_noOptions_5vw7o_542",s4="_newItemInput_5vw7o_549",r4="_confirmBtn_5vw7o_570",a4="_cancelBtn_5vw7o_571",i4="_formActions_5vw7o_667",o4="_rightActions_5vw7o_676",se={container:c$,toolbar:d$,toolbarLeft:u$,toolbarRight:f$,resultCount:h$,filterWrapper:m$,filterTrigger:p$,hasFilters:g$,chevron:_$,open:y$,filterDropdown:v$,filterActions:x$,clearFilters:w$,filterGrid:j$,filterField:S$,tableWrapper:C$,table:k$,disabled:b$,nameCell:N$,nameInfo:D$,userName:$$,userEmail:E$,disabledBadge:T$,jobTitleCell:M$,noValue:I$,roleBadge:P$,skillsCell:L$,skillBadge:A$,moreSkills:B$,sitesCell:R$,editBtn:O$,loading:F$,empty:z$,form:H$,formHeader:q$,backBtn:W$,error:V$,formGrid:U$,field:G$,toggleLabel:Y$,hint:Q$,optionButtons:X$,optionButton:K$,selected:Z$,addNew:J$,skillOption:e4,skillColorDot:t4,noOptions:n4,newItemInput:s4,confirmBtn:r4,cancelBtn:a4,formActions:i4,rightActions:o4},cc={admin:{label:"Admin",color:"#ef4444"},superuser:{label:"SuperUser",color:"#f97316"},user:{label:"User",color:"#3b82f6"}};function l4(){const e=ee(z=>z.activeModal),t=ee(z=>z.closeModal),n=O(z=>z.sites),r=O(z=>z.skills),a=O(z=>z.currentUser),{refreshStaff:i}=jl(),o=e==="userManagement",[l,c]=f.useState(!1),[d,h]=f.useState([]),[m,g]=f.useState(!1),[_,y]=f.useState(null),[u,w]=f.useState(!1),[p,x]=f.useState(!1),[v,C]=f.useState("all"),[N,b]=f.useState("all"),[B,M]=f.useState("active"),[L,S]=f.useState("all"),[P,I]=f.useState("all"),[D,k]=f.useState(!1),j=f.useRef(null),T=(a==null?void 0:a.role)==="admin",E=(a==null?void 0:a.role)==="superuser",$=T||E,A=f.useCallback(async()=>{g(!0);try{const z=await ax(!0);h(z)}catch(z){console.error("Failed to load users:",z)}finally{g(!1)}},[]);f.useEffect(()=>{o&&A()},[o,A]),f.useEffect(()=>{const z=ue=>{j.current&&!j.current.contains(ue.target)&&k(!1)};return D&&document.addEventListener("mousedown",z),()=>document.removeEventListener("mousedown",z)},[D]);const R=f.useMemo(()=>{const z=new Set;return d.forEach(ue=>{ue.job_title&&z.add(ue.job_title)}),Array.from(z).sort()},[d]),H=f.useMemo(()=>d.filter(z=>{var ue;if(v!=="all"&&z.role!==v||N!=="all"&&z.job_title!==N||B==="active"&&!z.active||B==="disabled"&&z.active||L!=="all"&&!z.site_ids.includes(parseInt(L)))return!1;if(P!=="all"){const Le=parseInt(P);if(!((ue=z.skills)!=null&&ue.some(q=>q.id===Le)))return!1}return!0}),[d,v,N,B,L,P]),F=f.useMemo(()=>{let z=0;return v!=="all"&&z++,N!=="all"&&z++,B!=="active"&&z++,L!=="all"&&z++,P!=="all"&&z++,z},[v,N,B,L,P]),V=()=>{C("all"),b("all"),M("active"),S("all"),I("all")},Q=z=>!z||z.length===0?"":z.map(ue=>{var Le;return(Le=n.find(q=>q.id===ue))==null?void 0:Le.name}).filter(Boolean).join(", "),X=z=>{y(z),w(!1)},Z=()=>{y(null),w(!0)},ce=()=>{y(null),w(!1)},K=async()=>{await A(),c(!0),ce()},fe=async()=>{await A(),c(!0),ce()},ae=async()=>{l&&(await i(),c(!1)),t()};return s.jsxs(s.Fragment,{children:[s.jsx(gt,{isOpen:o,onClose:ae,title:"User Management",size:"xxl",children:s.jsx("div",{className:se.container,children:_||u?s.jsx(c4,{user:_,sites:n,skills:r,currentUser:a,onSave:K,onDelete:fe,onCancel:ce}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:se.toolbar,children:[s.jsxs("div",{className:se.toolbarLeft,children:[s.jsxs("div",{ref:j,className:se.filterWrapper,children:[s.jsxs("button",{className:`${se.filterTrigger} ${F>0?se.hasFilters:""}`,onClick:()=>k(!D),children:[s.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),s.jsx("span",{children:F>0?`${F} filter${F>1?"s":""}`:"Filter"}),s.jsx("svg",{className:`${se.chevron} ${D?se.open:""}`,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),D&&s.jsxs("div",{className:se.filterDropdown,children:[F>0&&s.jsx("div",{className:se.filterActions,children:s.jsx("button",{className:se.clearFilters,onClick:V,children:"Clear all filters"})}),s.jsxs("div",{className:se.filterGrid,children:[s.jsxs("div",{className:se.filterField,children:[s.jsx("label",{children:"Status"}),s.jsxs("select",{value:B,onChange:z=>M(z.target.value),children:[s.jsx("option",{value:"all",children:"All"}),s.jsx("option",{value:"active",children:"Active"}),s.jsx("option",{value:"disabled",children:"Disabled"})]})]}),s.jsxs("div",{className:se.filterField,children:[s.jsx("label",{children:"Role"}),s.jsxs("select",{value:v,onChange:z=>C(z.target.value),children:[s.jsx("option",{value:"all",children:"All Roles"}),s.jsx("option",{value:"admin",children:"Admin"}),s.jsx("option",{value:"superuser",children:"SuperUser"}),s.jsx("option",{value:"user",children:"User"})]})]}),s.jsxs("div",{className:se.filterField,children:[s.jsx("label",{children:"Job Title"}),s.jsxs("select",{value:N,onChange:z=>b(z.target.value),children:[s.jsx("option",{value:"all",children:"All Job Titles"}),R.map(z=>s.jsx("option",{value:z,children:z},z))]})]}),s.jsxs("div",{className:se.filterField,children:[s.jsx("label",{children:"Site"}),s.jsxs("select",{value:L,onChange:z=>S(z.target.value),children:[s.jsx("option",{value:"all",children:"All Sites"}),n.map(z=>s.jsx("option",{value:z.id,children:z.name},z.id))]})]}),s.jsxs("div",{className:se.filterField,children:[s.jsx("label",{children:"Skill"}),s.jsxs("select",{value:P,onChange:z=>I(z.target.value),children:[s.jsx("option",{value:"all",children:"All Skills"}),r.map(z=>s.jsx("option",{value:z.id,children:z.name},z.id))]})]})]})]})]}),s.jsxs("span",{className:se.resultCount,children:[H.length," user",H.length!==1?"s":"",F>0&&` (filtered from ${d.length})`]})]}),s.jsx("div",{className:se.toolbarRight,children:$&&s.jsxs(s.Fragment,{children:[s.jsxs(oe,{variant:"secondary",onClick:()=>x(!0),children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"6px"},children:[s.jsx("circle",{cx:"12",cy:"12",r:"3"}),s.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),"Manage Skills"]}),s.jsxs(oe,{onClick:Z,children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"6px"},children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add User"]})]})})]}),s.jsx("div",{className:se.tableWrapper,children:m?s.jsx("div",{className:se.loading,children:"Loading users..."}):H.length===0?s.jsx("div",{className:se.empty,children:F>0?"No users match the selected filters":"No users found"}):s.jsxs("table",{className:se.table,children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Name"}),s.jsx("th",{children:"Job Title"}),s.jsx("th",{children:"Role"}),s.jsx("th",{children:"Skills"}),s.jsx("th",{children:"Sites"}),s.jsx("th",{style:{width:60}})]})}),s.jsx("tbody",{children:H.map(z=>s.jsxs("tr",{className:z.active?"":se.disabled,children:[s.jsx("td",{children:s.jsxs("div",{className:se.nameCell,children:[s.jsxs("div",{className:se.nameInfo,children:[s.jsxs("span",{className:se.userName,children:[z.first_name," ",z.last_name]}),s.jsx("span",{className:se.userEmail,children:z.email})]}),!z.active&&s.jsx("span",{className:se.disabledBadge,children:"Disabled"})]})}),s.jsx("td",{className:se.jobTitleCell,children:z.job_title||s.jsx("span",{className:se.noValue,children:""})}),s.jsx("td",{children:s.jsx("span",{className:se.roleBadge,style:{backgroundColor:`${cc[z.role].color}20`,color:cc[z.role].color},children:cc[z.role].label})}),s.jsx("td",{children:s.jsx("div",{className:se.skillsCell,children:z.skills&&z.skills.length>0?s.jsxs(s.Fragment,{children:[z.skills.slice(0,3).map(ue=>s.jsx("span",{className:se.skillBadge,style:{backgroundColor:`${ue.color}20`,color:ue.color},title:ue.name,children:ue.name},ue.id)),z.skills.length>3&&s.jsxs("span",{className:se.moreSkills,children:["+",z.skills.length-3]})]}):s.jsx("span",{className:se.noValue,children:""})})}),s.jsx("td",{className:se.sitesCell,title:Q(z.site_ids),children:Q(z.site_ids)}),s.jsx("td",{children:s.jsx("button",{className:se.editBtn,onClick:()=>X(z),title:"Edit user",children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),s.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})})]},z.id))})]})})]})})}),s.jsx(o$,{isOpen:p,onClose:()=>x(!1)})]})}function c4({user:e,sites:t,skills:n,currentUser:r,onSave:a,onDelete:i,onCancel:o}){var Le;const l=!!e,c=(r==null?void 0:r.role)==="admin",d=(r==null?void 0:r.role)==="superuser",[h,m]=f.useState((e==null?void 0:e.first_name)||""),[g,_]=f.useState((e==null?void 0:e.last_name)||""),[y,u]=f.useState((e==null?void 0:e.email)||""),[w,p]=f.useState(""),[x,v]=f.useState((e==null?void 0:e.job_title)||""),[C,N]=f.useState((e==null?void 0:e.role)||"user"),[b,B]=f.useState((e==null?void 0:e.active)??!0),[M,L]=f.useState((e==null?void 0:e.site_ids)||[]),[S,P]=f.useState(((Le=e==null?void 0:e.skills)==null?void 0:Le.map(q=>q.id))||[]),[I,D]=f.useState(!1),[k,j]=f.useState(""),[T,E]=f.useState(!1),$=O(q=>q.setSkills),[A,R]=f.useState(!1),[H,F]=f.useState(null),V=c,Q=c||d,X=c,Z=l&&(c&&(e==null?void 0:e.id)!==(r==null?void 0:r.id)||d&&(e==null?void 0:e.role)!=="admin"),ce=q=>{L(te=>te.includes(q)?te.filter(he=>he!==q):[...te,q])},K=q=>{P(te=>te.includes(q)?te.filter(he=>he!==q):[...te,q])},fe=async()=>{if(k.trim()){E(!0);try{const{skillsApi:q}=await jg(async()=>{const{skillsApi:Ee}=await Promise.resolve().then(()=>mx);return{skillsApi:Ee}},void 0),te=await q.create({name:k.trim(),color:"#6366f1"}),he=await q.getAll();$(he),P(Ee=>[...Ee,te.id]),D(!1),j("")}catch(q){console.error("Failed to create skill:",q),F(q instanceof Error?q.message:"Failed to create skill")}finally{E(!1)}}},ae=()=>{D(!1),j("")},z=async q=>{if(q.preventDefault(),F(null),!h.trim()||!g.trim()||!y.trim()){F("Please fill in all required fields");return}if(!l&&!w){F("Password is required for new users");return}if(!l&&w.length<6){F("Password must be at least 6 characters");return}R(!0);try{if(l&&e){const te={first_name:h.trim(),last_name:g.trim(),email:y.trim(),job_title:x.trim()||void 0,role:C,active:b,site_ids:M,skill_ids:S};w&&(te.password=w),await ox(e.id,te)}else{const te={first_name:h.trim(),last_name:g.trim(),email:y.trim(),password:w,job_title:x.trim()||void 0,role:C,site_ids:M,skill_ids:S};await ix(te)}a()}catch(te){console.error("Failed to save user:",te),F(te instanceof Error?te.message:"Failed to save user")}finally{R(!1)}},ue=async()=>{if(!(!e||!window.confirm(`Are you sure you want to delete "${e.first_name} ${e.last_name}"?

This action cannot be undone.`))){R(!0);try{await lx(e.id),i()}catch(te){console.error("Failed to delete user:",te),F(te instanceof Error?te.message:"Failed to delete user")}finally{R(!1)}}};return s.jsxs("form",{onSubmit:z,className:se.form,children:[s.jsxs("div",{className:se.formHeader,children:[s.jsx("h3",{children:l?"Edit User":"Add User"}),s.jsx("button",{type:"button",className:se.backBtn,onClick:o,children:" Back to list"})]}),H&&s.jsx("div",{className:se.error,children:H}),s.jsxs("div",{className:se.formGrid,children:[s.jsxs("div",{className:se.field,children:[s.jsx("label",{htmlFor:"firstName",children:"First Name *"}),s.jsx("input",{type:"text",id:"firstName",value:h,onChange:q=>m(q.target.value),placeholder:"Enter first name",required:!0})]}),s.jsxs("div",{className:se.field,children:[s.jsx("label",{htmlFor:"lastName",children:"Last Name *"}),s.jsx("input",{type:"text",id:"lastName",value:g,onChange:q=>_(q.target.value),placeholder:"Enter last name",required:!0})]}),s.jsxs("div",{className:se.field,children:[s.jsx("label",{htmlFor:"email",children:"Email *"}),s.jsx("input",{type:"email",id:"email",value:y,onChange:q=>u(q.target.value),placeholder:"Enter email address",required:!0})]}),s.jsxs("div",{className:se.field,children:[s.jsxs("label",{htmlFor:"password",children:["Password ",l?"(leave blank to keep)":"*"]}),s.jsx("input",{type:"password",id:"password",value:w,onChange:q=>p(q.target.value),placeholder:l?"":"Min 6 characters",required:!l,minLength:6})]}),s.jsxs("div",{className:se.field,children:[s.jsx("label",{htmlFor:"jobTitle",children:"Job Title"}),s.jsx("input",{type:"text",id:"jobTitle",value:x,onChange:q=>v(q.target.value),placeholder:"e.g., Project Manager"})]}),s.jsxs("div",{className:se.field,children:[s.jsx("label",{htmlFor:"role",children:"Role *"}),s.jsxs("select",{id:"role",value:C,onChange:q=>N(q.target.value),children:[s.jsx("option",{value:"user",children:"User"}),s.jsx("option",{value:"superuser",disabled:!Q,children:"SuperUser"}),s.jsxs("option",{value:"admin",disabled:!V,children:["Admin ",V?"":"(admin only)"]})]})]}),l&&s.jsxs("div",{className:se.field,children:[s.jsx("label",{children:"Status"}),s.jsxs("label",{className:se.toggleLabel,children:[s.jsx("input",{type:"checkbox",checked:b,onChange:q=>B(q.target.checked),disabled:!Z}),s.jsx("span",{children:"Active"})]}),!Z&&s.jsx("span",{className:se.hint,children:(e==null?void 0:e.id)===(r==null?void 0:r.id)?"Can't disable yourself":"Insufficient permissions"})]})]}),s.jsxs("div",{className:se.field,children:[s.jsx("label",{children:"Site Assignments"}),s.jsxs("div",{className:se.optionButtons,children:[t.map(q=>s.jsx("button",{type:"button",className:`${se.optionButton} ${M.includes(q.id)?se.selected:""}`,onClick:()=>ce(q.id),children:q.name},q.id)),t.length===0&&s.jsx("span",{className:se.noOptions,children:"No sites available"})]}),s.jsx("span",{className:se.hint,children:"Select which sites this user can access"})]}),s.jsxs("div",{className:se.field,children:[s.jsx("label",{children:"Skills"}),s.jsxs("div",{className:se.optionButtons,children:[n.map(q=>s.jsxs("button",{type:"button",className:`${se.optionButton} ${se.skillOption} ${S.includes(q.id)?se.selected:""}`,onClick:()=>K(q.id),style:{"--skill-color":q.color},children:[s.jsx("span",{className:se.skillColorDot,style:{backgroundColor:q.color}}),q.name]},q.id)),I?s.jsxs("div",{className:se.newItemInput,children:[s.jsx("input",{type:"text",value:k,onChange:q=>j(q.target.value),placeholder:"New skill name",autoFocus:!0,disabled:T,onKeyDown:q=>{q.key==="Enter"?(q.preventDefault(),fe()):q.key==="Escape"&&ae()}}),s.jsx("button",{type:"button",className:se.confirmBtn,onClick:fe,disabled:T,children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})})}),s.jsx("button",{type:"button",className:se.cancelBtn,onClick:ae,disabled:T,children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}):s.jsx("button",{type:"button",className:`${se.optionButton} ${se.addNew}`,onClick:()=>D(!0),children:"+ New skill"})]}),s.jsx("span",{className:se.hint,children:"Click to toggle skills. Skills are shared across all users."})]}),s.jsxs("div",{className:se.formActions,children:[l&&X&&s.jsx(oe,{type:"button",variant:"danger",onClick:ue,disabled:A,children:"Delete User"}),s.jsxs("div",{className:se.rightActions,children:[s.jsx(oe,{type:"button",variant:"secondary",onClick:o,disabled:A,children:"Cancel"}),s.jsx(oe,{type:"submit",disabled:A,children:A?"Saving...":l?"Save Changes":"Create User"})]})]})]})}const d4="_container_1s6nv_5",u4="_loading_1s6nv_11",f4="_error_1s6nv_17",h4="_success_1s6nv_26",m4="_toggleSection_1s6nv_36",p4="_toggle_1s6nv_36",g4="_toggleSwitch_1s6nv_52",_4="_toggleLabel_1s6nv_81",y4="_section_1s6nv_87",v4="_field_1s6nv_103",x4="_hint_1s6nv_143",w4="_checkbox_1s6nv_150",j4="_actions_1s6nv_170",rt={container:d4,loading:u4,error:f4,success:h4,toggleSection:m4,toggle:p4,toggleSwitch:g4,toggleLabel:_4,section:y4,field:v4,hint:x4,checkbox:w4,actions:j4};function S4(){const e=ee(T=>T.activeModal),t=ee(T=>T.closeModal),n=O(T=>T.currentUser),r=e==="ssoConfig",a=(n==null?void 0:n.role)==="admin",[i,o]=f.useState(!1),[l,c]=f.useState(""),[d,h]=f.useState(""),[m,g]=f.useState(""),[_,y]=f.useState(""),[u,w]=f.useState(""),[p,x]=f.useState(!1),[v,C]=f.useState("user"),[N,b]=f.useState(!1),[B,M]=f.useState(!1),[L,S]=f.useState(null),[P,I]=f.useState(null),D=typeof window<"u"?`${window.location.origin}/api/auth/sso/callback`:"/api/auth/sso/callback";f.useEffect(()=>{r&&a&&k()},[r,a]);const k=async()=>{b(!0),S(null);try{const T=await Pe("/api/sso/config/full");o(T.enabled),c(T.tenant_id||""),h(T.client_id||""),y(T.client_secret_masked||"Enter client secret"),w(T.redirect_uri||D),x(T.auto_create_users),C(T.default_role||"user")}catch(T){console.error("Failed to load SSO config:",T),S(T instanceof Error?T.message:"Failed to load configuration")}finally{b(!1)}},j=async()=>{if(S(null),I(null),i&&(!l.trim()||!d.trim()||!u.trim())){S("Please fill in Tenant ID, Client ID, and Redirect URI to enable SSO");return}M(!0);try{const T={enabled:i,tenant_id:l.trim(),client_id:d.trim(),redirect_uri:u.trim(),auto_create_users:p,default_role:v};m&&(T.client_secret=m),await nt("/api/sso/config",T),I("SSO configuration saved successfully"),g(""),await k()}catch(T){console.error("Failed to save SSO config:",T),S(T instanceof Error?T.message:"Failed to save configuration")}finally{M(!1)}};return a?s.jsx(gt,{isOpen:r,onClose:t,title:"SSO Configuration",size:"md",children:s.jsx("div",{className:rt.container,children:N?s.jsx("div",{className:rt.loading,children:"Loading configuration..."}):s.jsxs(s.Fragment,{children:[L&&s.jsx("div",{className:rt.error,children:L}),P&&s.jsx("div",{className:rt.success,children:P}),s.jsxs("div",{className:rt.toggleSection,children:[s.jsxs("label",{className:rt.toggle,children:[s.jsx("input",{type:"checkbox",checked:i,onChange:T=>o(T.target.checked)}),s.jsx("span",{className:rt.toggleSwitch}),s.jsx("span",{className:rt.toggleLabel,children:"Enable SSO"})]}),s.jsx("p",{className:rt.hint,children:"When enabled, users can sign in using Microsoft Entra (Azure AD)."})]}),s.jsxs("div",{className:rt.section,children:[s.jsx("h4",{children:"Microsoft Entra Settings"}),s.jsxs("div",{className:rt.field,children:[s.jsx("label",{htmlFor:"tenantId",children:"Tenant ID *"}),s.jsx("input",{type:"text",id:"tenantId",value:l,onChange:T=>c(T.target.value),placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",disabled:!i}),s.jsx("span",{className:rt.hint,children:"Found in Azure Portal  Microsoft Entra ID  Overview"})]}),s.jsxs("div",{className:rt.field,children:[s.jsx("label",{htmlFor:"clientId",children:"Client ID (Application ID) *"}),s.jsx("input",{type:"text",id:"clientId",value:d,onChange:T=>h(T.target.value),placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",disabled:!i}),s.jsx("span",{className:rt.hint,children:"Found in App Registration  Overview  Application (client) ID"})]}),s.jsxs("div",{className:rt.field,children:[s.jsx("label",{htmlFor:"clientSecret",children:"Client Secret"}),s.jsx("input",{type:"password",id:"clientSecret",value:m,onChange:T=>g(T.target.value),placeholder:_||"Enter client secret",disabled:!i}),s.jsx("span",{className:rt.hint,children:"Leave blank to keep existing secret. Create in App Registration  Certificates & secrets"})]}),s.jsxs("div",{className:rt.field,children:[s.jsx("label",{htmlFor:"redirectUri",children:"Redirect URI *"}),s.jsx("input",{type:"text",id:"redirectUri",value:u,onChange:T=>w(T.target.value),placeholder:D,disabled:!i}),s.jsx("span",{className:rt.hint,children:"Must be registered in App Registration  Authentication  Redirect URIs"})]})]}),s.jsxs("div",{className:rt.section,children:[s.jsx("h4",{children:"User Management"}),s.jsxs("label",{className:rt.checkbox,children:[s.jsx("input",{type:"checkbox",checked:p,onChange:T=>x(T.target.checked),disabled:!i}),s.jsx("span",{children:"Auto-create users on first SSO login"})]}),s.jsxs("div",{className:rt.field,children:[s.jsx("label",{htmlFor:"defaultRole",children:"Default role for new users"}),s.jsxs("select",{id:"defaultRole",value:v,onChange:T=>C(T.target.value),disabled:!i||!p,children:[s.jsx("option",{value:"user",children:"User"}),s.jsx("option",{value:"superuser",children:"SuperUser"}),s.jsx("option",{value:"admin",children:"Admin"})]})]})]}),s.jsxs("div",{className:rt.actions,children:[s.jsx(oe,{variant:"secondary",onClick:t,children:"Cancel"}),s.jsx(oe,{onClick:j,disabled:B,children:B?"Saving...":"Save Configuration"})]})]})})}):null}const C4="_container_rlhcs_5",k4="_toolbar_rlhcs_10",b4="_count_rlhcs_19",N4="_error_rlhcs_25",D4="_listWrapper_rlhcs_36",$4="_loading_rlhcs_41",E4="_empty_rlhcs_42",T4="_emptyHint_rlhcs_48",M4="_list_rlhcs_36",I4="_typeItem_rlhcs_59",P4="_typeInfo_rlhcs_74",L4="_typeName_rlhcs_80",A4="_typeCount_rlhcs_85",B4="_typeActions_rlhcs_90",R4="_actionBtn_rlhcs_97",O4="_deleteBtn_rlhcs_122",F4="_infoNote_rlhcs_128",z4="_form_rlhcs_144",H4="_formHeader_rlhcs_150",q4="_backBtn_rlhcs_165",W4="_field_rlhcs_181",V4="_renameWarning_rlhcs_214",U4="_createNote_rlhcs_227",G4="_formActions_rlhcs_239",qe={container:C4,toolbar:k4,count:b4,error:N4,listWrapper:D4,loading:$4,empty:E4,emptyHint:T4,list:M4,typeItem:I4,typeInfo:P4,typeName:L4,typeCount:A4,typeActions:B4,actionBtn:R4,deleteBtn:O4,infoNote:F4,form:z4,formHeader:H4,backBtn:q4,field:W4,renameWarning:V4,createNote:U4,formActions:G4};function Y4({isOpen:e,onClose:t,onTypesChanged:n}){const[r,a]=f.useState([]),[i,o]=f.useState([]),[l,c]=f.useState(!1),[d,h]=f.useState(null),[m,g]=f.useState(!1),[_,y]=f.useState(null),u=f.useCallback(async()=>{c(!0),y(null);try{const N=await Pe("/api/equipment/all");o(N);const b=new Map;N.forEach(M=>{M.type&&b.set(M.type,(b.get(M.type)||0)+1)});const B=Array.from(b.entries()).map(([M,L])=>({name:M,count:L})).sort((M,L)=>M.name.localeCompare(L.name));a(B)}catch(N){console.error("Failed to load equipment types:",N),y("Failed to load equipment types")}finally{c(!1)}},[]);f.useEffect(()=>{e&&u()},[e,u]);const w=N=>{h(N),g(!1)},p=()=>{h(null),g(!0)},x=()=>{h(null),g(!1)},v=async()=>{await u(),n==null||n(),x()},C=async N=>{const b=r.find(B=>B.name===N);if(b){if(b.count>0){y(`Cannot delete "${N}": ${b.count} equipment item(s) still use this type. Change their type first.`);return}a(B=>B.filter(M=>M.name!==N))}};return s.jsx(gt,{isOpen:e,onClose:t,title:"Manage Equipment Types",size:"md",children:s.jsx("div",{className:qe.container,children:d||m?s.jsx(Q4,{typeName:d,existingTypes:r.map(N=>N.name),allEquipment:i,onSave:v,onCancel:x}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:qe.toolbar,children:[s.jsxs("span",{className:qe.count,children:[r.length," type",r.length!==1?"s":""]}),s.jsxs(oe,{onClick:p,children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"6px"},children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Type"]})]}),_&&s.jsx("div",{className:qe.error,children:_}),s.jsx("div",{className:qe.listWrapper,children:l?s.jsx("div",{className:qe.loading,children:"Loading types..."}):r.length===0?s.jsxs("div",{className:qe.empty,children:[s.jsx("p",{children:"No equipment types defined yet"}),s.jsx("p",{className:qe.emptyHint,children:"Types are created when you add equipment"})]}):s.jsx("div",{className:qe.list,children:r.map(N=>s.jsxs("div",{className:qe.typeItem,children:[s.jsxs("div",{className:qe.typeInfo,children:[s.jsx("span",{className:qe.typeName,children:N.name}),s.jsxs("span",{className:qe.typeCount,children:[N.count," equipment item",N.count!==1?"s":""]})]}),s.jsxs("div",{className:qe.typeActions,children:[s.jsx("button",{className:qe.actionBtn,onClick:()=>w(N.name),title:"Rename type",children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),s.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),s.jsx("button",{className:`${qe.actionBtn} ${qe.deleteBtn}`,onClick:()=>C(N.name),title:N.count>0?"Cannot delete: type is in use":"Delete type",disabled:N.count>0,children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("polyline",{points:"3 6 5 6 21 6"}),s.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})]},N.name))})}),s.jsxs("div",{className:qe.infoNote,children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),s.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),s.jsx("span",{children:"Equipment types are shared across all sites"})]})]})})})}function Q4({typeName:e,existingTypes:t,allEquipment:n,onSave:r,onCancel:a}){const i=!!e,[o,l]=f.useState(e||""),[c,d]=f.useState(!1),[h,m]=f.useState(null),g=i?n.filter(y=>y.type===e).length:0,_=async y=>{y.preventDefault(),m(null);const u=o.trim();if(!u){m("Type name is required");return}if(t.some(p=>p.toLowerCase()===u.toLowerCase()&&p!==e)){m("A type with this name already exists");return}d(!0);try{i&&e&&await nt(`/api/equipment-types/${encodeURIComponent(e)}?new_type=${encodeURIComponent(u)}`),r()}catch(p){console.error("Failed to save type:",p);let x="Failed to save type";p instanceof Error&&(x=p.message),m(x)}finally{d(!1)}};return s.jsxs("form",{onSubmit:_,className:qe.form,children:[s.jsxs("div",{className:qe.formHeader,children:[s.jsx("h3",{children:i?"Rename Type":"Add Type"}),s.jsx("button",{type:"button",className:qe.backBtn,onClick:a,children:" Back to list"})]}),h&&s.jsx("div",{className:qe.error,children:h}),s.jsxs("div",{className:qe.field,children:[s.jsx("label",{htmlFor:"typeName",children:"Name *"}),s.jsx("input",{type:"text",id:"typeName",value:o,onChange:y=>l(y.target.value),placeholder:"e.g., Pilot Plant, Analytical Device",required:!0,autoFocus:!0})]}),i&&g>0&&s.jsxs("div",{className:qe.renameWarning,children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),s.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),s.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),s.jsxs("span",{children:["Renaming will update ",g," equipment item",g!==1?"s":""]})]}),!i&&s.jsxs("div",{className:qe.createNote,children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),s.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),s.jsx("span",{children:"New types become available when creating equipment"})]}),s.jsxs("div",{className:qe.formActions,children:[s.jsx(oe,{type:"button",variant:"secondary",onClick:a,disabled:c,children:"Cancel"}),s.jsx(oe,{type:"submit",disabled:c,children:c?"Saving...":i?"Rename Type":"Add Type"})]})]})}const X4="_container_129gp_5",K4="_toolbar_129gp_10",Z4="_toolbarButtons_129gp_20",J4="_filters_129gp_26",eE="_filterGroup_129gp_32",tE="_checkbox_129gp_61",nE="_tableWrapper_129gp_78",sE="_table_129gp_78",rE="_inactive_129gp_117",aE="_nameCell_129gp_122",iE="_equipName_129gp_128",oE="_inactiveBadge_129gp_133",lE="_typeBadge_129gp_144",cE="_siteCell_129gp_154",dE="_editBtn_129gp_160",uE="_loading_129gp_181",fE="_empty_129gp_182",hE="_form_129gp_192",mE="_formHeader_129gp_198",pE="_backBtn_129gp_213",gE="_error_129gp_229",_E="_formFields_129gp_239",yE="_field_129gp_245",vE="_typeOptions_129gp_280",xE="_typeOption_129gp_280",wE="_addNew_129gp_302",jE="_selectedTypeDisplay_129gp_312",SE="_selectedTypeBadge_129gp_318",CE="_changeTypeBtn_129gp_329",kE="_newTypeInput_129gp_346",bE="_confirmBtn_129gp_366",NE="_cancelBtn_129gp_367",DE="_siteOptions_129gp_399",$E="_siteOption_129gp_399",EE="_selected_129gp_312",TE="_siteOptionLabel_129gp_430",ME="_toggleLabel_129gp_441",IE="_hint_129gp_455",PE="_formActions_129gp_461",LE="_rightActions_129gp_469",ge={container:X4,toolbar:K4,toolbarButtons:Z4,filters:J4,filterGroup:eE,checkbox:tE,tableWrapper:nE,table:sE,inactive:rE,nameCell:aE,equipName:iE,inactiveBadge:oE,typeBadge:lE,siteCell:cE,editBtn:dE,loading:uE,empty:fE,form:hE,formHeader:mE,backBtn:pE,error:gE,formFields:_E,field:yE,typeOptions:vE,typeOption:xE,addNew:wE,selectedTypeDisplay:jE,selectedTypeBadge:SE,changeTypeBtn:CE,newTypeInput:kE,confirmBtn:bE,cancelBtn:NE,siteOptions:DE,siteOption:$E,selected:EE,siteOptionLabel:TE,toggleLabel:ME,hint:IE,formActions:PE,rightActions:LE};function AE(){const e=ee(j=>j.activeModal),t=ee(j=>j.closeModal),n=O(j=>j.sites),r=O(j=>j.currentUser),a=O(j=>j.currentSite),i=O(j=>j.setEquipment),o=e==="manageEquipment",l=(r==null?void 0:r.role)==="admin"||(r==null?void 0:r.role)==="superuser",[c,d]=f.useState([]),[h,m]=f.useState((a==null?void 0:a.id)||"all"),[g,_]=f.useState(!1),[y,u]=f.useState(!1),[w,p]=f.useState(null),[x,v]=f.useState(!1),[C,N]=f.useState(!1),b=f.useMemo(()=>{const j=new Set;return c.forEach(T=>{T.type&&j.add(T.type)}),Array.from(j).sort()},[c]),B=f.useCallback(async()=>{u(!0);try{const j=await Pe("/api/equipment/all");d(j)}catch(j){console.error("Failed to load equipment:",j)}finally{u(!1)}},[]);f.useEffect(()=>{o&&(B(),m((a==null?void 0:a.id)||"all"))},[o,B,a==null?void 0:a.id]);const M=c.filter(j=>!(h!=="all"&&j.site_id!==h||!g&&!j.active)),L=j=>{var T;return((T=n.find(E=>E.id===j))==null?void 0:T.name)||"Unknown"},S=j=>{p(j),v(!1)},P=()=>{p(null),v(!0)},I=()=>{p(null),v(!1)},D=async()=>{await B();const j=await Pe("/api/equipment/all");i(j),I()},k=async()=>{await B();const j=await Pe("/api/equipment/all");i(j),I()};return s.jsxs(s.Fragment,{children:[s.jsx(gt,{isOpen:o,onClose:t,title:"Equipment Management",size:"lg",children:s.jsx("div",{className:ge.container,children:w||x?s.jsx(BE,{equipment:w,sites:n,existingTypes:b,defaultSiteId:h!=="all"?h:(a==null?void 0:a.id)||null,onSave:D,onDelete:k,onCancel:I,canDelete:(r==null?void 0:r.role)==="admin"}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:ge.toolbar,children:[s.jsxs("div",{className:ge.filters,children:[s.jsxs("div",{className:ge.filterGroup,children:[s.jsx("label",{children:"Site"}),s.jsxs("select",{value:h,onChange:j=>m(j.target.value==="all"?"all":parseInt(j.target.value)),children:[s.jsx("option",{value:"all",children:"All Sites"}),n.map(j=>s.jsx("option",{value:j.id,children:j.name},j.id))]})]}),s.jsxs("label",{className:ge.checkbox,children:[s.jsx("input",{type:"checkbox",checked:g,onChange:j=>_(j.target.checked)}),s.jsx("span",{children:"Show inactive"})]})]}),l&&s.jsxs("div",{className:ge.toolbarButtons,children:[s.jsxs(oe,{variant:"secondary",onClick:()=>N(!0),children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"6px"},children:[s.jsx("circle",{cx:"12",cy:"12",r:"3"}),s.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),"Manage Types"]}),s.jsxs(oe,{onClick:P,children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"6px"},children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Equipment"]})]})]}),s.jsx("div",{className:ge.tableWrapper,children:y?s.jsx("div",{className:ge.loading,children:"Loading equipment..."}):M.length===0?s.jsx("div",{className:ge.empty,children:c.length===0?"No equipment found":"No equipment matching filters"}):s.jsxs("table",{className:ge.table,children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Name"}),s.jsx("th",{children:"Type"}),s.jsx("th",{children:"Site"}),s.jsx("th",{style:{width:60}})]})}),s.jsx("tbody",{children:M.map(j=>s.jsxs("tr",{className:j.active?"":ge.inactive,children:[s.jsx("td",{children:s.jsxs("div",{className:ge.nameCell,children:[s.jsx("span",{className:ge.equipName,children:j.name}),!j.active&&s.jsx("span",{className:ge.inactiveBadge,children:"Inactive"})]})}),s.jsx("td",{children:s.jsx("span",{className:ge.typeBadge,children:j.type})}),s.jsx("td",{className:ge.siteCell,children:L(j.site_id)}),s.jsx("td",{children:s.jsx("button",{className:ge.editBtn,onClick:()=>S(j),title:"Edit equipment",children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),s.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})})]},j.id))})]})})]})})}),s.jsx(Y4,{isOpen:C,onClose:()=>N(!1),onTypesChanged:B})]})}function BE({equipment:e,sites:t,existingTypes:n,defaultSiteId:r,onSave:a,onDelete:i,onCancel:o,canDelete:l}){const c=!!e,[d,h]=f.useState((e==null?void 0:e.name)||""),[m,g]=f.useState((e==null?void 0:e.type)||""),[_,y]=f.useState(!1),[u,w]=f.useState(""),[p,x]=f.useState((e==null?void 0:e.site_id)||r),[v,C]=f.useState((e==null?void 0:e.active)??!0),[N,b]=f.useState(!1),[B,M]=f.useState(null),L=()=>{u.trim()&&(g(u.trim()),y(!1))},S=()=>{y(!1),w("")},P=async D=>{if(D.preventDefault(),M(null),!d.trim()){M("Equipment name is required");return}if(!m.trim()){M("Equipment type is required");return}if(!p){M("Please select a site");return}b(!0);try{const k={name:d.trim(),type:m.trim(),site_id:p,active:v};c&&e?await nt(`/api/equipment/${e.id}`,k):await Oe("/api/equipment",k),a()}catch(k){console.error("Failed to save equipment:",k),M(k instanceof Error?k.message:"Failed to save equipment")}finally{b(!1)}},I=async()=>{if(!(!e||!window.confirm(`Are you sure you want to delete "${e.name}"?

This will also remove all assignments for this equipment.`))){b(!0);try{await zt(`/api/equipment/${e.id}`),i()}catch(k){console.error("Failed to delete equipment:",k),M(k instanceof Error?k.message:"Failed to delete equipment")}finally{b(!1)}}};return s.jsxs("form",{onSubmit:P,className:ge.form,children:[s.jsxs("div",{className:ge.formHeader,children:[s.jsx("h3",{children:c?"Edit Equipment":"Add Equipment"}),s.jsx("button",{type:"button",className:ge.backBtn,onClick:o,children:" Back to list"})]}),B&&s.jsx("div",{className:ge.error,children:B}),s.jsxs("div",{className:ge.formFields,children:[s.jsxs("div",{className:ge.field,children:[s.jsx("label",{htmlFor:"equipName",children:"Name *"}),s.jsx("input",{type:"text",id:"equipName",value:d,onChange:D=>h(D.target.value),placeholder:"e.g., Pilot Plant A, Mass Spec 1",required:!0})]}),s.jsxs("div",{className:ge.field,children:[s.jsx("label",{children:"Type *"}),_?s.jsxs("div",{className:ge.newTypeInput,children:[s.jsx("input",{type:"text",value:u,onChange:D=>w(D.target.value),placeholder:"Enter new equipment type",autoFocus:!0,onKeyDown:D=>{D.key==="Enter"?(D.preventDefault(),L()):D.key==="Escape"&&S()}}),s.jsx("button",{type:"button",className:ge.confirmBtn,onClick:L,children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})})}),s.jsx("button",{type:"button",className:ge.cancelBtn,onClick:S,children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}):m?s.jsxs("div",{className:ge.selectedTypeDisplay,children:[s.jsx("span",{className:ge.selectedTypeBadge,children:m}),s.jsx("button",{type:"button",className:ge.changeTypeBtn,onClick:()=>g(""),children:"Change"})]}):s.jsxs("div",{className:ge.typeOptions,children:[n.map(D=>s.jsx("button",{type:"button",className:ge.typeOption,onClick:()=>g(D),children:D},D)),s.jsx("button",{type:"button",className:`${ge.typeOption} ${ge.addNew}`,onClick:()=>{y(!0),w("")},children:"+ New type"})]}),s.jsx("span",{className:ge.hint,children:"Equipment types are shared across all sites"})]}),s.jsxs("div",{className:ge.field,children:[s.jsx("label",{children:"Site *"}),s.jsx("div",{className:ge.siteOptions,children:t.map(D=>s.jsxs("label",{className:`${ge.siteOption} ${p===D.id?ge.selected:""}`,children:[s.jsx("input",{type:"radio",name:"equipSite",value:D.id,checked:p===D.id,onChange:()=>x(D.id),required:!0}),s.jsx("span",{className:ge.siteOptionLabel,children:D.name})]},D.id))})]}),c&&s.jsxs("div",{className:ge.field,children:[s.jsx("label",{children:"Status"}),s.jsxs("label",{className:ge.toggleLabel,children:[s.jsx("input",{type:"checkbox",checked:v,onChange:D=>C(D.target.checked)}),s.jsx("span",{children:"Active"})]}),s.jsx("span",{className:ge.hint,children:"Inactive equipment won't appear in booking lists"})]})]}),s.jsxs("div",{className:ge.formActions,children:[c&&l&&s.jsx(oe,{type:"button",variant:"danger",onClick:I,disabled:N,children:"Delete Equipment"}),s.jsxs("div",{className:ge.rightActions,children:[s.jsx(oe,{type:"button",variant:"secondary",onClick:o,disabled:N,children:"Cancel"}),s.jsx(oe,{type:"submit",disabled:N,children:N?"Saving...":c?"Save Changes":"Create Equipment"})]})]})]})}const RE="_container_400gt_5",OE="_description_400gt_11",FE="_phaseList_400gt_19",zE="_loading_400gt_32",HE="_empty_400gt_33",qE="_phaseItem_400gt_41",WE="_inactive_400gt_57",VE="_dragging_400gt_61",UE="_dropBefore_400gt_65",GE="_dropAfter_400gt_77",YE="_dragHandle_400gt_90",QE="_phaseName_400gt_111",XE="_editable_400gt_122",KE="_phaseActions_400gt_151",ZE="_actionBtn_400gt_157",JE="_active_400gt_176",eT="_addSection_400gt_190",tT="_footer_400gt_217",ht={container:RE,description:OE,phaseList:FE,loading:zE,empty:HE,phaseItem:qE,inactive:WE,dragging:VE,dropBefore:UE,dropAfter:GE,dragHandle:YE,phaseName:QE,editable:XE,phaseActions:KE,actionBtn:ZE,active:JE,delete:"_delete_400gt_184",addSection:eT,footer:tT};function nT(){const e=ee($=>$.activeModal),t=ee($=>$.closeModal),n=O($=>$.currentUser),r=e==="predefinedPhases",a=(n==null?void 0:n.role)==="admin"||(n==null?void 0:n.role)==="superuser",[i,o]=f.useState([]),[l,c]=f.useState(!1),[d,h]=f.useState(""),[m,g]=f.useState(!1),[_,y]=f.useState(null),[u,w]=f.useState(""),[p,x]=f.useState(null),[v,C]=f.useState(null),[N,b]=f.useState(null),B=f.useCallback(async()=>{c(!0);try{const $=await Pe("/api/predefined-phases/all");o($)}catch($){console.error("Failed to load predefined phases:",$)}finally{c(!1)}},[]);f.useEffect(()=>{r&&B()},[r,B]);const M=async()=>{if(d.trim()){g(!0);try{await Oe("/api/predefined-phases",{name:d.trim()}),h(""),await B()}catch($){console.error("Failed to add phase:",$),alert($ instanceof Error?$.message:"Failed to add phase")}finally{g(!1)}}},L=async $=>{if(!u.trim()){y(null);return}try{await nt(`/api/predefined-phases/${$}`,{name:u.trim()}),y(null),await B()}catch(A){console.error("Failed to update phase:",A),alert(A instanceof Error?A.message:"Failed to update phase")}},S=async $=>{try{await nt(`/api/predefined-phases/${$.id}`,{is_active:!$.is_active}),await B()}catch(A){console.error("Failed to toggle phase:",A),alert(A instanceof Error?A.message:"Failed to update phase")}},P=async $=>{if(window.confirm(`Are you sure you want to delete "${$.name}"?`))try{await zt(`/api/predefined-phases/${$.id}`),await B()}catch(R){console.error("Failed to delete phase:",R),alert(R instanceof Error?R.message:"Failed to delete phase")}},I=$=>{y($.id),w($.name)},D=($,A)=>{x(A),$.dataTransfer.effectAllowed="move"},k=($,A)=>{if($.preventDefault(),p===A)return;const R=$.currentTarget.getBoundingClientRect(),H=R.top+R.height/2,F=$.clientY<H?"before":"after";C(A),b(F)},j=()=>{C(null),b(null)},T=async $=>{if($.preventDefault(),!p||!v||p===v){x(null),C(null),b(null);return}const A=i.map(F=>F.id),R=A.indexOf(p);let H=A.indexOf(v);A.splice(R,1),H=A.indexOf(v),N==="after"&&(H+=1),A.splice(H,0,p),x(null),C(null),b(null);try{await nt("/api/predefined-phases/reorder",{phase_order:A}),await B()}catch(F){console.error("Failed to reorder phases:",F),await B()}},E=()=>{x(null),C(null),b(null)};return s.jsx(gt,{isOpen:r,onClose:t,title:"Predefined Phases",size:"md",children:s.jsxs("div",{className:ht.container,children:[s.jsx("p",{className:ht.description,children:"Predefined phases appear as quick-add options when creating new projects. Drag to reorder. Inactive phases won't appear in the list."}),s.jsx("div",{className:ht.phaseList,children:l?s.jsx("div",{className:ht.loading,children:"Loading phases..."}):i.length===0?s.jsx("div",{className:ht.empty,children:"No predefined phases. Add one below."}):i.map($=>s.jsxs("div",{className:`
                  ${ht.phaseItem} 
                  ${$.is_active?"":ht.inactive}
                  ${p===$.id?ht.dragging:""}
                  ${v===$.id&&N==="before"?ht.dropBefore:""}
                  ${v===$.id&&N==="after"?ht.dropAfter:""}
                `,draggable:a,onDragStart:A=>D(A,$.id),onDragOver:A=>k(A,$.id),onDragLeave:j,onDrop:T,onDragEnd:E,children:[a&&s.jsx("div",{className:ht.dragHandle,children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"8",y1:"6",x2:"16",y2:"6"}),s.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"}),s.jsx("line",{x1:"8",y1:"18",x2:"16",y2:"18"})]})}),s.jsx("div",{className:ht.phaseName,children:_===$.id?s.jsx("input",{type:"text",value:u,onChange:A=>w(A.target.value),onBlur:()=>L($.id),onKeyDown:A=>{A.key==="Enter"&&L($.id),A.key==="Escape"&&y(null)},autoFocus:!0}):s.jsx("span",{onClick:()=>a&&I($),className:a?ht.editable:"",children:$.name})}),a&&s.jsxs("div",{className:ht.phaseActions,children:[s.jsx("button",{className:`${ht.actionBtn} ${$.is_active?ht.active:""}`,onClick:()=>S($),title:$.is_active?"Deactivate":"Activate",children:$.is_active?s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),s.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}):s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("circle",{cx:"12",cy:"12",r:"10"})})}),s.jsx("button",{className:`${ht.actionBtn} ${ht.delete}`,onClick:()=>P($),title:"Delete",children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("polyline",{points:"3 6 5 6 21 6"}),s.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})]},$.id))}),a&&s.jsxs("div",{className:ht.addSection,children:[s.jsx("input",{type:"text",value:d,onChange:$=>h($.target.value),placeholder:"New phase name...",onKeyDown:$=>{$.key==="Enter"&&M()}}),s.jsx(oe,{onClick:M,disabled:m||!d.trim(),children:m?"Adding...":"Add Phase"})]}),s.jsx("div",{className:ht.footer,children:s.jsx(oe,{variant:"secondary",onClick:t,children:"Close"})})]})})}const sT="_container_qzxfv_5",rT="_dropZone_qzxfv_12",aT="_dragging_qzxfv_31",iT="_hasFile_qzxfv_36",oT="_fileInput_qzxfv_41",lT="_dropContent_qzxfv_46",cT="_dropText_qzxfv_58",dT="_dropHint_qzxfv_64",uT="_selectedFile_qzxfv_70",fT="_fileIcon_qzxfv_77",hT="_fileName_qzxfv_81",mT="_fileSize_qzxfv_89",pT="_clearBtn_qzxfv_95",gT="_progressSection_qzxfv_112",_T="_progressBar_qzxfv_119",yT="_progressFill_qzxfv_126",vT="_progressMessage_qzxfv_133",xT="_error_qzxfv_140",wT="_success_qzxfv_150",jT="_successContent_qzxfv_166",ST="_successTitle_qzxfv_172",CT="_successDetails_qzxfv_177",kT="_actions_qzxfv_189",Ze={container:sT,dropZone:rT,dragging:aT,hasFile:iT,fileInput:oT,dropContent:lT,dropText:cT,dropHint:dT,selectedFile:uT,fileIcon:fT,fileName:hT,fileSize:mT,clearBtn:pT,progressSection:gT,progressBar:_T,progressFill:yT,progressMessage:vT,error:xT,success:wT,successContent:jT,successTitle:ST,successDetails:CT,actions:kT};function bT(){const e=ee(P=>P.activeModal),t=ee(P=>P.closeModal),n=O(P=>P.setProjects),r=O(P=>P.currentSite),a=e==="importProject",[i,o]=f.useState(null),[l,c]=f.useState(!1),[d,h]=f.useState(!1),[m,g]=f.useState(null),[_,y]=f.useState(null),[u,w]=f.useState(null),p=f.useRef(null),x=P=>{const I=P.name.toLowerCase();if(!I.endsWith(".mpp")&&!I.endsWith(".csv")&&!I.endsWith(".mpt")&&!I.endsWith(".mpx")&&!I.endsWith(".xml")){y("Please select an MPP, CSV, or XML file");return}o(P),y(null),w(null)},v=P=>{P.preventDefault(),c(!0)},C=P=>{P.preventDefault(),c(!1)},N=P=>{P.preventDefault(),c(!1);const I=P.dataTransfer.files[0];I&&x(I)},b=P=>{var D;const I=(D=P.target.files)==null?void 0:D[0];I&&x(I)},B=async()=>{if(i){h(!0),y(null),w(null);try{g({percent:10,message:"Uploading file..."});const P=new FormData;P.append("file",i),r!=null&&r.id&&P.append("site_id",r.id.toString()),g({percent:30,message:"Parsing and creating project..."});let I="/api/import/project";window.location.port==="3333"&&(I=`${window.location.protocol}//${window.location.hostname}:8485/api/import/project`);const D=window.location.pathname.match(/^(\/t\/[a-z0-9][a-z0-9-]*)/);D&&(I=I.replace("/api/",`${D[1]}/api/`)),console.log("Import URL:",I);const k=await fetch(I,{method:"POST",body:P,credentials:"include"}),j=await k.text();let T;try{T=j?JSON.parse(j):{success:!1,error:"Empty response from server"}}catch{throw console.error("Server response:",j),new Error(`Server error: ${k.status} ${k.statusText}. Check server logs.`)}if(!k.ok||!T.success)throw new Error(T.error||`Import failed: ${k.status}`);g({percent:90,message:"Refreshing project list..."});const E=await ft();n(E),g({percent:100,message:"Import complete!"}),w(T)}catch(P){console.error("Import error:",P),y(P instanceof Error?P.message:"Failed to import project"),g(null)}finally{h(!1)}}},M=()=>{o(null),g(null),y(null),w(null),h(!1),t()},L=()=>{o(null),y(null),w(null),p.current&&(p.current.value="")},S=P=>P.toLowerCase().split(".").pop()==="csv"?s.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[s.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),s.jsx("polyline",{points:"14 2 14 8 20 8"}),s.jsx("line",{x1:"8",y1:"13",x2:"16",y2:"13"}),s.jsx("line",{x1:"8",y1:"17",x2:"16",y2:"17"}),s.jsx("line",{x1:"8",y1:"9",x2:"10",y2:"9"})]}):s.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[s.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),s.jsx("polyline",{points:"14 2 14 8 20 8"}),s.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),s.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),s.jsx("polyline",{points:"10 9 9 9 8 9"})]});return s.jsx(gt,{isOpen:a,onClose:M,title:"Import Project",size:"md",children:s.jsxs("div",{className:Ze.container,children:[!d&&!u&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`${Ze.dropZone} ${l?Ze.dragging:""} ${i?Ze.hasFile:""}`,onDragOver:v,onDragLeave:C,onDrop:N,onClick:()=>{var P;return(P=p.current)==null?void 0:P.click()},children:[s.jsx("input",{ref:p,type:"file",accept:".mpp,.mpt,.mpx,.xml,.csv",onChange:b,className:Ze.fileInput}),i?s.jsxs("div",{className:Ze.selectedFile,children:[s.jsx("div",{className:Ze.fileIcon,children:S(i.name)}),s.jsx("div",{className:Ze.fileName,children:i.name}),s.jsxs("div",{className:Ze.fileSize,children:[(i.size/1024).toFixed(1)," KB"]})]}):s.jsxs("div",{className:Ze.dropContent,children:[s.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[s.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),s.jsx("polyline",{points:"17 8 12 3 7 8"}),s.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),s.jsx("div",{className:Ze.dropText,children:"Drop file here or click to browse"}),s.jsx("div",{className:Ze.dropHint,children:"Supports MPP, MPT, MPX, XML, and CSV files"})]})]}),i&&s.jsx("button",{className:Ze.clearBtn,onClick:L,children:"Choose different file"})]}),d&&m&&s.jsxs("div",{className:Ze.progressSection,children:[s.jsx("div",{className:Ze.progressBar,children:s.jsx("div",{className:Ze.progressFill,style:{width:`${m.percent}%`}})}),s.jsx("div",{className:Ze.progressMessage,children:m.message})]}),_&&s.jsx("div",{className:Ze.error,children:_}),u&&u.success&&s.jsxs("div",{className:Ze.success,children:[s.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),s.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),s.jsxs("div",{className:Ze.successContent,children:[s.jsx("div",{className:Ze.successTitle,children:"Import Complete!"}),s.jsxs("div",{className:Ze.successDetails,children:[s.jsx("strong",{children:u.project_name}),s.jsxs("span",{children:[u.phases_created," phase",u.phases_created!==1?"s":"",u.subphases_created?`, ${u.subphases_created} subphase${u.subphases_created!==1?"s":""}`:""]})]})]})]}),s.jsxs("div",{className:Ze.actions,children:[s.jsx(oe,{variant:"secondary",onClick:M,children:u?"Close":"Cancel"}),!u&&s.jsx(oe,{onClick:B,disabled:!i||d,children:d?"Importing...":"Import Project"})]})]})})}const NT="_container_1rqrs_3",DT="_loading_1rqrs_10",$T="_section_1rqrs_19",ET="_sectionTitle_1rqrs_25",TT="_field_1rqrs_37",MT="_label_1rqrs_43",IT="_hint_1rqrs_49",PT="_input_1rqrs_54",LT="_select_1rqrs_74",AT="_buttonGroup_1rqrs_92",BT="_optionButton_1rqrs_97",RT="_selected_1rqrs_116",OT="_toggleField_1rqrs_123",FT="_toggleInfo_1rqrs_131",zT="_toggle_1rqrs_123",HT="_toggleOn_1rqrs_153",qT="_toggleSlider_1rqrs_158",WT="_error_1rqrs_175",VT="_success_1rqrs_184",UT="_actions_1rqrs_194",GT="_rightActions_1rqrs_204",YT="_logoSection_1rqrs_210",QT="_logoField_1rqrs_216",XT="_logoUploader_1rqrs_222",KT="_logoPreview_1rqrs_228",ZT="_dark_1rqrs_242",JT="_light_1rqrs_246",e3="_dragActive_1rqrs_254",t3="_logoImage_1rqrs_259",n3="_logoOverlay_1rqrs_265",s3="_logoInput_1rqrs_284",r3="_logoRemoveBtn_1rqrs_288",le={container:NT,loading:DT,section:$T,sectionTitle:ET,field:TT,label:MT,hint:IT,input:PT,select:LT,buttonGroup:AT,optionButton:BT,selected:RT,toggleField:OT,toggleInfo:FT,toggle:zT,toggleOn:HT,toggleSlider:qT,error:WT,success:VT,actions:UT,rightActions:GT,logoSection:YT,logoField:QT,logoUploader:XT,logoPreview:KT,dark:ZT,light:JT,dragActive:e3,logoImage:t3,logoOverlay:n3,logoInput:s3,logoRemoveBtn:r3},no={instance_title:"",default_view:"month",week_start:"monday",date_format:"dd/mm/yyyy",show_weekends:"true",auto_expand_projects:"false",header_logo_dark:"",header_logo_light:""},a3=[{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"quarter",label:"Quarter"},{value:"year",label:"Year"}],i3=[{value:"monday",label:"Monday"},{value:"sunday",label:"Sunday"}],o3=[{value:"dd/mm/yyyy",label:"DD/MM/YYYY (31/12/2025)"},{value:"mm/dd/yyyy",label:"MM/DD/YYYY (12/31/2025)"},{value:"yyyy-mm-dd",label:"YYYY-MM-DD (2025-12-31)"}];function l3(){const e=ee(b=>b.activeModal),t=ee(b=>b.closeModal),n=O(b=>b.instanceSettings),r=O(b=>b.setInstanceSettings),a=e==="settings",[i,o]=f.useState(no),[l,c]=f.useState(no),[d,h]=f.useState(!0),[m,g]=f.useState(!1),[_,y]=f.useState(null),[u,w]=f.useState(null);f.useEffect(()=>{a&&p()},[a]);const p=async()=>{h(!0),y(null);try{const b={...no};for(const B of Object.keys(no))try{const M=await pd(B);M.value!==null&&(b[B]=M.value)}catch{}o(b),c(b)}catch(b){y("Failed to load settings"),console.error("Load settings error:",b)}finally{h(!1)}},x=f.useMemo(()=>JSON.stringify(i)!==JSON.stringify(l),[i,l]),v=async()=>{g(!0),y(null),w(null);try{for(const M of Object.keys(i))i[M]!==l[M]&&await cx(M,i[M]);const b={...n,instance_title:i.instance_title};r(b);const B=i.instance_title||"Milestone";document.title=B,c(i),w("Settings saved successfully")}catch(b){y("Failed to save settings"),console.error("Save settings error:",b)}finally{g(!1)}},C=f.useCallback(()=>{o(l),w(null),y(null)},[l]),N=f.useCallback(()=>{x&&!confirm("You have unsaved changes. Are you sure you want to close?")||t()},[x,t]);return s.jsx(gt,{isOpen:a,onClose:N,title:"Settings",size:"md",children:s.jsx("div",{className:le.container,children:d?s.jsx("div",{className:le.loading,children:"Loading settings..."}):s.jsxs(s.Fragment,{children:[s.jsxs("section",{className:le.section,children:[s.jsx("h3",{className:le.sectionTitle,children:"Instance"}),s.jsxs("div",{className:le.field,children:[s.jsx("label",{className:le.label,htmlFor:"instance-title",children:"Application Title"}),s.jsx("input",{id:"instance-title",type:"text",className:le.input,value:i.instance_title,onChange:b=>{const B=b.target.value;o(M=>({...M,instance_title:B})),w(null)},placeholder:"Milestone",autoComplete:"off"}),s.jsx("span",{className:le.hint,children:"Displayed in the header and browser tab"})]})]}),s.jsxs("section",{className:le.section,children:[s.jsx("h3",{className:le.sectionTitle,children:"Branding"}),s.jsxs("div",{className:le.logoSection,children:[s.jsxs("div",{className:le.logoField,children:[s.jsx("label",{className:le.label,children:"Dark Theme Logo"}),s.jsx(Fh,{value:i.header_logo_dark,onChange:b=>{o(B=>({...B,header_logo_dark:b})),w(null)},theme:"dark"}),s.jsx("span",{className:le.hint,children:"Used when dark theme is active"})]}),s.jsxs("div",{className:le.logoField,children:[s.jsx("label",{className:le.label,children:"Light Theme Logo"}),s.jsx(Fh,{value:i.header_logo_light,onChange:b=>{o(B=>({...B,header_logo_light:b})),w(null)},theme:"light"}),s.jsx("span",{className:le.hint,children:"Used when light theme is active"})]})]})]}),s.jsxs("section",{className:le.section,children:[s.jsx("h3",{className:le.sectionTitle,children:"Display"}),s.jsxs("div",{className:le.field,children:[s.jsx("label",{className:le.label,children:"Default View"}),s.jsx("div",{className:le.buttonGroup,children:a3.map(b=>s.jsx("button",{type:"button",className:`${le.optionButton} ${i.default_view===b.value?le.selected:""}`,onClick:()=>{o(B=>({...B,default_view:b.value})),w(null)},children:b.label},b.value))})]}),s.jsxs("div",{className:le.field,children:[s.jsx("label",{className:le.label,children:"Date Format"}),s.jsx("select",{className:le.select,value:i.date_format,onChange:b=>{o(B=>({...B,date_format:b.target.value})),w(null)},children:o3.map(b=>s.jsx("option",{value:b.value,children:b.label},b.value))})]}),s.jsxs("div",{className:le.field,children:[s.jsx("label",{className:le.label,children:"Week Starts On"}),s.jsx("div",{className:le.buttonGroup,children:i3.map(b=>s.jsx("button",{type:"button",className:`${le.optionButton} ${i.week_start===b.value?le.selected:""}`,onClick:()=>{o(B=>({...B,week_start:b.value})),w(null)},children:b.label},b.value))})]})]}),s.jsxs("section",{className:le.section,children:[s.jsx("h3",{className:le.sectionTitle,children:"Gantt Chart"}),s.jsxs("div",{className:le.toggleField,children:[s.jsxs("div",{className:le.toggleInfo,children:[s.jsx("label",{className:le.label,children:"Show Weekends"}),s.jsx("span",{className:le.hint,children:"Display Saturday and Sunday columns in the timeline"})]}),s.jsx("button",{type:"button",className:`${le.toggle} ${i.show_weekends==="true"?le.toggleOn:""}`,onClick:()=>{o(b=>({...b,show_weekends:b.show_weekends==="true"?"false":"true"})),w(null)},children:s.jsx("span",{className:le.toggleSlider})})]}),s.jsxs("div",{className:le.toggleField,children:[s.jsxs("div",{className:le.toggleInfo,children:[s.jsx("label",{className:le.label,children:"Auto-expand Projects"}),s.jsx("span",{className:le.hint,children:"Automatically expand projects to show phases on load"})]}),s.jsx("button",{type:"button",className:`${le.toggle} ${i.auto_expand_projects==="true"?le.toggleOn:""}`,onClick:()=>{o(b=>({...b,auto_expand_projects:b.auto_expand_projects==="true"?"false":"true"})),w(null)},children:s.jsx("span",{className:le.toggleSlider})})]})]}),_&&s.jsx("div",{className:le.error,children:_}),u&&s.jsx("div",{className:le.success,children:u}),s.jsxs("div",{className:le.actions,children:[s.jsx(oe,{variant:"secondary",onClick:N,children:"Cancel"}),s.jsxs("div",{className:le.rightActions,children:[x&&s.jsx(oe,{variant:"ghost",onClick:C,children:"Reset"}),s.jsx(oe,{onClick:v,disabled:!x||m,children:m?"Saving...":"Save Changes"})]})]})]})})})}function Fh({value:e,onChange:t,theme:n}){const r=f.useRef(null),[a,i]=f.useState(!1),o=n==="dark"?"/img/milestone_logo_dark_theme.svg":"/img/milestone_logo_light_theme.svg",l=f.useCallback(u=>{if(!["image/png","image/jpeg","image/svg+xml","image/webp"].includes(u.type)){alert("Please upload a PNG, JPG, SVG, or WebP image");return}if(u.size>500*1024){alert("Logo must be smaller than 500KB");return}const p=new FileReader;p.onload=x=>{var C;const v=(C=x.target)==null?void 0:C.result;t(v)},p.readAsDataURL(u)},[t]),c=f.useCallback(u=>{u.preventDefault(),i(!1);const w=u.dataTransfer.files[0];w&&l(w)},[l]),d=f.useCallback(u=>{u.preventDefault(),i(!0)},[]),h=f.useCallback(u=>{u.preventDefault(),i(!1)},[]),m=f.useCallback(u=>{var p;const w=(p=u.target.files)==null?void 0:p[0];w&&l(w)},[l]),g=f.useCallback(()=>{t(""),r.current&&(r.current.value="")},[t]),_=e||o,y=!!e;return s.jsxs("div",{className:le.logoUploader,children:[s.jsxs("div",{className:`${le.logoPreview} ${le[n]} ${a?le.dragActive:""}`,onDrop:c,onDragOver:d,onDragLeave:h,onClick:()=>{var u;return(u=r.current)==null?void 0:u.click()},children:[s.jsx("img",{src:_,alt:`${n} theme logo`,className:le.logoImage}),s.jsxs("div",{className:le.logoOverlay,children:[s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),s.jsx("polyline",{points:"17 8 12 3 7 8"}),s.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),s.jsx("span",{children:"Upload"})]})]}),s.jsx("input",{ref:r,type:"file",accept:"image/png,image/jpeg,image/svg+xml,image/webp",onChange:m,className:le.logoInput}),y&&s.jsxs("button",{type:"button",className:le.logoRemoveBtn,onClick:u=>{u.stopPropagation(),g()},title:"Remove custom logo",children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),"Remove"]})]})}const c3="_wrapper_10yst_1",d3="_fullWidth_10yst_7",u3="_label_10yst_11",f3="_inputWrapper_10yst_17",h3="_input_10yst_17",m3="_error_10yst_55",p3="_hasLeftIcon_10yst_63",g3="_hasRightIcon_10yst_67",_3="_leftIcon_10yst_71",y3="_rightIcon_10yst_72",v3="_errorText_10yst_97",x3="_hint_10yst_102",vn={wrapper:c3,fullWidth:d3,label:u3,inputWrapper:f3,input:h3,error:m3,hasLeftIcon:p3,hasRightIcon:g3,leftIcon:_3,rightIcon:y3,errorText:v3,hint:x3},xd=f.forwardRef(({label:e,error:t,hint:n,leftIcon:r,rightIcon:a,fullWidth:i=!1,className:o,id:l,...c},d)=>{const h=l||`input-${Math.random().toString(36).substr(2,9)}`,m=[vn.wrapper,i&&vn.fullWidth,o].filter(Boolean).join(" "),g=[vn.input,t&&vn.error,r&&vn.hasLeftIcon,a&&vn.hasRightIcon].filter(Boolean).join(" ");return s.jsxs("div",{className:m,children:[e&&s.jsx("label",{htmlFor:h,className:vn.label,children:e}),s.jsxs("div",{className:vn.inputWrapper,children:[r&&s.jsx("span",{className:vn.leftIcon,children:r}),s.jsx("input",{ref:d,id:h,className:g,...c}),a&&s.jsx("span",{className:vn.rightIcon,children:a})]}),t&&s.jsx("span",{className:vn.errorText,children:t}),n&&!t&&s.jsx("span",{className:vn.hint,children:n})]})});xd.displayName="Input";const w3="_wrapper_1tq09_1",j3="_fullWidth_1tq09_7",S3="_label_1tq09_11",C3="_selectWrapper_1tq09_17",k3="_select_1tq09_17",b3="_error_1tq09_53",N3="_hasIcon_1tq09_61",D3="_icon_1tq09_65",$3="_chevron_1tq09_82",E3="_errorText_1tq09_91",T3="_hint_1tq09_96",Mn={wrapper:w3,fullWidth:j3,label:S3,selectWrapper:C3,select:k3,error:b3,hasIcon:N3,icon:D3,chevron:$3,errorText:E3,hint:T3},h_=f.forwardRef(({label:e,error:t,hint:n,options:r,placeholder:a,fullWidth:i=!1,icon:o,className:l,id:c,...d},h)=>{const m=c||`select-${Math.random().toString(36).substr(2,9)}`,g=[Mn.wrapper,i&&Mn.fullWidth,l].filter(Boolean).join(" "),_=[Mn.select,t&&Mn.error,o&&Mn.hasIcon].filter(Boolean).join(" ");return s.jsxs("div",{className:g,children:[e&&s.jsx("label",{htmlFor:m,className:Mn.label,children:e}),s.jsxs("div",{className:Mn.selectWrapper,children:[o&&s.jsx("span",{className:Mn.icon,children:o}),s.jsxs("select",{ref:h,id:m,className:_,...d,children:[a&&s.jsx("option",{value:"",disabled:!0,children:a}),r.map(y=>s.jsx("option",{value:y.value,disabled:y.disabled,children:y.label},y.value))]}),s.jsx("span",{className:Mn.chevron,children:s.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"6 9 12 15 18 9"})})})]}),t&&s.jsx("span",{className:Mn.errorText,children:t}),n&&!t&&s.jsx("span",{className:Mn.hint,children:n})]})});h_.displayName="Select";const M3="_form_1deyf_3",I3="_error_1deyf_10",P3="_field_1deyf_19",L3="_label_1deyf_25",A3="_checkboxField_1deyf_31",B3="_checkboxLabel_1deyf_37",R3="_checkboxText_1deyf_50",O3="_hint_1deyf_55",F3="_listOptions_1deyf_62",z3="_listOptionRow_1deyf_68",H3="_removeOptionBtn_1deyf_74",q3="_addOptionBtn_1deyf_95",W3="_widthControl_1deyf_116",V3="_widthSlider_1deyf_122",U3="_widthValue_1deyf_156",G3="_actions_1deyf_164",Y3="_rightActions_1deyf_173",dt={form:M3,error:I3,field:P3,label:L3,checkboxField:A3,checkboxLabel:B3,checkboxText:R3,hint:O3,listOptions:F3,listOptionRow:z3,removeOptionBtn:H3,addOptionBtn:q3,widthControl:W3,widthSlider:V3,widthValue:U3,actions:G3,rightActions:Y3};function wd({isOpen:e,onClose:t,column:n,onSave:r}){const a=O(P=>P.currentSite),[i,o]=f.useState(""),[l,c]=f.useState("text"),[d,h]=f.useState(!1),[m,g]=f.useState([""]),[_,y]=f.useState(120),[u,w]=f.useState(!1),[p,x]=f.useState(!1),[v,C]=f.useState(null),N=!!n;f.useEffect(()=>{var P;e&&(n?(o(n.name),c(n.column_type),h(n.site_id===null),g((P=n.list_options)!=null&&P.length?n.list_options:[""]),y(n.width)):(o(""),c("text"),h(!1),g([""]),y(120)),C(null))},[e,n]);const b=()=>{g([...m,""])},B=P=>{m.length>1&&g(m.filter((I,D)=>D!==P))},M=(P,I)=>{const D=[...m];D[P]=I,g(D)},L=async()=>{if(!i.trim()){C("Column name is required");return}if(l==="list"&&m.filter(I=>I.trim()).length===0){C("At least one list option is required");return}w(!0),C(null);try{if(N&&n)await Du(n.id,{name:i.trim(),list_options:l==="list"?m.filter(P=>P.trim()):void 0,width:_});else{const P={name:i.trim(),column_type:l,site_id:d?null:a==null?void 0:a.id,width:_};l==="list"&&(P.list_options=m.filter(I=>I.trim())),await fx(P)}r(),t()}catch(P){C(P instanceof Error?P.message:"Failed to save column")}finally{w(!1)}},S=async()=>{if(!(!n||!confirm("Are you sure you want to delete this column? All values will be lost."))){x(!0),C(null);try{await Ag(n.id),r(),t()}catch(P){C(P instanceof Error?P.message:"Failed to delete column")}finally{x(!1)}}};return s.jsxs(gt,{isOpen:e,onClose:t,title:N?"Edit Custom Column":"Add Custom Column",size:"md",children:[s.jsxs("div",{className:dt.form,children:[v&&s.jsx("div",{className:dt.error,children:v}),s.jsx("div",{className:dt.field,children:s.jsx(xd,{label:"Column Name",value:i,onChange:P=>o(P.target.value),placeholder:"e.g., Priority, Status, Owner",fullWidth:!0})}),!N&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:dt.field,children:s.jsx(h_,{label:"Column Type",value:l,onChange:P=>c(P.target.value),options:[{value:"text",label:"Text"},{value:"boolean",label:"Checkbox"},{value:"list",label:"Dropdown List"}],fullWidth:!0})}),s.jsxs("div",{className:dt.checkboxField,children:[s.jsxs("label",{className:dt.checkboxLabel,children:[s.jsx("input",{type:"checkbox",checked:d,onChange:P=>h(P.target.checked)}),s.jsx("span",{className:dt.checkboxText,children:"Global column (available to all sites)"})]}),s.jsx("span",{className:dt.hint,children:d?"This column will be visible across all sites":`This column will only be visible to ${(a==null?void 0:a.name)||"this site"}`})]})]}),l==="list"&&s.jsxs("div",{className:dt.field,children:[s.jsx("label",{className:dt.label,children:"List Options"}),s.jsxs("div",{className:dt.listOptions,children:[m.map((P,I)=>s.jsxs("div",{className:dt.listOptionRow,children:[s.jsx(xd,{value:P,onChange:D=>M(I,D.target.value),placeholder:`Option ${I+1}`,fullWidth:!0}),m.length>1&&s.jsx("button",{type:"button",className:dt.removeOptionBtn,onClick:()=>B(I),title:"Remove option",children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},I)),s.jsxs("button",{type:"button",className:dt.addOptionBtn,onClick:b,children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Option"]})]})]}),s.jsxs("div",{className:dt.field,children:[s.jsx("label",{className:dt.label,children:"Column Width"}),s.jsxs("div",{className:dt.widthControl,children:[s.jsx("input",{type:"range",min:"60",max:"300",value:_,onChange:P=>y(parseInt(P.target.value)),className:dt.widthSlider}),s.jsxs("span",{className:dt.widthValue,children:[_,"px"]})]})]})]}),s.jsxs("div",{className:dt.actions,children:[N&&s.jsx(oe,{variant:"danger",onClick:S,disabled:p||u,children:p?"Deleting...":"Delete"}),s.jsxs("div",{className:dt.rightActions,children:[s.jsx(oe,{variant:"ghost",onClick:t,disabled:u||p,children:"Cancel"}),s.jsx(oe,{onClick:L,disabled:u||p,children:u?"Saving...":N?"Update":"Create"})]})]})]})}const Q3="_content_1iwdq_1",X3="_empty_1iwdq_6",K3="_emptyHint_1iwdq_27",Z3="_columnList_1iwdq_33",J3="_listHeader_1iwdq_39",eM="_columnItem_1iwdq_52",tM="_dragging_1iwdq_70",nM="_dragOver_1iwdq_74",sM="_colDrag_1iwdq_79",rM="_colName_1iwdq_97",aM="_colType_1iwdq_103",iM="_colScope_1iwdq_113",oM="_scopeGlobal_1iwdq_119",lM="_scopeLocal_1iwdq_126",cM="_colWidth_1iwdq_133",dM="_colActions_1iwdq_141",uM="_actionBtn_1iwdq_150",fM="_deleteBtn_1iwdq_171",hM="_addSection_1iwdq_177",mM="_footer_1iwdq_189",pM="_hint_1iwdq_198",ze={content:Q3,empty:X3,emptyHint:K3,columnList:Z3,listHeader:J3,columnItem:eM,dragging:tM,dragOver:nM,colDrag:sM,colName:rM,colType:aM,colScope:iM,scopeGlobal:oM,scopeLocal:lM,colWidth:cM,colActions:dM,actionBtn:uM,deleteBtn:fM,addSection:hM,footer:mM,hint:pM};function gM({isOpen:e,onClose:t}){const n=O(M=>M.customColumns),r=O(M=>M.currentSite),a=O(M=>M.setCustomColumns),i=O(M=>M.setCustomColumnValues),[o,l]=f.useState(null),[c,d]=f.useState(!1),[h,m]=f.useState(null),[g,_]=f.useState(null),y=f.useRef(null),u=f.useCallback(async()=>{if(r)try{const M=await Wo(r.id);a(M.columns),i(M.values)}catch(M){console.error("Failed to refresh columns:",M)}},[r,a,i]),w=(M,L,S)=>{m(L),y.current=S,M.dataTransfer.effectAllowed="move";const P=M.target;P.style.opacity="0.5"},p=M=>{const L=M.target;L.style.opacity="1",m(null),_(null),y.current=null},x=(M,L)=>{M.preventDefault(),y.current!==L&&_(L)},v=()=>{_(null)},C=async(M,L)=>{if(M.preventDefault(),!h||y.current===null||y.current===L){_(null);return}try{const S=[...n],[P]=S.splice(y.current,1);S.splice(L,0,P);const I=S.map((k,j)=>({id:k.id,display_order:j})),D=S.map((k,j)=>({...k,display_order:j}));a(D);for(const k of I)await Du(k.id,{display_order:k.display_order})}catch(S){console.error("Failed to reorder columns:",S),u()}finally{_(null)}},N=async M=>{if(confirm(`Delete column "${M.name}"? All values will be lost.`))try{await Ag(M.id),u()}catch(L){console.error("Failed to delete column:",L)}},b=M=>{switch(M){case"boolean":return"Checkbox";case"list":return"Dropdown";default:return"Text"}},B=M=>{switch(M){case"boolean":return s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("polyline",{points:"9 11 12 14 22 4"}),s.jsx("path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"})]});case"list":return s.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"6 9 12 15 18 9"})});default:return s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"17",y1:"10",x2:"3",y2:"10"}),s.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),s.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),s.jsx("line",{x1:"17",y1:"18",x2:"3",y2:"18"})]})}};return s.jsxs(s.Fragment,{children:[s.jsxs(gt,{isOpen:e,onClose:t,title:"Manage Custom Columns",size:"lg",children:[s.jsxs("div",{className:ze.content,children:[n.length===0?s.jsxs("div",{className:ze.empty,children:[s.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[s.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),s.jsx("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),s.jsx("line",{x1:"9",y1:"21",x2:"9",y2:"9"})]}),s.jsx("p",{children:"No custom columns yet"}),s.jsx("span",{className:ze.emptyHint,children:"Add columns to track additional properties on phases and subphases"})]}):s.jsxs("div",{className:ze.columnList,children:[s.jsxs("div",{className:ze.listHeader,children:[s.jsx("span",{className:ze.colDrag}),s.jsx("span",{className:ze.colName,children:"Name"}),s.jsx("span",{className:ze.colType,children:"Type"}),s.jsx("span",{className:ze.colScope,children:"Scope"}),s.jsx("span",{className:ze.colWidth,children:"Width"}),s.jsx("span",{className:ze.colActions,children:"Actions"})]}),n.map((M,L)=>s.jsxs("div",{className:`${ze.columnItem} ${g===L?ze.dragOver:""} ${(h==null?void 0:h.id)===M.id?ze.dragging:""}`,draggable:!0,onDragStart:S=>w(S,M,L),onDragEnd:p,onDragOver:S=>x(S,L),onDragLeave:v,onDrop:S=>C(S,L),children:[s.jsx("span",{className:ze.colDrag,children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"8",y1:"6",x2:"8",y2:"6"}),s.jsx("line",{x1:"16",y1:"6",x2:"16",y2:"6"}),s.jsx("line",{x1:"8",y1:"12",x2:"8",y2:"12"}),s.jsx("line",{x1:"16",y1:"12",x2:"16",y2:"12"}),s.jsx("line",{x1:"8",y1:"18",x2:"8",y2:"18"}),s.jsx("line",{x1:"16",y1:"18",x2:"16",y2:"18"})]})}),s.jsx("span",{className:ze.colName,children:M.name}),s.jsxs("span",{className:ze.colType,children:[B(M.column_type),b(M.column_type)]}),s.jsx("span",{className:ze.colScope,children:M.site_id===null?s.jsx("span",{className:ze.scopeGlobal,children:"Global"}):s.jsx("span",{className:ze.scopeLocal,children:"Local"})}),s.jsxs("span",{className:ze.colWidth,children:[M.width,"px"]}),s.jsxs("span",{className:ze.colActions,children:[s.jsx("button",{className:ze.actionBtn,onClick:()=>l(M),title:"Edit column",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),s.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),s.jsx("button",{className:`${ze.actionBtn} ${ze.deleteBtn}`,onClick:()=>N(M),title:"Delete column",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("polyline",{points:"3 6 5 6 21 6"}),s.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})]},M.id))]}),s.jsx("div",{className:ze.addSection,children:s.jsxs(oe,{variant:"primary",onClick:()=>d(!0),children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Column"]})})]}),s.jsxs("div",{className:ze.footer,children:[s.jsxs("div",{className:ze.hint,children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),s.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),"Drag columns to reorder. Changes apply to phases and subphases."]}),s.jsx(oe,{variant:"ghost",onClick:t,children:"Close"})]})]}),s.jsx(wd,{isOpen:!!o,onClose:()=>l(null),column:o,onSave:u}),s.jsx(wd,{isOpen:c,onClose:()=>d(!1),onSave:u})]})}function _M(){return s.jsxs(s.Fragment,{children:[s.jsx(ib,{}),s.jsx(Cb,{}),s.jsx(Eb,{}),s.jsx(Vb,{}),s.jsx(Ub,{}),s.jsx(hN,{}),s.jsx(ON,{}),s.jsx(YN,{}),s.jsx(uD,{}),s.jsx(ED,{}),s.jsx(l4,{}),s.jsx(S4,{}),s.jsx(AE,{}),s.jsx(nT,{}),s.jsx(bT,{}),s.jsx(l3,{})]})}const yM="_panel_1w4a8_1",vM="_header_1w4a8_10",xM="_headerContent_1w4a8_19",wM="_headerColumns_1w4a8_27",jM="_headerColumnPlaceholder_1w4a8_32",SM="_headerLeft_1w4a8_38",CM="_headerTitle_1w4a8_44",kM="_headerCount_1w4a8_50",bM="_headerActions_1w4a8_58",NM="_toggleBtn_1w4a8_64",DM="_toggleOff_1w4a8_83",$M="_columnsBtn_1w4a8_94",EM="_importBtn_1w4a8_115",TM="_newProjectBtn_1w4a8_136",MM="_columnHeaders_1w4a8_160",IM="_nameColumnHeader_1w4a8_168",PM="_body_1w4a8_172",LM="_empty_1w4a8_197",AM="_emptyHint_1w4a8_212",BM="_visibilityWrapper_1w4a8_219",RM="_hasHidden_1w4a8_223",OM="_visibilityDropdown_1w4a8_233",FM="_visibilityHeader_1w4a8_246",zM="_visibilityOption_1w4a8_257",HM="_visibilityCheckbox_1w4a8_281",qM="_visibilityCheckIcon_1w4a8_295",WM="_masterToggle_1w4a8_315",VM="_visibilityDivider_1w4a8_324",UM="_visibilityList_1w4a8_330",Ne={panel:yM,header:vM,headerContent:xM,headerColumns:wM,headerColumnPlaceholder:jM,headerLeft:SM,headerTitle:CM,headerCount:kM,headerActions:bM,toggleBtn:NM,toggleOff:DM,columnsBtn:$M,importBtn:EM,newProjectBtn:TM,columnHeaders:MM,nameColumnHeader:IM,body:PM,empty:LM,emptyHint:AM,visibilityWrapper:BM,hasHidden:RM,visibilityDropdown:OM,visibilityHeader:FM,visibilityOption:zM,visibilityCheckbox:HM,visibilityCheckIcon:qM,masterToggle:WM,visibilityDivider:VM,visibilityList:UM},GM=f.forwardRef(function({projects:t,width:n},r){const a=ee(R=>R.openProjectModal),i=ee(R=>R.setActiveModal),o=O(R=>R.currentUser),l=O(R=>R.currentSite),c=O(R=>R.customColumns),d=O(R=>R.setCustomColumns),h=O(R=>R.showAssignments),m=O(R=>R.toggleShowAssignments),g=O(R=>R.showAllCustomColumns),_=O(R=>R.hiddenCustomColumns),y=O(R=>R.setShowAllCustomColumns),u=O(R=>R.toggleCustomColumnVisibility),{refreshCustomColumns:w}=jl(),[p,x]=f.useState(!1),[v,C]=f.useState(!1),[N,b]=f.useState(!1),[B,M]=f.useState(null),L=f.useRef(null),S=(o==null?void 0:o.role)==="admin"||(o==null?void 0:o.role)==="superuser",P=g?c.filter(R=>!_.has(R.id)):[];f.useEffect(()=>{const R=H=>{L.current&&!L.current.contains(H.target)&&b(!1)};return N&&document.addEventListener("mousedown",R),()=>document.removeEventListener("mousedown",R)},[N]);const I=()=>{x(!0)},D=R=>{M(R),C(!0)},k=()=>{l&&w(l.id)},j=f.useCallback((R,H)=>{d(c.map(F=>F.id===R?{...F,width:H}:F))},[c,d]),T=()=>{y(!g)},E=P.reduce((R,H)=>R+H.width,0),$=n+E,A=c.length-P.length;return s.jsxs(Fj,{children:[s.jsxs("div",{className:Ne.panel,style:{width:$},children:[s.jsxs("div",{className:Ne.header,children:[s.jsxs("div",{className:Ne.headerContent,style:{width:n},children:[s.jsxs("div",{className:Ne.headerLeft,children:[s.jsx("span",{className:Ne.headerTitle,children:"Projects"}),s.jsx("span",{className:Ne.headerCount,children:t.length})]}),s.jsxs("div",{className:Ne.headerActions,children:[s.jsx("button",{className:`${Ne.toggleBtn} ${h?"":Ne.toggleOff}`,onClick:m,title:h?"Hide Staff & Equipment":"Show Staff & Equipment",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"9",cy:"7",r:"4"}),s.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),s.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}),c.length>0&&s.jsxs("div",{ref:L,className:Ne.visibilityWrapper,children:[s.jsx("button",{className:`${Ne.toggleBtn} ${A>0||!g?Ne.hasHidden:""}`,onClick:()=>b(!N),title:"Column Visibility",children:s.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:g&&A===0?s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),s.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),s.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})})}),N&&s.jsxs("div",{className:Ne.visibilityDropdown,children:[s.jsx("div",{className:Ne.visibilityHeader,children:s.jsx("span",{children:"Column Visibility"})}),s.jsxs("label",{className:`${Ne.visibilityOption} ${Ne.masterToggle}`,children:[s.jsx("input",{type:"checkbox",checked:g,onChange:T}),s.jsx("span",{className:Ne.visibilityCheckbox,children:s.jsx("svg",{className:Ne.visibilityCheckIcon,width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})})}),s.jsx("span",{children:"Show All Columns"})]}),g&&c.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:Ne.visibilityDivider}),s.jsx("div",{className:Ne.visibilityList,children:c.map(R=>s.jsxs("label",{className:Ne.visibilityOption,children:[s.jsx("input",{type:"checkbox",checked:!_.has(R.id),onChange:()=>u(R.id)}),s.jsx("span",{className:Ne.visibilityCheckbox,children:s.jsx("svg",{className:Ne.visibilityCheckIcon,width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})})}),s.jsx("span",{children:R.name})]},R.id))})]})]})]}),S&&s.jsxs(s.Fragment,{children:[s.jsx("button",{className:Ne.columnsBtn,onClick:I,title:"Manage Custom Columns",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),s.jsx("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),s.jsx("line",{x1:"9",y1:"21",x2:"9",y2:"9"})]})}),s.jsx("button",{className:Ne.importBtn,onClick:()=>i("importProject"),title:"Import Project",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),s.jsx("polyline",{points:"17 8 12 3 7 8"}),s.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]})}),s.jsxs("button",{className:Ne.newProjectBtn,onClick:()=>a(),title:"New Project",children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),s.jsx("span",{children:"New"})]})]})]})]}),P.length>0&&s.jsx("div",{className:Ne.headerColumns,children:P.map(R=>s.jsx("div",{className:Ne.headerColumnPlaceholder,style:{width:R.width}},R.id))})]}),P.length>0&&s.jsxs("div",{className:Ne.columnHeaders,children:[s.jsx("div",{className:Ne.nameColumnHeader,style:{width:n}}),P.map(R=>s.jsx(tC,{column:R,onEdit:D,onWidthChange:j},R.id))]}),s.jsx("div",{ref:r,className:Ne.body,children:t.length===0?s.jsxs("div",{className:Ne.empty,children:[s.jsx("p",{children:"No projects found"}),s.jsx("p",{className:Ne.emptyHint,children:S?'Click "New" to create a project':"No projects available for this site"})]}):t.map(R=>s.jsx(dk,{project:R,customColumns:P,nameColumnWidth:n},R.id))})]}),s.jsx(gM,{isOpen:p,onClose:()=>x(!1)}),s.jsx(wd,{isOpen:v,onClose:()=>C(!1),column:B,onSave:k})]})}),YM="_header_1seb9_1",QM="_headerContent_1seb9_7",XM="_primaryRow_1seb9_12",KM="_primaryCell_1seb9_18",ZM="_current_1seb9_32",JM="_secondaryRow_1seb9_37",eI="_secondaryCell_1seb9_42",tI="_weekend_1seb9_54",nI="_holiday_1seb9_58",sI="_today_1seb9_63",rI="_dayLabel_1seb9_69",aI="_weekLabelTop_1seb9_74",iI="_weekLabelBottom_1seb9_86",oI="_monthLabel_1seb9_95",lI="_customColumnSpacer_1seb9_104",Wt={header:YM,headerContent:QM,primaryRow:XM,primaryCell:KM,current:ZM,secondaryRow:JM,secondaryCell:eI,weekend:tI,holiday:nI,today:sI,dayLabel:rI,weekLabelTop:aI,weekLabelBottom:iI,monthLabel:oI,customColumnSpacer:lI},Ei=f.memo(function({headers:t,cells:n,cellWidth:r,totalWidth:a,viewMode:i,hasCustomColumns:o=!1}){const l=i==="week"||i==="month"||i==="quarter",c=i==="week"||i==="month";return s.jsx("div",{className:Wt.header,children:s.jsxs("div",{className:Wt.headerContent,style:{width:a},children:[s.jsx("div",{className:Wt.primaryRow,children:t.primary.map((d,h)=>s.jsx("div",{className:`${Wt.primaryCell} ${d.isCurrentPeriod?Wt.current:""}`,style:{width:d.span*r},children:d.label},h))}),s.jsx("div",{className:Wt.secondaryRow,children:n.map((d,h)=>s.jsxs("div",{className:`${Wt.secondaryCell} ${d.isToday?Wt.today:""} ${c&&d.isWeekend?Wt.weekend:""} ${c&&d.isBankHoliday?Wt.holiday:""}`,style:{width:r},title:c&&d.isBankHoliday?d.bankHolidayName:void 0,"data-date":d.dateStr,"data-date-end":d.dateEnd||void 0,children:[s.jsx("span",{className:Wt.dayLabel,children:d.label}),l&&d.isFirstOfWeek&&s.jsxs("span",{className:i==="month"?Wt.weekLabelBottom:Wt.weekLabelTop,children:["W",d.weekNumber]}),d.isFirstOfMonth&&r<40&&s.jsx("span",{className:Wt.monthLabel,children:d.monthLabel})]},h))}),o&&s.jsx("div",{className:Wt.customColumnSpacer})]})})}),cI="_bar_7th6k_1",dI="_confirmed_7th6k_34",uI="_unconfirmed_7th6k_39",fI="_label_7th6k_51",so={bar:cI,confirmed:dI,unconfirmed:uI,label:fI},hI=f.memo(function({left:t,width:n,name:r,confirmed:a,completion:i,projectId:o,startDate:l,endDate:c,onDragStart:d}){return s.jsx("div",{className:`${so.bar} ${a?so.confirmed:so.unconfirmed} gantt-bar`,style:{left:t,width:n},title:`${r}${i!=null?` (${i}%)`:""}
Drag to move project`,"data-project-id":o,"data-start":l,"data-end":c,onMouseDown:d,children:n>60&&s.jsx("span",{className:so.label,children:r})})}),mI="_bar_4cho9_1",pI="_subphase_4cho9_22",gI="_label_4cho9_27",_I="_completionBar_4cho9_47",yI="_resizeHandle_4cho9_64",vI="_left_4cho9_88",xI="_right_4cho9_93",wI="_milestone_4cho9_115",jI="_milestoneDiamond_4cho9_131",SI="_milestoneLabel_4cho9_143",CI="_linkZone_4cho9_183",kI="_start_4cho9_197",bI="_end_4cho9_201",NI="_linkingActive_4cho9_246",DI="_linkingSource_4cho9_263",$I="_milestoneZone_4cho9_274",Ae={bar:mI,subphase:pI,label:gI,completionBar:_I,resizeHandle:yI,left:vI,right:xI,milestone:wI,milestoneDiamond:jI,milestoneLabel:SI,linkZone:CI,start:kI,end:bI,linkingActive:NI,linkingSource:DI,milestoneZone:$I},zh=5;function Hh(e){return"touches"in e&&e.touches.length>0?{clientX:e.touches[0].clientX,clientY:e.touches[0].clientY}:"changedTouches"in e&&e.changedTouches.length>0?{clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY}:{clientX:e.clientX,clientY:e.clientY}}function dc(e,t="mousedown"){const n=e.touches[0]||e.changedTouches[0];return{...e,type:t,clientX:n.clientX,clientY:n.clientY,screenX:n.screenX,screenY:n.screenY,pageX:n.pageX,pageY:n.pageY,button:0,buttons:1}}const m_=f.memo(function({left:t,width:n,color:r,name:a,isSubphase:i=!1,isMilestone:o=!1,completion:l=null,phaseId:c,projectId:d,onDragStart:h,onResizeStart:m,onClick:g,onLinkZoneClick:_,isLinkingSource:y=!1,isLinkingActive:u=!1,onPhantomStart:w}){const p=f.useRef(null),x=f.useRef({isDragging:!1,startX:0,startY:0,hasMoved:!1,originalEvent:null,isTouch:!1}),v=i?16:20,C=f.useCallback(I=>{if(I.target.classList.contains(Ae.resizeHandle))return;I.preventDefault();const k="touches"in I,j=Hh(I),T=k?dc(I):I;x.current={isDragging:!0,startX:j.clientX,startY:j.clientY,hasMoved:!1,originalEvent:T,isTouch:k};const E=A=>{const R=x.current;if(!R.isDragging)return;const H=Hh(A),F=Math.abs(H.clientX-R.startX),V=Math.abs(H.clientY-R.startY);!R.hasMoved&&(F>zh||V>zh)&&(R.hasMoved=!0,"touches"in A&&A.preventDefault(),h&&p.current&&R.originalEvent&&h(R.originalEvent,p.current))},$=()=>{const A=x.current;document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",$),document.removeEventListener("touchmove",E),document.removeEventListener("touchend",$),document.removeEventListener("touchcancel",$),!A.hasMoved&&g&&A.originalEvent&&g(A.originalEvent),x.current={isDragging:!1,startX:0,startY:0,hasMoved:!1,originalEvent:null,isTouch:!1}};document.addEventListener("mousemove",E),document.addEventListener("mouseup",$),document.addEventListener("touchmove",E,{passive:!1}),document.addEventListener("touchend",$),document.addEventListener("touchcancel",$)},[h,g]),N=f.useCallback(I=>{I.stopPropagation(),I.preventDefault(),x.current.hasMoved=!0;const k="touches"in I?dc(I):I;m&&p.current&&m(k,"left",p.current)},[m]),b=f.useCallback(I=>{I.stopPropagation(),I.preventDefault(),x.current.hasMoved=!0;const k="touches"in I?dc(I):I;m&&p.current&&m(k,"right",p.current)},[m]),B=f.useCallback(I=>{if(I.stopPropagation(),I.preventDefault(),I.shiftKey&&w){w("start");return}_&&_(I,"start")},[_,w]),M=f.useCallback(I=>{if(I.stopPropagation(),I.preventDefault(),I.shiftKey&&w){w("end");return}_&&_(I,"end")},[_,w]);if(o){const I=i?{"data-subphase-id":c,"data-project-id":d}:{"data-phase-id":c,"data-project-id":d};return s.jsxs("div",{ref:p,className:`${Ae.milestone} ${i?Ae.subphase:""} ${y?Ae.linkingSource:""}`,style:{left:t+n/2-12},title:a,onMouseDown:C,onTouchStart:C,...I,children:[_&&s.jsx("div",{className:`${Ae.linkZone} ${Ae.start} ${Ae.milestoneZone} ${u?Ae.linkingActive:""}`,onClick:B,onMouseDown:D=>D.stopPropagation(),onTouchStart:D=>D.stopPropagation(),title:"Click to start linking (SS or SF)"}),s.jsx("div",{className:Ae.milestoneDiamond,style:{backgroundColor:r}}),a&&s.jsx("span",{className:Ae.milestoneLabel,children:a}),_&&s.jsx("div",{className:`${Ae.linkZone} ${Ae.end} ${Ae.milestoneZone} ${u?Ae.linkingActive:""}`,onClick:M,onMouseDown:D=>D.stopPropagation(),onTouchStart:D=>D.stopPropagation(),title:"Click to start linking (FS or FF)"})]})}const L=l!==null&&l>=0,S=L?Math.min(100,Math.max(0,l)):0,P=i?{"data-subphase-id":c,"data-project-id":d}:{"data-phase-id":c,"data-project-id":d};return s.jsxs("div",{ref:p,className:`${Ae.bar} ${i?Ae.subphase:""} ${y?Ae.linkingSource:""}`,style:{left:t,width:n,height:v,backgroundColor:r},title:L?`${a} (${l}%)`:a,onMouseDown:C,onTouchStart:C,...P,children:[L&&S>0&&s.jsx("div",{className:Ae.completionBar,style:{width:`${S}%`}}),_&&s.jsx("div",{className:`${Ae.linkZone} ${Ae.start} ${u?Ae.linkingActive:""}`,onClick:B,onMouseDown:I=>I.stopPropagation(),onTouchStart:I=>I.stopPropagation(),title:"Click to start linking (SS or SF)"}),!o&&m&&s.jsx("div",{className:`${Ae.resizeHandle} ${Ae.left}`,onMouseDown:N,onTouchStart:N}),n>40&&s.jsx("span",{className:Ae.label,children:a}),!o&&m&&s.jsx("div",{className:`${Ae.resizeHandle} ${Ae.right}`,onMouseDown:b,onTouchStart:b}),_&&s.jsx("div",{className:`${Ae.linkZone} ${Ae.end} ${u?Ae.linkingActive:""}`,onClick:M,onMouseDown:I=>I.stopPropagation(),onTouchStart:I=>I.stopPropagation(),title:"Click to start linking (FS or FF)"})]})}),EI="_row_sy6rr_1",TI="_projectRow_sy6rr_8",MI="_assignmentBar_sy6rr_16",II="_staff_sy6rr_33",PI="_equipment_sy6rr_37",LI="_interactive_sy6rr_48",AI="_dragging_sy6rr_60",BI="_resizeHandle_sy6rr_66",RI="_left_sy6rr_82",OI="_right_sy6rr_87",FI="_phaseStaff_sy6rr_93",zI="_subphaseStaff_sy6rr_98",HI="_barLabel_sy6rr_104",qI="_vacationCellMarker_sy6rr_114",WI="_phantomRow_sy6rr_137",Qe={row:EI,projectRow:TI,assignmentBar:MI,staff:II,equipment:PI,interactive:LI,dragging:AI,resizeHandle:BI,left:RI,right:OI,phaseStaff:FI,subphaseStaff:zI,barLabel:HI,vacationCellMarker:qI,phantomRow:WI};function VI(e){const t=e.phases??[];if(t.length===0)return null;let n=0,r=0;return t.forEach(a=>{const i=a.completion;if(i!=null){const o=new Date(a.start_date),l=new Date(a.end_date),c=Math.max(1,(l.getTime()-o.getTime())/(1e3*60*60*24));n+=i*c,r+=c}}),r>0?Math.round(n/r):null}const UI=f.memo(function({project:t,cells:n,cellWidth:r,isExpanded:a,expandedPhases:i,expandedSubphases:o}){const{openPhaseModal:l,openSubphaseModal:c,setEditingPhase:d,setEditingSubphase:h}=ee(),m=ee(q=>q.phantomSiblingMode),g=O(q=>q.viewMode),_=O(q=>q.customColumnFilters),y=O(q=>q.customColumnValues),u=O(q=>q.showAssignments),{startProjectDrag:w,startPhaseDrag:p,startSubphaseDrag:x,startStaffAssignmentDrag:v,startEquipmentAssignmentDrag:C}=O2(),{startPhaseResize:N,startSubphaseResize:b,startStaffAssignmentResize:B,startEquipmentAssignmentResize:M}=F2(),{isLinkingDependency:L,linkingFrom:S,handleLinkZoneClick:P}=V2(),{startPhantom:I,isPhantomMode:D}=$i(),k=f.useCallback((q,te)=>{const he=Object.keys(_).filter(Ee=>{var ne;return((ne=_[Number(Ee)])==null?void 0:ne.length)>0});if(he.length===0)return!0;for(const Ee of he){const ne=Number(Ee),ke=_[ne],Ht=`${ne}-${q}-${te}`,bt=y[Ht]??null;if(bt===null){if(!ke.includes("__empty__"))return!1}else if(!ke.includes(bt))return!1}return!0},[_,y]),j=f.useCallback(q=>{for(const te of q)if(k("subphase",te.id)||te.children&&te.children.length>0&&j(te.children))return!0;return!1},[k]),T=f.useMemo(()=>(t.phases??[]).filter(q=>k("phase",q.id)||j(q.children??[])),[t.phases,k,j]),E=f.useMemo(()=>{if(!t.start_date||!t.end_date){let q=null,te=null;return(t.phases??[]).forEach(he=>{(!q||he.start_date<q)&&(q=he.start_date),(!te||he.end_date>te)&&(te=he.end_date)}),q&&te?sn(q,te,n,r,g):null}return sn(t.start_date,t.end_date,n,r,g)},[t,n,r,g]),$=f.useMemo(()=>VI(t),[t]),A=f.useCallback(q=>{if(!t.start_date||!t.end_date){console.warn("Project has no dates, cannot drag");return}w(q,t.id,t.start_date,t.end_date)},[w,t.id,t.start_date,t.end_date]),R=f.useCallback((q,te,he)=>{p(q,te.id,t.id,te.start_date,te.end_date,te.is_milestone,he)},[p,t.id]),H=f.useCallback((q,te,he,Ee)=>{N(q,te.id,t.id,he,te.start_date,te.end_date,Ee)},[N,t.id]),F=f.useCallback(q=>{d(q),l(q,t.id)},[d,l,t.id]),V=f.useCallback((q,te,he,Ee)=>{x(q,te.id,t.id,he,te.start_date,te.end_date,te.is_milestone,Ee)},[x,t.id]),Q=f.useCallback((q,te,he,Ee)=>{b(q,te.id,t.id,he,te.start_date,te.end_date,Ee)},[b,t.id]),X=f.useCallback((q,te)=>{h(q),c(q,te,t.id)},[h,c,t.id]),Z=f.useCallback((q,te,he,Ee)=>{v(q,te,t.id,he,Ee)},[v,t.id]),ce=f.useCallback((q,te,he,Ee,ne)=>{B(q,te,t.id,he,Ee,ne)},[B,t.id]),K=f.useCallback((q,te,he,Ee)=>{C(q,te,t.id,he,Ee)},[C,t.id]),fe=f.useCallback((q,te,he,Ee,ne)=>{M(q,te,t.id,he,Ee,ne)},[M,t.id]),ae=f.useCallback((q,te,he,Ee)=>{P(q,t.id,te,he,Ee)},[P,t.id]),z=f.useCallback((q,te,he)=>{D||L||I({projectId:t.id,sourceId:q,type:te,zone:he})},[I,t.id,D,L]),ue=(S==null?void 0:S.projectId)===t.id?S.itemId:null,Le=(S==null?void 0:S.projectId)===t.id?S.itemType:null;return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`${Qe.row} ${Qe.projectRow}`,"data-project-id":t.id,children:E&&s.jsx(hI,{left:E.left,width:E.width,name:t.name,confirmed:t.confirmed,completion:$,projectId:t.id,startDate:t.start_date||"",endDate:t.end_date||"",onDragStart:A})}),a&&s.jsxs(s.Fragment,{children:[T.map(q=>{const te=(m==null?void 0:m.type)==="phase"&&m.projectId===t.id&&m.sourceId===q.id;return s.jsxs(f.Fragment,{children:[s.jsx(GI,{phase:q,projectId:t.id,cells:n,cellWidth:r,viewMode:g,isExpanded:i.has(q.id),expandedSubphases:o,depth:1,onPhaseDragStart:R,onPhaseResizeStart:H,onPhaseClick:F,onSubphaseDragStart:V,onSubphaseResizeStart:Q,onSubphaseClick:X,onLinkZoneClick:ae,isLinkingDependency:L,linkingFromId:ue,linkingFromType:Le,onPhantomStart:z,entityPassesFilters:k,anyDescendantMatches:j,showAssignments:u}),te&&s.jsx("div",{className:Qe.phantomRow})]},q.id)}),u&&(t.staffAssignments??[]).map(q=>s.jsx("div",{className:Qe.row,children:s.jsx(ga,{assignmentId:q.id,assignmentType:"staff",projectId:t.id,startDate:q.start_date,endDate:q.end_date,cells:n,cellWidth:r,viewMode:g,type:"staff",name:q.staff_name,allocation:q.allocation,staffId:q.staff_id,interactive:!0,onDragStart:te=>Z(te,q.id,q.start_date,q.end_date),onResizeStart:(te,he)=>ce(te,q.id,he,q.start_date,q.end_date)})},`staff-${q.id}`)),u&&(t.equipmentAssignments??[]).map(q=>s.jsx("div",{className:Qe.row,children:s.jsx(ga,{assignmentId:q.id,assignmentType:"equipment",projectId:t.id,startDate:q.start_date,endDate:q.end_date,cells:n,cellWidth:r,viewMode:g,type:"equipment",name:q.equipment_name,equipmentId:q.equipment_id,interactive:!0,onDragStart:te=>K(te,q.id,q.start_date,q.end_date),onResizeStart:(te,he)=>fe(te,q.id,he,q.start_date,q.end_date)})},`equip-${q.id}`))]})]})}),GI=f.memo(function({phase:t,projectId:n,cells:r,cellWidth:a,viewMode:i,isExpanded:o,expandedSubphases:l,depth:c,onPhaseDragStart:d,onPhaseResizeStart:h,onPhaseClick:m,onSubphaseDragStart:g,onSubphaseResizeStart:_,onSubphaseClick:y,onLinkZoneClick:u,isLinkingDependency:w,linkingFromId:p,linkingFromType:x,onPhantomStart:v,entityPassesFilters:C,anyDescendantMatches:N,showAssignments:b}){const B=ee(T=>T.phantomSiblingMode),M=f.useMemo(()=>(t.children??[]).filter(T=>C("subphase",T.id)||N(T.children??[])),[t.children,C,N]),L=f.useMemo(()=>sn(t.start_date,t.end_date,r,a,i),[t.start_date,t.end_date,r,a,i]),S=f.useCallback((T,E)=>{d(T,t,E)},[d,t]),P=f.useCallback((T,E,$)=>{h(T,t,E,$)},[h,t]),I=f.useCallback(T=>{T.stopPropagation(),m(t)},[m,t]),D=f.useCallback((T,E)=>{u(T,t.id,"phase",E)},[u,t.id]),k=f.useCallback(T=>{v(t.id,"phase",T)},[v,t.id]),j=w&&x==="phase"&&p===t.id;return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:Qe.row,"data-phase-id":t.id,children:L&&s.jsx(m_,{left:L.left,width:L.width,color:t.color,name:t.name,isMilestone:!!t.is_milestone,completion:t.completion,phaseId:t.id,projectId:n,startDate:t.start_date,endDate:t.end_date,onDragStart:S,onResizeStart:t.is_milestone?void 0:P,onClick:I,onLinkZoneClick:D,isLinkingSource:j,isLinkingActive:w,onPhantomStart:k})}),o&&s.jsxs(s.Fragment,{children:[M.map(T=>{const E=(B==null?void 0:B.type)==="subphase"&&B.projectId===n&&B.parentType==="phase"&&B.parentId===t.id&&B.sourceId===T.id;return s.jsxs(f.Fragment,{children:[s.jsx(YI,{subphase:T,phaseId:t.id,projectId:n,cells:r,cellWidth:a,viewMode:i,isExpanded:l.has(T.id),expandedSubphases:l,depth:c+1,onSubphaseDragStart:g,onSubphaseResizeStart:_,onSubphaseClick:y,onLinkZoneClick:u,isLinkingDependency:w,linkingFromId:p,linkingFromType:x,onPhantomStart:v,entityPassesFilters:C,anyDescendantMatches:N,showAssignments:b}),E&&s.jsx("div",{className:Qe.phantomRow})]},T.id)}),b&&(t.staffAssignments??[]).map(T=>s.jsx("div",{className:Qe.row,children:s.jsx(ga,{assignmentId:T.id,assignmentType:"staff",projectId:n,phaseId:t.id,startDate:t.start_date,endDate:t.end_date,cells:r,cellWidth:a,viewMode:i,type:"phase-staff",name:T.staff_name,allocation:T.allocation,phaseColor:t.color,staffId:T.staff_id})},`staff-${T.id}`)),b&&(t.equipmentAssignments??[]).map(T=>s.jsx("div",{className:Qe.row,children:s.jsx(ga,{assignmentId:T.id,assignmentType:"equipment",projectId:n,phaseId:t.id,startDate:t.start_date,endDate:t.end_date,cells:r,cellWidth:a,viewMode:i,type:"equipment",name:T.equipment_name,equipmentId:T.equipment_id})},`equip-${T.id}`))]})]})}),YI=f.memo(function e({subphase:t,phaseId:n,projectId:r,cells:a,cellWidth:i,viewMode:o,isExpanded:l,expandedSubphases:c,depth:d,onSubphaseDragStart:h,onSubphaseResizeStart:m,onSubphaseClick:g,onLinkZoneClick:_,isLinkingDependency:y,linkingFromId:u,linkingFromType:w,onPhantomStart:p,entityPassesFilters:x,anyDescendantMatches:v,showAssignments:C}){const N=ee(k=>k.phantomSiblingMode),b=f.useMemo(()=>(t.children??[]).filter(k=>x("subphase",k.id)||v(k.children??[])),[t.children,x,v]),B=f.useMemo(()=>sn(t.start_date,t.end_date,a,i,o),[t.start_date,t.end_date,a,i,o]),M=f.useCallback((k,j)=>{h(k,t,n,j)},[h,t,n]),L=f.useCallback((k,j,T)=>{m(k,t,j,T)},[m,t]),S=f.useCallback(k=>{k.stopPropagation(),g(t,n)},[g,t,n]),P=f.useCallback((k,j)=>{_(k,t.id,"subphase",j)},[_,t.id]),I=f.useCallback(k=>{p(t.id,"subphase",k)},[p,t.id]),D=y&&w==="subphase"&&u===t.id;return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:Qe.row,"data-subphase-id":t.id,children:B&&s.jsx(m_,{left:B.left,width:B.width,color:t.color,name:t.name,isSubphase:!0,isMilestone:!!t.is_milestone,completion:t.completion,phaseId:t.id,projectId:r,startDate:t.start_date,endDate:t.end_date,onDragStart:M,onResizeStart:t.is_milestone?void 0:L,onClick:S,onLinkZoneClick:P,isLinkingSource:D,isLinkingActive:y,onPhantomStart:I})}),l&&s.jsxs(s.Fragment,{children:[b.map(k=>{const j=(N==null?void 0:N.type)==="subphase"&&N.projectId===r&&N.sourceId===k.id;return s.jsxs(f.Fragment,{children:[s.jsx(e,{subphase:k,phaseId:n,projectId:r,cells:a,cellWidth:i,viewMode:o,isExpanded:c.has(k.id),expandedSubphases:c,depth:d+1,onSubphaseDragStart:h,onSubphaseResizeStart:m,onSubphaseClick:g,onLinkZoneClick:_,isLinkingDependency:y,linkingFromId:u,linkingFromType:w,onPhantomStart:p,entityPassesFilters:x,anyDescendantMatches:v,showAssignments:C}),j&&s.jsx("div",{className:Qe.phantomRow})]},k.id)}),C&&(t.staffAssignments??[]).map(k=>s.jsx("div",{className:Qe.row,children:s.jsx(ga,{assignmentId:k.id,assignmentType:"staff",projectId:r,phaseId:n,subphaseId:t.id,startDate:t.start_date,endDate:t.end_date,cells:a,cellWidth:i,viewMode:o,type:"subphase-staff",name:k.staff_name,allocation:k.allocation,phaseColor:t.color,staffId:k.staff_id})},`staff-${k.id}`)),C&&(t.equipmentAssignments??[]).map(k=>s.jsx("div",{className:Qe.row,children:s.jsx(ga,{assignmentId:k.id,assignmentType:"equipment",projectId:r,phaseId:n,subphaseId:t.id,startDate:t.start_date,endDate:t.end_date,cells:a,cellWidth:i,viewMode:o,type:"equipment",name:k.equipment_name,equipmentId:k.equipment_id})},`equip-${k.id}`))]})]})}),ga=f.memo(function({assignmentId:t,assignmentType:n,projectId:r,phaseId:a,subphaseId:i,startDate:o,endDate:l,cells:c,cellWidth:d,viewMode:h,type:m,name:g,allocation:_,phaseColor:y,staffId:u,equipmentId:w,onDragStart:p,onResizeStart:x,interactive:v=!1}){const C=O(k=>k.vacations),N=f.useMemo(()=>sn(o,l,c,d,h),[o,l,c,d,h]),b=f.useMemo(()=>{if(!u||n!=="staff")return[];const k=C.filter(T=>T.staff_id===u);if(k.length===0)return[];const j=[];return c.forEach((T,E)=>{const $=new Date(T.date),A=new Date($);A.setDate(A.getDate()+1);const R=k.find(H=>{const F=new Date(H.start_date),V=new Date(H.end_date);return V.setDate(V.getDate()+1),F<A&&V>$});if(R){const H=j[j.length-1],F=E*d;H&&H.left+H.width===F&&H.title===(R.description||"Vacation")?H.width+=d:j.push({left:F,width:d,title:R.description||"Vacation"})}}),j},[u,n,C,c,d]);if(!N)return null;const B=m==="phase-staff",M=m==="subphase-staff",L=m==="phase-staff"||m==="subphase-staff"?"staff":m,S={left:N.left,width:N.width};B&&(S.opacity=.7,y&&(S.background=y),S.border="1px dashed rgba(255,255,255,0.4)"),M&&(S.opacity=.7,S.height="14px",y&&(S.background=y));const P=g?_?`${g} (${_}%)`:g:_?`${_}%`:"",I=k=>{k.target.classList.contains("resize-handle")||p&&p(k)},D=(k,j)=>{k.stopPropagation(),x&&x(k,j)};return s.jsxs(s.Fragment,{children:[b.map((k,j)=>s.jsx("div",{className:Qe.vacationCellMarker,style:{left:k.left,width:k.width},title:k.title},`vac-${j}`)),s.jsxs("div",{className:`${Qe.assignmentBar} ${Qe[L]} ${B?Qe.phaseStaff:""} ${M?Qe.subphaseStaff:""} ${v?Qe.interactive:""}`,style:S,title:P,"data-assignment-id":t,"data-assignment-type":n,"data-start":o,"data-end":l,onMouseDown:v?I:void 0,children:[v&&s.jsx("div",{className:`${Qe.resizeHandle} ${Qe.left} resize-handle`,onMouseDown:k=>D(k,"left")}),s.jsx("span",{className:Qe.barLabel,children:P}),v&&s.jsx("div",{className:`${Qe.resizeHandle} ${Qe.right} resize-handle`,onMouseDown:k=>D(k,"right")})]})]})}),QI="_line_16bxs_1",XI="_marker_16bxs_11",qh={line:QI,marker:XI},$l=f.memo(function({position:t}){return s.jsx("div",{className:qh.line,style:{left:t},children:s.jsx("div",{className:qh.marker})})}),KI="_popup_17gls_3",ZI="_header_17gls_15",JI="_typeLabel_17gls_24",eP="_closeButton_17gls_30",tP="_content_17gls_50",nP="_connection_17gls_54",sP="_fromTo_17gls_66",rP="_name_17gls_71",aP="_footer_17gls_79",iP="_deleteButton_17gls_85",an={popup:KI,header:ZI,typeLabel:JI,closeButton:eP,content:tP,connection:nP,fromTo:sP,name:rP,footer:aP,deleteButton:iP},oP={FS:"Finish-to-Start",SS:"Start-to-Start",FF:"Finish-to-Finish",SF:"Start-to-Finish"},lP=f.memo(function({visible:t,x:n,y:r,dependencyType:a,fromName:i,toName:o,onClose:l,onDelete:c}){const d=f.useRef(null);f.useEffect(()=>{if(!t)return;const _=u=>{d.current&&!d.current.contains(u.target)&&l()},y=setTimeout(()=>{document.addEventListener("mousedown",_)},100);return()=>{clearTimeout(y),document.removeEventListener("mousedown",_)}},[t,l]),f.useEffect(()=>{if(!t)return;const _=y=>{y.key==="Escape"&&l()};return document.addEventListener("keydown",_),()=>document.removeEventListener("keydown",_)},[t,l]);const h=f.useCallback(()=>{confirm(`Remove this ${a} dependency?`)&&c()},[a,c]);if(!t)return null;const m=Math.min(n,window.innerWidth-250),g=Math.min(r,window.innerHeight-180);return s.jsxs("div",{ref:d,className:an.popup,style:{left:m,top:g},children:[s.jsxs("div",{className:an.header,children:[s.jsx("span",{className:an.typeLabel,children:oP[a]}),s.jsx("button",{className:an.closeButton,onClick:l,title:"Close",children:""})]}),s.jsxs("div",{className:an.content,children:[s.jsxs("div",{className:an.connection,children:[s.jsx("span",{className:an.fromTo,children:"From:"}),s.jsx("span",{className:an.name,children:i})]}),s.jsxs("div",{className:an.connection,children:[s.jsx("span",{className:an.fromTo,children:"To:"}),s.jsx("span",{className:an.name,children:o})]})]}),s.jsx("div",{className:an.footer,children:s.jsx("button",{className:an.deleteButton,onClick:h,children:"Delete Dependency"})})]})}),cP="_layer_7cyyn_5",dP="_dependency_7cyyn_16",uP="_arrow_7cyyn_20",fP="_hitArea_7cyyn_24",ro={layer:cP,dependency:dP,arrow:uP,hitArea:fP},hP=f.memo(function({projects:t,cells:n,cellWidth:r,rowPositions:a}){const i=O(S=>S.viewMode),o=O(S=>S.setProjects),l=O(S=>S.showAssignments),c=O(S=>S.customColumnFilters),d=ee(S=>S.isDragging),h=f.useRef(null),[m,g]=f.useState(new Map),[_,y]=f.useState(0),[u,w]=f.useState(null);f.useEffect(()=>{if(!d)return;const S=setInterval(()=>{y(P=>P+1)},33);return()=>clearInterval(S)},[d]),f.useEffect(()=>{const S=requestAnimationFrame(()=>{var j;if(!h.current)return;const P=(j=h.current.parentElement)==null?void 0:j.querySelector('[class*="rows"]');if(!P)return;const I=new Map;P.querySelectorAll("[data-phase-id]").forEach(T=>{const E=T.getAttribute("data-phase-id");if(E){const $=T.getBoundingClientRect(),A=P.getBoundingClientRect();I.set(`phase-${E}`,{top:$.top-A.top,height:$.height})}}),P.querySelectorAll("[data-subphase-id]").forEach(T=>{const E=T.getAttribute("data-subphase-id");if(E){const $=T.getBoundingClientRect(),A=P.getBoundingClientRect();I.set(`subphase-${E}`,{top:$.top-A.top,height:$.height})}}),g(I)});return()=>cancelAnimationFrame(S)},[t,a,l,c,d,_]);const p=m.size>0?m:a,x=f.useMemo(()=>I2(t),[t]),v=f.useMemo(()=>x.filter(S=>{const P=`${S.fromType}-${S.fromId}`,I=`${S.toType}-${S.toId}`;return a.has(P)&&a.has(I)}),[x,a]),C=f.useMemo(()=>{const S=new Map;return t.forEach(P=>{(P.phases??[]).forEach(I=>{S.set(`phase-${I.id}`,{start_date:I.start_date,end_date:I.end_date,color:I.color});const D=(k,j)=>{(k??[]).forEach(T=>{var E;S.set(`subphase-${T.id}`,{start_date:T.start_date,end_date:T.end_date,color:T.color||j}),(E=T.children)!=null&&E.length&&D(T.children,T.color||j)})};D(I.children,I.color)})}),S},[t]),N=f.useMemo(()=>v.map(S=>{const P=`${S.fromType}-${S.fromId}`,I=`${S.toType}-${S.toId}`,D=p.get(P),k=p.get(I),j=C.get(P),T=C.get(I);if(!D||!k||!j||!T)return null;const E=sn(j.start_date,j.end_date,n,r,i),$=sn(T.start_date,T.end_date,n,r,i);if(!E||!$)return null;const{sourceEdge:A,targetEdge:R}=A2(S.type),H=A==="start"?E.left:E.left+E.width,F=R==="start"?$.left:$.left+$.width,V=D.top+D.height/2,Q=k.top+k.height/2,X=L2(H,V,F,Q,S.type);return{...S,path:X,fromX:H,fromY:V,toX:F,toY:Q,sourceColor:j.color}}).filter(S=>S!==null),[v,p,C,n,r,i]),b=f.useMemo(()=>{const S=new Map;return t.forEach(P=>{(P.phases??[]).forEach(I=>{S.set(`phase-${I.id}`,I.name);const D=k=>{(k??[]).forEach(j=>{var T;S.set(`subphase-${j.id}`,j.name),(T=j.children)!=null&&T.length&&D(j.children)})};D(I.children)})}),S},[t]),B=f.useCallback((S,P)=>{if(!P)return;const I=b.get(`${P.fromType}-${P.fromId}`)||"Unknown",D=b.get(`${P.toType}-${P.toId}`)||"Unknown";w({id:P.id,type:P.type,fromId:P.fromId,toId:P.toId,fromType:P.fromType,toType:P.toType,projectId:P.projectId,fromName:I,toName:D,x:S.clientX,y:S.clientY})},[b]),M=f.useCallback(()=>{w(null)},[]),L=f.useCallback(async()=>{if(u)try{const S=t.map(I=>{if(I.id!==u.projectId)return I;if(u.toType==="phase")return{...I,phases:(I.phases??[]).map(D=>{if(D.id!==u.toId)return D;const k=(D.dependencies??[]).filter(j=>!(j.id===u.fromId&&j.type===u.type));return{...D,dependencies:k}})};{const D=k=>k.map(j=>{var T;if(j.id===u.toId){const E=(j.dependencies??[]).filter($=>!($.id===u.fromId&&$.type===u.type));return{...j,dependencies:E}}return(T=j.children)!=null&&T.length?{...j,children:D(j.children)}:j});return{...I,phases:(I.phases??[]).map(k=>({...k,children:D(k.children??[])}))}}});o(S),w(null);const P=t.find(I=>I.id===u.projectId);if(!P)return;if(u.toType==="phase"){const I=(P.phases??[]).find(D=>D.id===u.toId);if(I){const D=(I.dependencies??[]).filter(k=>!(k.id===u.fromId&&k.type===u.type));await Js(u.toId,{start_date:I.start_date,end_date:I.end_date,dependencies:D})}}else{const I=k=>{var j;for(const T of k){if(T.id===u.toId)return T;if((j=T.children)!=null&&j.length){const E=I(T.children);if(E)return E}}return null};let D=null;for(const k of P.phases??[])if(D=I(k.children??[]),D)break;if(D){const k=(D.dependencies??[]).filter(j=>!(j.id===u.fromId&&j.type===u.type));await er(u.toId,{start_date:D.start_date,end_date:D.end_date,dependencies:k})}}}catch(S){console.error("Failed to delete dependency:",S);const P=await ft();o(P)}},[u,t,o]);return s.jsxs(s.Fragment,{children:[s.jsx("svg",{ref:h,className:ro.layer,style:N.length===0?{display:"none"}:void 0,children:N.map(S=>{if(!S)return null;const P=P2[S.type],I=S.sourceColor||"#ec4899",D=`arrow-${S.id}`;return s.jsxs("g",{className:ro.dependency,children:[s.jsx("defs",{children:s.jsx("marker",{id:D,markerWidth:"6",markerHeight:"5",refX:"5",refY:"2.5",orient:"auto",markerUnits:"strokeWidth",children:s.jsx("polygon",{points:"0 0, 6 2.5, 0 5",fill:I})})}),s.jsx("path",{d:S.path,stroke:I,strokeWidth:"1.5",fill:"none",strokeLinejoin:"round",strokeLinecap:"round",strokeDasharray:P.dashArray,markerEnd:`url(#${D})`,className:ro.arrow}),s.jsx("path",{d:S.path,stroke:"transparent",strokeWidth:"10",fill:"none",className:ro.hitArea,"data-dependency-id":S.id,onClick:k=>B(k,S)})]},S.id)})}),s.jsx(lP,{visible:u!==null,x:(u==null?void 0:u.x)??0,y:(u==null?void 0:u.y)??0,dependencyType:(u==null?void 0:u.type)??"FS",fromName:(u==null?void 0:u.fromName)??"",toName:(u==null?void 0:u.toName)??"",onClose:M,onDelete:L})]})}),mP="_lagIndicator_1so8k_5",pP="_positive_1so8k_18",gP="_negative_1so8k_23",_P="_resizeIndicator_1so8k_29",yP="_duration_1so8k_47",vP="_date_1so8k_52",Ir={lagIndicator:mP,positive:pP,negative:gP,resizeIndicator:_P,duration:yP,date:vP};function xP(e){const t=new Date(e),n=t.getDate(),r=t.toLocaleString("en-GB",{month:"short"}),a=t.getFullYear();return`${n} ${r} ${a}`}const wP=f.memo(function({visible:t,left:n,top:r,type:a,lagDays:i,date:o,duration:l,edge:c}){if(!t)return null;if(a==="drag"&&i!==void 0){const d=i>=0,h=d?`+${i}d`:`${i}d`;return s.jsx("div",{className:`${Ir.lagIndicator} ${d?Ir.positive:Ir.negative}`,style:{left:n,top:r},children:h})}if(a==="resize"&&o){const d=c==="left"?"translateX(-100%)":"translateX(0)";return s.jsxs("div",{className:Ir.resizeIndicator,style:{left:n,top:r,transform:d},children:[s.jsxs("span",{className:Ir.duration,children:[l,"d"]}),s.jsx("span",{className:Ir.date,children:xP(o)})]})}return null}),jP="_overlay_yits3_3",SP="_phantomRow_yits3_11",CP="_phantomBar_yits3_22",kP="_barLabel_yits3_40",bP="_indicator_yits3_51",NP="_positive_yits3_70",DP="_negative_yits3_74",$P="_lag_yits3_78",EP="_depType_yits3_82",TP="_arrowSvg_yits3_90",xn={overlay:jP,phantomRow:SP,phantomBar:CP,barLabel:kP,indicator:bP,positive:NP,negative:DP,lag:$P,depType:EP,arrowSvg:TP};function MP(e,t,n){const r=t==="phase"?"data-phase-id":"data-subphase-id",a=n.querySelector(`[${r}="${e}"]`);if(!a)return null;const i=a.querySelector('[class*="phaseBar"], [class*="bar"], [class*="milestone"]');if(!i)return null;const o=i.getBoundingClientRect(),l=n.getBoundingClientRect();return{left:o.left-l.left+n.scrollLeft,width:o.width,top:a.offsetTop,height:a.clientHeight||32}}function IP(e,t){for(const n of e){const r=p_(n.children||[],t);if(r)return r}return null}function p_(e,t){for(const n of e){if(n.id===t)return n;if(n.children&&n.children.length>0){const r=p_(n.children,t);if(r)return r}}return null}function uc(e){const t=e.split("T")[0];return new Date(t+"T12:00:00")}function PP({cells:e,cellWidth:t,viewMode:n,timelineRef:r,containerWidth:a,containerHeight:i,phantomRowTop:o}){const l=ee(S=>S.phantomSiblingMode),c=ee(S=>S.updatePhantomPosition),d=O(S=>S.projects),{completePhantom:h}=$i(),[m,g]=f.useState(null);f.useEffect(()=>{if(!l||!r.current){g(null);return}const{sourceId:S,type:P}=l,I=()=>{if(r.current){const k=MP(S,P,r.current);g(k)}},D=requestAnimationFrame(()=>{I(),requestAnimationFrame(I)});return()=>cancelAnimationFrame(D)},[l,r]);const _=f.useCallback(S=>{if(!l||!r.current)return;const{siblingDurationDays:P}=l,I=r.current.getBoundingClientRect(),D=r.current.scrollLeft,k=S.clientX-I.left+D;if(e.length===0)return;const j=new Date(e[0].date);j.setHours(0,0,0,0);const T=e[e.length-1],E=new Date(T.date);E.setHours(23,59,59,999);const $=e.length*t,R=(E.getTime()-j.getTime())/$,H=(P-1)*24*60*60*1e3,F=H/R/2,V=k-F,Q=Math.max(0,Math.min(V,$-H/R)),X=j.getTime()+Q*R,Z=new Date(X);Z.setHours(0,0,0,0);const ce=kn(Z,P-1);c(Ie(Z,"yyyy-MM-dd"),Ie(ce,"yyyy-MM-dd"))},[l,r,e,t,c]),y=f.useCallback(S=>{if(!l)return;const P=S.target;(P.closest(`.${xn.phantomRow}`)||P.closest(`.${xn.phantomBar}`))&&(S.preventDefault(),S.stopPropagation(),h())},[l,h]);f.useEffect(()=>{if(!l||!r.current)return;const S=r.current;return S.addEventListener("mousemove",_),S.addEventListener("click",y,!0),()=>{S.removeEventListener("mousemove",_),S.removeEventListener("click",y,!0)}},[l,_,y,r]);const u=f.useMemo(()=>{if(!l)return null;const{phantomStart:S,phantomEnd:P,phantomColor:I,type:D,dependencyType:k,sourceId:j,projectId:T}=l,E=sn(S,P,e,t,n);if(!E)return null;const $=d.find(Q=>Q.id===T);if(!$)return null;let A;if(D==="phase"?A=($.phases||[]).find(Q=>Q.id===j):A=IP($.phases||[],j)||void 0,!A)return null;const R=uc(S),H=uc(A.start_date),F=uc(A.end_date);let V;if(k==="SS")V=Us(R,H);else{const Q=kn(F,1);V=Us(R,Q)}return{barPosition:E,phantomColor:I,type:D,dependencyType:k,lagDays:V,sourceBar:m}},[l,e,t,n,d,m]);if(!l||!u||!u.sourceBar)return null;const{barPosition:w,phantomColor:p,type:x,dependencyType:v,lagDays:C,sourceBar:N}=u,b=C>=0?`+${C}d`:`${C}d`,B=o??N.top+N.height,M=24,L=B+(32-M)/2;return s.jsxs("div",{className:xn.overlay,children:[s.jsx("div",{className:xn.phantomRow,style:{top:B,width:a},onClick:S=>{S.stopPropagation(),h()}}),s.jsx("div",{className:xn.phantomBar,style:{left:w.left,top:L,width:w.width,height:M,backgroundColor:`${p}80`,borderColor:p},onClick:S=>{S.stopPropagation(),h()},children:s.jsxs("span",{className:xn.barLabel,children:["New ",x==="phase"?"Phase":"Subphase"]})}),s.jsxs("div",{className:`${xn.indicator} ${C>=0?xn.positive:xn.negative}`,style:{left:w.left+w.width/2,top:B-28,borderColor:p},children:[s.jsx("span",{className:xn.lag,children:b}),s.jsx("span",{className:xn.depType,children:v})]}),s.jsxs("svg",{className:xn.arrowSvg,width:a,height:i,children:[s.jsx("defs",{children:s.jsx("marker",{id:"phantomArrowhead",markerWidth:"8",markerHeight:"6",refX:"7",refY:"3",orient:"auto",markerUnits:"strokeWidth",children:s.jsx("path",{d:"M0,0 L0,6 L8,3 z",fill:p})})}),s.jsx("path",{d:LP(N,{left:w.left,top:L+M/2},v),stroke:p,strokeWidth:"2",fill:"none",strokeDasharray:"5,3",markerEnd:"url(#phantomArrowhead)",opacity:"0.8"})]})]})}function LP(e,t,n){const a=e.top+e.height/2;let i;n==="SS"?i=e.left:i=e.left+e.width;const o=t.left,l=t.top;if(n==="SS"){const c=Math.min(i,o)-15;return`M${i},${a} H${c} V${l} H${o}`}else if(o>i+15){const c=i+(o-i)/2;return`M${i},${a} H${c} V${l} H${o}`}else{const c=i+15,d=Math.max(a,l)+20;return`M${i},${a} H${c} V${d} H${o-15} V${l} H${o}`}}const AP="_overlay_12ij7_3",BP="_dropZone_12ij7_14",RP="_previewBar_12ij7_24",OP="_staff_12ij7_35",FP="_equipment_12ij7_40",zP="_previewLabel_12ij7_45",HP="_instructions_12ij7_56",qP="_hint_12ij7_78",xs={overlay:AP,dropZone:BP,previewBar:RP,staff:OP,equipment:FP,previewLabel:zP,instructions:HP,hint:qP},ao=5,WP=100;function VP({projects:e,cells:t,cellWidth:n,totalWidth:r,containerRef:a,rowPositions:i}){var L,S;const o=ee(P=>P.resourceDrag),l=ee(P=>P.endResourceDrag),c=O(P=>P.setProjects),d=O(P=>P.ensureProjectExpanded),h=O(P=>P.ensurePhaseExpanded),m=O(P=>P.ensureSubphaseExpanded),g=f.useRef(null),[_,y]=f.useState(null),[u,w]=f.useState(null),p=f.useCallback(()=>{l(),document.body.classList.remove("resource-dragging")},[l]);f.useEffect(()=>{const P=I=>{I.key==="Escape"&&p()};return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[p]);const x=f.useCallback(P=>{var k;if(t.length===0)return Ie(new Date,"yyyy-MM-dd");const I=Math.floor(P/n),D=Math.max(0,Math.min(I,t.length-1));return((k=t[D])==null?void 0:k.dateStr)||Ie(new Date,"yyyy-MM-dd")},[t,n]),v=f.useCallback(P=>{for(const I of e){const D=`project-${I.id}`,k=i.get(D);if(k&&P>=k.top&&P<k.top+k.height)return{projectId:I.id,phaseId:null,subphaseId:null,rowKey:D};for(const j of I.phases||[]){const T=`phase-${j.id}`,E=i.get(T);if(E&&P>=E.top&&P<E.top+E.height)return{projectId:I.id,phaseId:j.id,subphaseId:null,rowKey:T};const $=(R,H)=>{var F;for(const V of R||[]){const Q=`subphase-${V.id}`,X=i.get(Q);if(X&&P>=X.top&&P<X.top+X.height)return{projectId:I.id,phaseId:H,subphaseId:V.id,rowKey:Q};if((F=V.children)!=null&&F.length){const Z=$(V.children,H);if(Z)return Z}}return null},A=$(j.children,j.id);if(A)return A}}return null},[e,i]),C=f.useCallback((P,I)=>{if(!a.current)return;const D=a.current.getBoundingClientRect(),k=a.current.scrollLeft||0,j=a.current.scrollTop||0,T=P-D.left+k,E=I-D.top+j;y(T),w(v(E))},[a,v]),N=f.useCallback(P=>{P.preventDefault(),P.stopPropagation(),P.dataTransfer.dropEffect="copy",C(P.clientX,P.clientY)},[C]),b=f.useCallback(async P=>{if(P.preventDefault(),P.stopPropagation(),!u||!o.resourceId||_===null){l(),document.body.classList.remove("resource-dragging");return}const I=x(_-n*ao/2),D=Ie(kn(new Date(I),ao-1),"yyyy-MM-dd"),k=!u.phaseId&&!u.subphaseId,j=u.phaseId&&!u.subphaseId,T=!!u.subphaseId;try{o.type==="staff"?await Su({staff_id:o.resourceId,allocation:WP,start_date:I,end_date:D,project_id:k||j?u.projectId:void 0,phase_id:j?u.phaseId:void 0,subphase_id:T?u.subphaseId:void 0}):o.type==="equipment"&&await Cu({equipment_id:o.resourceId,start_date:I,end_date:D,project_id:k||j?u.projectId:void 0,phase_id:j?u.phaseId:void 0,subphase_id:T?u.subphaseId:void 0}),k?d(u.projectId):j&&u.phaseId?(d(u.projectId),h(u.phaseId)):T&&u.subphaseId&&(d(u.projectId),u.phaseId&&h(u.phaseId),m(u.subphaseId));const E=await ft();c(E)}catch(E){console.error("Failed to create assignment:",E)}finally{l(),document.body.classList.remove("resource-dragging")}},[u,o,_,n,x,l,c,d,h,m]),B=f.useCallback(P=>{const I=P.relatedTarget;g.current&&!g.current.contains(I)&&(w(null),y(null))},[]),M=f.useMemo(()=>{if(!u||_===null)return null;const P=i.get(u.rowKey);if(!P)return null;const I=n*ao,D=_-I/2,k=P.top+(P.height-20)/2;return{left:Math.max(0,D),top:k,width:I,height:20}},[u,_,n,i]);return o.active?s.jsxs("div",{ref:g,className:xs.overlay,onDragOver:N,onDrop:b,onDragLeave:B,children:[u&&s.jsx("div",{className:xs.dropZone,style:{top:((L=i.get(u.rowKey))==null?void 0:L.top)||0,height:((S=i.get(u.rowKey))==null?void 0:S.height)||32,width:r}}),M&&s.jsx("div",{className:`${xs.previewBar} ${o.type==="staff"?xs.staff:xs.equipment}`,style:{left:M.left,top:M.top,width:M.width,height:M.height},children:s.jsxs("span",{className:xs.previewLabel,children:[o.resourceName," (",ao,"d)"]})}),s.jsxs("div",{className:xs.instructions,children:[s.jsxs("span",{children:["Drop to place ",o.type==="staff"?"staff":"equipment"," assignment"]}),s.jsx("span",{className:xs.hint,children:"Press Esc to cancel"})]})]}):null}const UP="_body_ceoor_1",GP="_content_ceoor_25",YP="_grid_ceoor_32",QP="_gridCell_ceoor_61",XP="_weekend_ceoor_69",KP="_holiday_ceoor_73",ZP="_rows_ceoor_77",JP="_dropTarget_ceoor_83",ns={body:UP,content:GP,grid:YP,gridCell:QP,weekend:XP,holiday:KP,rows:ZP,dropTarget:JP},e6=f.forwardRef(function({cells:t,projects:n,cellWidth:r,totalWidth:a,viewMode:i},o){const l=O(I=>I.expandedProjects),c=O(I=>I.expandedPhases),d=O(I=>I.expandedSubphases),h=O(I=>I.showAssignments),m=O(I=>I.customColumnFilters),g=O(I=>I.customColumnValues),_=ee(I=>I.dragIndicator),y=ee(I=>I.phantomSiblingMode),u=ee(I=>I.resourceDrag),w=f.useRef(null),p=I=>{w.current=I,typeof o=="function"?o(I):o&&(o.current=I)},x=f.useMemo(()=>bl(t,r),[t,r]),v=f.useCallback((I,D)=>{const k=Object.keys(m).filter(j=>{var T;return((T=m[Number(j)])==null?void 0:T.length)>0});if(k.length===0)return!0;for(const j of k){const T=Number(j),E=m[T],$=`${T}-${I}-${D}`,A=g[$]??null;if(A===null){if(!E.includes("__empty__"))return!1}else if(!E.includes(A))return!1}return!0},[m,g]),C=f.useCallback(I=>{for(const D of I)if(v("subphase",D.id)||D.children&&D.children.length>0&&C(D.children))return!0;return!1},[v]),N=y?{projectId:y.projectId,sourceId:y.sourceId,type:y.type,parentId:y.parentId,parentType:y.parentType}:null,b=Object.keys(m).some(I=>{var D;return((D=m[Number(I)])==null?void 0:D.length)>0}),B=f.useMemo(()=>B2(n,l,c,d,N,h,b?v:void 0,b?C:void 0),[n,l,c,d,N,h,b,v,C]),M=i==="week"||i==="month",L=B.totalHeight+100,S=f.useCallback(I=>{(I.dataTransfer.types.includes("application/json")||u.active)&&(I.preventDefault(),I.dataTransfer.dropEffect="copy")},[u.active]),P=f.useCallback(I=>{(I.dataTransfer.types.includes("application/json")||u.active)&&I.preventDefault()},[u.active]);return s.jsx("div",{ref:p,className:ns.body,children:s.jsxs("div",{className:`${ns.content} ${u.active?ns.dropTarget:""}`,style:{width:a,"--cell-width":`${r}px`},onDragOver:S,onDragEnter:P,children:[s.jsxs("div",{className:ns.grid,children:[M&&t.map((I,D)=>I.isWeekend?s.jsx("div",{className:`${ns.gridCell} ${ns.weekend}`,style:{left:D*r,width:r}},`weekend-${D}`):null),M&&t.map((I,D)=>I.isBankHoliday?s.jsx("div",{className:`${ns.gridCell} ${ns.holiday}`,style:{left:D*r,width:r}},`holiday-${D}`):null)]}),x!==null&&s.jsx($l,{position:x}),s.jsx("div",{className:ns.rows,children:n.map(I=>s.jsx(UI,{project:I,cells:t,cellWidth:r,isExpanded:l.has(I.id),expandedPhases:c,expandedSubphases:d},I.id))}),s.jsx(hP,{projects:n,cells:t,cellWidth:r,rowPositions:B.positions}),y&&s.jsx(PP,{cells:t,cellWidth:r,viewMode:i,timelineRef:w,containerWidth:a,containerHeight:L,phantomRowTop:B.phantomRowTop}),s.jsx(wP,{visible:_.visible,left:_.left,top:_.top,type:_.type,lagDays:_.lagDays,date:_.date,duration:_.duration,edge:_.edge}),u.active&&s.jsx(VP,{projects:n,cells:t,cellWidth:r,totalWidth:a,containerRef:w,rowPositions:B.positions})]})})}),g_=f.createContext(null);function t6({children:e}){const t=f.useRef(new Map),n=f.useRef(0),r=f.useRef(null),a=f.useRef(null),i=f.useCallback((d,h)=>{t.current.set(d,h),requestAnimationFrame(()=>{if(t.current.size>1&&h.current){for(const[m,g]of t.current)if(m!==d&&g.current){const _=g.current.scrollLeft;_>0&&(n.current=_,h.current.scrollLeft=_);break}}else h.current&&n.current>0&&(h.current.scrollLeft=n.current)})},[]),o=f.useCallback(d=>{t.current.delete(d)},[]),l=f.useCallback((d,h)=>{r.current&&r.current!==d||(r.current=d,n.current=h,t.current.forEach((m,g)=>{g!==d&&m.current&&(m.current.scrollLeft=h)}),a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{r.current=null},100))},[]),c=f.useCallback(()=>n.current,[]);return s.jsx(g_.Provider,{value:{registerScrollContainer:i,unregisterScrollContainer:o,syncScroll:l,getScrollLeft:c},children:e})}function Bu(e,t,n=!0){const r=f.useContext(g_),a=f.useRef(()=>{});f.useEffect(()=>{a.current=l=>{!r||!n||r.syncScroll(e,l)}},[r,e,n]),f.useEffect(()=>{if(!(!r||!n))return r.registerScrollContainer(e,t),requestAnimationFrame(()=>{const l=r.getScrollLeft();t.current&&l>0&&(t.current.scrollLeft=l)}),()=>r.unregisterScrollContainer(e)},[r,e,t,n]);const i=f.useCallback(l=>{!r||!n||r.syncScroll(e,l.currentTarget.scrollLeft)},[r,e,n]),o=f.useCallback(l=>{a.current(l)},[]);return{handleScroll:i,syncScrollPosition:o}}const n6="_timeline_1f83i_1",s6="_horizontalScroll_1f83i_9",r6="_scrollContent_1f83i_33",fc={timeline:n6,horizontalScroll:s6,scrollContent:r6},a6=200,i6=f.forwardRef(function({cells:t,headers:n,projects:r,cellWidth:a,viewMode:i,hasCustomColumns:o=!1},l){const c=t.length*a,d=f.useRef(null),h=ee(E=>E.scrollToTodayTrigger),m=ee(E=>E.scrollToDateTrigger),g=ee(E=>E.clearScrollToDateTrigger),_=ee(E=>E.zoomTrigger),y=ee(E=>E.clearZoomTrigger),u=O(E=>E.timelineScrollLeft),w=O(E=>E.setTimelineScrollLeft),p=O(E=>E.showStaffOverview),x=O(E=>E.showEquipmentOverview),v=f.useRef(!1),C=f.useRef(null),N=f.useRef(i),b=f.useRef(a),B=f.useRef(null),M=f.useRef(0);Dl({containerRef:d,cellWidth:a});const L=p||x,{handleScroll:S,syncScrollPosition:P}=Bu("gantt-timeline",d,L),I=f.useCallback(()=>{const E=d.current;if(!E||t.length===0)return null;const $=E.scrollLeft,A=Math.floor($/a),R=t[Math.min(A,t.length-1)];return(R==null?void 0:R.dateStr)||null},[t,a]),D=f.useCallback(()=>{const E=d.current;if(!E||t.length===0)return null;const $=E.scrollLeft+E.clientWidth/2,A=Math.floor($/a),R=t[Math.min(A,t.length-1)];return(R==null?void 0:R.dateStr)||null},[t,a]),k=f.useCallback(E=>{const $=d.current;if(!$||t.length===0)return;let A=t.findIndex(H=>H.dateStr>=E);A===-1?A=t.length-1:A>0&&t[A].dateStr!==E&&(A=A-1);const R=A*a;$.scrollLeft=R},[t,a]),j=f.useCallback(E=>{const $=d.current;if(!$||t.length===0)return;let A=t.findIndex(F=>F.dateStr>=E);A===-1&&(A=t.length-1);const H=A*a+a/2-$.clientWidth/2;$.scrollLeft=Math.max(0,H)},[t,a]);f.useEffect(()=>{const E=d.current;!E||v.current||(u>0?requestAnimationFrame(()=>{E.scrollLeft=u,v.current=!0,B.current=I(),P(u)}):v.current=!0)},[u,I]),f.useEffect(()=>{if(!_||_.timestamp===M.current)return;M.current=_.timestamp;const E=d.current;if(!E){y();return}const $=D();y(),$&&requestAnimationFrame(()=>{j($),w(E.scrollLeft),P(E.scrollLeft)})},[_,y,D,j,w]),f.useEffect(()=>{N.current!==i&&v.current&&B.current&&requestAnimationFrame(()=>{k(B.current);const $=d.current;$&&(w($.scrollLeft),P($.scrollLeft))}),N.current=i,b.current=a},[i,a,k,w]);const T=f.useCallback(E=>{const $=d.current;!$||!v.current||(B.current=I(),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{w($.scrollLeft)},a6),S(E))},[w,I,S]);return f.useEffect(()=>{if(h===0)return;const E=d.current;if(!E)return;const $=t.findIndex(A=>A.isToday);if($!==-1){const A=E.clientWidth,R=$*a,H=Math.max(0,R-A/2+a/2);L?(E.scrollLeft=H,P(H)):E.scrollTo({left:H,behavior:"smooth"})}},[h,t,a,L,P]),f.useEffect(()=>{if(!m)return;const E=d.current;if(!E)return;const $=m.date;let A=t.findIndex(R=>R.dateStr>=$);if(A===-1&&(A=t.length-1),A!==-1){const R=E.clientWidth,H=A*a,F=Math.max(0,H-R/4);L?(E.scrollLeft=F,P(F)):E.scrollTo({left:F,behavior:"smooth"})}g()},[m,t,a,g,L,P]),f.useEffect(()=>()=>{C.current&&clearTimeout(C.current)},[]),s.jsx("div",{className:fc.timeline,children:s.jsx("div",{ref:d,className:fc.horizontalScroll,onScroll:T,children:s.jsxs("div",{className:fc.scrollContent,style:{width:c},children:[s.jsx(Ei,{headers:n,cells:t,cellWidth:a,totalWidth:c,viewMode:i,hasCustomColumns:o}),s.jsx(e6,{ref:l,cells:t,projects:r,cellWidth:a,totalWidth:c,viewMode:i})]})})})});function o6(e,t){const n=f.useCallback((r,a)=>{r==="project"&&t.current?t.current.scrollTop=a:r==="timeline"&&e.current&&(e.current.scrollTop=a)},[e,t]);f.useEffect(()=>{const r=e.current,a=t.current;if(!r||!a)return;let i=!1;const o=()=>{i||(i=!0,n("project",r.scrollTop),requestAnimationFrame(()=>{i=!1}))},l=()=>{i||(i=!0,n("timeline",a.scrollTop),requestAnimationFrame(()=>{i=!1}))};return r.addEventListener("scroll",o,{passive:!0}),a.addEventListener("scroll",l,{passive:!0}),()=>{r.removeEventListener("scroll",o),a.removeEventListener("scroll",l)}},[e,t,n])}const l6="_body_1qodq_3",c6="_content_1qodq_23",d6="_grid_1qodq_29",u6="_gridCell_1qodq_56",f6="_weekend_1qodq_64",h6="_holiday_1qodq_68",m6="_today_1qodq_72",p6="_rows_1qodq_78",g6="_staffWrapper_1qodq_84",_6="_bankHolidaysWrapper_1qodq_89",y6="_row_1qodq_78",v6="_bar_1qodq_100",x6="_vacationBar_1qodq_118",w6="_assignmentBar_1qodq_124",j6="_barLabel_1qodq_128",S6="_detailBar_1qodq_140",C6="_vacationDetailBar_1qodq_146",k6="_assignmentDetailBar_1qodq_151",b6="_holidayDetailBar_1qodq_155",N6="_customHolidayBar_1qodq_160",D6="_workloadCell_1qodq_166",$6="_overloaded_1qodq_176",E6="_vacation_1qodq_118",T6="_conflict_1qodq_182",M6="_workloadIndicator_1qodq_188",I6="_full_1qodq_203",P6="_partial_1qodq_208",je={body:l6,content:c6,grid:d6,gridCell:u6,weekend:f6,holiday:h6,today:m6,rows:p6,staffWrapper:g6,bankHolidaysWrapper:_6,row:y6,bar:v6,vacationBar:x6,assignmentBar:w6,barLabel:j6,detailBar:S6,vacationDetailBar:C6,assignmentDetailBar:k6,holidayDetailBar:b6,customHolidayBar:N6,workloadCell:D6,overloaded:$6,vacation:E6,conflict:T6,workloadIndicator:M6,full:I6,partial:P6},L6=f.forwardRef(function({staff:t,assignmentsMap:n,vacationsMap:r,rowHeights:a,expandedStaff:i,expandedBankHolidays:o,cells:l,cellWidth:c,totalWidth:d,viewMode:h},m){const g=O(p=>p.bankHolidays),_=O(p=>p.currentUser),y=h==="week"||h==="month",u=f.useMemo(()=>bl(l,c),[l,c]),w=p=>_?_.role==="admin"||_.role==="superuser"?!0:_.id===p:!1;return s.jsx("div",{ref:m,className:je.body,children:s.jsxs("div",{className:je.content,style:{width:d,"--cell-width":`${c}px`},children:[s.jsxs("div",{className:je.grid,children:[y&&l.map((p,x)=>p.isWeekend?s.jsx("div",{className:`${je.gridCell} ${je.weekend}`,style:{left:x*c,width:c}},`weekend-${x}`):null),y&&l.map((p,x)=>p.isBankHoliday?s.jsx("div",{className:`${je.gridCell} ${je.holiday}`,style:{left:x*c,width:c}},`holiday-${x}`):null),l.map((p,x)=>p.isToday?s.jsx("div",{className:`${je.gridCell} ${je.today}`,style:{left:x*c,width:c}},`today-${x}`):null)]}),u!==null&&s.jsx($l,{position:u}),s.jsxs("div",{className:je.rows,children:[t.map(p=>{const x=i.has(p.id),v=r.get(p.id)||[],C=n.get(p.id)||[],N=w(p.id);return s.jsxs("div",{className:je.staffWrapper,children:[s.jsx(A6,{staffMember:p,assignments:C,vacations:v,rowHeight:a.get(p.id)||44,cells:l,cellWidth:c,viewMode:h}),x&&s.jsxs(s.Fragment,{children:[v.map(b=>s.jsx(B6,{vacation:b,cells:l,cellWidth:c,viewMode:h},`v-${b.id}`)),N&&s.jsx("div",{className:je.row,style:{height:ds}}),C.map(b=>s.jsx(R6,{assignment:b,cells:l,cellWidth:c,viewMode:h},`a-${b.id}-${b.level}`)),C.length===0&&v.length===0&&!N&&s.jsx("div",{className:je.row,style:{height:ds}})]})]},p.id)}),s.jsx(O6,{isExpanded:o,holidays:g,cells:l,cellWidth:c,viewMode:h})]})]})})});function A6({assignments:e,vacations:t,rowHeight:n,cells:r,cellWidth:a,viewMode:i}){const{openVacationModal:o}=ee(),l=z2(e,t,r),c=i==="week"||i==="month",d=f.useMemo(()=>{const g=[];e.forEach(u=>{let w=u.projectName;u.phaseName&&(w+=` - ${u.phaseName}`),w+=` (${u.allocation}%)`,g.push({type:"assignment",id:u.id,startDate:u.start_date,endDate:u.end_date,label:w,allocation:u.allocation,data:u})}),t.forEach(u=>{g.push({type:"vacation",id:u.id,startDate:u.start_date,endDate:u.end_date,label:u.description||"Vacation",data:u})}),g.sort((u,w)=>u.startDate.localeCompare(w.startDate));const _=[];g.forEach(u=>{let w=!1;for(const p of _)if(u.startDate>p.end){p.end=u.endDate,p.items.push(u),w=!0;break}w||_.push({end:u.endDate,items:[u]})});const y=[];return _.forEach((u,w)=>{u.items.forEach(p=>{const x=sn(p.startDate,p.endDate,r,a,i);x&&y.push({type:p.type,id:p.id,left:x.left,width:x.width,top:Sd+w*(jd+__),label:p.label,allocation:p.allocation,data:p.data})})}),y},[e,t,r,a,i]),h=g=>{g.type==="vacation"&&o(g.data)},m=n-Cd;return s.jsxs("div",{className:je.row,style:{height:n},children:[c&&l.map((g,_)=>g.total===0&&!g.isOnVacation?null:s.jsx("div",{className:`${je.workloadCell} ${je[g.state]}`,style:{left:_*a,width:a,top:m,height:Cd,...q2(g)},title:H2(g),children:s.jsx("div",{className:`${je.workloadIndicator} ${je[g.state]}`,children:g.state==="vacation"?"OFF":g.state==="conflict"?"0%":`${g.total}%`})},`workload-${_}`)),d.map((g,_)=>s.jsx("div",{className:`${je.bar} ${g.type==="vacation"?je.vacationBar:je.assignmentBar}`,style:{left:g.left,width:g.width,top:g.top,height:jd},title:g.label,onClick:()=>h(g),children:s.jsx("span",{className:je.barLabel,children:g.label})},`${g.type}-${g.id}-${_}`))]})}function B6({vacation:e,cells:t,cellWidth:n,viewMode:r}){const a=f.useMemo(()=>sn(e.start_date,e.end_date,t,n,r),[e,t,n,r]);return a?s.jsx("div",{className:je.row,style:{height:ds},children:s.jsx("div",{className:`${je.detailBar} ${je.vacationDetailBar}`,style:{left:a.left,width:a.width,height:20,top:6},title:e.description||"Vacation"})}):s.jsx("div",{className:je.row,style:{height:ds}})}function R6({assignment:e,cells:t,cellWidth:n,viewMode:r}){const a=f.useMemo(()=>sn(e.start_date,e.end_date,t,n,r),[e,t,n,r]);return a?s.jsx("div",{className:je.row,style:{height:ds},children:s.jsx("div",{className:`${je.detailBar} ${je.assignmentDetailBar}`,style:{left:a.left,width:a.width,height:20,top:6},title:`${e.projectName} (${e.allocation}%)`})}):s.jsx("div",{className:je.row,style:{height:ds}})}function O6({isExpanded:e,holidays:t,cells:n,cellWidth:r,viewMode:a}){const o=O(c=>c.currentUser),l=(o==null?void 0:o.role)==="admin"||(o==null?void 0:o.role)==="superuser";return s.jsxs("div",{className:je.bankHolidaysWrapper,children:[s.jsx("div",{className:je.row,style:{height:44}}),e&&s.jsxs(s.Fragment,{children:[t.map(c=>{const d=sn(c.date,c.end_date||c.date,n,r,a);return s.jsx("div",{className:je.row,style:{height:ds},children:d&&s.jsx("div",{className:`${je.detailBar} ${je.holidayDetailBar} ${c.is_custom?je.customHolidayBar:""}`,style:{left:d.left,width:d.width,height:20,top:6},title:c.name})},c.id)}),t.length===0&&s.jsx("div",{className:je.row,style:{height:ds}}),l&&s.jsx("div",{className:je.row,style:{height:ds}})]})]})}const F6="_container_16nlz_3",z6="_embedded_16nlz_11",H6="_panel_16nlz_19",q6="_panelHeader_16nlz_32",W6="_headerLeft_16nlz_48",V6="_headerTitle_16nlz_54",U6="_headerCount_16nlz_60",G6="_panelBody_16nlz_68",Y6="_empty_16nlz_88",Q6="_staffWrapper_16nlz_100",X6="_bankHolidaysWrapper_16nlz_105",K6="_staffRow_16nlz_111",Z6="_draggable_16nlz_125",J6="_dragHandle_16nlz_134",eL="_expandIcon_16nlz_152",tL="_expanded_16nlz_163",nL="_status_16nlz_167",sL="_available_16nlz_174",rL="_overloaded_16nlz_178",aL="_staffInfo_16nlz_182",iL="_staffName_16nlz_188",oL="_staffMeta_16nlz_197",lL="_overloadedText_16nlz_202",cL="_rowActions_16nlz_207",dL="_iconBtn_16nlz_214",uL="_expandedContent_16nlz_236",fL="_detailRow_16nlz_241",hL="_clickable_16nlz_255",mL="_detailType_16nlz_264",pL="_vacation_16nlz_273",gL="_allocation_16nlz_278",_L="_bankHoliday_16nlz_105",yL="_detailName_16nlz_290",vL="_dateBadge_16nlz_298",xL="_deleteBtn_16nlz_304",wL="_addRow_16nlz_325",jL="_addIcon_16nlz_334",SL="_addText_16nlz_343",CL="_vacationRow_16nlz_348",kL="_customHoliday_16nlz_353",bL="_deleteAction_16nlz_358",NL="_bankHolidaysRow_16nlz_385",DL="_bankHolidayStatus_16nlz_390",$L="_noAssignments_16nlz_394",EL="_timeline_16nlz_400",TL="_timelineScroll_16nlz_408",ML="_timelineContent_16nlz_430",IL="_timelineHeaderSpacer_16nlz_438",PL="_confirmOverlay_16nlz_446",LL="_confirmModal_16nlz_460",AL="_confirmIcon_16nlz_470",BL="_confirmTitle_16nlz_482",RL="_confirmText_16nlz_489",OL="_confirmWarning_16nlz_500",FL="_confirmActions_16nlz_506",zL="_confirmCancel_16nlz_512",HL="_confirmDelete_16nlz_513",qL="_filterWrapper_16nlz_552",WL="_filterTrigger_16nlz_556",VL="_hasFilters_16nlz_577",UL="_filterLabel_16nlz_588",GL="_chevron_16nlz_595",YL="_open_16nlz_600",QL="_filterDropdown_16nlz_604",XL="_filterActions_16nlz_633",KL="_filterActionBtn_16nlz_641",ZL="_filterColumns_16nlz_660",JL="_filterColumn_16nlz_660",eA="_filterSectionTitle_16nlz_683",tA="_filterOptions_16nlz_694",nA="_filterOption_16nlz_694",sA="_filterCheckboxInput_16nlz_727",rA="_filterCheckbox_16nlz_727",aA="_checkIcon_16nlz_748",iA="_filterOptionText_16nlz_773",oA="_skillDot_16nlz_781",lA="_filterEmptyColumn_16nlz_795",Y={container:F6,embedded:z6,panel:H6,panelHeader:q6,headerLeft:W6,headerTitle:V6,headerCount:U6,panelBody:G6,empty:Y6,staffWrapper:Q6,bankHolidaysWrapper:X6,staffRow:K6,draggable:Z6,dragHandle:J6,expandIcon:eL,expanded:tL,status:nL,available:sL,overloaded:rL,staffInfo:aL,staffName:iL,staffMeta:oL,overloadedText:lL,rowActions:cL,iconBtn:dL,expandedContent:uL,detailRow:fL,clickable:hL,detailType:mL,vacation:pL,allocation:gL,bankHoliday:_L,detailName:yL,dateBadge:vL,deleteBtn:xL,addRow:wL,addIcon:jL,addText:SL,vacationRow:CL,customHoliday:kL,deleteAction:bL,bankHolidaysRow:NL,bankHolidayStatus:DL,noAssignments:$L,timeline:EL,timelineScroll:TL,timelineContent:ML,timelineHeaderSpacer:IL,confirmOverlay:PL,confirmModal:LL,confirmIcon:AL,confirmTitle:BL,confirmText:RL,confirmWarning:OL,confirmActions:FL,confirmCancel:zL,confirmDelete:HL,filterWrapper:qL,filterTrigger:WL,hasFilters:VL,filterLabel:UL,chevron:GL,open:YL,filterDropdown:QL,filterActions:XL,filterActionBtn:KL,filterColumns:ZL,filterColumn:JL,filterSectionTitle:eA,filterOptions:tA,filterOption:nA,filterCheckboxInput:sA,filterCheckbox:rA,checkIcon:aA,filterOptionText:iA,skillDot:oA,filterEmptyColumn:lA};function cA({isExpanded:e,onToggle:t}){const n=O(_=>_.currentSite),r=O(_=>_.currentUser),a=O(_=>_.bankHolidays),i=O(_=>_.setBankHolidays),{openModal:o}=ee(),l=(r==null?void 0:r.role)==="admin"||(r==null?void 0:r.role)==="superuser",c=a.reduce((_,y)=>{const u=y.year||new Date(y.date).getFullYear();return _[u]||(_[u]=[]),_[u].push(y),_},{}),d=_=>new Date(_).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}),h=()=>{if(a.length===0)return;const _=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Milestone//Bank Holidays//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH"];a.forEach(p=>{const x=p.date.replace(/-/g,""),v=new Date(p.end_date||p.date);v.setDate(v.getDate()+1);const C=v.toISOString().split("T")[0].replace(/-/g,"");_.push("BEGIN:VEVENT"),_.push(`UID:bankholiday-${p.id}@milestone`),_.push(`DTSTART;VALUE=DATE:${x}`),_.push(`DTEND;VALUE=DATE:${C}`),_.push(`SUMMARY:${p.name.replace(/,/g,"\\,")}`),_.push("TRANSP:TRANSPARENT"),_.push("END:VEVENT")}),_.push("END:VCALENDAR");const y=new Blob([_.join(`\r
`)],{type:"text/calendar"}),u=URL.createObjectURL(y),w=document.createElement("a");w.href=u,w.download=`bank-holidays-${(n==null?void 0:n.name)||"site"}.ics`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(u)},m=()=>{o("customHoliday")},g=async _=>{if(n&&confirm("Delete this custom holiday?"))try{await Pg(n.id,_);const y=await Vs(n.id),u=Kn(y);i(y,u)}catch(y){console.error("Failed to delete custom holiday:",y),alert("Failed to delete custom holiday")}};return s.jsxs("div",{className:Y.bankHolidaysWrapper,children:[s.jsxs("div",{className:`${Y.staffRow} ${Y.bankHolidaysRow} ${t?"":Y.noExpand}`,onClick:t,style:{cursor:t?"pointer":"default"},children:[t&&s.jsx("div",{className:`${Y.expandIcon} ${e?Y.expanded:""}`,children:s.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"9 18 15 12 9 6"})})}),s.jsx("div",{className:`${Y.status} ${Y.bankHolidayStatus}`}),s.jsxs("div",{className:Y.staffInfo,children:[s.jsx("div",{className:Y.staffName,children:"Bank Holidays"}),s.jsxs("div",{className:Y.staffMeta,children:[s.jsx("span",{children:(n==null?void 0:n.name)||"Site"}),s.jsx("span",{children:"  "}),s.jsxs("span",{children:[a.length," holidays"]})]})]}),s.jsxs("div",{className:Y.rowActions,onClick:_=>_.stopPropagation(),children:[s.jsx("button",{className:Y.iconBtn,onClick:h,title:"Export to Outlook",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),s.jsx("polyline",{points:"7 10 12 15 17 10"}),s.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})}),l&&s.jsx("button",{className:Y.iconBtn,onClick:m,title:"Add custom holiday",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})]})]}),e&&s.jsxs("div",{className:Y.expandedContent,children:[Object.keys(c).sort().map(_=>c[Number(_)].map(y=>{const u=y.end_date&&y.end_date!==y.date?`${d(y.date)} - ${d(y.end_date)}`:d(y.date);return s.jsxs("div",{className:`${Y.detailRow} ${y.is_custom?Y.customHoliday:""}`,children:[s.jsx("span",{className:`${Y.detailType} ${Y.bankHoliday}`,children:y.is_custom?"Custom":"Holiday"}),s.jsx("span",{className:Y.detailName,children:y.name}),s.jsx("span",{className:Y.dateBadge,children:u}),l&&y.is_custom&&s.jsx("button",{className:Y.deleteAction,onClick:w=>{w.stopPropagation(),g(y.id)},title:"Delete custom holiday",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},y.id)})),a.length===0&&s.jsx("div",{className:Y.detailRow,children:s.jsx("span",{className:Y.noAssignments,children:"No holidays loaded"})}),l&&s.jsxs("div",{className:`${Y.detailRow} ${Y.addRow}`,onClick:m,children:[s.jsx("span",{className:Y.addIcon,children:s.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),s.jsx("span",{className:Y.addText,children:"Add custom holiday"})]})]})]})}const Wh=44,ds=32,jd=14,__=2,Sd=4,Cd=18;function y_({embedded:e=!1,panelWidth:t,height:n}){const r=f.useRef(null),a=f.useRef(null),i=f.useRef(null),o=f.useRef(null),l=O(U=>U.staff),c=O(U=>U.projects),d=O(U=>U.vacations),h=O(U=>U.setVacations),m=O(U=>U.currentSite),g=O(U=>U.currentUser),_=O(U=>U.skills),y=O(U=>U.viewMode),u=O(U=>U.currentDate),w=O(U=>U.cellWidth),p=O(U=>U.bankHolidayDates),x=O(U=>U.bankHolidays),{openVacationModal:v}=ee(),C=ee(U=>U.scrollToTodayTrigger),{handleDragStart:N,handleDragEnd:b}=a_();Dl({containerRef:i,cellWidth:w,enabled:!e});const{handleScroll:B}=Bu("staff-view",i,e),[M,L]=f.useState(new Set),[S,P]=f.useState(!1),[I,D]=f.useState(new Set),[k,j]=f.useState(new Set),[T,E]=f.useState(!1),[$,A]=f.useState(null),[R,H]=f.useState(!1);Nl(r,a);const F=f.useMemo(()=>l.filter(U=>U.site_id===(m==null?void 0:m.id)&&U.active!==!1).sort((U,de)=>U.name.localeCompare(de.name)),[l,m]),V=f.useMemo(()=>{const U=new Set;return F.forEach(de=>{de.role&&U.add(de.role)}),Array.from(U).sort((de,_e)=>de.localeCompare(_e))},[F]),Q=f.useMemo(()=>{let U=F;return I.size>0&&(U=U.filter(de=>de.role&&I.has(de.role))),k.size>0&&(U=U.filter(de=>{var _e;return(_e=de.skills)==null?void 0:_e.some(Nt=>k.has(Nt.id))})),U},[F,I,k]);f.useEffect(()=>{const U=de=>{o.current&&!o.current.contains(de.target)&&E(!1)};return T&&document.addEventListener("mousedown",U),()=>{document.removeEventListener("mousedown",U)}},[T]);const X=U=>{D(de=>{const _e=new Set(de);return _e.has(U)?_e.delete(U):_e.add(U),_e})},Z=U=>{j(de=>{const _e=new Set(de);return _e.has(U)?_e.delete(U):_e.add(U),_e})},ce=()=>{D(new Set),j(new Set)},K=I.size>0||k.size>0,fe=f.useMemo(()=>Ni(u,y,p,x),[u,y,p,x]),ae=f.useMemo(()=>Di(fe,y),[fe,y]),z=fe.length*w;f.useEffect(()=>{if(e||!C||!i.current)return;const U=fe.findIndex(Ke=>Ke.isToday);if(U===-1)return;const de=i.current,_e=de.clientWidth,Nt=U*w,Fe=Math.max(0,Nt-_e/2+w/2);de.scrollTo({left:Fe,behavior:"smooth"})},[e,C,fe,w]);const ue=f.useMemo(()=>{const U=new Map;return Q.forEach(de=>U.set(de.id,[])),c.forEach(de=>{var _e,Nt;de.archived||((_e=de.staffAssignments)==null||_e.forEach(Fe=>{const Ke=U.get(Fe.staff_id)||[];Ke.push({...Fe,projectName:de.name,projectId:de.id,level:"project"}),U.set(Fe.staff_id,Ke)}),(Nt=de.phases)==null||Nt.forEach(Fe=>{var Ke,pn;(Ke=Fe.staffAssignments)==null||Ke.forEach(Te=>{const nr=U.get(Te.staff_id)||[];nr.push({...Te,start_date:Te.start_date||Fe.start_date,end_date:Te.end_date||Fe.end_date,projectName:de.name,projectId:de.id,phaseName:Fe.name,phaseId:Fe.id,level:"phase"}),U.set(Te.staff_id,nr)}),(pn=Fe.children)==null||pn.forEach(Te=>{var nr;(nr=Te.staffAssignments)==null||nr.forEach(wa=>{const Ru=U.get(wa.staff_id)||[];Ru.push({...wa,start_date:wa.start_date||Te.start_date,end_date:wa.end_date||Te.end_date,projectName:de.name,projectId:de.id,phaseName:Fe.name,phaseId:Fe.id,subphaseName:Te.name,subphaseId:Te.id,level:"subphase"}),U.set(wa.staff_id,Ru)})})}))}),U},[c,Q]),Le=f.useMemo(()=>{const U=new Map;return Q.forEach(de=>U.set(de.id,[])),d.forEach(de=>{const _e=U.get(de.staff_id)||[];_e.push(de),U.set(de.staff_id,_e)}),U},[d,Q]),q=f.useMemo(()=>{const U=new Map;return Q.forEach(de=>{const _e=ue.get(de.id)||[],Nt=Le.get(de.id)||[],Fe=dA(_e,Nt),pn=(Fe>0?Sd+(jd+__)*Fe:0)+Cd+Sd;U.set(de.id,Math.max(Wh,pn))}),U},[Q,ue,Le]),te=(U,de)=>{const _e=new Date;_e.setHours(12,0,0,0);const Nt=new Date(U);Nt.setHours(0,0,0,0);const Fe=new Date(de);return Fe.setHours(23,59,59,999),_e>=Nt&&_e<=Fe},he=U=>(Le.get(U)||[]).some(Ke=>te(Ke.start_date,Ke.end_date))?0:100-(ue.get(U)||[]).filter(Ke=>Ke.start_date&&Ke.end_date&&te(Ke.start_date,Ke.end_date)).reduce((Ke,pn)=>Ke+(pn.allocation||0),0),Ee=f.useCallback(U=>{L(de=>{const _e=new Set(de);return _e.has(U)?_e.delete(U):_e.add(U),_e})},[]),ne=f.useCallback(U=>g?g.role==="admin"||g.role==="superuser"?!0:g.id===U:!1,[g]),ke=(g==null?void 0:g.role)==="admin"||(g==null?void 0:g.role)==="superuser",Ht=(U,de)=>{const _e=new Date(U),Nt=new Date(de),Fe=Ke=>Ke.toLocaleDateString("en-GB",{day:"numeric",month:"short"});return U===de?Fe(_e):`${Fe(_e)} - ${Fe(Nt)}`},bt=f.useCallback((U,de,_e)=>{A({vacationId:U,staffName:de,description:_e})},[]),Ti=f.useCallback(async()=>{if($){H(!0);try{await rx($.vacationId);const U=await Nu();h(U),A(null)}catch(U){console.error("Failed to delete vacation:",U)}finally{H(!1)}}},[$,h]),tr=f.useCallback(()=>{A(null)},[]),w_=e&&t?{width:t}:void 0,j_=e&&n?{height:n}:void 0,S_=()=>{const U=I.size+k.size;return U===0?"Filter":`${U} filter${U>1?"s":""}`};return s.jsxs("div",{className:`${Y.container} ${e?Y.embedded:""}`,style:j_,children:[s.jsxs("div",{className:Y.panel,style:w_,children:[s.jsxs("div",{className:Y.panelHeader,children:[s.jsxs("div",{className:Y.headerLeft,children:[s.jsx("span",{className:Y.headerTitle,children:"Staff Overview"}),s.jsxs("span",{className:Y.headerCount,children:[Q.length,K?`/${F.length}`:""]})]}),s.jsxs("div",{ref:o,className:Y.filterWrapper,children:[s.jsxs("button",{className:`${Y.filterTrigger} ${K?Y.hasFilters:""}`,onClick:()=>E(!T),"aria-expanded":T,"aria-haspopup":"true",children:[s.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),s.jsx("span",{className:Y.filterLabel,children:S_()}),s.jsx("svg",{className:`${Y.chevron} ${T?Y.open:""}`,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),T&&s.jsxs("div",{className:Y.filterDropdown,children:[K&&s.jsx("div",{className:Y.filterActions,children:s.jsx("button",{className:Y.filterActionBtn,onClick:ce,children:"Clear all filters"})}),s.jsxs("div",{className:Y.filterColumns,children:[s.jsxs("div",{className:Y.filterColumn,children:[s.jsx("div",{className:Y.filterSectionTitle,children:"Roles"}),s.jsx("div",{className:Y.filterOptions,children:V.length>0?V.map(U=>s.jsxs("label",{className:Y.filterOption,children:[s.jsx("input",{type:"checkbox",className:Y.filterCheckboxInput,checked:I.has(U),onChange:()=>X(U)}),s.jsx("span",{className:Y.filterCheckbox,children:s.jsx("svg",{className:Y.checkIcon,width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})})}),s.jsx("span",{className:Y.filterOptionText,children:U})]},U)):s.jsx("div",{className:Y.filterEmptyColumn,children:"No roles defined"})})]}),s.jsxs("div",{className:Y.filterColumn,children:[s.jsx("div",{className:Y.filterSectionTitle,children:"Skills"}),s.jsx("div",{className:Y.filterOptions,children:_.length>0?_.map(U=>s.jsxs("label",{className:Y.filterOption,children:[s.jsx("input",{type:"checkbox",className:Y.filterCheckboxInput,checked:k.has(U.id),onChange:()=>Z(U.id)}),s.jsx("span",{className:Y.filterCheckbox,children:s.jsx("svg",{className:Y.checkIcon,width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})})}),s.jsxs("span",{className:Y.filterOptionText,style:{display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx("span",{className:Y.skillDot,style:{backgroundColor:U.color}}),U.name]})]},U.id)):s.jsx("div",{className:Y.filterEmptyColumn,children:"No skills defined"})})]})]})]})]})]}),s.jsxs("div",{className:Y.panelBody,ref:r,children:[Q.length===0?s.jsx("div",{className:Y.empty,children:s.jsx("p",{children:"No staff found"})}):Q.map(U=>{const de=he(U.id),_e=q.get(U.id)||Wh,Nt=M.has(U.id),Fe=Le.get(U.id)||[],Ke=ue.get(U.id)||[],pn=ne(U.id);return s.jsxs("div",{className:Y.staffWrapper,children:[s.jsxs("div",{className:`${Y.staffRow} ${ke?Y.draggable:""}`,style:{height:_e},onClick:()=>Ee(U.id),draggable:ke,onDragStart:ke?Te=>{Te.stopPropagation(),N(Te,"staff",U.id,U.name)}:void 0,onDragEnd:ke?b:void 0,children:[ke&&s.jsx("div",{className:Y.dragHandle,title:"Drag to assign",children:s.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:[s.jsx("circle",{cx:"9",cy:"5",r:"2"}),s.jsx("circle",{cx:"9",cy:"12",r:"2"}),s.jsx("circle",{cx:"9",cy:"19",r:"2"}),s.jsx("circle",{cx:"15",cy:"5",r:"2"}),s.jsx("circle",{cx:"15",cy:"12",r:"2"}),s.jsx("circle",{cx:"15",cy:"19",r:"2"})]})}),s.jsx("div",{className:`${Y.expandIcon} ${Nt?Y.expanded:""}`,children:s.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"9 18 15 12 9 6"})})}),s.jsx("div",{className:`${Y.status} ${de>0?Y.available:Y.overloaded}`}),s.jsxs("div",{className:Y.staffInfo,children:[s.jsx("div",{className:Y.staffName,children:U.name}),s.jsxs("div",{className:Y.staffMeta,children:[s.jsx("span",{children:U.role||"No title"}),s.jsx("span",{children:"  "}),s.jsxs("span",{className:de<=0?Y.overloadedText:"",children:[de,"% available"]})]})]})]}),Nt&&s.jsxs("div",{className:Y.expandedContent,children:[Fe.map(Te=>s.jsxs("div",{className:`${Y.detailRow} ${pn?Y.clickable:""} ${Y.vacationRow}`,onClick:pn?()=>v(Te,U.id):void 0,children:[s.jsx("span",{className:`${Y.detailType} ${Y.vacation}`,children:"Vacation"}),s.jsx("span",{className:Y.detailName,children:Te.description||"Time Off"}),s.jsx("span",{className:Y.dateBadge,children:Ht(Te.start_date,Te.end_date)}),pn&&s.jsx("span",{className:Y.deleteBtn,onClick:nr=>{nr.stopPropagation(),bt(Te.id,U.name,Te.description||"Time Off")},title:"Delete vacation",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},`v-${Te.id}`)),pn&&s.jsxs("div",{className:`${Y.detailRow} ${Y.addRow}`,onClick:()=>v(void 0,U.id),children:[s.jsx("span",{className:Y.addIcon,children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),s.jsx("span",{className:Y.addText,children:"Add vacation / time off"})]}),Ke.map(Te=>s.jsxs("div",{className:`${Y.detailRow} ${Y.clickable}`,children:[s.jsxs("span",{className:`${Y.detailType} ${Y.allocation}`,children:[Te.allocation,"%"]}),s.jsxs("span",{className:Y.detailName,children:[Te.projectName,Te.phaseName&&`  ${Te.phaseName}`]}),s.jsx("span",{className:Y.dateBadge,children:Ht(Te.start_date,Te.end_date)})]},`a-${Te.id}-${Te.level}`)),Ke.length===0&&Fe.length===0&&!pn&&s.jsx("div",{className:Y.detailRow,children:s.jsx("span",{className:Y.noAssignments,children:"No assignments"})})]})]},U.id)}),s.jsx(cA,{isExpanded:e?!1:S,onToggle:e?void 0:()=>P(!S)})]})]}),s.jsxs("div",{className:Y.timeline,children:[e&&s.jsx("div",{className:Y.timelineHeaderSpacer}),s.jsx("div",{className:Y.timelineScroll,ref:i,onScroll:B,children:s.jsxs("div",{className:Y.timelineContent,style:{width:z},children:[!e&&s.jsx(Ei,{headers:ae,cells:fe,cellWidth:w,totalWidth:z,viewMode:y}),s.jsx(L6,{ref:a,staff:Q,assignmentsMap:ue,vacationsMap:Le,rowHeights:q,expandedStaff:M,expandedBankHolidays:e?!1:S,cells:fe,cellWidth:w,totalWidth:z,viewMode:y})]})})]}),$&&s.jsx("div",{className:Y.confirmOverlay,onClick:tr,children:s.jsxs("div",{className:Y.confirmModal,onClick:U=>U.stopPropagation(),children:[s.jsx("div",{className:Y.confirmIcon,children:s.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M3 6h18"}),s.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),s.jsx("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),s.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),s.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})}),s.jsx("h3",{className:Y.confirmTitle,children:"Delete Vacation"}),s.jsxs("p",{className:Y.confirmText,children:["Are you sure you want to delete ",s.jsx("strong",{children:$.description})," for ",s.jsx("strong",{children:$.staffName}),"?"]}),s.jsx("p",{className:Y.confirmWarning,children:"This action cannot be undone."}),s.jsxs("div",{className:Y.confirmActions,children:[s.jsx("button",{className:Y.confirmCancel,onClick:tr,disabled:R,children:"Cancel"}),s.jsx("button",{className:Y.confirmDelete,onClick:Ti,disabled:R,children:R?"Deleting...":"Delete"})]})]})})]})}function dA(e,t){if(e.length===0&&t.length===0)return 0;const n=[...e.map(o=>({start:o.start_date,end:o.end_date})),...t.map(o=>({start:o.start_date,end:o.end_date}))];if(n.length===0)return 0;const r=[];n.forEach(o=>{o.start&&o.end&&(r.push({date:o.start,type:"start"}),r.push({date:o.end,type:"end"}))}),r.sort((o,l)=>o.date!==l.date?o.date.localeCompare(l.date):o.type==="start"?-1:1);let a=0,i=0;return r.forEach(o=>{o.type==="start"?(i++,a=Math.max(a,i)):i--}),a}const uA="_body_jm4k4_3",fA="_content_jm4k4_23",hA="_grid_jm4k4_29",mA="_gridCell_jm4k4_56",pA="_weekend_jm4k4_64",gA="_holiday_jm4k4_68",_A="_today_jm4k4_72",yA="_rows_jm4k4_78",vA="_row_jm4k4_78",xA="_bookingBar_jm4k4_91",wA="_barLabel_jm4k4_112",on={body:uA,content:fA,grid:hA,gridCell:mA,weekend:pA,holiday:gA,today:_A,rows:yA,row:vA,bookingBar:xA,barLabel:wA},jA=f.forwardRef(function({equipment:t,bookingsMap:n,cells:r,cellWidth:a,totalWidth:i,viewMode:o},l){const c=o==="week"||o==="month",d=f.useMemo(()=>bl(r,a),[r,a]);return s.jsx("div",{ref:l,className:on.body,children:s.jsxs("div",{className:on.content,style:{width:i,"--cell-width":`${a}px`},children:[s.jsxs("div",{className:on.grid,children:[c&&r.map((h,m)=>h.isWeekend?s.jsx("div",{className:`${on.gridCell} ${on.weekend}`,style:{left:m*a,width:a}},`weekend-${m}`):null),c&&r.map((h,m)=>h.isBankHoliday?s.jsx("div",{className:`${on.gridCell} ${on.holiday}`,style:{left:m*a,width:a}},`holiday-${m}`):null),r.map((h,m)=>h.isToday?s.jsx("div",{className:`${on.gridCell} ${on.today}`,style:{left:m*a,width:a}},`today-${m}`):null)]}),d!==null&&s.jsx($l,{position:d}),s.jsx("div",{className:on.rows,children:t.map(h=>s.jsx(SA,{equipment:h,bookings:n.get(h.id)||[],cells:r,cellWidth:a,viewMode:o},h.id))})]})})});function SA({bookings:e,cells:t,cellWidth:n,viewMode:r}){const a=f.useMemo(()=>e.map(i=>{const o=sn(i.start_date,i.end_date,t,n,r);return o?{...i,left:o.left,width:o.width}:null}).filter(Boolean),[e,t,n,r]);return s.jsx("div",{className:on.row,children:a.map(i=>i&&s.jsx("div",{className:on.bookingBar,style:{left:i.left,width:i.width},title:`${i.projectName}${i.phaseName?` - ${i.phaseName}`:""}`,children:s.jsx("span",{className:on.barLabel,children:i.projectName})},`booking-${i.id}`))})}const CA="_container_1pq1a_3",kA="_embedded_1pq1a_11",bA="_panel_1pq1a_19",NA="_panelHeader_1pq1a_32",DA="_headerLeft_1pq1a_48",$A="_headerTitle_1pq1a_54",EA="_headerCount_1pq1a_60",TA="_filterWrapper_1pq1a_69",MA="_filterTrigger_1pq1a_73",IA="_hasFilters_1pq1a_94",PA="_filterLabel_1pq1a_105",LA="_chevron_1pq1a_112",AA="_open_1pq1a_117",BA="_filterDropdown_1pq1a_121",RA="_filterActions_1pq1a_146",OA="_filterActionBtn_1pq1a_152",FA="_filterDivider_1pq1a_171",zA="_filterOptions_1pq1a_176",HA="_filterOption_1pq1a_176",qA="_filterCheckboxInput_1pq1a_208",WA="_filterCheckbox_1pq1a_208",VA="_checkIcon_1pq1a_229",UA="_filterOptionText_1pq1a_254",GA="_panelBody_1pq1a_262",YA="_empty_1pq1a_282",QA="_equipmentRow_1pq1a_294",XA="_draggable_1pq1a_308",KA="_dragHandle_1pq1a_317",ZA="_status_1pq1a_334",JA="_available_1pq1a_341",e5="_booked_1pq1a_345",t5="_equipmentInfo_1pq1a_349",n5="_equipmentName_1pq1a_355",s5="_equipmentMeta_1pq1a_364",r5="_timeline_1pq1a_370",a5="_timelineScroll_1pq1a_378",i5="_timelineContent_1pq1a_400",o5="_timelineHeaderSpacer_1pq1a_427",xe={container:CA,embedded:kA,panel:bA,panelHeader:NA,headerLeft:DA,headerTitle:$A,headerCount:EA,filterWrapper:TA,filterTrigger:MA,hasFilters:IA,filterLabel:PA,chevron:LA,open:AA,filterDropdown:BA,filterActions:RA,filterActionBtn:OA,filterDivider:FA,filterOptions:zA,filterOption:HA,filterCheckboxInput:qA,filterCheckbox:WA,checkIcon:VA,filterOptionText:UA,panelBody:GA,empty:YA,equipmentRow:QA,draggable:XA,dragHandle:KA,status:ZA,available:JA,booked:e5,equipmentInfo:t5,equipmentName:n5,equipmentMeta:s5,timeline:r5,timelineScroll:a5,timelineContent:i5,timelineHeaderSpacer:o5};function v_({embedded:e=!1,panelWidth:t,height:n}){const r=f.useRef(null),a=f.useRef(null),i=f.useRef(null),o=f.useRef(null),l=O(F=>F.equipment),c=O(F=>F.projects),d=O(F=>F.currentSite),h=O(F=>F.viewMode),m=O(F=>F.currentDate),g=O(F=>F.cellWidth),_=O(F=>F.bankHolidayDates),y=O(F=>F.bankHolidays),u=ee(F=>F.scrollToTodayTrigger),w=O(F=>F.currentUser),{handleDragStart:p,handleDragEnd:x}=a_(),v=(w==null?void 0:w.role)==="admin"||(w==null?void 0:w.role)==="superuser";Dl({containerRef:i,cellWidth:g,enabled:!e});const{handleScroll:C}=Bu("equipment-view",i,e),[N,b]=f.useState(new Set),[B,M]=f.useState(!1);Nl(r,a);const L=f.useMemo(()=>l.filter(F=>F.site_id===(d==null?void 0:d.id)).sort((F,V)=>F.name.localeCompare(V.name)),[l,d]),S=f.useMemo(()=>{const F=new Set;return L.forEach(V=>{V.type&&F.add(V.type)}),Array.from(F).sort((V,Q)=>V.localeCompare(Q))},[L]),P=f.useMemo(()=>N.size===0?L:L.filter(F=>F.type&&N.has(F.type)),[L,N]);f.useEffect(()=>{const F=V=>{o.current&&!o.current.contains(V.target)&&M(!1)};return B&&document.addEventListener("mousedown",F),()=>{document.removeEventListener("mousedown",F)}},[B]);const I=F=>{b(V=>{const Q=new Set(V);return Q.has(F)?Q.delete(F):Q.add(F),Q})},D=()=>{b(new Set(S))},k=()=>{b(new Set)},j=f.useMemo(()=>Ni(m,h,_,y),[m,h,_,y]),T=f.useMemo(()=>Di(j,h),[j,h]),E=j.length*g;f.useEffect(()=>{if(e||!u||!i.current)return;const F=j.findIndex(ce=>ce.isToday);if(F===-1)return;const V=i.current,Q=V.clientWidth,X=F*g,Z=Math.max(0,X-Q/2+g/2);V.scrollTo({left:Z,behavior:"smooth"})},[e,u,j,g]);const $=f.useMemo(()=>{const F=new Map;return P.forEach(V=>F.set(V.id,[])),c.forEach(V=>{var Q,X;V.archived||((Q=V.equipmentAssignments)==null||Q.forEach(Z=>{const ce=F.get(Z.equipment_id)||[];ce.push({...Z,projectName:V.name,projectId:V.id,level:"project"}),F.set(Z.equipment_id,ce)}),(X=V.phases)==null||X.forEach(Z=>{var ce;(ce=Z.equipmentAssignments)==null||ce.forEach(K=>{const fe=F.get(K.equipment_id)||[];fe.push({...K,start_date:K.start_date||Z.start_date,end_date:K.end_date||Z.end_date,projectName:V.name,projectId:V.id,phaseName:Z.name,phaseId:Z.id,level:"phase"}),F.set(K.equipment_id,fe)})}))}),F},[c,P]),A=F=>($.get(F)||[]).length>0?100:0,R=e&&t?{width:t}:void 0,H=e&&n?{height:n}:void 0;return s.jsxs("div",{className:`${xe.container} ${e?xe.embedded:""}`,style:H,children:[s.jsxs("div",{className:xe.panel,style:R,children:[s.jsxs("div",{className:xe.panelHeader,children:[s.jsxs("div",{className:xe.headerLeft,children:[s.jsx("span",{className:xe.headerTitle,children:"Equipment Overview"}),s.jsx("span",{className:xe.headerCount,children:P.length})]}),S.length>0&&s.jsxs("div",{ref:o,className:xe.filterWrapper,children:[s.jsxs("button",{className:`${xe.filterTrigger} ${N.size>0?xe.hasFilters:""}`,onClick:()=>M(!B),"aria-expanded":B,"aria-haspopup":"true",children:[s.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),s.jsx("span",{className:xe.filterLabel,children:N.size===0?"All Types":N.size===1?Array.from(N)[0]:`${N.size} types`}),s.jsx("svg",{className:`${xe.chevron} ${B?xe.open:""}`,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),B&&s.jsxs("div",{className:xe.filterDropdown,children:[s.jsxs("div",{className:xe.filterActions,children:[s.jsx("button",{className:xe.filterActionBtn,onClick:D,children:"Select All"}),s.jsx("button",{className:xe.filterActionBtn,onClick:k,children:"Clear"})]}),s.jsx("div",{className:xe.filterDivider}),s.jsx("div",{className:xe.filterOptions,children:S.map(F=>s.jsxs("label",{className:xe.filterOption,children:[s.jsx("input",{type:"checkbox",checked:N.has(F),onChange:()=>I(F),className:xe.filterCheckboxInput}),s.jsx("span",{className:xe.filterCheckbox,children:s.jsx("svg",{className:xe.checkIcon,width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})})}),s.jsx("span",{className:xe.filterOptionText,children:F})]},F))})]})]})]}),s.jsx("div",{className:xe.panelBody,ref:r,children:P.length===0?s.jsx("div",{className:xe.empty,children:s.jsx("p",{children:"No equipment found"})}):P.map(F=>{const V=A(F.id);return s.jsxs("div",{className:`${xe.equipmentRow} ${v?xe.draggable:""}`,draggable:v,onDragStart:v?Q=>{Q.stopPropagation(),p(Q,"equipment",F.id,F.name)}:void 0,onDragEnd:v?x:void 0,children:[v&&s.jsx("div",{className:xe.dragHandle,title:"Drag to assign",children:s.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:[s.jsx("circle",{cx:"9",cy:"5",r:"2"}),s.jsx("circle",{cx:"9",cy:"12",r:"2"}),s.jsx("circle",{cx:"9",cy:"19",r:"2"}),s.jsx("circle",{cx:"15",cy:"5",r:"2"}),s.jsx("circle",{cx:"15",cy:"12",r:"2"}),s.jsx("circle",{cx:"15",cy:"19",r:"2"})]})}),s.jsx("div",{className:`${xe.status} ${V>0?xe.booked:xe.available}`}),s.jsxs("div",{className:xe.equipmentInfo,children:[s.jsx("div",{className:xe.equipmentName,children:F.name}),s.jsxs("div",{className:xe.equipmentMeta,children:[s.jsx("span",{children:F.type||"Equipment"}),s.jsx("span",{children:"  "}),s.jsx("span",{children:V>0?"In use":"Available"})]})]})]},F.id)})})]}),s.jsxs("div",{className:xe.timeline,children:[e&&s.jsx("div",{className:xe.timelineHeaderSpacer}),s.jsx("div",{className:xe.timelineScroll,ref:i,onScroll:C,children:s.jsxs("div",{className:xe.timelineContent,style:{width:E},children:[!e&&s.jsx(Ei,{headers:T,cells:j,cellWidth:g,totalWidth:E,viewMode:h}),s.jsx(jA,{ref:a,equipment:P,bookingsMap:$,cells:j,cellWidth:g,totalWidth:E,viewMode:h})]})})]})]})}const l5="_container_m1huf_1",c5="_ganttArea_m1huf_9",d5="_resizer_m1huf_16",u5="_horizontalResizer_m1huf_29",f5="_equipment_m1huf_42",Ba={container:l5,ganttArea:c5,resizer:d5,horizontalResizer:u5,equipment:f5};function Vh(){const e=f.useRef(null),t=f.useRef(null),[n,r]=f.useState(320),[a,i]=f.useState(250),o=O(E=>E.projects),l=O(E=>E.currentSite),c=O(E=>E.viewMode),d=O(E=>E.currentDate),h=O(E=>E.cellWidth),m=O(E=>E.bankHolidayDates),g=O(E=>E.bankHolidays),_=O(E=>E.customColumns),y=O(E=>E.showAllCustomColumns),u=O(E=>E.hiddenCustomColumns),w=O(E=>E.showStaffOverview),p=O(E=>E.showEquipmentOverview),x=O(E=>E.currentUser),v=(x==null?void 0:x.role)==="superuser"||(x==null?void 0:x.role)==="admin",C=y?_.filter(E=>!u.has(E.id)):[],N=f.useMemo(()=>o.filter(E=>E.site_id===(l==null?void 0:l.id)&&!E.archived).sort((E,$)=>E.confirmed!==$.confirmed?E.confirmed?-1:1:E.name.localeCompare($.name)),[o,l]),b=f.useMemo(()=>Ni(d,c,m,g),[d,c,m,g]),B=f.useMemo(()=>Di(b,c),[b,c]);o6(e,t);const M=C.reduce((E,$)=>E+$.width,0),L=n+M,S=E=>{E.preventDefault();const $=E.clientX,A=n,R=F=>{const V=F.clientX-$,Q=Math.max(200,Math.min(600,A+V));r(Q)},H=()=>{document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",H),document.body.style.cursor="",document.body.style.userSelect=""};document.addEventListener("mousemove",R),document.addEventListener("mouseup",H),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},P=E=>{E.preventDefault();const $=E.clientY,A=a,R=F=>{const V=$-F.clientY,Q=Math.max(100,Math.min(500,A+V));i(Q)},H=()=>{document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",H),document.body.style.cursor="",document.body.style.userSelect=""};document.addEventListener("mousemove",R),document.addEventListener("mouseup",H),document.body.style.cursor="row-resize",document.body.style.userSelect="none"},I=v&&w,D=v&&p,k=I||D,j=4,T=s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:Ba.ganttArea,children:[s.jsx(GM,{ref:e,projects:N,width:n}),s.jsx("div",{className:Ba.resizer,onMouseDown:S}),s.jsx(i6,{ref:t,cells:b,headers:B,projects:N,cellWidth:h,viewMode:c,hasCustomColumns:C.length>0})]}),k&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`${Ba.horizontalResizer} ${D?Ba.equipment:""}`,onMouseDown:P}),I&&s.jsx(y_,{embedded:!0,panelWidth:L+j,height:a}),D&&s.jsx(v_,{embedded:!0,panelWidth:L+j,height:a})]})]});return s.jsx(t6,{children:s.jsx("div",{className:Ba.container,children:T})})}const h5="_tooltip_1u2qd_3",m5="_title_1u2qd_28",p5="_row_1u2qd_37",g5="_label_1u2qd_46",Kt={tooltip:h5,title:m5,row:p5,label:g5};function Uh(e,t,n){const r=ps(e),a=ps(t),i=Us(a,r)+1;let o=0,l=0;try{const c=c0({start:r,end:a});for(const d of c){const h=Ie(d,"yyyy-MM-dd"),m=n.has(h),g=Hg(d);m?l++:g||o++}}catch{o=i}return{totalDays:i,workDays:o,holidays:l}}function el(e){if(!e)return{completion:null,isCalculated:!1};const t=e.children??[];let n=!1;for(const r of t){const a=el(r);if(a&&a.completion!==null){n=!0;break}}if(n){let r=0,a=0;for(const i of t){const o=el(i),l=ps(i.start_date),c=ps(i.end_date),d=Math.max(1,Us(c,l)+1),h=o.completion??0;r+=h*d,a+=d}if(a>0)return{completion:Math.round(r/a),isCalculated:!0}}return{completion:e.completion??null,isCalculated:!1}}function _5(e,t){const n=ps(e),r=ps(t);return`${Ie(n,"MMM d, yyyy")} - ${Ie(r,"MMM d, yyyy")}`}function y5(e,t){return e.find(n=>(n.phases??[]).some(r=>r.id===t))??null}function v5(e,t){for(const n of e){const r=(n.phases??[]).find(a=>a.id===t);if(r)return r}return null}function x5(e,t){for(const n of e)for(const r of n.phases??[]){const a=x_(r.children??[],t);if(a)return{subphase:a,project:n,parentPhase:r}}return null}function x_(e,t){var n;for(const r of e){if(r.id===t)return r;if((n=r.children)!=null&&n.length){const a=x_(r.children,t);if(a)return a}}return null}function w5(e){var n,r,a;let t=e;for(;t;){if(t.classList.contains("linkZone")||(r=(n=t.className)==null?void 0:n.includes)!=null&&r.call(n,"linkZone")||(a=t.getAttribute("title"))!=null&&a.includes("linking"))return!0;if(t.dataset.phaseId||t.dataset.subphaseId)break;t=t.parentElement}return!1}function j5(){const[e,t]=f.useState(null),[n,r]=f.useState(!1),a=O(m=>m.projects),i=O(m=>m.bankHolidayDates),o=f.useRef(null);f.useEffect(()=>{const m=_=>{_.key==="Shift"&&r(!0)},g=_=>{_.key==="Shift"&&(r(!1),t(null),o.current=null)};return window.addEventListener("keydown",m),window.addEventListener("keyup",g),()=>{window.removeEventListener("keydown",m),window.removeEventListener("keyup",g)}},[]);const l=f.useCallback((m,g,_)=>{const y=v5(a,m),u=y5(a,m);if(y&&u){const{totalDays:w,workDays:p,holidays:x}=Uh(y.start_date,y.end_date,i),v=el(y);t({type:"phase",title:y.name,projectName:u.name,startDate:y.start_date,endDate:y.end_date,completion:v.completion,isCalculatedCompletion:v.isCalculated,workDays:p,totalDays:w,holidays:x,x:g,y:_})}},[a,i]),c=f.useCallback((m,g,_)=>{const y=x5(a,m);if(y){const{subphase:u,project:w,parentPhase:p}=y,{totalDays:x,workDays:v,holidays:C}=Uh(u.start_date,u.end_date,i),N=el(u);t({type:"subphase",title:u.name,projectName:w.name,parentName:p.name,startDate:u.start_date,endDate:u.end_date,completion:N.completion,isCalculatedCompletion:N.isCalculated,workDays:v,totalDays:x,holidays:C,x:g,y:_})}},[a,i]);if(f.useEffect(()=>{const m=g=>{if(!n){e&&(t(null),o.current=null);return}const _=g.target;if(w5(_)){t(null),o.current=null;return}const y=_.closest("[data-phase-id], [data-subphase-id]");if(!y){t(null),o.current=null;return}if(!(window.getComputedStyle(y).position==="absolute"||y.classList.toString().includes("bar")||y.classList.toString().includes("Bar"))){t(null),o.current=null;return}const p=y.getBoundingClientRect();if(g.clientX<p.left||g.clientX>p.right||g.clientY<p.top||g.clientY>p.bottom){t(null),o.current=null;return}if(y===o.current&&e){t(C=>C?{...C,x:g.clientX,y:g.clientY}:null);return}o.current=y;const x=y.dataset.phaseId,v=y.dataset.subphaseId;x?l(parseInt(x),g.clientX,g.clientY):v&&c(parseInt(v),g.clientX,g.clientY)};return document.addEventListener("mousemove",m),()=>{document.removeEventListener("mousemove",m)}},[n,e,l,c]),!e||!n)return null;const d=e.completion!==null?`${e.completion}%${e.isCalculatedCompletion?" (calc)":""}`:"",h={left:Math.min(e.x+15,window.innerWidth-280),top:Math.min(e.y+15,window.innerHeight-200)};return s.jsxs("div",{className:Kt.tooltip,style:h,children:[s.jsx("div",{className:Kt.title,children:e.title}),s.jsxs("div",{className:Kt.row,children:[s.jsx("span",{className:Kt.label,children:"Project:"}),s.jsx("span",{children:e.projectName})]}),e.parentName&&s.jsxs("div",{className:Kt.row,children:[s.jsx("span",{className:Kt.label,children:"Parent:"}),s.jsx("span",{children:e.parentName})]}),s.jsxs("div",{className:Kt.row,children:[s.jsx("span",{className:Kt.label,children:"Period:"}),s.jsx("span",{children:_5(e.startDate,e.endDate)})]}),s.jsxs("div",{className:Kt.row,children:[s.jsx("span",{className:Kt.label,children:"Completion:"}),s.jsx("span",{children:d})]}),s.jsxs("div",{className:Kt.row,children:[s.jsx("span",{className:Kt.label,children:"Work days:"}),s.jsxs("span",{children:[e.workDays," days",e.holidays>0&&` (excl. ${e.holidays} hol.)`]})]}),s.jsxs("div",{className:Kt.row,children:[s.jsx("span",{className:Kt.label,children:"Total:"}),s.jsxs("span",{children:[e.totalDays," days"]})]})]})}const S5="_body_11czp_3",C5="_content_11czp_23",k5="_grid_11czp_29",b5="_gridCell_11czp_56",N5="_weekend_11czp_64",D5="_holiday_11czp_68",$5="_today_11czp_72",E5="_rows_11czp_78",T5="_siteRow_11czp_84",M5="_currentSite_11czp_90",I5="_projectRow_11czp_95",P5="_bar_11czp_102",L5="_confirmed_11czp_128",A5="_unconfirmed_11czp_133",B5="_masked_11czp_146",R5="_barLabel_11czp_150",St={body:S5,content:C5,grid:k5,gridCell:b5,weekend:N5,holiday:D5,today:$5,rows:E5,siteRow:T5,currentSite:M5,projectRow:I5,bar:P5,confirmed:L5,unconfirmed:A5,masked:B5,barLabel:R5},O5=f.forwardRef(function({rows:t,cells:n,cellWidth:r,totalWidth:a,viewMode:i},o){const l=i==="week"||i==="month",c=f.useMemo(()=>bl(n,r),[n,r]);return s.jsx("div",{ref:o,className:St.body,children:s.jsxs("div",{className:St.content,style:{width:a,"--cell-width":`${r}px`},children:[s.jsxs("div",{className:St.grid,children:[l&&n.map((d,h)=>d.isWeekend?s.jsx("div",{className:`${St.gridCell} ${St.weekend}`,style:{left:h*r,width:r}},`weekend-${h}`):null),l&&n.map((d,h)=>d.isBankHoliday?s.jsx("div",{className:`${St.gridCell} ${St.holiday}`,style:{left:h*r,width:r}},`holiday-${h}`):null),n.map((d,h)=>d.isToday?s.jsx("div",{className:`${St.gridCell} ${St.today}`,style:{left:h*r,width:r}},`today-${h}`):null)]}),c!==null&&s.jsx($l,{position:c}),s.jsx("div",{className:St.rows,children:t.map(d=>d.type==="site"?s.jsx("div",{className:`${St.siteRow} ${d.isCurrentSite?St.currentSite:""}`},`site-row-${d.site.id}`):s.jsx(F5,{row:d,cells:n,cellWidth:r,viewMode:i},`project-row-${d.project.id}`))})]})})});function F5({row:e,cells:t,cellWidth:n,viewMode:r}){const{project:a,isCurrentSite:i,displayName:o}=e,l=f.useMemo(()=>!a.start_date||!a.end_date?null:sn(a.start_date,a.end_date,t,n,r),[a.start_date,a.end_date,t,n,r]);return s.jsx("div",{className:St.projectRow,children:l&&s.jsx("div",{className:`${St.bar} ${a.confirmed?St.confirmed:St.unconfirmed} ${i?"":St.masked}`,style:{left:l.left,width:l.width},title:i?a.name:"Confidential",children:s.jsx("span",{className:St.barLabel,children:i?o:"Project"})})})}const z5="_container_144fl_3",H5="_panel_144fl_11",q5="_panelHeader_144fl_20",W5="_headerTitle_144fl_31",V5="_panelBody_144fl_37",U5="_siteRow_144fl_58",G5="_currentSite_144fl_68",Y5="_siteIndicator_144fl_72",Q5="_current_144fl_68",X5="_siteInfo_144fl_84",K5="_siteName_144fl_89",Z5="_siteMeta_144fl_95",J5="_projectRow_144fl_101",eB="_masked_144fl_110",tB="_status_144fl_114",nB="_confirmed_144fl_121",sB="_unconfirmed_144fl_125",rB="_projectInfo_144fl_129",aB="_projectName_144fl_135",iB="_projectMeta_144fl_143",oB="_timeline_144fl_149",lB="_timelineScroll_144fl_157",cB="_timelineContent_144fl_179",Je={container:z5,panel:H5,panelHeader:q5,headerTitle:W5,panelBody:V5,siteRow:U5,currentSite:G5,siteIndicator:Y5,current:Q5,siteInfo:X5,siteName:K5,siteMeta:Z5,projectRow:J5,masked:eB,status:tB,confirmed:nB,unconfirmed:sB,projectInfo:rB,projectName:aB,projectMeta:iB,timeline:oB,timelineScroll:lB,timelineContent:cB};function dB(){const e=f.useRef(null),t=f.useRef(null),n=f.useRef(null),r=O(p=>p.sites),a=O(p=>p.projects),i=O(p=>p.currentSite),o=O(p=>p.viewMode),l=O(p=>p.currentDate),c=O(p=>p.cellWidth),d=O(p=>p.bankHolidayDates),h=O(p=>p.bankHolidays),m=ee(p=>p.scrollToTodayTrigger);Dl({containerRef:n,cellWidth:c}),Nl(e,t);const g=f.useMemo(()=>Ni(l,o,d,h),[l,o,d,h]),_=f.useMemo(()=>Di(g,o),[g,o]),y=g.length*c;f.useEffect(()=>{if(!m||!n.current)return;const p=g.findIndex(b=>b.isToday);if(p===-1)return;const x=n.current,v=x.clientWidth,C=p*c,N=Math.max(0,C-v/2+c/2);x.scrollTo({left:N,behavior:"smooth"})},[m,g,c]);const u=f.useMemo(()=>{const p=new Map;return r.forEach(x=>{p.set(x.id,[])}),a.forEach(x=>{if(x.archived)return;const v=p.get(x.site_id)||[];v.push(x),p.set(x.site_id,v)}),p.forEach((x,v)=>{p.set(v,x.sort((C,N)=>C.name.localeCompare(N.name)))}),p},[r,a]),w=f.useMemo(()=>{const p=[];return r.forEach(x=>{const v=x.id===(i==null?void 0:i.id),C=u.get(x.id)||[];p.push({type:"site",site:x,isCurrentSite:v,projectCount:C.length}),C.forEach(N=>{p.push({type:"project",project:N,site:x,isCurrentSite:v,displayName:v?N.name:"Confidential Project",displayCustomer:v?N.customer||"":"***"})})}),p},[r,u,i]);return s.jsxs("div",{className:Je.container,children:[s.jsxs("div",{className:Je.panel,children:[s.jsx("div",{className:Je.panelHeader,children:s.jsx("span",{className:Je.headerTitle,children:"Cross-Site Overview"})}),s.jsx("div",{className:Je.panelBody,ref:e,children:w.map(p=>p.type==="site"?s.jsxs("div",{className:`${Je.siteRow} ${p.isCurrentSite?Je.currentSite:""}`,children:[s.jsx("div",{className:`${Je.siteIndicator} ${p.isCurrentSite?Je.current:""}`}),s.jsxs("div",{className:Je.siteInfo,children:[s.jsx("div",{className:Je.siteName,children:p.site.name}),s.jsxs("div",{className:Je.siteMeta,children:[p.projectCount," projects"]})]})]},`site-${p.site.id}`):s.jsxs("div",{className:`${Je.projectRow} ${p.isCurrentSite?"":Je.masked}`,children:[s.jsx("div",{className:`${Je.status} ${p.project.confirmed?Je.confirmed:Je.unconfirmed}`}),s.jsxs("div",{className:Je.projectInfo,children:[s.jsx("div",{className:Je.projectName,children:p.displayName}),p.displayCustomer&&s.jsx("div",{className:Je.projectMeta,children:p.displayCustomer})]})]},`project-${p.project.id}`))})]}),s.jsx("div",{className:Je.timeline,children:s.jsx("div",{className:Je.timelineScroll,ref:n,children:s.jsxs("div",{className:Je.timelineContent,style:{width:y},children:[s.jsx(Ei,{headers:_,cells:g,cellWidth:c,totalWidth:y,viewMode:o}),s.jsx(O5,{ref:t,rows:w,cells:g,cellWidth:c,totalWidth:y,viewMode:o})]})})})]})}const uB="_row_ku0c1_3",fB="_specialCell_ku0c1_29",hB="_weekend_ku0c1_37",mB="_bankHoliday_ku0c1_41",pB="_today_ku0c1_45",gB="_bar_ku0c1_52",_B="_confirmed_ku0c1_77",yB="_unconfirmed_ku0c1_82",Wn={row:uB,specialCell:fB,weekend:hB,bankHoliday:mB,today:pB,bar:gB,confirmed:_B,unconfirmed:yB};function vB({project:e,cells:t,cellWidth:n,totalWidth:r,showHighlighting:a}){const i=f.useMemo(()=>{if(!e.start_date||!e.end_date||t.length===0)return null;const o=new Date(e.start_date),l=new Date(e.end_date);o.setHours(0,0,0,0),l.setHours(0,0,0,0);const c=t[0].date,d=t[t.length-1].date;if(l<c||o>d)return null;let h=0;for(let y=0;y<t.length;y++){if(t[y].date>=o){h=y;break}y===t.length-1&&(h=y)}o<c&&(h=0);let m=t.length-1;for(let y=t.length-1;y>=0;y--)if(t[y].date<=l){m=y;break}const g=h*n,_=Math.max((m-h+1)*n,n);return{left:g,width:_}},[e.start_date,e.end_date,t,n]);return s.jsxs("div",{className:Wn.row,style:{width:r,"--cell-width":`${n}px`},children:[a&&t.map((o,l)=>o.isWeekend?s.jsx("div",{className:`${Wn.specialCell} ${Wn.weekend}`,style:{left:l*n,width:n}},`weekend-${l}`):null),a&&t.map((o,l)=>o.isBankHoliday?s.jsx("div",{className:`${Wn.specialCell} ${Wn.bankHoliday}`,style:{left:l*n,width:n}},`holiday-${l}`):null),t.map((o,l)=>o.isToday?s.jsx("div",{className:`${Wn.specialCell} ${Wn.today}`,style:{left:l*n,width:n}},`today-${l}`):null),i&&s.jsx("div",{className:`${Wn.bar} ${e.confirmed?Wn.confirmed:Wn.unconfirmed}`,style:{left:i.left,width:i.width},children:e.name})]})}const xB="_container_1h039_3",wB="_projectPanel_1h039_11",jB="_panelHeader_1h039_21",SB="_panelContent_1h039_34",CB="_emptyState_1h039_58",kB="_projectRow_1h039_70",bB="_projectMain_1h039_75",NB="_expandPlaceholder_1h039_83",DB="_status_1h039_92",$B="_confirmed_1h039_99",EB="_unconfirmed_1h039_103",TB="_projectInfo_1h039_107",MB="_projectName_1h039_113",IB="_projectMeta_1h039_122",PB="_pmName_1h039_130",LB="_editBtn_1h039_134",AB="_timelineWrapper_1h039_155",BB="_timelineScroll_1h039_163",RB="_timelineContent_1h039_185",OB="_timelineBody_1h039_192",FB="_timelineBodyContent_1h039_212",zB="_emptyTimeline_1h039_217",at={container:xB,projectPanel:wB,panelHeader:jB,panelContent:SB,emptyState:CB,projectRow:kB,projectMain:bB,expandPlaceholder:NB,status:DB,confirmed:$B,unconfirmed:EB,projectInfo:TB,projectName:MB,projectMeta:IB,pmName:PB,editBtn:LB,timelineWrapper:AB,timelineScroll:BB,timelineContent:RB,timelineBody:OB,timelineBodyContent:FB,emptyTimeline:zB};function HB(){const e=f.useRef(null),t=f.useRef(null),n=O(u=>u.projects),r=O(u=>u.currentSite),a=O(u=>u.viewMode),i=O(u=>u.currentDate),o=O(u=>u.cellWidth),l=O(u=>u.bankHolidayDates),c=O(u=>u.bankHolidays),d=ee(u=>u.openProjectModal);Nl(e,t);const h=f.useMemo(()=>n.filter(u=>u.archived&&u.site_id===(r==null?void 0:r.id)).sort((u,w)=>u.name.localeCompare(w.name)),[n,r]),m=f.useMemo(()=>Ni(i,a,l,c),[i,a,l,c]),g=f.useMemo(()=>Di(m,a),[m,a]),_=m.length*o,y=a==="week"||a==="month";return s.jsxs("div",{className:at.container,children:[s.jsxs("div",{className:at.projectPanel,children:[s.jsx("div",{className:at.panelHeader,children:"Archived Projects"}),s.jsx("div",{className:at.panelContent,ref:e,children:h.length===0?s.jsx("div",{className:at.emptyState,children:s.jsx("p",{children:"No archived projects"})}):h.map(u=>s.jsx("div",{className:at.projectRow,"data-project-id":u.id,children:s.jsxs("div",{className:at.projectMain,children:[s.jsx("div",{className:at.expandPlaceholder,children:s.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24"})}),s.jsx("div",{className:`${at.status} ${u.confirmed?at.confirmed:at.unconfirmed}`}),s.jsxs("div",{className:at.projectInfo,children:[s.jsx("div",{className:at.projectName,children:u.name}),s.jsxs("div",{className:at.projectMeta,children:[s.jsx("span",{className:at.pmName,children:u.pm_name||"No PM"}),s.jsx("span",{children:"  "}),s.jsx("span",{children:u.customer||"No customer"})]})]}),s.jsx("button",{className:at.editBtn,onClick:w=>{w.stopPropagation(),d(u)},title:"Edit project",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),s.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})})]})},u.id))})]}),s.jsx("div",{className:at.timelineWrapper,children:s.jsx("div",{className:at.timelineScroll,children:s.jsxs("div",{className:at.timelineContent,style:{width:_},children:[s.jsx(Ei,{headers:g,cells:m,cellWidth:o,totalWidth:_,viewMode:a}),s.jsx("div",{className:at.timelineBody,ref:t,children:s.jsx("div",{className:at.timelineBodyContent,style:{width:_,"--cell-width":`${o}px`},children:h.length===0?s.jsx("div",{className:at.emptyTimeline}):h.map(u=>s.jsx(vB,{project:u,cells:m,cellWidth:o,totalWidth:_,showHighlighting:y},u.id))})})]})})})]})}const qB="_container_16j28_1",WB="_body_16j28_11",VB="_main_16j28_18",hc={container:qB,body:WB,main:VB};function UB(){const e=O(n=>n.currentView);Z2();const t=()=>{switch(e){case"gantt":return s.jsx(Vh,{});case"staff":return s.jsx(y_,{});case"equipment":return s.jsx(v_,{});case"crosssite":return s.jsx(dB,{});case"archived":return s.jsx(HB,{});default:return s.jsx(Vh,{})}};return s.jsxs("div",{className:hc.container,children:[s.jsx(uj,{}),s.jsxs("div",{className:hc.body,children:[s.jsx(Oj,{}),s.jsx("main",{className:hc.main,children:t()})]}),s.jsx(j5,{})]})}const GB="_wrapper_1mmpa_1",YB="_label_1mmpa_7",QB="_input_1mmpa_14",XB="_checkbox_1mmpa_21",KB="_checkIcon_1mmpa_34",ZB="_indeterminateIcon_1mmpa_35",JB="_labelText_1mmpa_75",e8="_error_1mmpa_85",ws={wrapper:GB,label:YB,input:QB,checkbox:XB,checkIcon:KB,indeterminateIcon:ZB,labelText:JB,error:e8},t8=f.forwardRef(({label:e,error:t,indeterminate:n,className:r,id:a,...i},o)=>{const l=a||`checkbox-${Math.random().toString(36).substr(2,9)}`,c=[ws.wrapper,r].filter(Boolean).join(" ");return s.jsxs("div",{className:c,children:[s.jsxs("label",{htmlFor:l,className:ws.label,children:[s.jsx("input",{ref:d=>{d&&(d.indeterminate=n||!1),typeof o=="function"?o(d):o&&(o.current=d)},type:"checkbox",id:l,className:ws.input,...i}),s.jsxs("span",{className:ws.checkbox,children:[s.jsx("svg",{className:ws.checkIcon,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})}),s.jsx("svg",{className:ws.indeterminateIcon,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})})]}),e&&s.jsx("span",{className:ws.labelText,children:e})]}),t&&s.jsx("span",{className:ws.error,children:t})]})});t8.displayName="Checkbox";const n8="_menu_1rdk0_1",s8="_item_1rdk0_25",r8="_disabled_1rdk0_41",a8="_danger_1rdk0_45",i8="_icon_1rdk0_58",o8="_label_1rdk0_71",l8="_divider_1rdk0_75",ar={menu:n8,item:s8,disabled:r8,danger:a8,icon:i8,label:o8,divider:l8};function c8({x:e,y:t,items:n,onClose:r}){const a=f.useRef(null);return f.useEffect(()=>{const i=l=>{a.current&&!a.current.contains(l.target)&&r()},o=l=>{l.key==="Escape"&&r()};return document.addEventListener("mousedown",i),document.addEventListener("keydown",o),()=>{document.removeEventListener("mousedown",i),document.removeEventListener("keydown",o)}},[r]),f.useEffect(()=>{if(a.current){const i=a.current.getBoundingClientRect(),o=window.innerWidth,l=window.innerHeight;let c=e,d=t;e+i.width>o&&(c=o-i.width-8),t+i.height>l&&(d=l-i.height-8),a.current.style.left=`${c}px`,a.current.style.top=`${d}px`}},[e,t]),s.jsx("div",{ref:a,className:ar.menu,style:{left:e,top:t},children:n.map((i,o)=>i.divider?s.jsx("div",{className:ar.divider},o):s.jsxs("button",{className:`${ar.item} ${i.danger?ar.danger:""} ${i.disabled?ar.disabled:""}`,onClick:()=>{i.disabled||(i.onClick(),r())},disabled:i.disabled,children:[i.icon&&s.jsx("span",{className:ar.icon,children:i.icon}),s.jsx("span",{className:ar.label,children:i.label})]},o))})}function d8(){const e=ee(y=>y.contextMenu),t=ee(y=>y.hideContextMenu),n=ee(y=>y.openProjectModal),r=ee(y=>y.openPhaseModal),a=ee(y=>y.openSubphaseModal),i=ee(y=>y.openModal),o=ee(y=>y.setEditingStaffAssignment),l=ee(y=>y.setEditingEquipmentAssignment),c=O(y=>y.projects),d=O(y=>y.currentUser),{loadAllData:h}=jl(),m=(d==null?void 0:d.role)==="admin"||(d==null?void 0:d.role)==="superuser",g=f.useCallback(()=>{var y,u,w;if(!e.targetId||!e.type)return null;if(e.type==="project")return c.find(p=>p.id===e.targetId);if(e.type==="phase"&&e.projectId){const p=c.find(x=>x.id===e.projectId);return(y=p==null?void 0:p.phases)==null?void 0:y.find(x=>x.id===e.targetId)}if(e.type==="subphase"&&e.projectId&&e.phaseId){const p=c.find(v=>v.id===e.projectId),x=(u=p==null?void 0:p.phases)==null?void 0:u.find(v=>v.id===e.phaseId);return(w=x==null?void 0:x.children)==null?void 0:w.find(v=>v.id===e.targetId)}return null},[e,c]),_=f.useCallback(()=>{const{type:y,targetId:u,projectId:w,phaseId:p}=e,x=g();if(!y||!u)return[];if(y==="project"){const v=x;return[{label:"Edit Project",icon:s.jsx(Ra,{}),onClick:()=>{v&&n(v)},disabled:!m},{label:"Add Phase",icon:s.jsx(mc,{}),onClick:()=>{r(void 0,u)},disabled:!m},{label:"Assign Staff",icon:s.jsx(pc,{}),onClick:()=>{i("staffAssignment",{projectId:u})},disabled:!m},{label:"Assign Equipment",icon:s.jsx(gc,{}),onClick:()=>{i("equipmentAssignment",{projectId:u})},disabled:!m},{label:"",divider:!0,onClick:()=>{}},{label:"Delete Project",icon:s.jsx(Oa,{}),danger:!0,onClick:async()=>{confirm(`Delete project "${v==null?void 0:v.name}"? This cannot be undone.`)&&(await zv(u),h())},disabled:!m}]}if(y==="phase"){const v=x;return[{label:"Edit Phase",icon:s.jsx(Ra,{}),onClick:()=>{v&&w&&r(v,w)},disabled:!m},{label:"Add Subphase",icon:s.jsx(mc,{}),onClick:()=>{a(void 0,u,w)},disabled:!m},{label:"Assign Staff",icon:s.jsx(pc,{}),onClick:()=>{i("staffAssignment",{phaseId:u,projectId:w})},disabled:!m},{label:"Assign Equipment",icon:s.jsx(gc,{}),onClick:()=>{i("equipmentAssignment",{phaseId:u,projectId:w})},disabled:!m},{label:"",divider:!0,onClick:()=>{}},{label:"Delete Phase",icon:s.jsx(Oa,{}),danger:!0,onClick:async()=>{confirm(`Delete phase "${v==null?void 0:v.name}"? This cannot be undone.`)&&(await Dg(u),h())},disabled:!m}]}if(y==="subphase"){const v=x;return[{label:"Edit Subphase",icon:s.jsx(Ra,{}),onClick:()=>{v&&p&&w&&a(v,p,w)},disabled:!m},{label:"Add Child Subphase",icon:s.jsx(mc,{}),onClick:()=>{a(void 0,p,w,u)},disabled:!m},{label:"Assign Staff",icon:s.jsx(pc,{}),onClick:()=>{i("staffAssignment",{subphaseId:u,phaseId:p,projectId:w})},disabled:!m},{label:"Assign Equipment",icon:s.jsx(gc,{}),onClick:()=>{i("equipmentAssignment",{subphaseId:u,phaseId:p,projectId:w})},disabled:!m},{label:"",divider:!0,onClick:()=>{}},{label:"Delete Subphase",icon:s.jsx(Oa,{}),danger:!0,onClick:async()=>{confirm(`Delete subphase "${v==null?void 0:v.name}"? This cannot be undone.`)&&(await $g(u),h())},disabled:!m}]}if(y==="staffAssignment"){const{assignmentData:v,subphaseId:C}=e,N=(v==null?void 0:v.name)||"Staff Assignment",b=C?"subphase":p?"phase":"project";return[{label:"Edit Assignment",icon:s.jsx(Ra,{}),onClick:()=>{o({id:u,project_id:w||0,phase_id:p||null,subphase_id:C||null,staff_id:(v==null?void 0:v.staffId)||0,staff_name:(v==null?void 0:v.name)||"",allocation:(v==null?void 0:v.allocation)||100,start_date:(v==null?void 0:v.startDate)||"",end_date:(v==null?void 0:v.endDate)||""}),i("staffAssignment",{projectId:w,phaseId:p,subphaseId:C})},disabled:!m},{label:"",divider:!0,onClick:()=>{}},{label:"Delete Assignment",icon:s.jsx(Oa,{}),danger:!0,onClick:async()=>{confirm(`Remove ${N} from this assignment?`)&&(await Eg(u,b),h())},disabled:!m}]}if(y==="equipmentAssignment"){const{assignmentData:v,subphaseId:C}=e,N=(v==null?void 0:v.name)||"Equipment Assignment";return[{label:"Edit Assignment",icon:s.jsx(Ra,{}),onClick:()=>{l({id:u,project_id:w||0,phase_id:p||null,subphase_id:C||null,equipment_id:(v==null?void 0:v.equipmentId)||0,equipment_name:(v==null?void 0:v.name)||"",start_date:(v==null?void 0:v.startDate)||"",end_date:(v==null?void 0:v.endDate)||""}),i("equipmentAssignment",{projectId:w,phaseId:p,subphaseId:C})},disabled:!m},{label:"",divider:!0,onClick:()=>{}},{label:"Delete Assignment",icon:s.jsx(Oa,{}),danger:!0,onClick:async()=>{confirm(`Remove ${N} from this assignment?`)&&(await Tg(u),h())},disabled:!m}]}return[]},[e,g,m,n,r,a,i,o,l,h]);return e.visible?s.jsx(c8,{x:e.x,y:e.y,items:_(),onClose:t}):null}const Ra=()=>s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),s.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})]}),mc=()=>s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),Oa=()=>s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("polyline",{points:"3 6 5 6 21 6"}),s.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})]}),pc=()=>s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"}),s.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),gc=()=>s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),s.jsx("path",{d:"M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16"})]}),Gh={adminUser:null,isAuthenticated:!1,isLoading:!0,tenants:[],systemStats:null,adminUsers:[],activeTab:"tenants",selectedTenantId:null},lt=vl(e=>({...Gh,setAdminUser:t=>e({adminUser:t}),setIsAuthenticated:t=>e({isAuthenticated:t}),setIsLoading:t=>e({isLoading:t}),setTenants:t=>e({tenants:t}),setSystemStats:t=>e({systemStats:t}),setAdminUsers:t=>e({adminUsers:t}),setActiveTab:t=>e({activeTab:t}),setSelectedTenantId:t=>e({selectedTenantId:t}),updateTenantInList:(t,n)=>e(r=>({tenants:r.tenants.map(a=>a.id===t?{...a,...n}:a)})),removeTenantFromList:t=>e(n=>({tenants:n.tenants.filter(r=>r.id!==t)})),addTenantToList:t=>e(n=>({tenants:[t,...n.tenants]})),updateAdminUserInList:(t,n)=>e(r=>({adminUsers:r.adminUsers.map(a=>a.id===t?{...a,...n}:a)})),removeAdminUserFromList:t=>e(n=>({adminUsers:n.adminUsers.filter(r=>r.id!==t)})),addAdminUserToList:t=>e(n=>({adminUsers:[t,...n.adminUsers]})),reset:()=>e(Gh)})),u8="_container_1g5x6_3",f8="_card_1g5x6_12",h8="_header_1g5x6_22",m8="_logo_1g5x6_27",p8="_title_1g5x6_33",g8="_subtitle_1g5x6_40",_8="_form_1g5x6_46",y8="_formGroup_1g5x6_52",v8="_label_1g5x6_58",x8="_input_1g5x6_64",w8="_error_1g5x6_89",j8="_submitBtn_1g5x6_97",S8="_footer_1g5x6_118",C8="_backLink_1g5x6_125",Dt={container:u8,card:f8,header:h8,logo:m8,title:p8,subtitle:g8,form:_8,formGroup:y8,label:v8,input:x8,error:w8,submitBtn:j8,footer:S8,backLink:C8};function k8(){const[e,t]=f.useState(""),[n,r]=f.useState(""),[a,i]=f.useState(null),[o,l]=f.useState(!1),[c,d]=f.useState(()=>Nr()),h=lt(u=>u.setAdminUser),m=lt(u=>u.setIsAuthenticated),g=lt(u=>u.setIsLoading);f.useEffect(()=>{const u=new MutationObserver(()=>{const w=document.documentElement.dataset.theme;w&&w!==c&&d(w)});return u.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>u.disconnect()},[c]);const _=async u=>{u.preventDefault(),i(null),l(!0);try{const w=await px(e,n);w.success&&w.user&&(h(w.user),m(!0))}catch(w){i(w instanceof Error?w.message:"Invalid credentials")}finally{l(!1),g(!1)}},y=c==="dark"?"/img/milestone_logo_dark_theme.svg":"/img/milestone_logo_light_theme.svg";return s.jsx("div",{className:Dt.container,children:s.jsxs("div",{className:Dt.card,children:[s.jsxs("div",{className:Dt.header,children:[s.jsx("img",{src:y,alt:"Milestone",className:Dt.logo}),s.jsx("h1",{className:Dt.title,children:"Admin Portal"}),s.jsx("p",{className:Dt.subtitle,children:"Multi-tenant Management"})]}),s.jsxs("form",{onSubmit:_,className:Dt.form,children:[s.jsxs("div",{className:Dt.formGroup,children:[s.jsx("label",{htmlFor:"email",className:Dt.label,children:"Email"}),s.jsx("input",{type:"email",id:"email",className:Dt.input,value:e,onChange:u=>t(u.target.value),placeholder:"admin@example.com",required:!0,autoFocus:!0,disabled:o})]}),s.jsxs("div",{className:Dt.formGroup,children:[s.jsx("label",{htmlFor:"password",className:Dt.label,children:"Password"}),s.jsx("input",{type:"password",id:"password",className:Dt.input,value:n,onChange:u=>r(u.target.value),placeholder:"",required:!0,disabled:o})]}),a&&s.jsx("div",{className:Dt.error,children:a}),s.jsx("button",{type:"submit",className:Dt.submitBtn,disabled:o,children:o?"Signing in...":"Sign In"})]}),s.jsx("div",{className:Dt.footer,children:s.jsx("a",{href:"/",className:Dt.backLink,children:" Back to Application"})})]})})}const b8="_container_1d2fr_3",N8="_statsGrid_1d2fr_10",D8="_statCard_1d2fr_16",$8="_statValue_1d2fr_31",E8="_success_1d2fr_37",T8="_warning_1d2fr_38",M8="_danger_1d2fr_39",I8="_panel_1d2fr_42",P8="_panelHeader_1d2fr_49",L8="_tableWrapper_1d2fr_65",A8="_table_1d2fr_65",B8="_emptyMessage_1d2fr_93",R8="_tenantName_1d2fr_99",O8="_companyName_1d2fr_113",F8="_slug_1d2fr_119",z8="_badge_1d2fr_127",H8="_badgeSuccess_1d2fr_136",q8="_badgeWarning_1d2fr_141",W8="_badgeDanger_1d2fr_146",V8="_badgeInfo_1d2fr_151",U8="_btnPrimary_1d2fr_157",G8="_actions_1d2fr_177",Y8="_btnSmall_1d2fr_182",Q8="_btnSuccess_1d2fr_202",X8="_btnWarning_1d2fr_210",K8="_btnDanger_1d2fr_218",Z8="_loading_1d2fr_226",ie={container:b8,statsGrid:N8,statCard:D8,statValue:$8,success:E8,warning:T8,danger:M8,panel:I8,panelHeader:P8,tableWrapper:L8,table:A8,emptyMessage:B8,tenantName:R8,companyName:O8,slug:F8,badge:z8,badgeSuccess:H8,badgeWarning:q8,badgeDanger:W8,badgeInfo:V8,btnPrimary:U8,actions:G8,btnSmall:Y8,btnSuccess:Q8,btnWarning:X8,btnDanger:K8,loading:Z8};function J8({onCreateNew:e,onViewDetails:t,onShowCredentials:n,onRefresh:r}){const a=lt(u=>u.tenants),i=lt(u=>u.systemStats),[o,l]=f.useState(null),c=async u=>{if(confirm("This will create the database for this tenant. Continue?")){l(u.id);try{const w=await Sx(u.id);n("Database Provisioned!",w.adminEmail,w.adminPassword),r()}catch(w){alert("Error: "+(w instanceof Error?w.message:"Unknown error"))}finally{l(null)}}},d=async u=>{if(confirm("This will generate a new password for the tenant admin. Continue?")){l(u.id);try{const w=await Cx(u.id);n("Password Reset!",w.email,w.password)}catch(w){alert("Error: "+(w instanceof Error?w.message:"Unknown error"))}finally{l(null)}}},h=async(u,w)=>{if(confirm(`Change tenant status to ${w}?`)){l(u.id);try{await wx(u.id,w),r()}catch(p){alert("Error: "+(p instanceof Error?p.message:"Unknown error"))}finally{l(null)}}},m=async u=>{var p;if(u.status==="active"){alert("You must suspend the tenant before deleting it. This ensures no users are actively using the system.");return}const w=(p=u.database_status)!=null&&p.accessible?`Delete tenant "${u.name}"?

 This will permanently delete:
 The tenant record
 The tenant database and all its data

This action cannot be undone.`:`Delete tenant "${u.name}"?

This will remove the tenant record.
This action cannot be undone.`;if(confirm(w)){l(u.id);try{await jx(u.id,!0),r()}catch(x){alert("Error: "+(x instanceof Error?x.message:"Unknown error"))}finally{l(null)}}},g=u=>{const w={active:ie.badgeSuccess,pending:ie.badgeWarning,suspended:ie.badgeDanger,archived:ie.badgeInfo};return s.jsx("span",{className:`${ie.badge} ${w[u]||""}`,children:u})},_=u=>u?u.accessible?s.jsx("span",{className:`${ie.badge} ${ie.badgeSuccess}`,children:"Connected"}):u.exists?s.jsx("span",{className:`${ie.badge} ${ie.badgeWarning}`,children:"Exists"}):s.jsx("span",{className:`${ie.badge} ${ie.badgeDanger}`,children:"Not provisioned"}):s.jsx("span",{className:ie.badge,children:"Unknown"}),y=u=>new Date(u).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return s.jsxs("div",{className:ie.container,children:[i&&s.jsxs("div",{className:ie.statsGrid,children:[s.jsxs("div",{className:ie.statCard,children:[s.jsx("h3",{children:"Total Tenants"}),s.jsx("div",{className:ie.statValue,children:i.tenants.total})]}),s.jsxs("div",{className:`${ie.statCard} ${ie.success}`,children:[s.jsx("h3",{children:"Active"}),s.jsx("div",{className:ie.statValue,children:i.tenants.active})]}),s.jsxs("div",{className:`${ie.statCard} ${ie.warning}`,children:[s.jsx("h3",{children:"Pending"}),s.jsx("div",{className:ie.statValue,children:i.tenants.pending})]}),s.jsxs("div",{className:`${ie.statCard} ${ie.danger}`,children:[s.jsx("h3",{children:"Suspended"}),s.jsx("div",{className:ie.statValue,children:i.tenants.suspended})]})]}),s.jsxs("div",{className:ie.panel,children:[s.jsxs("div",{className:ie.panelHeader,children:[s.jsx("h2",{children:"Tenants"}),s.jsxs("button",{className:ie.btnPrimary,onClick:e,children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Create Tenant"]})]}),s.jsx("div",{className:ie.tableWrapper,children:s.jsxs("table",{className:ie.table,children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Name"}),s.jsx("th",{children:"Slug"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Database"}),s.jsx("th",{children:"Admin Email"}),s.jsx("th",{children:"Plan"}),s.jsx("th",{children:"Created"}),s.jsx("th",{children:"Actions"})]})}),s.jsx("tbody",{children:a.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:8,className:ie.emptyMessage,children:"No tenants found. Create your first tenant to get started."})}):a.map(u=>{var w,p;return s.jsxs("tr",{children:[s.jsxs("td",{children:[s.jsx("button",{className:ie.tenantName,onClick:()=>t(u.id),children:u.name}),u.company_name&&s.jsx("div",{className:ie.companyName,children:u.company_name})]}),s.jsx("td",{children:s.jsx("code",{className:ie.slug,children:u.slug})}),s.jsx("td",{children:g(u.status)}),s.jsx("td",{children:_(u.database_status)}),s.jsx("td",{children:u.admin_email}),s.jsx("td",{children:u.plan}),s.jsx("td",{children:y(u.created_at)}),s.jsx("td",{children:s.jsx("div",{className:ie.actions,children:o===u.id?s.jsx("span",{className:ie.loading,children:"Loading..."}):s.jsxs(s.Fragment,{children:[s.jsx("button",{className:ie.btnSmall,onClick:()=>t(u.id),title:"View Details",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),s.jsx("circle",{cx:"12",cy:"12",r:"3"})]})}),!((w=u.database_status)!=null&&w.accessible)&&s.jsx("button",{className:`${ie.btnSmall} ${ie.btnSuccess}`,onClick:()=>c(u),title:"Provision Database",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),s.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),s.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"})]})}),((p=u.database_status)==null?void 0:p.accessible)&&s.jsx("button",{className:ie.btnSmall,onClick:()=>d(u),title:"Reset Admin Password",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),s.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),u.status==="active"&&s.jsx("button",{className:`${ie.btnSmall} ${ie.btnWarning}`,onClick:()=>h(u,"suspended"),title:"Suspend",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("rect",{x:"6",y:"4",width:"4",height:"16"}),s.jsx("rect",{x:"14",y:"4",width:"4",height:"16"})]})}),u.status==="suspended"&&s.jsx("button",{className:`${ie.btnSmall} ${ie.btnSuccess}`,onClick:()=>h(u,"active"),title:"Activate",children:s.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polygon",{points:"5 3 19 12 5 21 5 3"})})}),s.jsx("button",{className:`${ie.btnSmall} ${ie.btnDanger}`,onClick:()=>m(u),title:"Delete Tenant",children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("polyline",{points:"3 6 5 6 21 6"}),s.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})})})]},u.id)})})]})})]})]})}function eR({onCreateNew:e,onRefresh:t}){const n=lt(d=>d.adminUsers),r=lt(d=>d.adminUser),[a,i]=f.useState(null),o=async(d,h)=>{i(d);try{await $x(d,{active:!h}),t()}catch(m){alert("Error: "+(m instanceof Error?m.message:"Unknown error"))}finally{i(null)}},l=async(d,h)=>{if(d===(r==null?void 0:r.id)){alert("You cannot delete yourself.");return}if(confirm(`Delete admin user "${h}"?`)){i(d);try{await Ex(d),t()}catch(m){alert("Error: "+(m instanceof Error?m.message:"Unknown error"))}finally{i(null)}}},c=d=>d?new Date(d).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-";return s.jsx("div",{className:ie.container,children:s.jsxs("div",{className:ie.panel,children:[s.jsxs("div",{className:ie.panelHeader,children:[s.jsx("h2",{children:"Admin Users"}),s.jsxs("button",{className:ie.btnPrimary,onClick:e,children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Admin"]})]}),s.jsx("div",{className:ie.tableWrapper,children:s.jsxs("table",{className:ie.table,children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Email"}),s.jsx("th",{children:"Name"}),s.jsx("th",{children:"Role"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Created"}),s.jsx("th",{children:"Last Login"}),s.jsx("th",{children:"Actions"})]})}),s.jsx("tbody",{children:n.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:ie.emptyMessage,children:"No admin users found."})}):n.map(d=>s.jsxs("tr",{children:[s.jsxs("td",{children:[s.jsx("strong",{children:d.email}),d.id===(r==null?void 0:r.id)&&s.jsx("span",{style:{marginLeft:8,fontSize:"0.75rem",color:"var(--text-muted)"},children:"(you)"})]}),s.jsx("td",{children:d.name}),s.jsx("td",{children:s.jsx("span",{className:`${ie.badge} ${d.role==="superadmin"?ie.badgeInfo:""}`,children:d.role})}),s.jsx("td",{children:s.jsx("span",{className:`${ie.badge} ${d.active?ie.badgeSuccess:ie.badgeDanger}`,children:d.active?"Active":"Disabled"})}),s.jsx("td",{children:c(d.created_at)}),s.jsx("td",{children:c(d.last_login)}),s.jsx("td",{children:s.jsx("div",{className:ie.actions,children:a===d.id?s.jsx("span",{className:ie.loading,children:"Loading..."}):s.jsxs(s.Fragment,{children:[s.jsx("button",{className:`${ie.btnSmall} ${d.active?ie.btnWarning:ie.btnSuccess}`,onClick:()=>o(d.id,d.active),title:d.active?"Disable":"Enable",disabled:d.id===(r==null?void 0:r.id),children:d.active?s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})]}):s.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})})}),s.jsx("button",{className:`${ie.btnSmall} ${ie.btnDanger}`,onClick:()=>l(d.id,d.email),title:"Delete",disabled:d.id===(r==null?void 0:r.id),children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("polyline",{points:"3 6 5 6 21 6"}),s.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]})})})]},d.id))})]})})]})})}const tR="_container_1fjtr_3",nR="_loading_1fjtr_9",sR="_header_1fjtr_15",rR="_refreshBtn_1fjtr_28",aR="_grid_1fjtr_48",iR="_section_1fjtr_53",oR="_statsRow_1fjtr_68",lR="_stat_1fjtr_68",cR="_statLabel_1fjtr_80",dR="_statValue_1fjtr_85",uR="_success_1fjtr_91",fR="_warning_1fjtr_92",hR="_danger_1fjtr_93",mR="_info_1fjtr_95",pR="_infoLabel_1fjtr_104",gR="_infoValue_1fjtr_109",pe={container:tR,loading:nR,header:sR,refreshBtn:rR,grid:aR,section:iR,statsRow:oR,stat:lR,statLabel:cR,statValue:dR,success:uR,warning:fR,danger:hR,info:mR,infoLabel:pR,infoValue:gR};function _R({onRefresh:e}){const t=lt(r=>r.systemStats),n=r=>{const a=Math.floor(r/86400),i=Math.floor(r%86400/3600),o=Math.floor(r%3600/60);return a>0?`${a}d ${i}h ${o}m`:i>0?`${i}h ${o}m`:`${o}m`};return t?s.jsxs("div",{className:pe.container,children:[s.jsxs("div",{className:pe.header,children:[s.jsx("h2",{children:"System Statistics"}),s.jsxs("button",{className:pe.refreshBtn,onClick:e,children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("polyline",{points:"23 4 23 10 17 10"}),s.jsx("polyline",{points:"1 20 1 14 7 14"}),s.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),"Refresh"]})]}),s.jsxs("div",{className:pe.grid,children:[s.jsxs("div",{className:pe.section,children:[s.jsx("h3",{children:"Tenants"}),s.jsxs("div",{className:pe.statsRow,children:[s.jsxs("div",{className:pe.stat,children:[s.jsx("span",{className:pe.statLabel,children:"Total"}),s.jsx("span",{className:pe.statValue,children:t.tenants.total})]}),s.jsxs("div",{className:pe.stat,children:[s.jsx("span",{className:pe.statLabel,children:"Active"}),s.jsx("span",{className:`${pe.statValue} ${pe.success}`,children:t.tenants.active})]}),s.jsxs("div",{className:pe.stat,children:[s.jsx("span",{className:pe.statLabel,children:"Pending"}),s.jsx("span",{className:`${pe.statValue} ${pe.warning}`,children:t.tenants.pending})]}),s.jsxs("div",{className:pe.stat,children:[s.jsx("span",{className:pe.statLabel,children:"Suspended"}),s.jsx("span",{className:`${pe.statValue} ${pe.danger}`,children:t.tenants.suspended})]}),s.jsxs("div",{className:pe.stat,children:[s.jsx("span",{className:pe.statLabel,children:"Archived"}),s.jsx("span",{className:pe.statValue,children:t.tenants.archived})]})]})]}),s.jsxs("div",{className:pe.section,children:[s.jsx("h3",{children:"Database Connections"}),s.jsxs("div",{className:pe.statsRow,children:[s.jsxs("div",{className:pe.stat,children:[s.jsx("span",{className:pe.statLabel,children:"Active Pools"}),s.jsx("span",{className:pe.statValue,children:t.connections.active_pools})]}),s.jsxs("div",{className:pe.stat,children:[s.jsx("span",{className:pe.statLabel,children:"Total Connections"}),s.jsx("span",{className:pe.statValue,children:t.connections.total_connections})]})]})]}),s.jsxs("div",{className:pe.section,children:[s.jsx("h3",{children:"Server"}),s.jsxs("div",{className:pe.statsRow,children:[s.jsxs("div",{className:pe.stat,children:[s.jsx("span",{className:pe.statLabel,children:"Uptime"}),s.jsx("span",{className:pe.statValue,children:n(t.system.uptime)})]}),s.jsxs("div",{className:pe.stat,children:[s.jsx("span",{className:pe.statLabel,children:"Memory"}),s.jsxs("span",{className:pe.statValue,children:[Math.round(t.system.memory_mb)," MB"]})]})]}),s.jsxs("div",{className:pe.info,children:[s.jsx("span",{className:pe.infoLabel,children:"Python Version:"}),s.jsx("code",{className:pe.infoValue,children:t.system.python_version.split(" ")[0]})]})]})]})]}):s.jsx("div",{className:pe.container,children:s.jsx("div",{className:pe.loading,children:"Loading statistics..."})})}const yR="_overlay_rjfm1_3",vR="_modal_rjfm1_14",xR="_wide_rjfm1_27",wR="_header_rjfm1_31",jR="_title_rjfm1_39",SR="_closeBtn_rjfm1_46",CR="_body_rjfm1_66",kR="_footer_rjfm1_72",bR="_form_rjfm1_84",NR="_formGroup_rjfm1_90",DR="_formRow_rjfm1_96",$R="_label_rjfm1_102",ER="_input_rjfm1_108",TR="_select_rjfm1_109",MR="_error_rjfm1_135",IR="_btn_rjfm1_144",PR="_btnPrimary_rjfm1_159",LR="_btnSecondary_rjfm1_168",AR="_infoGrid_rjfm1_180",BR="_infoRow_rjfm1_185",RR="_infoLabel_rjfm1_192",OR="_infoValue_rjfm1_198",FR="_codeBlock_rjfm1_204",zR="_credentialsField_rjfm1_214",HR="_credentialsInput_rjfm1_220",qR="_badge_rjfm1_252",WR="_badgeSuccess_rjfm1_261",VR="_badgeWarning_rjfm1_266",UR="_badgeDanger_rjfm1_271",GR="_badgeInfo_rjfm1_276",YR="_auditLog_rjfm1_282",QR="_auditEntry_rjfm1_288",XR="_auditAction_rjfm1_298",KR="_auditMeta_rjfm1_308",ZR="_sectionTitle_rjfm1_314",W={overlay:yR,modal:vR,wide:xR,header:wR,title:jR,closeBtn:SR,body:CR,footer:kR,form:bR,formGroup:NR,formRow:DR,label:$R,input:ER,select:TR,error:MR,btn:IR,btnPrimary:PR,btnSecondary:LR,infoGrid:AR,infoRow:BR,infoLabel:RR,infoValue:OR,codeBlock:FR,credentialsField:zR,credentialsInput:HR,badge:qR,badgeSuccess:WR,badgeWarning:VR,badgeDanger:UR,badgeInfo:GR,auditLog:YR,auditEntry:QR,auditAction:XR,auditMeta:KR,sectionTitle:ZR};function JR({onClose:e,onCreated:t}){const[n,r]=f.useState({name:"",slug:"",company_name:"",admin_email:"",plan:"standard",max_users:10,max_projects:50}),[a,i]=f.useState(!1),[o,l]=f.useState(null),c=g=>{const{name:_,value:y,type:u}=g.target;r(w=>({...w,[_]:u==="number"?parseInt(y,10):y}))},d=g=>{const _=g.target.value,y=_.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");r(u=>({...u,name:_,slug:y}))},h=async g=>{g.preventDefault(),l(null),i(!0);try{const _=await xx(n);t(_)}catch(_){l(_ instanceof Error?_.message:"Failed to create tenant")}finally{i(!1)}},m=g=>{g.target===g.currentTarget&&e()};return s.jsx("div",{className:W.overlay,onClick:m,children:s.jsxs("div",{className:W.modal,children:[s.jsxs("div",{className:W.header,children:[s.jsx("h2",{className:W.title,children:"Create Tenant"}),s.jsx("button",{className:W.closeBtn,onClick:e,children:s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),s.jsxs("form",{onSubmit:h,children:[s.jsx("div",{className:W.body,children:s.jsxs("div",{className:W.form,children:[s.jsxs("div",{className:W.formGroup,children:[s.jsx("label",{className:W.label,children:"Tenant Name *"}),s.jsx("input",{type:"text",name:"name",className:W.input,value:n.name,onChange:d,placeholder:"Acme Corporation",required:!0,disabled:a})]}),s.jsxs("div",{className:W.formGroup,children:[s.jsx("label",{className:W.label,children:"URL Slug *"}),s.jsx("input",{type:"text",name:"slug",className:W.input,value:n.slug,onChange:c,placeholder:"acme-corp",pattern:"[a-z0-9-]+",required:!0,disabled:a}),s.jsxs("small",{style:{color:"var(--text-muted)",fontSize:"0.75rem"},children:["Access URL: /t/",n.slug||"slug","/"]})]}),s.jsxs("div",{className:W.formGroup,children:[s.jsx("label",{className:W.label,children:"Company Name"}),s.jsx("input",{type:"text",name:"company_name",className:W.input,value:n.company_name,onChange:c,placeholder:"Acme Corporation Inc.",disabled:a})]}),s.jsxs("div",{className:W.formGroup,children:[s.jsx("label",{className:W.label,children:"Admin Email *"}),s.jsx("input",{type:"email",name:"admin_email",className:W.input,value:n.admin_email,onChange:c,placeholder:"admin@acme.com",required:!0,disabled:a})]}),s.jsxs("div",{className:W.formRow,children:[s.jsxs("div",{className:W.formGroup,children:[s.jsx("label",{className:W.label,children:"Plan"}),s.jsxs("select",{name:"plan",className:W.select,value:n.plan,onChange:c,disabled:a,children:[s.jsx("option",{value:"trial",children:"Trial"}),s.jsx("option",{value:"standard",children:"Standard"}),s.jsx("option",{value:"professional",children:"Professional"}),s.jsx("option",{value:"enterprise",children:"Enterprise"})]})]}),s.jsxs("div",{className:W.formGroup,children:[s.jsx("label",{className:W.label,children:"Max Users"}),s.jsx("input",{type:"number",name:"max_users",className:W.input,value:n.max_users,onChange:c,min:"1",disabled:a})]})]}),s.jsxs("div",{className:W.formGroup,children:[s.jsx("label",{className:W.label,children:"Max Projects"}),s.jsx("input",{type:"number",name:"max_projects",className:W.input,value:n.max_projects,onChange:c,min:"1",disabled:a})]}),o&&s.jsx("div",{className:W.error,children:o})]})}),s.jsxs("div",{className:W.footer,children:[s.jsx("button",{type:"button",className:`${W.btn} ${W.btnSecondary}`,onClick:e,disabled:a,children:"Cancel"}),s.jsx("button",{type:"submit",className:`${W.btn} ${W.btnPrimary}`,disabled:a,children:a?"Creating...":"Create Tenant"})]})]})]})})}function eO({onClose:e,onCreated:t}){const[n,r]=f.useState({email:"",password:"",name:"",role:"admin"}),[a,i]=f.useState(!1),[o,l]=f.useState(null),c=m=>{const{name:g,value:_}=m.target;r(y=>({...y,[g]:_}))},d=async m=>{m.preventDefault(),l(null),i(!0);try{await Dx(n),t()}catch(g){l(g instanceof Error?g.message:"Failed to create admin user")}finally{i(!1)}},h=m=>{m.target===m.currentTarget&&e()};return s.jsx("div",{className:W.overlay,onClick:h,children:s.jsxs("div",{className:W.modal,children:[s.jsxs("div",{className:W.header,children:[s.jsx("h2",{className:W.title,children:"Create Admin User"}),s.jsx("button",{className:W.closeBtn,onClick:e,children:s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),s.jsxs("form",{onSubmit:d,children:[s.jsx("div",{className:W.body,children:s.jsxs("div",{className:W.form,children:[s.jsxs("div",{className:W.formGroup,children:[s.jsx("label",{className:W.label,children:"Email *"}),s.jsx("input",{type:"email",name:"email",className:W.input,value:n.email,onChange:c,placeholder:"admin@example.com",required:!0,disabled:a})]}),s.jsxs("div",{className:W.formGroup,children:[s.jsx("label",{className:W.label,children:"Password *"}),s.jsx("input",{type:"password",name:"password",className:W.input,value:n.password,onChange:c,placeholder:"",minLength:8,required:!0,disabled:a})]}),s.jsxs("div",{className:W.formGroup,children:[s.jsx("label",{className:W.label,children:"Name *"}),s.jsx("input",{type:"text",name:"name",className:W.input,value:n.name,onChange:c,placeholder:"John Doe",required:!0,disabled:a})]}),s.jsxs("div",{className:W.formGroup,children:[s.jsx("label",{className:W.label,children:"Role"}),s.jsxs("select",{name:"role",className:W.select,value:n.role,onChange:c,disabled:a,children:[s.jsx("option",{value:"admin",children:"Admin"}),s.jsx("option",{value:"superadmin",children:"Superadmin"})]})]}),o&&s.jsx("div",{className:W.error,children:o})]})}),s.jsxs("div",{className:W.footer,children:[s.jsx("button",{type:"button",className:`${W.btn} ${W.btnSecondary}`,onClick:e,disabled:a,children:"Cancel"}),s.jsx("button",{type:"submit",className:`${W.btn} ${W.btnPrimary}`,disabled:a,children:a?"Creating...":"Create Admin"})]})]})]})})}function tO({tenantId:e,onClose:t}){const[n,r]=f.useState(null),[a,i]=f.useState([]),[o,l]=f.useState(!0),[c,d]=f.useState(null);f.useEffect(()=>{h()},[e]);const h=async()=>{l(!0),d(null);try{const[u,w]=await Promise.all([vx(e),kx(e,10)]);r(u),i(w)}catch(u){d(u instanceof Error?u.message:"Failed to load tenant details")}finally{l(!1)}},m=u=>{u.target===u.currentTarget&&t()},g=u=>{const w={active:W.badgeSuccess,pending:W.badgeWarning,suspended:W.badgeDanger,archived:W.badgeInfo};return s.jsx("span",{className:`${W.badge} ${w[u]||""}`,children:u})},_=u=>u?u.accessible?s.jsx("span",{className:`${W.badge} ${W.badgeSuccess}`,children:"Connected"}):u.exists?s.jsx("span",{className:`${W.badge} ${W.badgeWarning}`,children:"Exists"}):s.jsx("span",{className:`${W.badge} ${W.badgeDanger}`,children:"Not provisioned"}):s.jsx("span",{className:W.badge,children:"Unknown"}),y=u=>new Date(u).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return s.jsx("div",{className:W.overlay,onClick:m,children:s.jsxs("div",{className:`${W.modal} ${W.wide}`,children:[s.jsxs("div",{className:W.header,children:[s.jsx("h2",{className:W.title,children:"Tenant Details"}),s.jsx("button",{className:W.closeBtn,onClick:t,children:s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),s.jsx("div",{className:W.body,children:o?s.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"var(--text-muted)"},children:"Loading..."}):c?s.jsx("div",{className:W.error,children:c}):n?s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("h3",{style:{margin:0,color:"var(--text-primary)"},children:n.name}),n.company_name&&s.jsx("p",{style:{margin:"0.25rem 0 0",color:"var(--text-muted)"},children:n.company_name})]}),s.jsxs("div",{className:W.infoGrid,children:[s.jsxs("div",{className:W.infoRow,children:[s.jsx("span",{className:W.infoLabel,children:"Slug"}),s.jsx("code",{className:W.infoValue,children:n.slug})]}),s.jsxs("div",{className:W.infoRow,children:[s.jsx("span",{className:W.infoLabel,children:"Status"}),s.jsx("span",{className:W.infoValue,children:g(n.status)})]}),s.jsxs("div",{className:W.infoRow,children:[s.jsx("span",{className:W.infoLabel,children:"Database"}),s.jsx("span",{className:W.infoValue,children:_(n.database_status)})]}),s.jsxs("div",{className:W.infoRow,children:[s.jsx("span",{className:W.infoLabel,children:"DB Name"}),s.jsx("code",{className:W.infoValue,children:n.database_name})]}),s.jsxs("div",{className:W.infoRow,children:[s.jsx("span",{className:W.infoLabel,children:"DB User"}),s.jsx("code",{className:W.infoValue,children:n.database_user})]}),s.jsxs("div",{className:W.infoRow,children:[s.jsx("span",{className:W.infoLabel,children:"Admin Email"}),s.jsx("span",{className:W.infoValue,children:n.admin_email})]}),s.jsxs("div",{className:W.infoRow,children:[s.jsx("span",{className:W.infoLabel,children:"Plan"}),s.jsx("span",{className:W.infoValue,children:n.plan})]}),s.jsxs("div",{className:W.infoRow,children:[s.jsx("span",{className:W.infoLabel,children:"Max Users"}),s.jsx("span",{className:W.infoValue,children:n.max_users})]}),s.jsxs("div",{className:W.infoRow,children:[s.jsx("span",{className:W.infoLabel,children:"Max Projects"}),s.jsx("span",{className:W.infoValue,children:n.max_projects})]}),s.jsxs("div",{className:W.infoRow,children:[s.jsx("span",{className:W.infoLabel,children:"Created"}),s.jsx("span",{className:W.infoValue,children:y(n.created_at)})]})]}),s.jsx("h4",{className:W.sectionTitle,children:"Access URL"}),s.jsxs("div",{className:W.codeBlock,children:[window.location.origin,"/t/",n.slug,"/"]}),a.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("h4",{className:W.sectionTitle,children:"Recent Activity"}),s.jsx("div",{className:W.auditLog,children:a.map(u=>s.jsxs("div",{className:W.auditEntry,children:[s.jsx("span",{className:W.auditAction,children:u.action}),s.jsxs("span",{className:W.auditMeta,children:[y(u.created_at),u.actor&&` by ${u.actor}`]})]},u.id))})]})]}):null}),s.jsx("div",{className:W.footer,children:s.jsx("button",{className:`${W.btn} ${W.btnSecondary}`,onClick:t,children:"Close"})})]})})}function nO({title:e,email:t,password:n,onClose:r}){const[a,i]=f.useState(!1),o=async()=>{const c=`Email: ${t}
Password: ${n}`;try{await navigator.clipboard.writeText(c),i(!0),setTimeout(()=>i(!1),2e3)}catch(d){console.error("Failed to copy:",d)}},l=c=>{c.target===c.currentTarget&&r()};return s.jsx("div",{className:W.overlay,onClick:l,children:s.jsxs("div",{className:W.modal,children:[s.jsxs("div",{className:W.header,children:[s.jsx("h2",{className:W.title,children:e}),s.jsx("button",{className:W.closeBtn,onClick:r,children:s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),s.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),s.jsxs("div",{className:W.body,children:[s.jsx("p",{style:{marginBottom:"1.5rem",color:"var(--text-secondary)"},children:"Please save these credentials securely. The password will not be shown again."}),s.jsxs("div",{className:W.form,children:[s.jsxs("div",{className:W.formGroup,children:[s.jsx("label",{className:W.label,children:"Email"}),s.jsx("div",{className:W.credentialsField,children:s.jsx("input",{type:"text",className:W.credentialsInput,value:t,readOnly:!0})})]}),s.jsxs("div",{className:W.formGroup,children:[s.jsx("label",{className:W.label,children:"Password"}),s.jsx("div",{className:W.credentialsField,children:s.jsx("input",{type:"text",className:W.credentialsInput,value:n,readOnly:!0})})]})]})]}),s.jsxs("div",{className:W.footer,children:[s.jsx("button",{className:`${W.btn} ${W.btnSecondary}`,onClick:r,children:"Close"}),s.jsx("button",{className:`${W.btn} ${W.btnPrimary}`,onClick:o,children:a?"Copied!":"Copy Credentials"})]})]})})}const sO="_container_1by4n_3",rO="_header_1by4n_12",aO="_headerLeft_1by4n_21",iO="_logo_1by4n_27",oO="_title_1by4n_32",lO="_headerRight_1by4n_39",cO="_userInfo_1by4n_45",dO="_roleBadge_1by4n_53",uO="_logoutBtn_1by4n_63",fO="_tabs_1by4n_81",hO="_tab_1by4n_81",mO="_active_1by4n_109",pO="_main_1by4n_119",$t={container:sO,header:rO,headerLeft:aO,logo:iO,title:oO,headerRight:lO,userInfo:cO,roleBadge:dO,logoutBtn:uO,tabs:fO,tab:hO,active:mO,main:pO};function gO(){const e=lt(S=>S.adminUser),t=lt(S=>S.activeTab),n=lt(S=>S.setActiveTab),r=lt(S=>S.setTenants),a=lt(S=>S.setSystemStats),i=lt(S=>S.setAdminUsers),o=lt(S=>S.setIsAuthenticated),l=lt(S=>S.setAdminUser),c=lt(S=>S.reset),[d,h]=f.useState(()=>Nr()),[m,g]=f.useState(!1),[_,y]=f.useState(!1),[u,w]=f.useState(null),[p,x]=f.useState(null);f.useEffect(()=>{const S=new MutationObserver(()=>{const P=document.documentElement.dataset.theme;P&&P!==d&&h(P)});return S.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>S.disconnect()},[d]),f.useEffect(()=>{v(),C()},[]),f.useEffect(()=>{t==="admins"&&N()},[t]);const v=async()=>{try{const S=await yx();r(S)}catch(S){console.error("Failed to load tenants:",S)}},C=async()=>{try{const S=await bx();a(S)}catch(S){console.error("Failed to load stats:",S)}},N=async()=>{try{const S=await Nx();i(S)}catch(S){console.error("Failed to load admin users:",S)}},b=async()=>{try{await gx()}catch(S){console.error("Logout error:",S)}finally{c(),o(!1),l(null)}},B=(S,P,I)=>{x({title:S,email:P,password:I})},M=d==="dark"?"/img/milestone_logo_dark_theme.svg":"/img/milestone_logo_light_theme.svg",L=(e==null?void 0:e.role)==="superadmin";return s.jsxs("div",{className:$t.container,children:[s.jsxs("header",{className:$t.header,children:[s.jsxs("div",{className:$t.headerLeft,children:[s.jsx("img",{src:M,alt:"Milestone",className:$t.logo}),s.jsx("h1",{className:$t.title,children:"Admin Portal"})]}),s.jsxs("div",{className:$t.headerRight,children:[s.jsxs("span",{className:$t.userInfo,children:[e==null?void 0:e.email,(e==null?void 0:e.role)==="superadmin"&&s.jsx("span",{className:$t.roleBadge,children:"Superadmin"})]}),s.jsx("button",{className:$t.logoutBtn,onClick:b,children:"Logout"})]})]}),s.jsxs("nav",{className:$t.tabs,children:[s.jsxs("button",{className:`${$t.tab} ${t==="tenants"?$t.active:""}`,onClick:()=>n("tenants"),children:[s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),s.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),"Tenants"]}),L&&s.jsxs("button",{className:`${$t.tab} ${t==="admins"?$t.active:""}`,onClick:()=>n("admins"),children:[s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"9",cy:"7",r:"4"}),s.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),s.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),"Admin Users"]}),s.jsxs("button",{className:`${$t.tab} ${t==="stats"?$t.active:""}`,onClick:()=>n("stats"),children:[s.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),s.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),s.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]}),"System Stats"]})]}),s.jsxs("main",{className:$t.main,children:[t==="tenants"&&s.jsx(J8,{onCreateNew:()=>g(!0),onViewDetails:S=>w(S),onShowCredentials:B,onRefresh:v}),t==="admins"&&L&&s.jsx(eR,{onCreateNew:()=>y(!0),onRefresh:N}),t==="stats"&&s.jsx(_R,{onRefresh:C})]}),m&&s.jsx(JR,{onClose:()=>g(!1),onCreated:()=>{v(),g(!1)}}),_&&s.jsx(eO,{onClose:()=>y(!1),onCreated:()=>{N(),y(!1)}}),u&&s.jsx(tO,{tenantId:u,onClose:()=>w(null),onShowCredentials:B,onRefresh:v}),p&&s.jsx(nO,{title:p.title,email:p.email,password:p.password,onClose:()=>x(null)})]})}function _O(){const e=lt(i=>i.isAuthenticated),t=lt(i=>i.isLoading),n=lt(i=>i.setAdminUser),r=lt(i=>i.setIsAuthenticated),a=lt(i=>i.setIsLoading);return f.useEffect(()=>{(async()=>{try{const o=await _x();o.user&&(n(o.user),r(!0))}catch{console.log("Admin not authenticated")}finally{a(!1)}})()},[n,r,a]),t?s.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",background:"var(--bg-primary)",color:"var(--text-muted)"},children:"Loading..."}):e?s.jsx(gO,{}):s.jsx(k8,{})}function yO(){const{isLoading:e,isAuthenticated:t}=Bg(),{loadAllData:n,isLoading:r}=jl(),a=O(c=>c.whatIfMode),i=O(c=>c.instanceSettings),[o,l]=f.useState(!1);return f.useEffect(()=>{const c=window.location.pathname,d=c==="/admin"||c==="/admin/"||c.startsWith("/admin/");l(d)},[]),f.useEffect(()=>{t&&!o&&n()},[t,n,o]),f.useEffect(()=>{if(o)document.title="Milestone Admin";else{const c=(i==null?void 0:i.instance_title)||"Milestone";document.title=c}},[i,o]),f.useEffect(()=>(a?document.body.classList.add("what-if-mode"):document.body.classList.remove("what-if-mode"),()=>{document.body.classList.remove("what-if-mode")}),[a]),o?s.jsx(_O,{}):e?s.jsx(hh,{}):t?r?s.jsx(hh,{message:"Loading data..."}):s.jsxs(s.Fragment,{children:[s.jsx(UB,{}),s.jsx(_M,{}),s.jsx(d8,{})]}):s.jsx(Jx,{})}Ox();Ax();bg({isWhatIfMode:()=>O.getState().whatIfMode,queueWhatIfOperation:e=>O.getState().queueWhatIfOperation(e)});const vO=new wv({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*30,retry:1,refetchOnWindowFocus:!1},mutations:{retry:0}}});pg(document.getElementById("root")).render(s.jsx(f.StrictMode,{children:s.jsx(Sv,{client:vO,children:s.jsx(yO,{})})}));
//# sourceMappingURL=index-Ufv_SA76.js.map
