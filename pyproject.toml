[tool.pytest.ini_options]
testpaths = ["tests"]
asyncio_mode = "auto"
filterwarnings = [
    "ignore::DeprecationWarning",
]
addopts = [
    "-v",
    "--strict-markers",
    "--tb=short",
]
markers = [
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "integration: marks tests requiring database or external services",
]

[tool.black]
line-length = 100
target-version = ["py311"]

[tool.isort]
profile = "black"
line_length = 100

[tool.ruff]
line-length = 100
target-version = "py311"

[tool.ruff.lint]
select = [
    "E",   # pycodestyle errors
    "W",   # pycodestyle warnings
    "F",   # pyflakes
    "I",   # isort
    "B",   # flake8-bugbear
    "UP",  # pyupgrade
]
ignore = [
    "E501", # line too long (handled by black)
    "B008", # function call in default argument (false positive for FastAPI Depends)
]

[tool.mypy]
python_version = "3.11"
warn_return_any = false
warn_unused_configs = true
ignore_missing_imports = true
disable_error_code = [
    "no-any-return",  # SQLAlchemy column values are typed as Any
    "valid-type",     # SQLAlchemy 2.0 DeclarativeBase not recognized by mypy
]

[[tool.mypy.overrides]]
module = "app.routers.mpp_import"
disable_error_code = [
    "no-any-return",
    "valid-type",
    "index",
    "union-attr",
    "var-annotated",
    "import-untyped",
]
