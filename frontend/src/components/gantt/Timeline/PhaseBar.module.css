.bar {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  padding: 0 0.375rem;
  cursor: grab;
  transition: filter var(--transition-fast);
  overflow: visible; /* Changed from hidden to allow changedBy badge to show above */
  pointer-events: auto; /* Capture events even when parent has pointer-events: none */
}

/* Clip the label text but not the badge */
.bar .label {
  overflow: hidden;
  text-overflow: ellipsis;
}

.bar:hover {
  filter: brightness(1.1);
}

.bar:active {
  cursor: grabbing;
}

.bar.subphase {
  opacity: 0.85;
  cursor: pointer; /* Subphases click to edit, no drag */
}

.label {
  font-size: 10px;
  font-weight: var(--font-weight-medium);
  color: white;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
  flex: 1;
  text-align: left;
  position: relative;
  z-index: 2;
}

.completionText {
  opacity: 0.8;
  font-size: 9px;
}

/* Completion bar (progress indicator) - thick line at top */
.completionBar {
  position: absolute;
  top: 0;
  left: 0;
  height: 4px;
  background: var(--progress-line-color, rgba(255, 255, 255, 0.9));
  border-radius: var(--radius-sm) 0 0 0;
  z-index: 2;
  pointer-events: none;
}

/* Full completion styling */
.completionBar[style*="100%"] {
  border-radius: var(--radius-sm) var(--radius-sm) 0 0;
}

/* Resize handles */
.resizeHandle {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 8px;
  cursor: ew-resize;
  z-index: 5;
  background: transparent;
  /* Touch: add pseudo-element for larger touch target */
}

.resizeHandle::after {
  content: '';
  position: absolute;
  top: -8px;
  bottom: -8px;
  left: -8px;
  right: -8px;
}

.resizeHandle:hover {
  background: rgba(255, 255, 255, 0.2);
}

.resizeHandle.left {
  left: 0;
  border-radius: var(--radius-sm) 0 0 var(--radius-sm);
}

.resizeHandle.right {
  right: 0;
  border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
}

/* Touch device: larger resize handles */
@media (hover: none) and (pointer: coarse) {
  .resizeHandle {
    width: 16px;
    background: rgba(255, 255, 255, 0.15);
  }
  
  .resizeHandle.left {
    left: -4px;
  }
  
  .resizeHandle.right {
    right: -4px;
  }
}

/* Milestone (diamond shape) - matches vanilla JS */
.milestone {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  height: 24px;
  width: auto;
  min-width: 24px;
  background: transparent;
  display: flex;
  align-items: center;
  cursor: grab;
  padding: 0;
  border-radius: 0;
  overflow: visible;
}

.milestoneDiamond {
  width: 12px;
  height: 12px;
  min-width: 12px;
  min-height: 12px;
  background: #ec4899;
  transform: rotate(45deg);
  flex-shrink: 0;
  margin: 6px;
  border-radius: 3px;
}

.milestoneLabel {
  margin-left: 2px;
  font-size: 10px;
  font-weight: 500;
  color: var(--text-primary);
  white-space: nowrap;
}

.milestone:hover .milestoneDiamond {
  filter: brightness(1.2);
}

.milestone.subphase .milestoneDiamond {
  width: 10px;
  height: 10px;
  min-width: 10px;
  min-height: 10px;
  margin: 5px;
}

.milestone.subphase {
  height: 20px;
  min-width: 20px;
}

/* Dragging state */
.bar:global(.dragging),
.milestone:global(.dragging) {
  opacity: 0.8;
  z-index: 1000;
  cursor: grabbing;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

/* Resizing state */
.bar:global(.resizing) {
  z-index: 1000;
}

/* Dependency link zones */
.linkZone {
  position: absolute;
  top: 2px;
  bottom: 2px;
  width: 16px;
  cursor: crosshair;
  z-index: 4;
  opacity: 0;
  transition: opacity 0.15s, background 0.15s;
  background: transparent;
  border-radius: 3px;
}

/* Position link zones inside the resize handles (after the 8px resize area) */
.linkZone.start {
  left: 8px;
}

.linkZone.end {
  right: 8px;
}

/* Show on hover */
.bar:hover .linkZone,
.milestone:hover .linkZone {
  opacity: 0.6;
  background: rgba(0, 0, 0, 0.15);
}

.linkZone:hover {
  opacity: 1 !important;
  background: rgba(0, 0, 0, 0.35) !important;
}

/* Dot indicator */
.linkZone::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.5);
  transition: all 0.15s;
}

.bar:hover .linkZone::after,
.milestone:hover .linkZone::after {
  width: 8px;
  height: 8px;
  background: rgba(255, 255, 255, 0.7);
}

.linkZone:hover::after {
  width: 10px;
  height: 10px;
  background: #fff;
  box-shadow: 0 0 4px rgba(0, 0, 0, 0.4);
}

/* Linking mode active - highlight all start zones */
.linkZone.linkingActive {
  opacity: 1;
  background: rgba(6, 182, 212, 0.3);
  animation: pulseLink 1s infinite;
}

.linkZone.linkingActive:hover {
  background: rgba(6, 182, 212, 0.5) !important;
}

.linkZone.linkingActive::after {
  width: 10px;
  height: 10px;
  background: var(--accent-cyan, #06b6d4);
}

/* Linking source bar */
.linkingSource {
  box-shadow: 0 0 0 2px var(--accent-cyan, #06b6d4);
}

/* Hide end zone on source bar */
.linkingSource .linkZone.end {
  opacity: 0 !important;
  pointer-events: none;
}

/* Milestone link zones - positioned outside diamond */
.linkZone.milestoneZone {
  width: 16px;
  top: 50%;
  bottom: auto;
  height: 16px;
  transform: translateY(-50%);
}

.linkZone.milestoneZone.start {
  left: -20px;
}

.linkZone.milestoneZone.end {
  right: -20px;
}

@keyframes pulseLink {
  0%, 100% { background: rgba(6, 182, 212, 0.15); }
  50% { background: rgba(6, 182, 212, 0.3); }
}

/* Critical Path - Orange Border with Subtle Glow */
.criticalPath {
  box-shadow: 0 0 6px 1px rgba(251, 146, 60, 0.4);
  border: 2px solid rgb(251, 146, 60);
  animation: criticalPathGlow 2.5s ease-in-out infinite;
  z-index: 10;
}

.criticalPath::before {
  display: none;
}

/* Critical path milestone diamond glow */
.criticalPathDiamond {
  box-shadow: 0 0 6px 1px rgba(251, 146, 60, 0.4);
  outline: 2px solid rgb(251, 146, 60);
  outline-offset: 1px;
  animation: criticalPathGlow 2.5s ease-in-out infinite;
}

/* Milestone critical path container */
.milestone.criticalPath {
  box-shadow: none;
}

.milestone.criticalPath::before {
  display: none;
}

@keyframes criticalPathGlow {
  0%, 100% {
    box-shadow: 0 0 6px 1px rgba(251, 146, 60, 0.4);
  }
  50% {
    box-shadow: 0 0 10px 2px rgba(251, 146, 60, 0.5);
  }
}

/* Recently changed indicator - shows when another user modifies this item */
.recentlyChanged {
  animation: recentChangeGlow 0.5s ease-out;
  box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.6);
}

@keyframes recentChangeGlow {
  0% {
    box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.8);
  }
  50% {
    box-shadow: 0 0 0 6px rgba(251, 191, 36, 0.4);
  }
  100% {
    box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.6);
  }
}

.changedByBadge {
  position: absolute;
  top: -18px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(251, 191, 36, 0.9);
  color: #000;
  font-size: 10px;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 4px;
  white-space: nowrap;
  z-index: 100;
  pointer-events: none;
  animation: fadeInBadge 0.3s ease-out;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

@keyframes fadeInBadge {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

/* Milestone changed badge position */
.milestone .changedByBadge {
  top: -20px;
  left: 12px;
}
